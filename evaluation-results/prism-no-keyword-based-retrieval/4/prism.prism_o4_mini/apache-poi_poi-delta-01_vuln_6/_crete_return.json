{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-delta-01_vuln_6",
  "source_directory": "/home/user/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.22284900000000002,
    "prompt_tokens": 84274,
    "completion_tokens": 29579
  },
  "variant": "sound",
  "diff": "--- a/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n+++ b/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n@@ -73,7 +73,8 @@\n     implements POIXMLTextExtractor, ExcelExtractor {\n \n     private static final Logger LOGGER = PoiLogManager.getLogger(XSSFEventBasedExcelExtractor.class);\n-    private static final Pattern MAJOR_VERSION_PATTERN = Pattern.compile(\"(-?(?:\\\\d{1,30})*)(?:\\\\.(\\\\dc?)*)\");\n+    // Maximum length for AppVersion to avoid resource exhaustion\n+    private static final int MAX_APP_VERSION_LENGTH = 200;\n     protected final OPCPackage container;\n     protected final POIXMLProperties properties;\n \n@@ -526,9 +527,21 @@\n             if (appVersionString.isEmpty()) {\n                 return;\n             }\n-            Matcher m = MAJOR_VERSION_PATTERN.matcher(appVersionString);\n-            if (m.find()) {\n-                text.append(\"MajorVersion: \").append(m.group(1)).append(\"\\n\");\n+            if (appVersionString.length() > MAX_APP_VERSION_LENGTH) {\n+                LOGGER.warn(\"Skipping AppVersion parsing, length={} exceeds safe limit\", appVersionString.length());\n+            } else {\n+                // Extract major version without regex to avoid backtracking and injection risks\n+                int idx = 0;\n+                if (appVersionString.charAt(0) == '-') {\n+                    idx = 1;\n+                }\n+                int start = idx;\n+                while (idx < appVersionString.length() && Character.isDigit(appVersionString.charAt(idx))) {\n+                    idx++;\n+                }\n+                if (idx > start) {\n+                    text.append(\"MajorVersion: \").append(appVersionString.substring(0, idx)).append(\"\\n\");\n+                }\n             }\n             appVersionBuffer.setLength(0);\n         }\n",
  "stdout": "",
  "stderr": ""
}