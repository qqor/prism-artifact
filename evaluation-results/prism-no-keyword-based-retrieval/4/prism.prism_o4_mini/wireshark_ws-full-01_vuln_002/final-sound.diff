--- a/epan/dissectors/packet-telnet.c
+++ b/epan/dissectors/packet-telnet.c
@@ -636,9 +636,11 @@
 dissect_linemode_subopt(packet_info *pinfo, const char *optname _U_, tvbuff_t *tvb _U_, int offset _U_,
                     int len _U_, proto_tree *tree _U_, proto_item *item _U_)
 {
-  if ( hf_telnet_naws_subopt_set )
+  if ( hf_telnet_naws_subopt_set ) {
     wmem_free(pinfo->pool, hf_naws_data);
-
+    hf_telnet_naws_subopt_set = 0;
+    hf_naws_data = NULL;
+  }
   return;
 }
 
@@ -2206,7 +2208,7 @@
        If this subopt is set then a method for storing the data in a given window
        is necessary.
     */
-   if ( hf_telnet_naws_subopt_set ) {
+   if ( hf_telnet_naws_subopt_set && hf_naws_data != NULL ) {
     int start_offset = hf_telnet_width * hf_telnet_line;
     tvb_get_raw_bytes_as_stringz(tvb, offset, (linelen < hf_telnet_width) ? linelen : hf_telnet_width, hf_naws_data + start_offset);
     hf_telnet_line = (hf_telnet_line + 1) % hf_telnet_height;
