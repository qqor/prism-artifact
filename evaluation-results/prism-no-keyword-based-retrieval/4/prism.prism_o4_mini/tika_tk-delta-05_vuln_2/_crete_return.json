{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.0713372,
    "prompt_tokens": 25624,
    "completion_tokens": 9807
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1157,13 +1157,17 @@\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n-            //if file already exists, prepend uuid\n+            java.nio.file.Path base = extractDir.toPath();\n+            java.nio.file.Path candidate = base.resolve(normalizedName).normalize();\n+            if (!candidate.startsWith(base)) {\n+                LOG.warn(\"Illegal entry name \\\"{}\\\" resolves outside extraction directory; using safe fallback filename.\", normalizedName);\n+                String safeName = \"file\" + count++ + ext;\n+                candidate = base.resolve(safeName);\n+            }\n+            File outputFile = candidate.toFile();\n             if (outputFile.exists()) {\n-                String fileName = FilenameUtils.getName(normalizedName);\n-                outputFile = new File(extractDir, UUID\n-                        .randomUUID()\n-                        .toString() + \"-\" + fileName);\n+                String fileName = FilenameUtils.getName(candidate.getFileName().toString());\n+                outputFile = base.resolve(UUID.randomUUID().toString() + \"-\" + fileName).toFile();\n             }\n             return outputFile;\n         }\n",
  "stdout": "",
  "stderr": ""
}