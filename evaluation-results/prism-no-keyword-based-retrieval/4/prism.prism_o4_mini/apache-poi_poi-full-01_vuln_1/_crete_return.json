{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/home/qqor/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.2069936,
    "prompt_tokens": 110348,
    "completion_tokens": 19457
  },
  "variant": "sound",
  "diff": "--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java\n+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java\n@@ -83,6 +83,10 @@\n             throws ArrayIndexOutOfBoundsException, IllegalArgumentException {\n         if (len == 0) {\n             return \"\";\n+        }\n+        if (len > MAX_RECORD_LENGTH) {\n+            throw new IllegalArgumentException(\"String length \" + len\n+                + \" exceeds max allowed \" + MAX_RECORD_LENGTH);\n         }\n         if ((offset < 0) || (offset >= string.length)) {\n             throw new ArrayIndexOutOfBoundsException(\"Illegal offset \" + offset + \" (String data is of length \" + string.length + \")\");\n\n--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n@@ -118,11 +118,15 @@\n       }\n       try(UnsynchronizedByteArrayInputStream inp = UnsynchronizedByteArrayInputStream.builder().setByteArray(parent.getData()).get()) {\n          // First up, get the number of attributes\n-         int count = LittleEndian.readInt(inp);\n-         List<MAPIAttribute> attrs = new ArrayList<>();\n-\n-         // Now, read each one in in turn\n-         for(int i=0; i<count; i++) {\n+            int count = LittleEndian.readInt(inp);\n+            if (count < 0 || count > MAX_RECORD_COUNT) {\n+                throw new IOException(\"Invalid MAPI attribute count \" + count\n+                    + \", exceeds max \" + MAX_RECORD_COUNT);\n+            }\n+            List<MAPIAttribute> attrs = new ArrayList<>();\n+\n+            // Now, read each one in in turn\n+            for(int i=0; i<count; i++) {\n             int typeAndMV = LittleEndian.readUShort(inp);\n             int id = LittleEndian.readUShort(inp);\n \n",
  "stdout": "",
  "stderr": ""
}