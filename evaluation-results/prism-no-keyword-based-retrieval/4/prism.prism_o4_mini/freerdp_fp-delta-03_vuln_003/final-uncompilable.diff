--- a/libfreerdp/codec/rfx_types.h
+++ b/libfreerdp/codec/rfx_types.h
@@ -77,6 +77,11 @@
 
 	wBufferPool* BufferPool;
 
+	/* per-context RemoteFX metadata buffer */
+	UINT8* metadataBuffer;
+	UINT8* metadataBlock;
+	UINT64 metadataData;
+	size_t metadataBufferSize;
 	/* profilers */
 	PROFILER_DEFINE(prof_rfx_decode_rgb)
 	PROFILER_DEFINE(prof_rfx_decode_component)

--- a/libfreerdp/codec/rfx.c
+++ b/libfreerdp/codec/rfx.c
@@ -326,7 +326,13 @@
 
 	/* initialize the default pixel format */
 	rfx_context_set_pixel_format(context, PIXEL_FORMAT_BGRX32);
-	/* create profilers for default decoding routines */
+	priv->BufferPool = BufferPool_New(context->log);
+
+	/* initialize metadata fields */
+	priv->metadataBuffer = NULL;
+	priv->metadataBlock  = NULL;
+	priv->metadataData   = 0;
+	priv->metadataBufferSize = 0;
 	rfx_profiler_create(context);
 	/* set up default routines */
 	context->quantization_decode = rfx_quantization_decode;
@@ -386,6 +392,10 @@
 #endif
 		}
 
+		/* free our metadata buffer first */
+		if (priv->metadataBuffer)
+			winpr_aligned_free(priv->metadataBuffer);
+		priv->metadataBuffer = NULL;
 		BufferPool_Free(priv->BufferPool);
 		winpr_aligned_free(priv);
 	}
@@ -671,12 +681,32 @@
 	Stream_Read_UINT32(
 	    s, frameIdx); /* frameIdx (4 bytes), if codec is in video mode, must be ignored */
 	Stream_Read_UINT16(s, numRegions); /* numRegions (2 bytes) */
-	if (Stream_GetRemainingLength(s) >= 8)
-	{
+	/* allocate or grow per-context metadataBuffer */
+	{
+	    size_t rem = Stream_GetRemainingLength(s);
+	    if (rem >= sizeof(UINT64))
+	    {
+	        S_RFX_CONTEXT_PRIV* priv = context->priv;
+	        /* reallocate if too small */
+	        if (priv->metadataBufferSize < rem)
+	        {
+	            if (priv->metadataBuffer)
+	                winpr_aligned_free(priv->metadataBuffer);
+	            priv->metadataBuffer = (UINT8*) winpr_aligned_malloc(16, rem);
+	            if (!priv->metadataBuffer)
+	                return FALSE;
+	            priv->metadataBufferSize = rem;
+	        }
+	        /* reset write pointer */
+	        priv->metadataBlock = priv->metadataBuffer;
+	        /* read offset and data */
 	        UINT64 blockOffset = 0;
 	        Stream_Read_UINT64(s, blockOffset);
-	        Stream_Read_UINT64(s, metadataData);
-	        metadataBlock += blockOffset;
+	        Stream_Read_UINT64(s, priv->metadataData);
+	        if (blockOffset + sizeof(UINT64) > priv->metadataBufferSize)
+	            return FALSE;
+	        priv->metadataBlock = priv->metadataBuffer + blockOffset;
+	    }
 	}
 	WLog_Print(context->priv->log, WLOG_DEBUG,
 	           "RFX_FRAME_BEGIN: frameIdx: %" PRIu32 " numRegions: %" PRIu16 "", frameIdx,
@@ -731,7 +761,8 @@
 		WLog_Print(context->priv->log, WLOG_ERROR, "invalid magic number 0x%08" PRIX32 "", magic);
 		return FALSE;
 	}
-	*(UINT64*)metadataBlock = metadataData;
+	/* write into our per-context buffer */
+	*(UINT64*)(context->priv->metadataBlock) = context->priv->metadataData;
 	return TRUE;
 }
 
