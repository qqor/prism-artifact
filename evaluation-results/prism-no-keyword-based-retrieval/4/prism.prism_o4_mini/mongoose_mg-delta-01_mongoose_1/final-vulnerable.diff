--- a/src/fmt.c
+++ b/src/fmt.c
@@ -315,16 +315,22 @@
         for (j = 0; minus && pr < w && j + pr < w; j++)
           n += scpy(out, param, &pad, 1);
       } else if (c == 'e' || c == 'E') {
-		  char tmp[8];
           double d = va_arg(*ap, double);
-          int64_t exponent = (int64_t)log10(my_fabs(d));
-          double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
-          n += scpy(out, param, tmp, k);
+          int exponent_int = (int)log10(my_fabs(d));
+          double mantissa = d / power(10, exponent_int);
+          /* Mantissa buffer: safe 40 bytes */
+          char mant_buf[40];
+          size_t pr_e = (pr == ~0U ? 6 : pr);
+          size_t k1 = mg_dtoa(mant_buf, sizeof(mant_buf), mantissa, (int)pr_e, c == 'e');
+          n += scpy(out, param, mant_buf, k1);
+          /* Emit specifier */
+          out(c, param); n++;
+          /* Exponent buffer: enlarged to avoid overflow */
+          char exp_buf[10];
+          int abs_e = exponent_int < 0 ? -exponent_int : exponent_int;
+          char sign_char = exponent_int < 0 ? '-' : '+';
+          size_t k2 = addexp(exp_buf, abs_e, sign_char);
+          n += scpy(out, param, exp_buf, k2);
 	  } else if (c == '%') {
         out('%', param);
         n++;
