--- a/lib/doh.c
+++ b/lib/doh.c
@@ -460,11 +460,12 @@
     dohp->pending++;
   }
 #endif
-
-#ifdef USE_HTTPSRR
-  /*
-   * TODO: Figure out the conditions under which we want to make
-   * a request for an HTTPS RR when we are not doing ECH. For now,
+error:
+#ifndef CURL_DISABLE_DOH
+  /* ensure any partial DOH state is fully cleaned up */
+  Curl_doh_cleanup(data);
+#endif
+  return NULL;
    * making this request breaks a bunch of DoH tests, e.g. test2100,
    * where the additional request does not match the pre-cooked data
    * files, so there is a bit of work attached to making the request
