{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-02_vuln_9",
  "source_directory": "/home/user/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 0.4714391,
    "prompt_tokens": 237005,
    "completion_tokens": 47894
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n@@ -45,6 +45,10 @@\n     protected final BitInputStream in;\n     private int clearCode = -1;\n     private int codeSize = DEFAULT_CODE_SIZE;\n+    /**\n+     * Upper bound to prevent unbounded dictionary allocations (1 << maxCodeSize).\n+     */\n+    protected static final int MAX_REASONABLE_CODE_SIZE = 16;\n     private byte previousCodeFirstChar;\n     private int previousCode = UNUSED_PREFIX;\n     private int tableSize;\n@@ -176,6 +180,10 @@\n      * @throws IllegalArgumentException if {@code maxCodeSize} is out of bounds for {@code prefixes} and {@code characters}.\n      */\n     protected void initializeTables(final int maxCodeSize) {\n+        if (maxCodeSize > MAX_REASONABLE_CODE_SIZE) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize\n+                + \" exceeds allowed maximum of \" + MAX_REASONABLE_CODE_SIZE);\n+        }\n         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException\n         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException\n         if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n@@ -205,6 +213,10 @@\n     protected void initializeTables(final int maxCodeSize, final int memoryLimiKiB) throws MemoryLimitException {\n         if (maxCodeSize <= 0) {\n             throw new IllegalArgumentException(\"maxCodeSize is \" + maxCodeSize + \", must be bigger than 0\");\n+        }\n+        if (maxCodeSize > MAX_REASONABLE_CODE_SIZE) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize\n+                + \" exceeds allowed maximum of \" + MAX_REASONABLE_CODE_SIZE);\n         }\n \n         if (memoryLimiKiB > -1) {\n",
  "stdout": "",
  "stderr": ""
}