{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-07_vuln_013",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.39061880000000004,
    "prompt_tokens": 287308,
    "completion_tokens": 16950
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-gvcp.c\n+++ b/epan/dissectors/packet-gvcp.c\n@@ -980,10 +980,14 @@\n {\n \tuint32_t value = 0;\n \t\n-\tvalue = tvb_get_letohl(tvb, offset);\n-\tgvcp_register_number[gvcp_register_count] = addr;\n-\tgvcp_register_value[gvcp_register_count++] = value;\n-\n+    value = tvb_get_letohl(tvb, offset);\n+    if (gvcp_register_count < GVCP_MAX_REGISTER_COUNT) {\n+        gvcp_register_number[gvcp_register_count] = addr;\n+        gvcp_register_value[gvcp_register_count++] = value;\n+    } else {\n+        /* Extra entries beyond GVCP_MAX_REGISTER_COUNT are dropped */\n+        return 0;\n+    }\n \tswitch (addr)\n \t{\n \tcase GVCP_VERSION:\n@@ -1778,15 +1782,22 @@\n \tproto_item *item = NULL;\n \tuint32_t addr = 0;\n \tuint32_t value = 0;\n-\tconst char *address_string = NULL;\n-\tbool is_custom_register = false;\n-\tint num_registers = length / 8; /* divide by 8 because we are counting register-value pairs */\n-\tproto_tree *subtree = NULL;\n-\n-\tif (gvcp_trans)\n-\t{\n-\t\tgvcp_trans->addr_count = num_registers;\n-\t}\n+    const char *address_string = NULL;\n+    bool is_custom_register = false;\n+    int num_registers = length / 8; /* divide by 8 because we are counting register-value pairs */\n+    proto_tree *subtree = NULL;\n+\n+    /* Reset the global-write register buffers for this command */\n+    gvcp_register_count = 0;\n+    if (num_registers > GVCP_MAX_REGISTER_COUNT) {\n+        /* Too many register/value pairs in packet; truncate to avoid overflow */\n+        num_registers = GVCP_MAX_REGISTER_COUNT;\n+    }\n+\n+    if (gvcp_trans)\n+    {\n+        gvcp_trans->addr_count = num_registers;\n+    }\n \n \taddr = tvb_get_ntohl(tvb, offset);    /* first register address to be read from WRITEREG_CMD */\n \tvalue = tvb_get_ntohl(tvb, offset+4);\n",
  "stdout": "",
  "stderr": ""
}