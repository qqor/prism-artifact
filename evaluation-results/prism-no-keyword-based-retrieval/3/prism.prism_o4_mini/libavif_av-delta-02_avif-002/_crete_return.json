{
  "project_name": "libavif",
  "vulnerability_identifier": "libavif_av-delta-02_avif-002",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libavif",
  "llm_usage": {
    "total_cost": 0.20836090000000002,
    "prompt_tokens": 128079,
    "completion_tokens": 15335
  },
  "variant": "sound",
  "diff": "--- a/src/reformat.c\n+++ b/src/reformat.c\n@@ -795,27 +795,24 @@\n                     total_spill += fabs(spill_Cb);\n                     total_spill += fabs(spill_Cr);\n                     // if spill too high, dampen\n-                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)){\n-                        int a, b;\n-                        if (i % 2 == 0){\n-                            a = 1;\n-                        }else{\n-                            a = -1;\n-                        }\n-                        if (j % 2 == 0){\n-                            b = 1;\n-                        }else{\n-                            b = -1;\n-                        }\n-                        uspill_image[i][j] -= pSpillCb;\n-                        vspill_image[i][j] -= pSpillCb;\n-                        uspill_image[i+a][j] -= pSpillCb;\n-                        vspill_image[i+a][j] -= pSpillCr;\n-                        uspill_image[i][j+b] -= pSpillCb;\n-                        vspill_image[i][j+b] -= pSpillCr;\n-                        uspill_image[i+a][j+b] -= pSpillCb;\n-                        vspill_image[i+a][j+b] -= pSpillCr;\n-                    }   \n+                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)) {\n+                        int ni = (i % 2 == 0) ? (int)i + 1 : (int)i - 1;\n+                        if (ni < 0 || (uint32_t)ni >= image->width) {\n+                            ni = i;\n+                        }\n+                        int nj = (j % 2 == 0) ? (int)j + 1 : (int)j - 1;\n+                        if (nj < 0 || (uint32_t)nj >= image->height) {\n+                            nj = j;\n+                        }\n+                        uspill_image[i][j]   -= pSpillCb;\n+                        vspill_image[i][j]   -= pSpillCr;\n+                        uspill_image[ni][j]  -= pSpillCb;\n+                        vspill_image[ni][j]  -= pSpillCr;\n+                        uspill_image[i][nj]  -= pSpillCb;\n+                        vspill_image[i][nj]  -= pSpillCr;\n+                        uspill_image[ni][nj] -= pSpillCb;\n+                        vspill_image[ni][nj] -= pSpillCr;\n+                    }\n                 }\n             }\n             // break out of iteration if improvement is small compared to the size of the image\n",
  "stdout": "",
  "stderr": ""
}