{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_010",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.8650894999999998,
    "prompt_tokens": 554181,
    "completion_tokens": 58066
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-netbios.c\n+++ b/epan/dissectors/packet-netbios.c\n@@ -687,10 +687,10 @@\n     proto_item *tf;\n \tuint8_t flag;\n \tstatic const char hex_digits[16] = {'0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'};\n-\tuint8_t *signature;\n-\tuint8_t byte;\n-\tint i = 0;\n-\tint index = 0;\n+\t/* buffer for hex-encoded signature plus NUL */\n+\tgchar signature_buf[NB_SIZE_HMAC * 2 + 1];\n+\tint raw_len;\n+\tint j, idx;\n \n     if (!tree)\n         return 0;\n@@ -702,37 +702,26 @@\n \n \tflag = tvb_get_uint8(tvb, offset + NB_DATA1);\n \n-\t/* Allocate buffer for signature field */\n-\tif (flag & 0x80) {\n-\t\tsignature = g_malloc( NB_SIZE_HMAC + 1);\n-\t} else {\n-\t\tsignature = g_malloc( NB_SIZE_TMAC + 1);\n+\t/* Hex-encode signature into stack buffer */\n+\traw_len = (flag & 0x80) ? NB_SIZE_HMAC : NB_SIZE_TMAC;\n+\tproto_tree_add_item(ttree, hf_netb_trace_id,    tvb, offset + NB_DATA2,      2, ENC_BIG_ENDIAN);\n+\tproto_tree_add_item(ttree, hf_netb_trace_timestamp, tvb, offset + NB_XMIT_CORL, 4, ENC_BIG_ENDIAN);\n+\tproto_tree_add_item(ttree, hf_netb_trace_reason, tvb, offset + NB_RMT_SES,    1, ENC_NA);\n+\tproto_tree_add_item(ttree, hf_netb_trace_initiator, tvb, offset + NB_INIT_NAME,16, ENC_ASCII | ENC_NA);\n+\tproto_tree_add_item(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, raw_len, ENC_NA);\n+\n+\tfor (j = 0, idx = 0;\n+\t     j < raw_len && tvb_offset_exists(tvb, offset + NB_SIGNATURE + j);\n+\t     ++j)\n+\t{\n+\t\tguint8 b = tvb_get_uint8(tvb, offset + NB_SIGNATURE + j);\n+\t\tsignature_buf[idx++] = hex_digits[b >> 4];\n+\t\tsignature_buf[idx++] = hex_digits[b & 0x0F];\n \t}\n-\n-\tif (signature == NULL)\n-\t\treturn 0;\n-\n-    proto_tree_add_item(ttree, hf_netb_trace_id, tvb, offset + NB_DATA2, 2, ENC_BIG_ENDIAN);\n-    proto_tree_add_item(ttree, hf_netb_trace_timestamp, tvb, offset + NB_XMIT_CORL, 4, ENC_BIG_ENDIAN);\n-    proto_tree_add_item(ttree, hf_netb_trace_reason, tvb, offset + NB_RMT_SES, 1, ENC_NA);\n-    proto_tree_add_item(ttree, hf_netb_trace_initiator, tvb, offset + NB_INIT_NAME, 16, ENC_ASCII | ENC_NA);\n-    proto_tree_add_item(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, 8, ENC_NA);\n-\n-\t/* Convert signature field to a string */\n-\twhile ( tvb_offset_exists(tvb, offset + NB_SIGNATURE + i) ) {\n-\t\tbyte = tvb_get_uint8(tvb, offset + NB_SIGNATURE + i);\n-\n-\t\tsignature[index++] = hex_digits[byte >> 4];\n-\t\tsignature[index++] = hex_digits[byte & 0x0F];\n-\n-\t\ti++;\n-\t}\n-\n-\tsignature[index] = '\\0';\n-\t\n-\tproto_tree_add_string(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, i - 1, signature);\n-\n-\tfree(signature);\n+\tsignature_buf[idx] = '\\0';\n+\tproto_tree_add_string(ttree, hf_netb_trace_signature,\n+\t                      tvb, offset + NB_SIGNATURE,\n+\t                      j, signature_buf);\n \n \treturn 0;\n }\n",
  "stdout": "",
  "stderr": ""
}