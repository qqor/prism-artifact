{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-02_vuln_3",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.8563258,
    "prompt_tokens": 438602,
    "completion_tokens": 84969
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-audiovideo-module/src/main/java/org/apache/tika/parser/m3/M3U8Parser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-audiovideo-module/src/main/java/org/apache/tika/parser/m3/M3U8Parser.java\n@@ -45,6 +45,7 @@\n import org.apache.tika.sax.EmbeddedContentHandler;\n import org.apache.tika.sax.XHTMLContentHandler;\n import org.apache.tika.utils.StringUtils;\n+import org.apache.tika.config.Field;\n \n /**\n  * Basic parser for m3u8 files\n@@ -61,6 +62,29 @@\n     private static final String EXTINF = \"#EXTINF:\";\n     private static final String ENDLIST = \"#EXT-X-ENDLIST\";\n     private static final String EXTVERSION = \"#EXT-X-VERSION:\";\n+\n+    // Configuration for M3U8Parser to control external link fetching.\n+    public static class M3U8ParserConfig {\n+        @Field(name = \"parser.m3u8.allowExternalLinks\", required = false)\n+        private boolean allowExternalLinks = false;\n+\n+        /**\n+         * Returns true if fetching of external links is permitted.\n+         */\n+        public boolean isAllowExternalLinks() {\n+            return allowExternalLinks;\n+        }\n+\n+        /**\n+         * Sets whether external links may be fetched during parsing.\n+         */\n+        public void setAllowExternalLinks(boolean allowExternalLinks) {\n+            this.allowExternalLinks = allowExternalLinks;\n+        }\n+    }\n+\n+    // Default config instance, disabled external fetching by default.\n+    private static final M3U8ParserConfig DEFAULT_CONFIG = new M3U8ParserConfig();\n     private static final String EXTKEY = \"#EXT-X-KEY:\";\n     private static final String EXTPLAYLISTTYPE = \"#EXT-X-PLAYLIST-TYPE:\";\n \n@@ -161,7 +185,16 @@\n         // split on , then the first value is the length (can be -1),\n         // the last value is the title; intermediate values are key=value format\n         metadata.add(PLAY_LIST_LINK, nextLine);\n-        if (! nextLine.startsWith(\"http\")) {\n+        if (!nextLine.startsWith(\"http\")) {\n+            return;\n+        }\n+        // SSRF protection: only fetch external links when enabled in config\n+        M3U8ParserConfig cfg = DEFAULT_CONFIG;\n+        M3U8ParserConfig userCfg = context.get(M3U8ParserConfig.class);\n+        if (userCfg != null) {\n+            cfg = userCfg;\n+        }\n+        if (!cfg.isAllowExternalLinks()) {\n             return;\n         }\n         EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n",
  "stdout": "",
  "stderr": ""
}