{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-full-01_vuln_7",
  "source_directory": "/home/user/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.2496384,
    "prompt_tokens": 150608,
    "completion_tokens": 19084
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n@@ -183,11 +183,16 @@\n \n         private PageIterator(COSDictionary node)\n         {\n+            // reset visited set to prevent cycles in malformed page trees\n+            pageSet.clear();\n+            if (node != null)\n+            {\n+                pageSet.add(node);\n+            }\n             List<COSDictionary> kids = enqueueKids(node);\n             while (!kids.isEmpty())\n             {\n                 List<COSDictionary> newKids = new ArrayList<>();\n-\n                 for (COSDictionary kid : kids)\n                 {\n                     newKids.addAll(enqueueKids(kid));\n@@ -205,23 +210,33 @@\n          */\n         private List<COSDictionary> enqueueKids(COSDictionary node)\n         {\n+            if (node == null)\n+            {\n+                return Collections.emptyList();\n+            }\n             if (isPageTreeNode(node))\n             {\n-                return getKids(node);\n+                // gather children of this page-tree node, filtering already seen ones\n+                List<COSDictionary> kids = getKids(node);\n+                List<COSDictionary> filtered = new ArrayList<>();\n+                for (COSDictionary kid : kids)\n+                {\n+                    if (pageSet.add(kid))\n+                    {\n+                        filtered.add(kid);\n+                    }\n+                }\n+                return filtered;\n             }\n             else\n             {\n-                if (node != null && COSName.PAGE.equals(node.getCOSName(COSName.TYPE)))\n+                // leaf page: enqueue if not visited\n+                if (COSName.PAGE.equals(node.getCOSName(COSName.TYPE)) && pageSet.add(node))\n                 {\n                     queue.add(node);\n                 }\n-                else\n-                {\n-                    LOG.error(\"Page skipped due to an invalid or missing type {}\",\n-                            () -> (node == null ? \"(null)\" : node.getCOSName(COSName.TYPE)));\n-                }\n-            }\n-            return Collections.EMPTY_LIST;\n+                return Collections.emptyList();\n+            }\n         }\n \n         @Override\n",
  "stdout": "",
  "stderr": ""
}