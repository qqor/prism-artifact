--- a/epan/dissectors/packet-irc.c
+++ b/epan/dissectors/packet-irc.c
@@ -542,30 +542,40 @@
  
      start_offset = offset;
  
-     tree = proto_item_add_subtree(item, ett_irc_request_command_names);
- 
-     while(tvb_offset_exists(tvb, start_offset) ) {
-         length = tvb_captured_length_remaining(tvb, start_offset);
-         end_offset = tvb_find_uint8(tvb, start_offset, length, ',');
- 
-         if ( end_offset == -1 ) {
-             proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, length, ENC_ASCII);
-             
-             memset(channel_name, 0, CHANNELLEN+1);
-             tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);
-             proto_item_append_text(tree, "Channel: %s", channel_name);
- 
-             free(channel_name);
-             return;
-         }
- 
-         memset(channel_name, 0, CHANNELLEN+1);
-         tvb_memcpy(tvb, channel_name, start_offset, length);
-         proto_item_append_text(tree, "Channel: %s", channel_name);
- 
-         proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, end_offset-start_offset, ENC_ASCII);
-         start_offset = end_offset + 1;
-     }
+    tree = proto_item_add_subtree(item, ett_irc_request_command_names);
+    start_offset = offset;
+    channel_name = (uint8_t *)malloc(CHANNELLEN + 1);
+    if (!channel_name)
+        return;
+ 
+    while (tvb_offset_exists(tvb, start_offset)) {
+        int seg_len;
+        length = tvb_captured_length_remaining(tvb, start_offset);
+        end_offset = tvb_find_uint8(tvb, start_offset, length, ',');
+
+        if (end_offset == -1) {
+            /* final segment: clamp length, add item, and exit loop */
+            seg_len = length;
+            proto_tree_add_item(tree, hf_irc_request_command_names_channel,
+                                tvb, start_offset, seg_len, ENC_ASCII);
+            memset(channel_name, 0, CHANNELLEN + 1);
+            tvb_memcpy(tvb, channel_name, start_offset,
+                       (seg_len < CHANNELLEN) ? seg_len : CHANNELLEN);
+            proto_item_append_text(tree, "Channel: %s", channel_name);
+            break;
+        }
+
+        /* intermediate segment: clamp at comma boundary */
+        seg_len = end_offset - start_offset;
+        proto_tree_add_item(tree, hf_irc_request_command_names_channel,
+                            tvb, start_offset, seg_len, ENC_ASCII);
+        memset(channel_name, 0, CHANNELLEN + 1);
+        tvb_memcpy(tvb, channel_name, start_offset,
+                   (seg_len < CHANNELLEN) ? seg_len : CHANNELLEN);
+        proto_item_append_text(tree, "Channel: %s", channel_name);
+
+        start_offset = end_offset + 1;
+    }
  
      free(channel_name);
      return;
