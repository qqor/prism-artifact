{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-full-01_vuln_8",
  "source_directory": "/home/qqor/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 1.6034326,
    "prompt_tokens": 1122218,
    "completion_tokens": 83862
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/BaseParser.java\n@@ -1168,6 +1168,7 @@\n         }\n \n         StringBuilder buffer = new StringBuilder( 11 );\n+        int count = 0;\n \n         int c;\n         while ((c = source.read()) != -1)\n@@ -1176,6 +1177,10 @@\n             if (isEOL(c))\n             {\n                 break;\n+            }\n+            if (++count > 10000)\n+            {\n+                throw new IOException(\"Line length exceeds limit: 10000 at offset \" + source.getPosition());\n             }\n             buffer.append( (char)c );\n         }\n\n--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/XrefParser.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/XrefParser.java\n@@ -102,8 +102,13 @@\n         long lastPrev = -1;\n         // ---- parse whole chain of xref tables/object streams using PREV reference\n         COSDictionary trailer = null;\n+        int chainCount = 0;\n         while (prev > 0 && prev != lastPrev)\n         {\n+            if (++chainCount > 10)\n+            {\n+                throw new IOException(\"Too many chained XRef tables: \" + chainCount);\n+            }\n             lastPrev = prev;\n             // seek to xref table\n             source.seek(prev);\n@@ -598,8 +603,14 @@\n         }\n         \n         // Xref tables can have multiple sections. Each starts with a starting object id and a count.\n+        int sectionCount = 0;\n         while(true)\n         {\n+            if (++sectionCount > 50)\n+            {\n+                LOG.warn(\"Too many XRef sections: {}\", sectionCount);\n+                return false;\n+            }\n             String currentLine = parser.readLine();\n             String[] splitString = currentLine.split(\"\\\\s\");\n             if (splitString.length != 2)\n@@ -628,6 +639,11 @@\n             catch (NumberFormatException exception)\n             {\n                 LOG.warn(\"XRefTable: invalid number of objects: {}\", currentLine);\n+                return false;\n+            }\n+            if (count < 0 || count > 50000)\n+            {\n+                LOG.warn(\"XRefTable: unrealistic object count: {}\", count);\n                 return false;\n             }\n             \n\n--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java\n@@ -1205,6 +1205,16 @@\n         {\n             return;\n         }\n+        if (isLenient())\n+        {\n+            String filterName = encryptionDictionary.getNameAsString(COSName.FILTER);\n+            int version = encryptionDictionary.getInt(COSName.V, -1);\n+            if (filterName == null || version < 0)\n+            {\n+                // malformed or unsupported encryption â€“ skip heavy setup in lenient mode\n+                return;\n+            }\n+        }\n \n         try\n         {\n",
  "stdout": "",
  "stderr": ""
}