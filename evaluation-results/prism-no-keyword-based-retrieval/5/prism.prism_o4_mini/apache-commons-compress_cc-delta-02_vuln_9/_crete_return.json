{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-02_vuln_9",
  "source_directory": "/home/qqor/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 0.33819720000000003,
    "prompt_tokens": 200260,
    "completion_tokens": 26798
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java\n@@ -21,6 +21,7 @@\n import java.io.IOException;\n import java.io.InputStream;\n import java.nio.ByteOrder;\n+import org.apache.commons.compress.compressors.CompressorException;\n \n import org.apache.commons.compress.compressors.lzw.LZWInputStream;\n \n@@ -79,7 +80,12 @@\n             throw new IOException(\"Input is not in .Z format\");\n         }\n         blockMode = (thirdByte & BLOCK_MODE_MASK) != 0;\n-        maxCodeSize = thirdByte & MAX_CODE_SIZE_MASK;\n+        final int rawMax = thirdByte & MAX_CODE_SIZE_MASK;\n+        if (rawMax < DEFAULT_CODE_SIZE || rawMax > 16) {\n+            throw new CompressorException(\"Unsupported LZW code size: \" + rawMax\n+                + \". Must be between \" + DEFAULT_CODE_SIZE + \" and 16.\");\n+        }\n+        maxCodeSize = rawMax;\n         if (blockMode) {\n             setClearCode(DEFAULT_CODE_SIZE);\n         }\n\n--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n@@ -176,6 +176,10 @@\n      * @throws IllegalArgumentException if {@code maxCodeSize} is out of bounds for {@code prefixes} and {@code characters}.\n      */\n     protected void initializeTables(final int maxCodeSize) {\n+        if (maxCodeSize > 16) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize\n+                + \" exceeds allowed maximum of 16\");\n+        }\n         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException\n         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException\n         if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n",
  "stdout": "",
  "stderr": ""
}