{
  "project_name": "libexif",
  "vulnerability_identifier": "libexif_ex-delta-03_exif-002",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libexif",
  "llm_usage": {
    "total_cost": 1.1085327000000003,
    "prompt_tokens": 498337,
    "completion_tokens": 127355
  },
  "variant": "sound",
  "diff": "--- a/libexif/exif-data.c\n+++ b/libexif/exif-data.c\n@@ -195,26 +195,27 @@\n \t\tdoff = offset + 8;\n \n \t/* Sanity checks */\n-\tif (doff >= size) {\n+\tif (size < 8 || offset > size - 8) {\n \t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n-\t\t\t\t  \"Tag starts past end of buffer (%u > %u)\", doff, size);\n+\t\t\t\t  \"Tag starts past end of buffer or invalid offset (%u + 8 > %u)\",\n+\t\t\t\t  offset, size);\n \t\treturn 0;\n \t}\n-\n+\tdoff = offset + 8;\n+\t/* Ensure the tag data of length s fits in remaining bytes */\n \tif (s > size - doff) {\n \t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n-\t\t\t\t  \"Tag data goes past end of buffer (%u > %u)\", doff+s, size);\n+\t\t\t\t  \"Tag data goes past end of buffer (%u + %u > %u)\",\n+\t\t\t\t  doff, s, size);\n \t\treturn 0;\n \t}\n-\n \tentry->data = exif_data_alloc (data, s);\n-\tif (entry->data) {\n-\t\tentry->size = s;\n-\t\tmemcpy (entry->data, d + doff, s);\n-\t} else {\n-\t\tEXIF_LOG_NO_MEMORY(data->priv->log, \"ExifData\", s);\n+\tif (!entry->data) {\n+\t\tEXIF_LOG_NO_MEMORY (data->priv->log, \"ExifData\", s);\n \t\treturn 0;\n \t}\n+\tentry->size = s;\n+\tmemcpy (entry->data, d + doff, s);\n \n \t/* If this is the MakerNote, remember the offset */\n \tif (entry->tag == EXIF_TAG_MAKER_NOTE) {\n",
  "stdout": "",
  "stderr": ""
}