--- a/src/cmsvirt.c
+++ b/src/cmsvirt.c
@@ -1094,13 +1094,25 @@
     nc2 ->ColorantCount = cmsPipelineOutputChannels(v ->Lut);
 
     // Make sure we have proper formatters
-    cmsChangeBuffersFormat(xform, TYPE_NAMED_COLOR_INDEX,
-        FLOAT_SH(0) | COLORSPACE_SH(_cmsLCMScolorSpace(v ->ExitColorSpace))
-        | BYTES_SH(2) | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)));
-
-    // Apply the transfor to colorants.
-    for (i=0; i < nColors; i++) {
-        cmsDoTransform(xform, &i, nc2 ->List[i].DeviceColorant, 1);
+    cmsChangeBuffersFormat(xform,
+        TYPE_NAMED_COLOR_INDEX
+        | BYTES_SH(2)
+        | CHANNELS_SH(1)
+        | EXTRA_SH(0)
+        | DOSWAP_SH(0)
+        | SWAPFIRST_SH(0)
+        | FLAVOR_SH(0)
+        | PREMUL_SH(0),
+        FLOAT_SH(0)
+        | COLORSPACE_SH(_cmsLCMScolorSpace(v ->ExitColorSpace))
+        | BYTES_SH(2)
+        | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)));
+
+    // Apply the transform to colorants.
+    cmsUInt16Number srcIndex;
+    for (i = 0; i < nColors; i++) {
+        srcIndex = (cmsUInt16Number) i;
+        cmsDoTransform(xform, &srcIndex, nc2 ->List[i].DeviceColorant, 1);
     }
 
     if (!cmsWriteTag(hICC, cmsSigNamedColor2Tag, (void*) nc2)) goto Error;
