{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-full-01_vuln_004",
  "source_directory": "/home/qqor/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 1.0129460000000003,
    "prompt_tokens": 588444,
    "completion_tokens": 83104
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/core/mcs.h\n+++ b/libfreerdp/core/mcs.h\n@@ -144,7 +144,7 @@\n \tBOOL globalChannelJoined;\n \tBOOL messageChannelJoined;\n \n-\tINT8 channelCount;\n+\tUINT8 channelCount;\n \trdpMcsChannel* channels;\n };\n \n\n--- a/libfreerdp/core/gcc.c\n+++ b/libfreerdp/core/gcc.c\n@@ -1854,13 +1854,19 @@\n \tif (blockLength < 4)\n \t\treturn FALSE;\n \n-\tStream_Read_UINT8(s, mcs->channelCount); /* channelCount */\n-\n-\tif (blockLength < 4 + (UINT8)mcs->channelCount * 12)\n-\t\treturn FALSE;\n-\n+\t/* Read the on-wire unsigned channel count */\n+\tStream_Read_UINT8(s, mcs->channelCount);\n+\n+\t/* Reject values larger than our allocation */\n \tif (mcs->channelCount > CHANNEL_MAX_COUNT)\n \t\treturn FALSE;\n+\n+\t/* Ensure the buffer contains enough bytes for all channel entries */\n+\t{\n+\t\tsize_t needed = 4 + (size_t)mcs->channelCount * 12;\n+\t\tif (blockLength < needed)\n+\t\t\treturn FALSE;\n+\t}\n \n \t/* channelDefArray */\n \tfor (UINT32 i = 0; i < mcs->channelCount; i++)\n",
  "stdout": "",
  "stderr": ""
}