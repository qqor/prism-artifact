{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-01_vuln_9",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.2447511,
    "prompt_tokens": 107229,
    "completion_tokens": 28818
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n@@ -360,9 +360,8 @@\n             return;\n         }\n         int added = 0;\n-        if (metadata.get(\"html_meta:exiftool_path\") != null) {\n-            added = configureExifTool(metadata.get(\"html_meta:exiftool_path\"));\n-        }\n+        // Metadata-based exiftool path configuration disabled for security reasons\n+        // added = configureExifTool(metadata.get(\"html_meta:exiftool_path\"));\n         //do anything with attrs?\n         Metadata m = new Metadata();\n         m.set(TikaCoreProperties.EMBEDDED_RESOURCE_TYPE,\n\n--- a/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java\n+++ b/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java\n@@ -287,11 +287,19 @@\n \n         // Build our command\n         String[] cmd;\n-        if (command.length == 1) {\n-            cmd = command[0].split(\" \");\n-        } else {\n-            cmd = new String[command.length];\n-            System.arraycopy(command, 0, cmd, 0, command.length);\n+        // Use provided command tokens directly and validate to avoid shell interpolation\n+        cmd = new String[command.length];\n+        System.arraycopy(command, 0, cmd, 0, command.length);\n+        // Validate executable (first token)\n+        java.io.File exeFile = new java.io.File(cmd[0]);\n+        if (!exeFile.isAbsolute() || !exeFile.exists() || !exeFile.canExecute()) {\n+            throw new org.apache.tika.exception.TikaException(\"External parser executable not valid: \" + cmd[0]);\n+        }\n+        // Validate no shell metacharacters in tokens\n+        for (String token : cmd) {\n+            if (token.matches(\".*[;&|`><].*\")) {\n+                throw new org.apache.tika.exception.TikaException(\"Invalid characters in external command token: \" + token);\n+            }\n         }\n         for (int i = 0; i < cmd.length; i++) {\n             if (cmd[i].contains(INPUT_FILE_TOKEN)) {\n@@ -308,11 +316,9 @@\n         // Execute\n         Process process = null;\n         try {\n-            if (cmd.length == 1) {\n-                process = Runtime.getRuntime().exec(cmd[0]);\n-            } else {\n-                process = Runtime.getRuntime().exec(cmd);\n-            }\n+            // Use ProcessBuilder to avoid shell interpolation\n+            ProcessBuilder pb = new ProcessBuilder(cmd);\n+            process = pb.start();\n         } catch (Exception e) {\n             LOG.warn(\"problem with process exec\", e);\n         }\n",
  "stdout": "",
  "stderr": ""
}