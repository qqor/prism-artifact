--- a/src/net_builtin.c
+++ b/src/net_builtin.c
@@ -380,6 +380,7 @@
 }
 
 static void rx_icmp(struct mg_tcpip_if *ifp, struct pkt *pkt) {
+  if (pkt->pay.len < sizeof(*pkt->icmp)) return;
   // MG_DEBUG(("ICMP %d", (int) len));
   if (pkt->icmp->type == 8 && pkt->ip != NULL && pkt->ip->dst == ifp->ip) {
     size_t hlen = sizeof(struct eth) + sizeof(struct ip) + sizeof(struct icmp);
