--- a/lib/file.c
+++ b/lib/file.c
@@ -492,8 +492,10 @@
 
     if(data->req.no_body) {
       headerlen =
-      msnprintf(header, sizeof(no_body), "%s (%ld bytes) \r\n",
-                  no_body, expected_size);
+        msnprintf(header, sizeof(header),
+                  "%s (%ld bytes) \r\n", no_body, expected_size);
+      if(headerlen < 0 || (size_t)headerlen >= sizeof(header))
+        headerlen = sizeof(header) - 1;
       result = Curl_client_write(data, CLIENTWRITE_HEADER, header, headerlen);
     }
     else {
