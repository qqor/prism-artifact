{
  "project_name": "libxml2",
  "vulnerability_identifier": "libxml2_lx-full-01_vuln_005",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libxml2",
  "llm_usage": {
    "total_cost": 3.2693375000000002,
    "prompt_tokens": 2175929,
    "completion_tokens": 199049
  },
  "variant": "vulnerable",
  "diff": "--- a/tree.c\n+++ b/tree.c\n@@ -1593,7 +1593,12 @@\n             escMode = 1;\n     }\n \n-    return(xmlNodeListGetStringInternal(doc, list, escMode));\n+    {\n+        xmlChar *tmp = xmlNodeListGetStringInternal((xmlDocPtr) doc, list, escMode);\n+        xmlChar *ret = tmp ? xmlStrdup(tmp) : NULL;\n+        xmlFree(tmp);\n+        return ret;\n+    }\n }\n \n /**\n@@ -1614,13 +1619,26 @@\n xmlChar *\n xmlNodeListGetRawString(const xmlDoc *doc, const xmlNode *list, int inLine)\n {\n-    int escMode = inLine ? 0 : 3;\n-\n-    /* backward compatibility */\n-    if (list == NULL)\n+    xmlChar *tmp = xmlNodeListGetStringInternal((xmlDocPtr) doc, list, inLine ? 0 : 3);\n+    xmlChar *ret = tmp ? xmlStrdup(tmp) : NULL;\n+    xmlFree(tmp);\n+    return(ret);\n+}\n+\n+/**\n+ * xmlNodeGetRawString:\n+ * @doc:      the document context\n+ * @cur:      the node whose content is to be obtained\n+ * @inLine:   whether entity references are substituted\n+ *\n+ * Returns a newly allocated xmlChar* which the caller must free.\n+ */\n+xmlChar *\n+xmlNodeGetRawString(const xmlDoc *doc, const xmlNode *cur, int inLine)\n+{\n+    if (cur == NULL)\n         return(NULL);\n-\n-    return(xmlNodeListGetStringInternal((xmlDocPtr) doc, list, escMode));\n+    return(xmlNodeListGetRawString(doc, cur, inLine));\n }\n \n static xmlAttrPtr\n\n--- a/include/libxml/tree.h\n+++ b/include/libxml/tree.h\n@@ -1082,6 +1082,10 @@\n \t\txmlNodeListGetRawString\t(const xmlDoc *doc,\n \t\t\t\t\t const xmlNode *list,\n \t\t\t\t\t int inLine);\n+XMLPUBFUN xmlChar *\n+\t\txmlNodeGetRawString\t(const xmlDoc *doc,\n+\t\t\t\t\t const xmlNode *cur,\n+\t\t\t\t\t int inLine);\n XMLPUBFUN int\n \t\txmlNodeSetContent\t(xmlNodePtr cur,\n \t\t\t\t\t const xmlChar *content);\n",
  "stdout": "+ FUZZER=api\r\n+ shift\r\n+ '[' '!' -v TESTCASE ']'\r\n+ TESTCASE=/testcase\r\n+ '[' '!' -f /testcase ']'\r\n+ export RUN_FUZZER_MODE=interactive\r\n+ RUN_FUZZER_MODE=interactive\r\n+ export FUZZING_ENGINE=libfuzzer\r\n+ FUZZING_ENGINE=libfuzzer\r\n+ export SKIP_SEED_CORPUS=1\r\n+ SKIP_SEED_CORPUS=1\r\n+ run_fuzzer api -runs=100 /testcase\r\nvm.mmap_rnd_bits = 28\r\n/out/api -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 3636563929\r\nINFO: Loaded 1 modules   (51273 inline 8-bit counters): 51273 [0x556a4fb65078, 0x556a4fb718c1), \r\nINFO: Loaded 1 PC tables (51273 PCs): 51273 [0x556a4fb718c8,0x556a4fc39d58), \r\n/out/api: Running 1 inputs 100 time(s) each.\r\nRunning: /testcase\r\n=================================================================\r\n==18==ERROR: AddressSanitizer: attempting double-free on 0x5020000000b0 in thread T0:\r\nSCARINESS: 42 (double-free)\r\n    #0 0x556a4f725f46 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3\r\n    #1 0x556a4f77b1ef in LLVMFuzzerTestOneInput /src/libxml2/fuzz/api.c:3580:9\r\n    #2 0x556a4f61a410 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #3 0x556a4f605685 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #4 0x556a4f60b11f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #5 0x556a4f6363c2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #6 0x7f830fb7f082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n    #7 0x556a4f5fd86d in _start (/out/api+0x1b686d)\r\n\r\nDEDUP_TOKEN: __interceptor_free--LLVMFuzzerTestOneInput--fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)\r\n0x5020000000b0 is located 0 bytes inside of 11-byte region [0x5020000000b0,0x5020000000bb)\r\nfreed by thread T0 here:\r\n    #0 0x556a4f725f46 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3\r\n    #1 0x556a4f77b1ef in LLVMFuzzerTestOneInput /src/libxml2/fuzz/api.c:3580:9\r\n    #2 0x556a4f61a410 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #3 0x556a4f605685 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #4 0x556a4f60b11f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #5 0x556a4f6363c2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #6 0x7f830fb7f082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n\r\nDEDUP_TOKEN: __interceptor_free--LLVMFuzzerTestOneInput--fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)\r\npreviously allocated by thread T0 here:\r\n    #0 0x556a4f7261df in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3\r\n    #1 0x556a4f77e0a8 in xmlFuzzMalloc /src/libxml2/fuzz/fuzz.c:127:11\r\n    #2 0x556a4f879704 in xmlStrndup /src/libxml2/xmlstring.c:57:11\r\n    #3 0x556a4f879704 in xmlStrdup /src/libxml2/xmlstring.c:82:12\r\n    #4 0x556a4f8241b8 in xmlNewComment /src/libxml2/tree.c:2601:17\r\n    #5 0x556a4f76d54c in LLVMFuzzerTestOneInput /src/libxml2/fuzz/api.c:1339:24\r\n    #6 0x556a4f61a410 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #7 0x556a4f605685 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #8 0x556a4f60b11f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #9 0x556a4f6363c2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #10 0x7f830fb7f082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n\r\nDEDUP_TOKEN: __interceptor_malloc--xmlFuzzMalloc--xmlStrndup\r\nSUMMARY: AddressSanitizer: double-free /src/libxml2/fuzz/api.c:3580:9 in LLVMFuzzerTestOneInput\r\n==18==ABORTING\r\nsubprocess command returned a non-zero exit status: 1\n",
  "stderr": "INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/libxml2:/out -v /tmp/tmpuamn7mg8:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce api -runs=100.\n"
}