--- a/epan/dissectors/packet-zbee-zdp-management.c
+++ b/epan/dissectors/packet-zbee-zdp-management.c
@@ -202,14 +202,12 @@
     channels_and_flags = tvb_get_letohl(tvb, offset);
     channels = channels_and_flags & 0xff;
 
-    /* bounds check */
-    if (channels > max_channel_count)
+    if (channels >= max_channel_count)
         return;
 
-    channels_arr = (struct ZBChannel**)malloc(sizeof(struct ZBChannel*) * max_channel_count);
-    for (i=0; i < max_channel_count; i++) {
-        channels_arr[i] = (struct ZBChannel*)malloc(sizeof(struct ZBChannel));
-        channels_arr[i]->free_text = 0;
+    channels_arr = g_malloc0(sizeof(*channels_arr) * max_channel_count);
+    for (i = 0; i < max_channel_count; i++) {
+        channels_arr[i] = g_malloc0(sizeof(*channels_arr[i]));
     }
 
     if (tree) {
@@ -240,12 +238,16 @@
             proto_item_append_text(ti, "None");
         if (channels_and_flags & 0xfff4131b) {
             for (i=0; i <= channels; i++) {
-                printf("DEBUG:\t(0x%x/0x%x)\t%d / 0x%x\t%s\n",
-                        i, channels,
-                        channels_arr[i]->channel_id,
-                        channels_arr[i]->channels,
-                        channels_arr[i]->free_text,
-                        channels_arr[i]->text);
+                {
+                    const gchar *txt = channels_arr[i]->text ? channels_arr[i]->text : "<null>";
+                    printf("DEBUG:\t(0x%x/0x%x)\t%d / 0x%x\t%d\t%s\n",
+                           i,
+                           channels,
+                           channels_arr[i]->channel_id,
+                           channels_arr[i]->channels,
+                           channels_arr[i]->free_text,
+                           txt);
+                }
             }
         }
     }
