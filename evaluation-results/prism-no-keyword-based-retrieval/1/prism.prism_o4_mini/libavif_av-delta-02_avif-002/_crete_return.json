{
  "project_name": "libavif",
  "vulnerability_identifier": "libavif_av-delta-02_avif-002",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libavif",
  "llm_usage": {
    "total_cost": 0.1662826,
    "prompt_tokens": 89046,
    "completion_tokens": 15530
  },
  "variant": "sound",
  "diff": "--- a/src/reformat.c\n+++ b/src/reformat.c\n@@ -799,22 +799,34 @@\n                         int a, b;\n                         if (i % 2 == 0){\n                             a = 1;\n-                        }else{\n+                        } else {\n                             a = -1;\n                         }\n                         if (j % 2 == 0){\n                             b = 1;\n-                        }else{\n+                        } else {\n                             b = -1;\n                         }\n-                        uspill_image[i][j] -= pSpillCb;\n-                        vspill_image[i][j] -= pSpillCb;\n-                        uspill_image[i+a][j] -= pSpillCb;\n-                        vspill_image[i+a][j] -= pSpillCr;\n-                        uspill_image[i][j+b] -= pSpillCb;\n-                        vspill_image[i][j+b] -= pSpillCr;\n-                        uspill_image[i+a][j+b] -= pSpillCb;\n-                        vspill_image[i+a][j+b] -= pSpillCr;\n+                        // clamp offsets to stay within image boundaries\n+                        if ((int)i + a < 0) { a = 0; }\n+                        if ((int)j + b < 0) { b = 0; }\n+                        if (i + (uint32_t)a >= image->width) { a = 0; }\n+                        if (j + (uint32_t)b >= image->height) { b = 0; }\n+\n+                        uspill_image[i][j]   -= pSpillCb;\n+                        vspill_image[i][j]   -= pSpillCr;\n+                        if (i + (uint32_t)a < image->width) {\n+                            uspill_image[i + a][j]   -= pSpillCb;\n+                            vspill_image[i + a][j]   -= pSpillCr;\n+                        }\n+                        if (j + (uint32_t)b < image->height) {\n+                            uspill_image[i][j + b]   -= pSpillCb;\n+                            vspill_image[i][j + b]   -= pSpillCr;\n+                        }\n+                        if ((i + (uint32_t)a < image->width) && (j + (uint32_t)b < image->height)) {\n+                            uspill_image[i + a][j + b] -= pSpillCb;\n+                            vspill_image[i + a][j + b] -= pSpillCr;\n+                        }\n                     }   \n                 }\n             }\n",
  "stdout": "",
  "stderr": ""
}