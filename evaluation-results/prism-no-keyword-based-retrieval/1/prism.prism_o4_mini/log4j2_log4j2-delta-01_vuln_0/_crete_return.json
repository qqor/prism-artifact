{
  "project_name": "log4j2",
  "vulnerability_identifier": "log4j2_log4j2-delta-01_vuln_0",
  "source_directory": "/home/qqor/crete/.cache/official-afc-logging-log4j2",
  "llm_usage": {
    "total_cost": 0.5859920000000001,
    "prompt_tokens": 334360,
    "completion_tokens": 49590
  },
  "variant": "sound",
  "diff": "--- a/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java\n+++ b/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java\n@@ -21,6 +21,7 @@\n \n import org.apache.logging.log4j.core.LogEvent;\n import org.apache.logging.log4j.core.config.plugins.Plugin;\n+import org.apache.logging.log4j.util.PropertiesUtil;\n \n /**\n  * Looks up keys from JNDI resources.\n@@ -28,7 +29,9 @@\n @Plugin(name = \"jndi\", category = \"Lookup\")\n public class JndiLookup implements StrLookup {\n \n-    private static boolean ENABLE_JNDI = true;\n+    private static final String ENABLE_JNDI_PROP = \"log4j2.enableJndiLookup\";\n+    public static final boolean ENABLE_JNDI = PropertiesUtil.getProperties()\n+        .getBooleanProperty(ENABLE_JNDI_PROP, false);\n \n     /** JNDI resourcce path prefix used in a J2EE container */\n     static final String CONTAINER_JNDI_RESOURCE_PATH_PREFIX = \"java:comp/env/\";\n@@ -40,6 +43,9 @@\n      */\n     @Override\n     public String lookup(final String key) {\n+        if (!ENABLE_JNDI) {\n+            return null;\n+        }\n         return lookup(null, key);\n     }\n \n@@ -51,7 +57,7 @@\n      */\n     @Override\n     public String lookup(final LogEvent event, final String key) {\n-        if (key == null || ! ENABLE_JNDI) {\n+        if (key == null || !ENABLE_JNDI) {\n             return null;\n         }\n \n@@ -78,10 +84,7 @@\n         return jndiName;\n     }\n \n-    public static void setEnableJndi(boolean enableJndi) {\n-        ENABLE_JNDI = enableJndi;\n-    }\n-\n+    // Removed setter for ENABLE_JNDI to enforce immutability via system property log4j2.enableJndiLookup\n     public static boolean isEnableJndi() {\n         return ENABLE_JNDI;\n     }\n\n--- a/core/src/main/java/org/apache/logging/log4j/core/lookup/Interpolator.java\n+++ b/core/src/main/java/org/apache/logging/log4j/core/lookup/Interpolator.java\n@@ -46,12 +46,16 @@\n         final Map<String, PluginType> plugins = manager.getPlugins();\n \n         for (final Map.Entry<String, PluginType> entry : plugins.entrySet()) {\n+            final String key = entry.getKey();\n+            if (\"jndi\".equals(key) && !JndiLookup.isEnableJndi()) {\n+                continue;\n+            }\n             @SuppressWarnings(\"unchecked\")\n             final Class<StrLookup> clazz = entry.getValue().getPluginClass();\n             try {\n-                lookups.put(entry.getKey(), clazz.newInstance());\n+                lookups.put(key, clazz.newInstance());\n             } catch (final Exception ex) {\n-                LOGGER.error(\"Unable to create Lookup for \" + entry.getKey(), ex);\n+                LOGGER.error(\"Unable to create Lookup for \" + key, ex);\n             }\n         }\n     }\n@@ -63,7 +67,9 @@\n         this.defaultLookup = new MapLookup(new HashMap<String, String>());\n         lookups.put(\"sys\", new SystemPropertiesLookup());\n         lookups.put(\"env\", new EnvironmentLookup());\n-        lookups.put(\"jndi\", new JndiLookup());\n+        if (JndiLookup.ENABLE_JNDI) {\n+            lookups.put(\"jndi\", new JndiLookup());\n+        }\n     }\n \n      /**\n",
  "stdout": "",
  "stderr": ""
}