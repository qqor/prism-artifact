{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-full-01_vuln_004",
  "source_directory": "/home/user/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 0.29651820000000007,
    "prompt_tokens": 135914,
    "completion_tokens": 33412
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/core/gcc.c\n+++ b/libfreerdp/core/gcc.c\n@@ -1850,15 +1850,29 @@\n \tWINPR_ASSERT(s);\n \tWINPR_ASSERT(mcs);\n \n-\tconst size_t blockLength = Stream_GetRemainingLength(s);\n-\tif (blockLength < 4)\n-\t\treturn FALSE;\n-\n-\tStream_Read_UINT8(s, mcs->channelCount); /* channelCount */\n-\n-\tif (blockLength < 4 + (UINT8)mcs->channelCount * 12)\n-\t\treturn FALSE;\n-\n+\t/* Read and validate channelCount */\n+\t{\n+\t\tsize_t rem = Stream_GetRemainingLength(s);\n+\t\tif (rem < 1)\n+\t\t\treturn FALSE;\n+\n+\t\tUINT8 count;\n+\t\tStream_Read_UINT8(s, count);\n+\t\tif (count > CHANNEL_MAX_COUNT)\n+\t\t\treturn FALSE;\n+\n+\t\tmcs->channelCount = count;\n+\n+\t\t/* Each channel entry is\n+\t\t   CHANNEL_NAME_LEN+1 bytes (Name)\n+\t\t + sizeof(UINT32)      (options)\n+\t\t + sizeof(UINT16)      (ChannelId)\n+\t\t   = entrySize bytes total */\n+\t\tconst size_t entrySize = (CHANNEL_NAME_LEN + 1) + sizeof(UINT32) + sizeof(UINT16);\n+\t\tsize_t need = (size_t)count * entrySize;\n+\t\tif (Stream_GetRemainingLength(s) < need)\n+\t\t\treturn FALSE;\n+\t}\n \tif (mcs->channelCount > CHANNEL_MAX_COUNT)\n \t\treturn FALSE;\n \n",
  "stdout": "",
  "stderr": ""
}