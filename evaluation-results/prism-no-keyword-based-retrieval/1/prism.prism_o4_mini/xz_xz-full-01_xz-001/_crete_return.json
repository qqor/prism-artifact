{
  "project_name": "xz",
  "vulnerability_identifier": "xz_xz-full-01_xz-001",
  "source_directory": "/home/qqor/crete/.cache/official-afc-xz",
  "llm_usage": {
    "total_cost": 1.0027325,
    "prompt_tokens": 462663,
    "completion_tokens": 112228
  },
  "variant": "sound",
  "diff": "--- a/src/liblzma/check/treeck.h\n+++ b/src/liblzma/check/treeck.h\n@@ -14,6 +14,7 @@\n #define STATE_CLEAR   0\n #define STATE_VISITED 1\n #define STATE_HASHED  2\n+#define STATE_FREED   3\n \n #define MAX_BLOCK_WIDTH  0x7fffffffull\n #define MAX_BLOCK_HEIGHT 0x7fffffffull\n\n--- a/src/liblzma/check/treeck.c\n+++ b/src/liblzma/check/treeck.c\n@@ -85,19 +85,32 @@\n     node->state = STATE_HASHED;\n   }\n \n-  // Free the node and edges\n-  free(node->edges);\n-  free(node);\n+  // Memory is freed later by free_tree\n \n   return sum;\n }\n \n+// Recursively free all nodes in the tree exactly once\n+static void\n+free_tree(TreeNode *node)\n+{\n+    if (!node || node->state == STATE_FREED)\n+        return;\n+    node->state = STATE_FREED;\n+    for (size_t i = 0; i < node->edge_count; ++i) {\n+        free_tree(node->edges[i]);\n+    }\n+    free(node->edges);\n+    free(node);\n+}\n+\n+// Public API: build tree, compute checksum, then free tree\n extern LZMA_API(uint32_t)\n lzma_tree(const uint8_t *buf, size_t size, uint32_t checksum)\n {\n-  unsigned long seed = hash_data(buf, size);\n-  TreeNode *root = create_tree(buf, size, 0, 16, seed, NULL);\n-  checksum ^= compute_tree_checksum(root, 0);\n-  return checksum;\n+    unsigned long seed = hash_data(buf, size);\n+    TreeNode *root = create_tree(buf, size, 0, 16, seed, NULL);\n+    checksum ^= compute_tree_checksum(root, 0);\n+    free_tree(root);\n+    return checksum;\n }\n-\n",
  "stdout": "",
  "stderr": ""
}