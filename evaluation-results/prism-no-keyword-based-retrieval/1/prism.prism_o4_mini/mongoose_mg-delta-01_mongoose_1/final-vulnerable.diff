--- a/src/fmt.c
+++ b/src/fmt.c
@@ -315,15 +315,27 @@
         for (j = 0; minus && pr < w && j + pr < w; j++)
           n += scpy(out, param, &pad, 1);
       } else if (c == 'e' || c == 'E') {
-		  char tmp[8];
           double d = va_arg(*ap, double);
+          if (pr == ~0U) pr = 6;
           int64_t exponent = (int64_t)log10(my_fabs(d));
           double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
+          k = mg_dtoa(tmp, sizeof(tmp), mantissa, (int)pr, c == 'e');
+          tmp[k++] = c;
+          tmp[k++] = (exponent < 0 ? '-' : '+');
+          unsigned long long abs_exp = (unsigned long long)(exponent < 0 ? -exponent : exponent);
+          int dig = 0;
+          unsigned long long t_exp = abs_exp;
+          do {
+              dig++;
+              t_exp /= 10;
+          } while (t_exp > 0);
+          if (dig < 2) dig = 2;
+          unsigned long long div = 1;
+          for (int i = 1; i < dig; i++) div *= 10;
+          for (int i = 0; i < dig; i++) {
+              tmp[k++] = (char)('0' + (int)((abs_exp / div) % 10));
+              div /= 10;
+          }
           n += scpy(out, param, tmp, k);
 	  } else if (c == '%') {
         out('%', param);
