{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-01_vuln_3",
  "source_directory": "/home/user/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 0.16685570000000002,
    "prompt_tokens": 90975,
    "completion_tokens": 15178
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/tar/TarArchiveEntry.java\n@@ -219,9 +219,43 @@\n      * Since they are parsed into long values, maximum length of each is the same as Long.MAX_VALUE which is 19 digits.\n      * </p>\n      */\n-    private static final Pattern PAX_EXTENDED_HEADER_FILE_TIMES_PATTERN = Pattern.compile(\n-            \"(-?(?:\\\\d{1,19}|(?:.|\\\\d)*))(?:\\\\.\\\\d{1,19})?\");\n-\n+    private static final int MAX_TIMESTAMP_LENGTH = 40;\n+    private static boolean isValidDecimalSeconds(String s) {\n+        if (s == null || s.length() == 0 || s.length() > MAX_TIMESTAMP_LENGTH) {\n+            return false;\n+        }\n+        int pos = 0, n = s.length();\n+        if (s.charAt(0) == '-') {\n+            if (n == 1) {\n+                return false;\n+            }\n+            pos++;\n+        }\n+        int dotCount = 0, intLen = 0, fracLen = 0;\n+        for (int i = pos; i < n; i++) {\n+            char c = s.charAt(i);\n+            if (c == '.') {\n+                dotCount++;\n+                if (dotCount > 1 || intLen < 1) {\n+                    return false;\n+                }\n+                continue;\n+            }\n+            if (c < '0' || c > '9') {\n+                return false;\n+            }\n+            if (dotCount == 0) {\n+                if (++intLen > 19) {\n+                    return false;\n+                }\n+            } else {\n+                if (++fracLen > 19) {\n+                    return false;\n+                }\n+            }\n+        }\n+        return intLen >= 1;\n+    }\n     private static FileTime fileTimeFromOptionalSeconds(final long seconds) {\n         return seconds <= 0 ? null : FileTimes.fromUnixTime(seconds);\n     }\n@@ -271,13 +305,7 @@\n                                                           final String value) throws IOException {\n \n         // Validate field values to prevent denial of service attacks with BigDecimal values (see JDK-6560193)\n-        Matcher fileTimesMatcher = PAX_EXTENDED_HEADER_FILE_TIMES_PATTERN.matcher(value);\n-        if (! fileTimesMatcher.matches()) {\n-            throw new IOException(\n-                    \"Corrupted PAX header. Time field value is invalid '\" + value + \"'\");\n-        }\n-        //As with the check above, exponents should not be allowed.\n-        if (value.contains(\"e\") || value.contains(\"E\")) {\n+        if (!isValidDecimalSeconds(value)) {\n             throw new IOException(\n                     \"Corrupted PAX header. Time field value is invalid '\" + value + \"'\");\n         }\n",
  "stdout": "",
  "stderr": ""
}