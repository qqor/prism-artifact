--- a/src/cmsps2.c
+++ b/src/cmsps2.c
@@ -749,7 +749,6 @@
     return 1;
 }
 
-
 static
 int EmitCIEBasedDEF(cmsIOHANDLER* m, cmsPipeline* Pipeline, cmsUInt32Number Intent, cmsCIEXYZ* BlackPoint)
 {
@@ -757,8 +756,13 @@
     const char* PostMaj;
     const char* PreMin, *PostMin;
     cmsStage* mpe;
-        
+
+    if (Pipeline == NULL) return 0;
     mpe = Pipeline->Elements;
+    if (mpe == NULL) {
+        cmsSignalError(m->ContextID, cmsERROR_COLORSPACE_CHECK, "Empty pipeline in EmitCIEBasedDEF");
+        return 0;
+    }
 
     switch (cmsStageInputChannels(mpe)) {
     case 3:
@@ -792,7 +796,7 @@
         mpe = mpe ->Next;
     }
 
-    if (cmsStageType(mpe) == cmsSigCLutElemType) {
+    if (mpe != NULL && cmsStageType(mpe) == cmsSigCLutElemType) {
 
             _cmsIOPrintf(m, "/Table ");
             WriteCLUT(m, mpe, PreMaj, PostMaj, PreMin, PostMin, FALSE, (cmsColorSpaceSignature) 0);
