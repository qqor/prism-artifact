{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_010",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.6525145,
    "prompt_tokens": 389527,
    "completion_tokens": 50917
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-netbios.c\n+++ b/epan/dissectors/packet-netbios.c\n@@ -685,7 +685,7 @@\n {/* Handle the TERMINATE TRACE command. See RFC 1002 5.2.3 */\n \tproto_tree *ttree;\n     proto_item *tf;\n-\tuint8_t flag;\n+/* removed unused flag */\n \tstatic const char hex_digits[16] = {'0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'};\n \tuint8_t *signature;\n \tuint8_t byte;\n@@ -700,16 +700,11 @@\n \n     proto_tree_add_item(ttree, hf_netb_trace_flags, tvb, offset + NB_DATA1, 1, ENC_NA);\n \n-\tflag = tvb_get_uint8(tvb, offset + NB_DATA1);\n-\n-\t/* Allocate buffer for signature field */\n-\tif (flag & 0x80) {\n-\t\tsignature = g_malloc( NB_SIZE_HMAC + 1);\n-\t} else {\n-\t\tsignature = g_malloc( NB_SIZE_TMAC + 1);\n-\t}\n-\n-\tif (signature == NULL)\n+\t/* Allocate buffer for signature field: 8 raw bytes -> 2 hex chars each + null */\n+\tconst int sig_len = 8;\n+\tconst int buf_size = (sig_len * 2) + 1;\n+\tsignature = g_malloc(buf_size);\n+\tif (!signature)\n \t\treturn 0;\n \n     proto_tree_add_item(ttree, hf_netb_trace_id, tvb, offset + NB_DATA2, 2, ENC_BIG_ENDIAN);\n@@ -718,19 +713,14 @@\n     proto_tree_add_item(ttree, hf_netb_trace_initiator, tvb, offset + NB_INIT_NAME, 16, ENC_ASCII | ENC_NA);\n     proto_tree_add_item(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, 8, ENC_NA);\n \n-\t/* Convert signature field to a string */\n-\twhile ( tvb_offset_exists(tvb, offset + NB_SIGNATURE + i) ) {\n+\tfor (i = 0, index = 0; i < sig_len && tvb_offset_exists(tvb, offset + NB_SIGNATURE + i); i++) {\n \t\tbyte = tvb_get_uint8(tvb, offset + NB_SIGNATURE + i);\n-\n \t\tsignature[index++] = hex_digits[byte >> 4];\n \t\tsignature[index++] = hex_digits[byte & 0x0F];\n-\n-\t\ti++;\n \t}\n-\n \tsignature[index] = '\\0';\n-\t\n-\tproto_tree_add_string(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, i - 1, signature);\n+\n+\tproto_tree_add_string(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, i, signature);\n \n \tfree(signature);\n \n",
  "stdout": "",
  "stderr": ""
}