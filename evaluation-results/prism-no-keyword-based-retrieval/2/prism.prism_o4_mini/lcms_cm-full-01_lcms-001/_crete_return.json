{
  "project_name": "lcms",
  "vulnerability_identifier": "lcms_cm-full-01_lcms-001",
  "source_directory": "/home/qqor/crete/.cache/official-afc-little-cms",
  "llm_usage": {
    "total_cost": 0.7468549000000001,
    "prompt_tokens": 363455,
    "completion_tokens": 78876
  },
  "variant": "sound",
  "diff": "--- a/src/cmsps2.c\n+++ b/src/cmsps2.c\n@@ -753,13 +753,13 @@\n static\n int EmitCIEBasedDEF(cmsIOHANDLER* m, cmsPipeline* Pipeline, cmsUInt32Number Intent, cmsCIEXYZ* BlackPoint)\n {\n+    if (Pipeline == NULL || Pipeline->Elements == NULL)\n+        return 0;\n+\n     const char* PreMaj;\n     const char* PostMaj;\n     const char* PreMin, *PostMin;\n-    cmsStage* mpe;\n-        \n-    mpe = Pipeline->Elements;\n-\n+    cmsStage* mpe = Pipeline->Elements;\n     switch (cmsStageInputChannels(mpe)) {\n     case 3:\n         _cmsIOPrintf(m, \"[ /CIEBasedDEF\\n\");\n@@ -783,20 +783,17 @@\n \n     _cmsIOPrintf(m, \"<<\\n\");\n \n-    if (cmsStageType(mpe) == cmsSigCurveSetElemType) {\n-\n+    if (mpe != NULL && cmsStageType(mpe) == cmsSigCurveSetElemType) {\n         _cmsIOPrintf(m, \"/DecodeDEF [ \");\n         EmitNGamma(m, cmsStageOutputChannels(mpe), _cmsStageGetPtrToCurveSet(mpe));\n         _cmsIOPrintf(m, \"]\\n\");\n-\n-        mpe = mpe ->Next;\n-    }\n-\n-    if (cmsStageType(mpe) == cmsSigCLutElemType) {\n-\n-            _cmsIOPrintf(m, \"/Table \");\n-            WriteCLUT(m, mpe, PreMaj, PostMaj, PreMin, PostMin, FALSE, (cmsColorSpaceSignature) 0);\n-            _cmsIOPrintf(m, \"]\\n\");\n+        mpe = mpe->Next;\n+    }\n+\n+    if (mpe != NULL && cmsStageType(mpe) == cmsSigCLutElemType) {\n+        _cmsIOPrintf(m, \"/Table \");\n+        WriteCLUT(m, mpe, PreMaj, PostMaj, PreMin, PostMin, FALSE, (cmsColorSpaceSignature)0);\n+        _cmsIOPrintf(m, \"]\\n\");\n     }\n \n     EmitLab2XYZ(m);\n",
  "stdout": "",
  "stderr": ""
}