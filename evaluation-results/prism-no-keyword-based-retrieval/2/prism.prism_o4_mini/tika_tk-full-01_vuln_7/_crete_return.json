{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_7",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.1556016,
    "prompt_tokens": 68776,
    "completion_tokens": 18170
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n@@ -19,7 +19,7 @@\n import java.io.Serializable;\n import java.util.HashMap;\n import java.util.Map;\n-\n+import org.apache.tika.config.Field;\n public class TextAndCSVConfig implements Serializable {\n \n     private static final Map<Character, String> DELIMITER_TO_NAME_MAP = new HashMap<>();\n@@ -41,6 +41,16 @@\n     private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;\n     private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;\n \n+    @Field\n+    private boolean allowExternalFetch = false;\n+\n+    public boolean isAllowExternalFetch() {\n+        return allowExternalFetch;\n+    }\n+\n+    public void setAllowExternalFetch(boolean allowExternalFetch) {\n+        this.allowExternalFetch = allowExternalFetch;\n+    }\n     public Map<String, Character> getNameToDelimiterMap() {\n         return nameToDelimiterMap;\n     }\n\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n@@ -268,6 +268,12 @@\n     private void processURL(String urlString, String name, XHTMLContentHandler xhtml,\n                             Metadata parentMetadata,\n                             ParseContext context) throws IOException, SAXException {\n+        TextAndCSVConfig cfg = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);\n+        if (!cfg.isAllowExternalFetch()) {\n+            parentMetadata.set(TikaCoreProperties.EMBEDDED_EXCEPTION,\n+                    \"Skipped external fetch for URL: \" + urlString);\n+            return;\n+        }\n         EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n         Metadata metadata = new Metadata();\n         metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);\n",
  "stdout": "",
  "stderr": ""
}