[2;36m[12/23/25 17:40:58][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=369598;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=824477;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmps7ywxehb[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_o4_mini/tika_tk-full-01_vuln_7/[0m[95magent-output-176[0m [2m               [0m
[2;36m                    [0m         [95m6479258.8943489[0m                                                                      [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/tika_tk-full-01_vuln_7.toml             [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=209493;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=140906;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:42:58][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m119.38[0m ]8;id=845165;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=803495;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=891423;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=523386;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=225426;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=250153;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=589545;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=407131;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m119[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=356644;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=778113;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.61[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=713319;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=103659;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/23/25 17:43:00][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=288594;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=311098;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=159500;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=109778;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m[12/23/25 17:43:01][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=136016;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=69029;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=104842;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=170206;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:43:04][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m3.12[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=978906;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=699244;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=794696;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=37982;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:43:05][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.55[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=434073;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=85882;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/23/25 17:43:15][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=224408;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=112645;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium:      [2m                [0m
[2;36m                    [0m         Server Side Request Forgery [1m([0mSSRF[1m)[0m                                                  [2m                [0m
[2;36m                    [0m         Attempted connection to: jazzer.com:[1;36m443[0m                                             [2m                [0m
[2;36m                    [0m         Requests to destinations based on untrusted data could lead to exfiltration of      [2m                [0m
[2;36m                    [0m         sensitive data or exposure of internal services.                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf[0m[1m([0mServerSi [2m                [0m
[2;36m                    [0m         deRequestForgery.jav[1;92ma:127[0m[1m)[0m                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket[0m[1m([0mSe [2m                [0m
[2;36m                    [0m         rverSideRequestForgery.jav[1;92ma:71[0m[1m)[0m                                                     [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.net.Socket.connect[0m[1m([0mSocket.jav[1;92ma:633[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35msun.security.ssl.SSLSocketImpl.connect[0m[1m([0mSSLSocketImpl.jav[1;92ma:299[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at java.base/[1;35msun.net.NetworkClient.doConnect[0m[1m([0mNetworkClient.jav[1;92ma:178[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at java.base/[1;35msun.net.www.http.HttpClient.openServer[0m[1m([0mHttpClient.jav[1;92ma:498[0m[1m)[0m    [2m                [0m
[2;36m                    [0m                 at java.base/[1;35msun.net.www.http.HttpClient.openServer[0m[1m([0mHttpClient.jav[1;92ma:603[0m[1m)[0m    [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/sun.net.www.protocol.https.HttpsClient.[1m<[0m[1;95minit[0m[39m>[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:266[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsClient.New[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:380[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpC[0m [2m                [0m
[2;36m                    [0m         [1;35mlient[0m[1;39m([0m[39mAbstractDelegateHttpsURLConnection.jav[0m[1;92ma:189[0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect0[0m[1;39m([0m[39mHttpURLConnecti[0m [2m                [0m
[2;36m                    [0m         [39mon.jav[0m[1;92ma:1242[0m[1;39m)[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect[0m[1;39m([0m[39mHttpURLConnectio[0m [2m                [0m
[2;36m                    [0m         [39mn.jav[0m[1;92ma:1128[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect[0m[1;39m([0m[39mAbs[0m [2m                [0m
[2;36m                    [0m         [39mtractDelegateHttpsURLConnection.jav[0m[1;92ma:175[0m[1;39m)[0m                                           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream0[0m[1;39m([0m[39mHttpURLConnec[0m [2m                [0m
[2;36m                    [0m         [39mtion.jav[0m[1;92ma:1665[0m[1;39m)[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream[0m[1;39m([0m[39mHttpURLConnect[0m [2m                [0m
[2;36m                    [0m         [39mion.jav[0m[1;92ma:1589[0m[1;39m)[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream[0m[1;39m([0m[39mHttpsURL[0m [2m                [0m
[2;36m                    [0m         [39mConnectionImpl.jav[0m[1;92ma:224[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processURL[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:278[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processCell[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:261[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.parse[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:211[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.parseOne[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:57[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:4[0m [2m                [0m
[2;36m                    [0m         [1;92m1[0m[1;39m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: 092377579d0e2656[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: [0m     [2m                [0m
[2;36m                    [0m         [39mServer Side Request Forgery [0m[1;39m([0m[39mSSRF[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [39mAttempted connection to: jazzer.com:[0m[1;36m443[0m                                             [2m                [0m
[2;36m                    [0m         [39mRequests to destinations based on untrusted data could lead to exfiltration of [0m     [2m                [0m
[2;36m                    [0m         [39msensitive data or exposure of internal services.[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf[0m[1;39m([0m[39mServerSi[0m [2m                [0m
[2;36m                    [0m         [39mdeRequestForgery.jav[0m[1;92ma:127[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket[0m[1;39m([0m[39mSe[0m [2m                [0m
[2;36m                    [0m         [39mrverSideRequestForgery.jav[0m[1;92ma:71[0m[1;39m)[0m                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.net.Socket.connect[0m[1;39m([0m[39mSocket.jav[0m[1;92ma:633[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.security.ssl.SSLSocketImpl.connect[0m[1;39m([0m[39mSSLSocketImpl.jav[0m[1;92ma:299[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.NetworkClient.doConnect[0m[1;39m([0m[39mNetworkClient.jav[0m[1;92ma:178[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:498[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:603[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/sun.net.www.protocol.https.HttpsClient.<init[0m[1m>[0m[1m([0mHttpsClient.jav[1;92ma:266[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.https.HttpsClient.New[0m[1m([0mHttpsClient.jav[1;92ma:380[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpC[0m [2m                [0m
[2;36m                    [0m         [1;35mlient[0m[1m([0mAbstractDelegateHttpsURLConnection.jav[1;92ma:189[0m[1m)[0m                                  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect0[0m[1m([0mHttpURLConnecti [2m                [0m
[2;36m                    [0m         on.jav[1;92ma:1242[0m[1m)[0m                                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect[0m[1m([0mHttpURLConnectio [2m                [0m
[2;36m                    [0m         n.jav[1;92ma:1128[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect[0m[1m([0mAbs [2m                [0m
[2;36m                    [0m         tractDelegateHttpsURLConnection.jav[1;92ma:175[0m[1m)[0m                                           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream0[0m[1m([0mHttpURLConnec [2m                [0m
[2;36m                    [0m         tion.jav[1;92ma:1665[0m[1m)[0m                                                                     [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream[0m[1m([0mHttpURLConnect [2m                [0m
[2;36m                    [0m         ion.jav[1;92ma:1589[0m[1m)[0m                                                                      [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/[1;35msun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream[0m[1m([0mHttpsURL [2m                [0m
[2;36m                    [0m         ConnectionImpl.jav[1;92ma:224[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processURL[0m[1m([0mTextAndCSVParser.jav[1;92ma:278[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processCell[0m[1m([0mTextAndCSVParser.jav[1;92ma:261[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.parse[0m[1m([0mTextAndCSVParser.jav[1;92ma:211[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.parseOne[0m[1m([0mTextAndCSVParserFuzzer.jav[1;92ma:57[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.fuzzerTestOneInput[0m[1m([0mTextAndCSVParserFuzzer.jav[1;92ma:4[0m [2m                [0m
[2;36m                    [0m         [1;92m1[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: 092377579d0e2656                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[12/23/25 17:43:19][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=869075;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=464923;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/23/25 17:44:24][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=988905;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=945671;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/23/25 17:45:20][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=931230;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=917782;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=91544;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=846052;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.54[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=892268;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=97653;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/23/25 17:45:21][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=356072;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=685723;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpa6ffqotn[0m                                                 ]8;id=546083;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=632912;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[12/23/25 17:46:53][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m92.60[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=252903;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=75179;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=43062;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=900296;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:47:23][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m29.97[0m seconds;                ]8;id=415377;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=405661;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=405194;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=902678;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:47:33][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m9.58[0m seconds; [33mexception[0m=[3;91mFalse[0m    ]8;id=220712;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=987453;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=993506;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=572695;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=915087;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=702379;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=229724;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=622811;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.57[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=541506;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=346003;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/23/25 17:47:35][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=982793;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=146824;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/23/25 17:47:36][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.58[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=834378;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=201053;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=166140;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=61323;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.58[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=276087;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=788048;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/23/25 17:47:37][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=455352;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=487119;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         ---                                                                                 [2m                [0m
[2;36m                    [0m         a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text [2m                [0m
[2;36m                    [0m         -module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java              [2m                [0m
[2;36m                    [0m         +++                                                                                 [2m                [0m
[2;36m                    [0m         b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text [2m                [0m
[2;36m                    [0m         -module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java              [2m                [0m
[2;36m                    [0m         @@ [1;36m-19[0m,[1;36m7[0m +[1;36m19[0m,[1;36m7[0m @@                                                                   [2m                [0m
[2;36m                    [0m          import java.io.Serializable;                                                       [2m                [0m
[2;36m                    [0m          import java.util.HashMap;                                                          [2m                [0m
[2;36m                    [0m          import java.util.Map;                                                              [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         +import org.apache.tika.config.Field;                                               [2m                [0m
[2;36m                    [0m          public class TextAndCSVConfig implements Serializable [1m{[0m                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m              private static final Map[1m<[0m[1;95mCharacter[0m[39m, String> DELIMITER_TO_NAME_MAP = new [0m       [2m                [0m
[2;36m                    [0m         [39mHashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m@@ [0m[1;36m-41[0m[39m,[0m[1;36m6[0m[39m +[0m[1;36m41[0m[39m,[0m[1;36m16[0m[39m @@[0m                                                                  [2m                [0m
[2;36m                    [0m         [39m     private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;[0m     [2m                [0m
[2;36m                    [0m         [39m     private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;[0m     [2m                [0m
[2;36m                    [0m         [39m [0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m+    @Field[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m+    private boolean allowExternalFetch = false;[0m                                    [2m                [0m
[2;36m                    [0m         [39m+[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m+    public boolean [0m[1;35misAllowExternalFetch[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [39m+        return allowExternalFetch;[0m                                                 [2m                [0m
[2;36m                    [0m         [39m+    [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m+[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m+    public void [0m[1;35msetAllowExternalFetch[0m[1;39m([0m[39mboolean allowExternalFetch[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [39m+        this.allowExternalFetch = allowExternalFetch;[0m                              [2m                [0m
[2;36m                    [0m         [39m+    [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m     public Map<String, Character> [0m[1;35mgetNameToDelimiterMap[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [39m         return nameToDelimiterMap;[0m                                                 [2m                [0m
[2;36m                    [0m         [39m     [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m--- [0m                                                                                [2m                [0m
[2;36m                    [0m         [39ma/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text[0m [2m                [0m
[2;36m                    [0m         [39m-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java[0m              [2m                [0m
[2;36m                    [0m         [39m+++ [0m                                                                                [2m                [0m
[2;36m                    [0m         [39mb/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text[0m [2m                [0m
[2;36m                    [0m         [39m-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java[0m              [2m                [0m
[2;36m                    [0m         [39m@@ [0m[1;36m-268[0m[39m,[0m[1;36m6[0m[39m +[0m[1;36m268[0m[39m,[0m[1;36m12[0m[39m @@[0m                                                                [2m                [0m
[2;36m                    [0m         [39m     private void [0m[1;35mprocessURL[0m[1;39m([0m[39mString urlString, String name, XHTMLContentHandler [0m    [2m                [0m
[2;36m                    [0m         [39mxhtml,[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m                             Metadata parentMetadata,[0m                               [2m                [0m
[2;36m                    [0m         [39m                             ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m+        TextAndCSVConfig cfg = [0m[1;35mcontext.get[0m[1;39m([0m[39mTextAndCSVConfig.class, [0m                [2m                [0m
[2;36m                    [0m         [39mdefaultTextAndCSVConfig[0m[1;39m)[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [39m+        if [0m[1;39m([0m[39m![0m[1;35mcfg.isAllowExternalFetch[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [39m+            [0m[1;35mparentMetadata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_EXCEPTION,[0m              [2m                [0m
[2;36m                    [0m         [39m+                    [0m[32m"Skipped external fetch for URL: "[0m[39m + urlString[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m+            return;[0m                                                                [2m                [0m
[2;36m                    [0m         [39m+        [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m         EmbeddedDocumentExtractor ex = [0m                                            [2m                [0m
[2;36m                    [0m         [1;35mEmbeddedDocumentUtil.getEmbeddedDocumentExtractor[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [39m         Metadata metadata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [39m         [0m[1;35mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===Patch [0m[33mResult[0m[39m===[0m                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: [0m     [2m                [0m
[2;36m                    [0m         [39mServer Side Request Forgery [0m[1;39m([0m[39mSSRF[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [39mAttempted connection to: jazzer.com:[0m[1;36m443[0m                                             [2m                [0m
[2;36m                    [0m         [39mRequests to destinations based on untrusted data could lead to exfiltration of [0m     [2m                [0m
[2;36m                    [0m         [39msensitive data or exposure of internal services.[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf[0m[1;39m([0m[39mServerSi[0m [2m                [0m
[2;36m                    [0m         [39mdeRequestForgery.jav[0m[1;92ma:127[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket[0m[1;39m([0m[39mSe[0m [2m                [0m
[2;36m                    [0m         [39mrverSideRequestForgery.jav[0m[1;92ma:71[0m[1;39m)[0m                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.net.Socket.connect[0m[1;39m([0m[39mSocket.jav[0m[1;92ma:633[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.security.ssl.SSLSocketImpl.connect[0m[1;39m([0m[39mSSLSocketImpl.jav[0m[1;92ma:299[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.NetworkClient.doConnect[0m[1;39m([0m[39mNetworkClient.jav[0m[1;92ma:178[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:498[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:603[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/sun.net.www.protocol.https.HttpsClient.<init>[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:266[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsClient.New[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:380[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpC[0m [2m                [0m
[2;36m                    [0m         [1;35mlient[0m[1;39m([0m[39mAbstractDelegateHttpsURLConnection.jav[0m[1;92ma:189[0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect0[0m[1;39m([0m[39mHttpURLConnecti[0m [2m                [0m
[2;36m                    [0m         [39mon.jav[0m[1;92ma:1242[0m[1;39m)[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect[0m[1;39m([0m[39mHttpURLConnectio[0m [2m                [0m
[2;36m                    [0m         [39mn.jav[0m[1;92ma:1128[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect[0m[1;39m([0m[39mAbs[0m [2m                [0m
[2;36m                    [0m         [39mtractDelegateHttpsURLConnection.jav[0m[1;92ma:175[0m[1;39m)[0m                                           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream0[0m[1;39m([0m[39mHttpURLConnec[0m [2m                [0m
[2;36m                    [0m         [39mtion.jav[0m[1;92ma:1665[0m[1;39m)[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream[0m[1;39m([0m[39mHttpURLConnect[0m [2m                [0m
[2;36m                    [0m         [39mion.jav[0m[1;92ma:1589[0m[1;39m)[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream[0m[1;39m([0m[39mHttpsURL[0m [2m                [0m
[2;36m                    [0m         [39mConnectionImpl.jav[0m[1;92ma:224[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processURL[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:278[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processCell[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:261[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.parse[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:211[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.parseOne[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:57[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:4[0m [2m                [0m
[2;36m                    [0m         [1;92m1[0m[1;39m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: 092377579d0e2656[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===Evaluation [0m[33mReport[0m[39m===[0m                                                             [2m                [0m
[2;36m                    [0m         [39m# Evaluation Report[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Summary[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mA Jazzer fuzzing run detected a Server Side Request Forgery [0m[1;39m([0m[39mSSRF[0m[1;39m)[0m[39m issue in the CSV[0m [2m                [0m
[2;36m                    [0m         [39mparsing functionality. During parsing, an attempt was made to open an HTTPS [0m        [2m                [0m
[2;36m                    [0m         [39mconnection to “jazzer.com:[0m[1;36m443[0m[39m” using untrusted input data. This triggered the [0m      [2m                [0m
[2;36m                    [0m         [39mJazzer `FuzzerSecurityIssueMedium` sanitizer, indicating a medium-severity SSRF [0m    [2m                [0m
[2;36m                    [0m         [39mfinding.[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Description[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- Issue Observed  [0m                                                                  [2m                [0m
[2;36m                    [0m         [39m  During a fuzzing session with Jazzer, the CSV parser in Apache Tika tried to [0m     [2m                [0m
[2;36m                    [0m         [39mestablish a network connection to an external host [0m[1;39m([0m[39m`jazzer.com:[0m[1;36m443[0m[39m`[0m[1;39m)[0m[39m. The built-in[0m [2m                [0m
[2;36m                    [0m         [39mSSRF sanitizer [0m[1;39m([0m[39m`ServerSideRequestForgery.checkSsrf`[0m[1;39m)[0m[39m intercepted the call and [0m     [2m                [0m
[2;36m                    [0m         [39mraised a `FuzzerSecurityIssueMedium`.[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- Vulnerability Type  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m  The sanitizer explicitly identifies the issue as Server Side Request Forgery [0m     [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mSSRF[0m[1;39m)[0m[39m. SSRF vulnerabilities occur when untrusted input is used to make network [0m    [2m                [0m
[2;36m                    [0m         [39mrequests, potentially exposing internal services or leaking sensitive data.[0m         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- Key Findings  [0m                                                                    [2m                [0m
[2;36m                    [0m         [39m  • The exception stack trace pinpoints the failure in [0m                             [2m                [0m
[2;36m                    [0m         [39m`ServerSideRequestForgery.checkSsrf` and `checkSsrfSocket`, showing the sanitizer’s[0m [2m                [0m
[2;36m                    [0m         [39minvolvement.  [0m                                                                      [2m                [0m
[2;36m                    [0m         [39m  • The network call originates from Java’s standard library [0m                       [2m                [0m
[2;36m                    [0m         [1;39m([0m[39m`java.net.Socket.connect`, `HttpsURLConnectionImpl.getInputStream`[0m[1;39m)[0m[39m invoked by [0m    [2m                [0m
[2;36m                    [0m         [39mTika’s CSV parser [0m[1;39m([0m[39m`TextAndCSVParser.processURL`[0m[1;39m)[0m[39m.  [0m                                [2m                [0m
[2;36m                    [0m         [39m  • The parser’s cell-processing routine [0m[1;39m([0m[39m`processCell` and `parse`[0m[1;39m)[0m[39m is where the [0m  [2m                [0m
[2;36m                    [0m         [39muntrusted URL is passed through to a network request.[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- Code Areas for Investigation  [0m                                                    [2m                [0m
[2;36m                    [0m         [39m  To gain a holistic understanding of the issue, review the following locations:  [0m  [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m1[0m[39m. org.apache.tika.parser.csv.TextAndCSVParser.processURL  [0m                       [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m2[0m[39m. org.apache.tika.parser.csv.TextAndCSVParser.processCell  [0m                      [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m3[0m[39m. org.apache.tika.parser.csv.TextAndCSVParser.parse  [0m                            [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m4[0m[39m. Any URL-handling or network-invocation logic invoked by the CSV parser  [0m       [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m5[0m[39m. The fuzzer harness [0m[1;39m([0m[39m`TextAndCSVParserFuzzer`[0m[1;39m)[0m[39m as an entry point to understand [0m [2m                [0m
[2;36m                    [0m         [39mhow input is fed into the parser[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThese components collectively handle untrusted input and perform the network [0m       [2m                [0m
[2;36m                    [0m         [39mrequest that triggered the SSRF sanitizer.[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Initial Issue Log[0m                                                                [2m                [0m
[2;36m                    [0m         [39mHere is the initial issue log of the codebase:[0m                                      [2m                [0m
[2;36m                    [0m         [39m<issue>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: [0m     [2m                [0m
[2;36m                    [0m         [39mServer Side Request Forgery [0m[1;39m([0m[39mSSRF[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [39mAttempted connection to: jazzer.com:[0m[1;36m443[0m                                             [2m                [0m
[2;36m                    [0m         [39mRequests to destinations based on untrusted data could lead to exfiltration of [0m     [2m                [0m
[2;36m                    [0m         [39msensitive data or exposure of internal services.[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf[0m[1;39m([0m[39mServerSi[0m [2m                [0m
[2;36m                    [0m         [39mdeRequestForgery.jav[0m[1;92ma:127[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket[0m[1;39m([0m[39mSe[0m [2m                [0m
[2;36m                    [0m         [39mrverSideRequestForgery.jav[0m[1;92ma:71[0m[1;39m)[0m                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.net.Socket.connect[0m[1;39m([0m[39mSocket.jav[0m[1;92ma:633[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.security.ssl.SSLSocketImpl.connect[0m[1;39m([0m[39mSSLSocketImpl.jav[0m[1;92ma:299[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.NetworkClient.doConnect[0m[1;39m([0m[39mNetworkClient.jav[0m[1;92ma:178[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:498[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35msun.net.www.http.HttpClient.openServer[0m[1;39m([0m[39mHttpClient.jav[0m[1;92ma:603[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/sun.net.www.protocol.https.HttpsClient.<init>[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:266[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsClient.New[0m[1;39m([0m[39mHttpsClient.jav[0m[1;92ma:380[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpC[0m [2m                [0m
[2;36m                    [0m         [1;35mlient[0m[1;39m([0m[39mAbstractDelegateHttpsURLConnection.jav[0m[1;92ma:189[0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect0[0m[1;39m([0m[39mHttpURLConnecti[0m [2m                [0m
[2;36m                    [0m         [39mon.jav[0m[1;92ma:1242[0m[1;39m)[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.plainConnect[0m[1;39m([0m[39mHttpURLConnectio[0m [2m                [0m
[2;36m                    [0m         [39mn.jav[0m[1;92ma:1128[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect[0m[1;39m([0m[39mAbs[0m [2m                [0m
[2;36m                    [0m         [39mtractDelegateHttpsURLConnection.jav[0m[1;92ma:175[0m[1;39m)[0m                                           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream0[0m[1;39m([0m[39mHttpURLConnec[0m [2m                [0m
[2;36m                    [0m         [39mtion.jav[0m[1;92ma:1665[0m[1;39m)[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.http.HttpURLConnection.getInputStream[0m[1;39m([0m[39mHttpURLConnect[0m [2m                [0m
[2;36m                    [0m         [39mion.jav[0m[1;92ma:1589[0m[1;39m)[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/[0m[1;35msun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream[0m[1;39m([0m[39mHttpsURL[0m [2m                [0m
[2;36m                    [0m         [39mConnectionImpl.jav[0m[1;92ma:224[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processURL[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:278[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.processCell[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:261[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.csv.TextAndCSVParser.parse[0m[1;39m([0m[39mTextAndCSVParser.jav[0m[1;92ma:211[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.parseOne[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:57[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TextAndCSVParserFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTextAndCSVParserFuzzer.jav[0m[1;92ma:4[0m [2m                [0m
[2;36m                    [0m         [1;92m1[0m[1;39m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: 092377579d0e2656[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:240[0m[39m-[0m[1;36m350[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m241[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m242[0m[39m:            [0m[1;35mxhtmlContentHandler.endElement[0m[1;39m([0m[39mTABLE[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m243[0m[39m:            [0m[1;35mxhtmlContentHandler.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m244[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m245[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m246[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m247[0m[39m:    private void [0m[1;35mprocessCell[0m[1;39m([0m[39mString cellContent, XHTMLContentHandler xhtml,[0m     [2m                [0m
[2;36m                    [0m         [1;36m248[0m[39m:                             Metadata metadata,[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m249[0m[39m:                             ParseContext context[0m[1;39m)[0m[39m throws IOException, [0m         [2m                [0m
[2;36m                    [0m         [39mSAXException [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m250[0m[39m:        [0m[1;35mxhtml.startElement[0m[1;39m([0m[39mTD[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m251[0m[39m:        Matcher m = [0m[1;35mHYPERLINK_PATTERN.matcher[0m[1;39m([0m[39mcellContent[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m252[0m[39m:        if [0m[1;39m([0m[1;35mm.find[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m253[0m[39m:            String url = [0m[1;35mm.group[0m[1;39m([0m[1;36m1[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m254[0m[39m:            String name = [0m[1;35mm.group[0m[1;39m([0m[1;36m2[0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m255[0m[39m:            if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m256[0m[39m:                name = url;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:            [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"a"[0m[39m, [0m[32m"href"[0m[39m, url[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:            [0m[1;35mxhtml.characters[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:            [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"a"[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:            [0m[1;35mprocessURL[0m[1;39m([0m[39murl, name, xhtml, metadata, context[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:            [0m[1;35mxhtml.characters[0m[1;39m([0m[39mcellContent[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:        [0m[1;35mxhtml.endElement[0m[1;39m([0m[39mTD[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:    private void [0m[1;35mprocessURL[0m[1;39m([0m[39mString urlString, String name, XHTMLContentHandler [0m [2m                [0m
[2;36m                    [0m         [39mxhtml,[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:                            Metadata parentMetadata,[0m                            [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:                            ParseContext context[0m[1;39m)[0m[39m throws IOException, [0m          [2m                [0m
[2;36m                    [0m         [39mSAXException [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:        EmbeddedDocumentExtractor ex = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mEmbeddedDocumentUtil.getEmbeddedDocumentExtractor[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:        Metadata metadata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:            URL url = new [0m[1;35mURL[0m[1;39m([0m[39murlString[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:            URLConnection connection = [0m[1;35murl.openConnection[0m[1;39m([0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:            [0m[1;35mconnection.setConnectTimeout[0m[1;39m([0m[1;36m5000[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:            try [0m[1;39m([0m[39mTikaInputStream tis = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mconnection.getInputStream[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:                [0m[1;35mex.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, metadata, false[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:            [0m[1;35mparentMetadata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_EXCEPTION,[0m           [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:                    [0m[1;35mExceptionUtils.getStackTrace[0m[1;39m([0m[39me[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:    private void [0m[1;35mhandleText[0m[1;39m([0m[39mReader reader, Charset charset, ContentHandler [0m     [2m                [0m
[2;36m                    [0m         [39mhandler,[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:                            Metadata metadata[0m[1;39m)[0m[39m throws SAXException, [0m            [2m                [0m
[2;36m                    [0m         [39mIOException, TikaException [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:        [0m[35m/[0m[35m/[0m[39m Automatically detect the character encoding[0m                          [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:        [0m[35m/[0m[35m/[0m[95mtry[0m[39m to get detected content type; could be a subclass of text/plain[0m   [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        [0m[35m/[0m[35m/[0m[95msuch[0m[39m as vcal, etc.[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        String incomingMime = [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:        MediaType mediaType = MediaType.TEXT_PLAIN;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:        if [0m[1;39m([0m[39mincomingMime != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m296[0m[39m:            MediaType tmpMediaType = [0m[1;35mMediaType.parse[0m[1;39m([0m[39mincomingMime[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m297[0m[39m:            if [0m[1;39m([0m[39mtmpMediaType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m298[0m[39m:                mediaType = tmpMediaType;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m299[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m300[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:        MediaType type = new [0m[1;35mMediaType[0m[1;39m([0m[39mmediaType, charset[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:        [0m[35m/[0m[35m/[0m[39m deprecated, see TIKA-[0m[1;36m431[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_ENCODING, [0m[1;35mcharset.name[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:        XHTMLContentHandler xhtml = new [0m[1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, metadata[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:        [0m[1;35mxhtml.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:        [0m[1;35mhandleText[0m[1;39m([0m[39mreader, xhtml[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:        [0m[1;35mxhtml.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m311[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m312[0m[39m:    private Reader [0m[1;35mdetect[0m[1;39m([0m[39mCSVParams params, TextAndCSVConfig textAndCSVConfig, [0m [2m                [0m
[2;36m                    [0m         [39mInputStream stream, Metadata metadata,[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m313[0m[39m:                          ParseContext context[0m[1;39m)[0m[39m throws IOException, [0m            [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m314[0m[39m:        [0m[35m/[0m[35m/[0m[95mif[0m[39m the file was already identified as not .txt, .csv or .tsv[0m          [2m                [0m
[2;36m                    [0m         [1;36m315[0m[39m:        [0m[35m/[0m[35m/[0m[95mdon[0m[39m't even try to csv or not[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m316[0m[39m:        String mediaString = [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m317[0m[39m:        if [0m[1;39m([0m[39mmediaString != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m318[0m[39m:            MediaType mediaType = [0m[1;35mMediaType.parse[0m[1;39m([0m[39mmediaString[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m319[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mSUPPORTED_TYPES.contains[0m[1;39m([0m[1;35mmediaType.getBaseType[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m320[0m[39m:                [0m[1;35mparams.setMediaType[0m[1;39m([0m[39mmediaType[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m321[0m[39m:                return new [0m                                                     [2m                [0m
[2;36m                    [0m         [1;35mAutoDetectReader[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, metadata,[0m                     [2m                [0m
[2;36m                    [0m         [1;36m322[0m[39m:                        [0m[1;35mgetEncodingDetector[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m323[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m324[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m325[0m[39m:        Reader reader;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m326[0m[39m:        if [0m[1;39m([0m[1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[39m == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m327[0m[39m:            reader = new [0m[1;35mAutoDetectReader[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m328[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m329[0m[39m:            [0m[1;35mparams.setCharset[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mAutoDetectReader[0m[1;39m)[0m[39m reader[0m[1;39m)[0m[1;35m.getCharset[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m330[0m[39m:            if [0m[1;39m([0m[1;35mparams.isComplete[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m331[0m[39m:                return reader;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m332[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m333[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m334[0m[39m:            reader = new [0m[1;35mBufferedReader[0m[1;39m([0m                                        [2m                [0m
[2;36m                    [0m         [1;36m335[0m[39m:                    new [0m[1;35mInputStreamReader[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m336[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m337[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m338[0m[39m:        if [0m[1;39m([0m[1;35mparams.getDelimiter[0m[1;39m([0m[1;39m)[0m[39m == null &&[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:                [0m[1;39m([0m[1;35mparams.getMediaType[0m[1;39m([0m[1;39m)[0m[39m == null || [0m                              [2m                [0m
[2;36m                    [0m         [1;35misCSVOrTSV[0m[1;39m([0m[1;35mparams.getMediaType[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:            CSVSniffer sniffer = new [0m[1;35mCSVSniffer[0m[1;39m([0m[39mmarkLimit, [0m                     [2m                [0m
[2;36m                    [0m         [1;35mtextAndCSVConfig.getDelimiterToNameMap[0m[1;39m([0m[1;39m)[0m[1;35m.keySet[0m[1;39m([0m[1;39m)[0m[39m, minConfidence[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:            CSVResult result = [0m[1;35msniffer.getBest[0m[1;39m([0m[39mreader, metadata[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:            [0m[1;35mparams.setMediaType[0m[1;39m([0m[1;35mresult.getMediaType[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:            [0m[1;35mparams.setDelimiter[0m[1;39m([0m[1;35mresult.getDelimiter[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:        return reader;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:    private CSVParams [0m[1;35mgetOverride[0m[1;39m([0m[39mMetadata metadata, TextAndCSVConfig [0m          [2m                [0m
[2;36m                    [0m         [39mtextAndCSVConfig[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:        String override = [0m                                                      [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_USER_OVERRIDE[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:1[0m[39m-[0m[1;36m120[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *      [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.parser.csv;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.Reader;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.UncheckedIOException;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.net.URLConnection;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.nio.charset.UnsupportedCharsetException;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.regex.Matcher;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.commons.csv.CSVFormat;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.commons.csv.CSVParser;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.commons.csv.CSVRecord;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.tika.detect.AutoDetectReader;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import org.apache.tika.detect.EncodingDetector;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentExtractor;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentUtil;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:import org.apache.tika.parser.AbstractEncodingDetectorParser;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.tika.sax.XHTMLContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.apache.tika.utils.ExceptionUtils;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m: * Unless the [0m[1;39m{[0m[39m@link TikaCoreProperties#CONTENT_TYPE_USER_OVERRIDE[0m[1;39m}[0m[39m is set,[0m      [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m: * this parser tries to assess whether the file is a text file, csv or tsv.[0m      [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m: * If the detector detects regularity in column numbers and/or encapsulated [0m     [2m                [0m
[2;36m                    [0m         [39mcells,[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m: * this parser will apply the [0m[1;39m{[0m[39m@link org.apache.commons.csv.CSVParser[0m[1;39m}[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m: * otherwise, it will treat the contents as text.[0m                                [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m: * <p>[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m: * If there is a csv parse exception during detection, the parser sets[0m           [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m: * the [0m[1;39m{[0m[39m@link Metadata#CONTENT_TYPE[0m[1;39m}[0m[39m to [0m[1;39m{[0m[39m@link MediaType#TEXT_PLAIN[0m[1;39m}[0m             [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m: * and treats the file as [0m[1;39m{[0m[39m@link MediaType#TEXT_PLAIN[0m[1;39m}[0m[39m.[0m                          [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m: * <[0m[35m/[0m[95mp[0m[39m>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m: * <p>[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m: * If there is a csv parse exception during the parse, the parser[0m                [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m: * writes what's left of the stream as if it were text and then throws[0m           [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m: * an exception.  As of this writing, the content that was buffered by the [0m      [2m                [0m
[2;36m                    [0m         [39munderlying[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m: * [0m[1;39m{[0m[39m@link org.apache.commons.csv.CSVParser[0m[1;39m}[0m[39m is lost.[0m                             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m: * <[0m[35m/[0m[95mp[0m[39m>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:public class TextAndCSVParser extends AbstractEncodingDetectorParser [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:    static final MediaType CSV = [0m[1;35mMediaType.text[0m[1;39m([0m[32m"csv"[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:    static final MediaType TSV = [0m[1;35mMediaType.text[0m[1;39m([0m[32m"tsv"[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:    private static final String CSV_PREFIX = [0m[32m"csv"[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    private static final String CHARSET = [0m[32m"charset"[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    private static final String DELIMITER = [0m[32m"delimiter"[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:    public static final Property DELIMITER_PROPERTY = [0m[1;35mProperty.externalText[0m[1;39m([0m     [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:            CSV_PREFIX + TikaCoreProperties.NAMESPACE_PREFIX_DELIMITER + [0m        [2m                [0m
[2;36m                    [0m         [39mDELIMITER[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     * If the file is detected as a csv/tsv, this is the number of columns in [0m   [2m                [0m
[2;36m                    [0m         [39mthe first row.[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:    public static final Property NUM_COLUMNS = [0m[1;35mProperty.externalInteger[0m[1;39m([0m         [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:            CSV_PREFIX + TikaCoreProperties.NAMESPACE_PREFIX_DELIMITER + [0m        [2m                [0m
[2;36m                    [0m         [32m"num_columns"[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:     * If the file is detected as a csv/tsv, this is the number of rows if the [0m  [2m                [0m
[2;36m                    [0m         [39mfile[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:     * is successfully read [0m[1;39m([0m[39me.g. no encapsulation exceptions, etc[0m[1;39m)[0m[39m.[0m             [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:    public static final Property NUM_ROWS = [0m[1;35mProperty.externalInteger[0m[1;39m([0m           [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:            CSV_PREFIX + TikaCoreProperties.NAMESPACE_PREFIX_DELIMITER + [0m       [2m                [0m
[2;36m                    [0m         [32m"num_rows"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:    private static final Pattern HYPERLINK_PATTERN =[0m                            [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35mPattern.compile[0m[1;39m([0m[32m"[0m[32m([0m[32m?i[0m[32m)[0m[32m[[0m[32m\"[0m[32m][0m[32m*=HYPERLINK\\[0m[32m([0m[32m[[0m[32m\"[0m[32m][0m[32m+[0m[32m([0m[32m[[0m[32m^\"[0m[32m][0m[32m+[0m[32m)[0m[32m([0m[32m?:[0m[32m[[0m[32m\" [0m[32m][0m[32m+,[0m[32m[[0m[32m [0m    [2m                [0m
[2;36m                    [0m         [32m\"[0m[32m][0m[32m+[0m[32m([0m[32m[[0m[32m^\"[0m[32m][0m[32m+[0m[32m)[0m[32m)[0m[32m?"[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:    private static final String TD = [0m[32m"td"[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:    private static final String TR = [0m[32m"tr"[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:    private static final String TABLE = [0m[32m"table"[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:    private static final int DEFAULT_MARK_LIMIT = [0m[1;36m20000[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    private static final Set<MediaType> SUPPORTED_TYPES = Collections[0m           [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:            [0m[1;35m.unmodifiableSet[0m[1;39m([0m[39mnew HashSet<>[0m[1;39m([0m[1;35mArrays.asList[0m[1;39m([0m[39mCSV, TSV, [0m             [2m                [0m
[2;36m                    [0m         [39mMediaType.TEXT_PLAIN[0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     * This is the mark limit in characters [0m[1;39m([0m[39mnot bytes[0m[1;39m)[0m[39m to[0m                      [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:     * read from the stream when classifying the stream as[0m                      [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:     * csv, tsv or txt.[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:180[0m[39m-[0m[1;36m240[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:            reader = new [0m[1;35mBufferedReader[0m[1;39m([0m[39mnew [0m[1;35mInputStreamReader[0m[1;39m([0m[39mstream, [0m          [2m                [0m
[2;36m                    [0m         [1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:            charset = [0m[1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m184[0m[39m:        [0m[1;35mupdateMetadata[0m[1;39m([0m[39mparams, metadata, textAndCSVConfig[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:        [0m[35m/[0m[35m/[0m[95mif[0m[39m text or a non-csv/tsv category of text[0m                             [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:        [0m[35m/[0m[35m/[0m[95mtreat[0m[39m this as text and be done[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:        [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- if it was detected as a non-csv subtype of text[0m               [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mparams.getMediaType[0m[1;39m([0m[1;39m)[0m[1;35m.getBaseType[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mCSV[0m[1;39m)[0m[39m &&[0m                 [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:                ![0m[1;35mparams.getMediaType[0m[1;39m([0m[1;39m)[0m[1;35m.getBaseType[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mTSV[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:            [0m[1;35mhandleText[0m[1;39m([0m[39mreader, charset, handler, metadata[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:        CSVFormat csvFormat = [0m                                                  [2m                [0m
[2;36m                    [0m         [1;35mCSVFormat.EXCEL.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setDelimiter[0m[1;39m([0m[1;35mparams.getDelimiter[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mDELIMITER_PROPERTY, [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mtextAndCSVConfig.getDelimiterToNameMap[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;35mcsvFormat.getDelimiterString[0m[1;39m([0m[1;39m)[0m[1;35m.charAt[0m[1;39m([0m [2m                [0m
[2;36m                    [0m         [1;36m0[0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:        XHTMLContentHandler xhtmlContentHandler = new [0m                          [2m                [0m
[2;36m                    [0m         [1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, metadata[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:        int totalRows = [0m[1;36m0[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:        try [0m[1;39m([0m[39mCSVParser commonsParser = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mCSVParser.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setReader[0m[1;39m([0m[39mreader[0m[1;39m)[0m[1;35m.setFormat[0m[1;39m([0m[39mcsvFormat[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:            [0m[1;35mxhtmlContentHandler.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:            [0m[1;35mxhtmlContentHandler.startElement[0m[1;39m([0m[39mTABLE[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:            int firstRowColCount = [0m[1;36m0[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:                for [0m[1;39m([0m[39mCSVRecord row : commonsParser[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m206[0m[39m:                    [0m[1;35mxhtmlContentHandler.startElement[0m[1;39m([0m[39mTR[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m207[0m[39m:                    for [0m[1;39m([0m[39mString cell : row[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:                        if [0m[1;39m([0m[39mtotalRows == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                            firstRowColCount++;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:                        [0m[1;35mprocessCell[0m[1;39m([0m[39mcell, xhtmlContentHandler, metadata, [0m       [2m                [0m
[2;36m                    [0m         [39mcontext[0m[1;39m)[0m[39m;                    [0m[1;39m}[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:                    [0m[1;35mxhtmlContentHandler.endElement[0m[1;39m([0m[39mTR[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:                    if [0m[1;39m([0m[39mtotalRows == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:                        [0m[1;35mmetadata.set[0m[1;39m([0m[39mNUM_COLUMNS, firstRowColCount[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:                    totalRows++;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mNUM_ROWS, totalRows[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mUncheckedIOException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:                if [0m[1;39m([0m[1;35me.getCause[0m[1;39m([0m[1;39m)[0m[39m != null && [0m[1;35me.getCause[0m[1;39m([0m[1;39m)[0m[1;35m.getMessage[0m[1;39m([0m[1;39m)[0m[39m != null [0m  [2m                [0m
[2;36m                    [0m         [39m&&[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:                        [0m[1;35me.getCause[0m[1;39m([0m[1;39m)[0m[1;35m.getMessage[0m[1;39m([0m[1;39m)[0m[1;35m.contains[0m[1;39m([0m[32m"encapsulated"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:                    [0m[35m/[0m[35m/[0m[95mif[0m[39m there's a parse exception[0m                              [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:                    [0m[35m/[0m[35m/[0m[95mtry[0m[39m to get the rest of the content[0m[33m...[0m[39mtreat it as text for[0m [2m                [0m
[2;36m                    [0m         [39mnow[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:                    [0m[35m/[0m[35m/[0m[95mThere[0m[39m will be some content lost because of buffering.[0m     [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:                    [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- figure out how to improve this[0m                    [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:                    [0m[1;35mxhtmlContentHandler.endElement[0m[1;39m([0m[39mTABLE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:                    [0m[1;35mxhtmlContentHandler.startElement[0m[1;39m([0m[32m"div"[0m[39m, [0m[32m"name"[0m[39m, [0m[32m"after [0m     [2m                [0m
[2;36m                    [0m         [32mexception"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:                    [0m[1;35mhandleText[0m[1;39m([0m[39mreader, xhtmlContentHandler[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:                    [0m[1;35mxhtmlContentHandler.endElement[0m[1;39m([0m[32m"div"[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:                    [0m[1;35mxhtmlContentHandler.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:                    [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- consider dumping what's left in the reader as [0m    [2m                [0m
[2;36m                    [0m         [39mtext[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:                    throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"exception parsing the csv"[0m[39m, e[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:                    if [0m[1;39m([0m[1;35me.getCause[0m[1;39m([0m[1;39m)[0m[39m != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m235[0m[39m:                        throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"exception parsing the csv"[0m[39m, [0m   [2m                [0m
[2;36m                    [0m         [1;35me.getCause[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:                    [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:                        throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"exception parsing the csv"[0m[39m, [0m   [2m                [0m
[2;36m                    [0m         [39me[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:120[0m[39m-[0m[1;36m180[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:    private int markLimit = DEFAULT_MARK_LIMIT;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:     * minimum confidence score that there's enough[0m                             [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:     * evidence to determine csv/tsv vs. txt[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:    private double minConfidence = [0m[1;36m0.50[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:    public [0m[1;35mTextAndCSVParser[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:    public [0m[1;35mTextAndCSVParser[0m[1;39m([0m[39mEncodingDetector encodingDetector[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:        [0m[1;35msuper[0m[1;39m([0m[39mencodingDetector[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:    private static void [0m[1;35mhandleText[0m[1;39m([0m[39mReader reader, XHTMLContentHandler xhtml[0m[1;39m)[0m    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            throws SAXException, IOException [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:        [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"p"[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:        char[0m[1;39m[[0m[1;39m][0m[39m buffer = new char[0m[1;39m[[0m[1;36m4096[0m[1;39m][0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:        int n = [0m[1;35mreader.read[0m[1;39m([0m[39mbuffer[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:        while [0m[1;39m([0m[39mn != [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:            [0m[1;35mxhtml.characters[0m[1;39m([0m[39mbuffer, [0m[1;36m0[0m[39m, n[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:            n = [0m[1;35mreader.read[0m[1;39m([0m[39mbuffer[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"p"[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:    static boolean [0m[1;35misCSVOrTSV[0m[1;39m([0m[39mMediaType mediaType[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        if [0m[1;39m([0m[39mmediaType == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            return false;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:        return [0m[1;35mmediaType.getBaseType[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mTSV[0m[1;39m)[0m[39m || [0m                          [2m                [0m
[2;36m                    [0m         [1;35mmediaType.getBaseType[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mCSV[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:    private final TextAndCSVConfig defaultTextAndCSVConfig = new [0m               [2m                [0m
[2;36m                    [0m         [1;35mTextAndCSVConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:    public Set<MediaType> [0m[1;35mgetSupportedTypes[0m[1;39m([0m[39mParseContext context[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:        return SUPPORTED_TYPES;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    public void [0m[1;35mparse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:        TextAndCSVConfig textAndCSVConfig = [0m[1;35mcontext.get[0m[1;39m([0m[39mTextAndCSVConfig.class,[0m [2m                [0m
[2;36m                    [0m         [39mdefaultTextAndCSVConfig[0m[1;39m)[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:        CSVParams params = [0m[1;35mgetOverride[0m[1;39m([0m[39mmetadata, textAndCSVConfig[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:        Reader reader;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:        Charset charset;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mparams.isComplete[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:            reader = [0m[1;35mdetect[0m[1;39m([0m[39mparams, textAndCSVConfig, stream, metadata, [0m        [2m                [0m
[2;36m                    [0m         [39mcontext[0m[1;39m)[0m[39m;[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:            if [0m[1;39m([0m[1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[39m != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                charset = [0m[1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:                charset = [0m[1;39m([0m[1;39m([0m[39mAutoDetectReader[0m[1;39m)[0m[39m reader[0m[1;39m)[0m[1;35m.getCharset[0m[1;39m([0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:            reader = new [0m[1;35mBufferedReader[0m[1;39m([0m[39mnew [0m[1;35mInputStreamReader[0m[1;39m([0m[39mstream, [0m          [2m                [0m
[2;36m                    [0m         [1;35mparams.getCharset[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.jav[0m[1;92ma:17[0m[39m-[0m[1;36m58[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.parser.csv;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.Serializable;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:public class TextAndCSVConfig implements Serializable [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:    private static final Map<Character, String> DELIMITER_TO_NAME_MAP = new [0m     [2m                [0m
[2;36m                    [0m         [39mHashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    private static final Map<String, Character> NAME_TO_DELIMITER_MAP = new [0m     [2m                [0m
[2;36m                    [0m         [39mHashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    static [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:        [0m[1;35mDELIMITER_TO_NAME_MAP.put[0m[1;39m([0m[32m','[0m[39m, [0m[32m"comma"[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:        [0m[1;35mDELIMITER_TO_NAME_MAP.put[0m[1;39m([0m[32m'\t'[0m[39m, [0m[32m"tab"[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:        [0m[1;35mDELIMITER_TO_NAME_MAP.put[0m[1;39m([0m[32m'|'[0m[39m, [0m[32m"pipe"[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:        [0m[1;35mDELIMITER_TO_NAME_MAP.put[0m[1;39m([0m[32m';'[0m[39m, [0m[32m"semicolon"[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    static [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:        for [0m[1;39m([0m[39mMap.Entry<Character, String> e : [0m[1;35mDELIMITER_TO_NAME_MAP.entrySet[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:            [0m[1;35mNAME_TO_DELIMITER_MAP.put[0m[1;39m([0m[1;35me.getValue[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35me.getKey[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;[0m   [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:    private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;[0m   [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public Map<String, Character> [0m[1;35mgetNameToDelimiterMap[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        return nameToDelimiterMap;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public Map<Character, String> [0m[1;35mgetDelimiterToNameMap[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:        return delimiterToNameMap;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    public void [0m[1;35msetNameToDelimiterMap[0m[1;39m([0m[39mMap<String, Character> nameToDelimiterMap[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:        this.nameToDelimiterMap = new HashMap<>[0m[1;39m([0m[39mnameToDelimiterMap[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        this.delimiterToNameMap = new HashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35mnameToDelimiterMap.entrySet[0m[1;39m([0m[1;39m)[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:                          [0m[1;35m.forEach[0m[1;39m([0m[39me -> [0m[1;35mdelimiterToNameMap.put[0m[1;39m([0m[1;35me.getValue[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [1;35me.getKey[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:165[0m[39m-[0m[1;36m172[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    public void [0m[1;35mparse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:        TextAndCSVConfig textAndCSVConfig = [0m[1;35mcontext.get[0m[1;39m([0m[39mTextAndCSVConfig.class,[0m [2m                [0m
[2;36m                    [0m         [39mdefaultTextAndCSVConfig[0m[1;39m)[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:        CSVParams params = [0m[1;35mgetOverride[0m[1;39m([0m[39mmetadata, textAndCSVConfig[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:        Reader reader;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:        Charset charset;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mparams.isComplete[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-m[0m [2m                [0m
[2;36m                    [0m         [39module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.jav[0m[1;92ma:268[0m[39m-[0m[1;36m276[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:    private void [0m[1;35mprocessURL[0m[1;39m([0m[39mString urlString, String name, XHTMLContentHandler [0m [2m                [0m
[2;36m                    [0m         [39mxhtml,[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:                            Metadata parentMetadata,[0m                            [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:                            ParseContext context[0m[1;39m)[0m[39m throws IOException, [0m          [2m                [0m
[2;36m                    [0m         [39mSAXException [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:        EmbeddedDocumentExtractor ex = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mEmbeddedDocumentUtil.getEmbeddedDocumentExtractor[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:        Metadata metadata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:            URL url = new [0m[1;35mURL[0m[1;39m([0m[39murlString[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:            URLConnection connection = [0m[1;35murl.openConnection[0m[1;39m([0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Introduce an explicit “external-fetch” toggle in the CSV parser configuration  [0m  [2m                [0m
[2;36m                    [0m         [39m   a. In TextAndCSVConfig, add a new boolean field “allowExternalFetch” [0m[1;39m([0m[39mdefaulting[0m [2m                [0m
[2;36m                    [0m         [39mto false[0m[1;39m)[0m[39m and annotate it with @Field so it can be set via Tika configuration or [0m   [2m                [0m
[2;36m                    [0m         [39mParseContext.  [0m                                                                     [2m                [0m
[2;36m                    [0m         [39m   b. Provide public getter/setter:  [0m                                               [2m                [0m
[2;36m                    [0m         [39m      - boolean [0m[1;35misAllowExternalFetch[0m[1;39m([0m[1;39m)[0m[39m  [0m                                            [2m                [0m
[2;36m                    [0m         [39m      - void [0m[1;35msetAllowExternalFetch[0m[1;39m([0m[39mboolean allowExternalFetch[0m[1;39m)[0m[39m  [0m                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. At parse-time, carry the configured TextAndCSVConfig through to the [0m             [2m                [0m
[2;36m                    [0m         [39mURL-processing logic  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m   a. In [0m[1;35mTextAndCSVParser.parse[0m[1;39m([0m[39mInputStream, …, ParseContext[0m[1;39m)[0m[39m, retrieve the [0m        [2m                [0m
[2;36m                    [0m         [39mTextAndCSVConfig once via  [0m                                                         [2m                [0m
[2;36m                    [0m         [39m        TextAndCSVConfig cfg = [0m[1;35mcontext.get[0m[1;39m([0m[39mTextAndCSVConfig.class, [0m                 [2m                [0m
[2;36m                    [0m         [39mdefaultTextAndCSVConfig[0m[1;39m)[0m[39m;  [0m                                                         [2m                [0m
[2;36m                    [0m         [39m      and leave it in a local final variable.  [0m                                     [2m                [0m
[2;36m                    [0m         [39m   b. No harness or test modifications are needed—existing code will still pick up [0m [2m                [0m
[2;36m                    [0m         [39mthe same config via the ParseContext.[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Guard all outbound URLConnections in [0m[1;35mprocessURL[0m[1;39m([0m[33m...[0m[1;39m)[0m[39m behind the new config flag [0m [2m                [0m
[2;36m                    [0m         [39m   a. At the very beginning of processURL, do:  [0m                                    [2m                [0m
[2;36m                    [0m         [39m         TextAndCSVConfig cfg = [0m[1;35mcontext.get[0m[1;39m([0m[39mTextAndCSVConfig.class, [0m                [2m                [0m
[2;36m                    [0m         [39mdefaultTextAndCSVConfig[0m[1;39m)[0m[39m;  [0m                                                         [2m                [0m
[2;36m                    [0m         [39m         if [0m[1;39m([0m[39m![0m[1;35mcfg.isAllowExternalFetch[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m[39m  [0m                                       [2m                [0m
[2;36m                    [0m         [39m             [0m[35m/[0m[35m/[0m[39m Optionally record that the fetch was skipped, e.g.:  [0m               [2m                [0m
[2;36m                    [0m         [39m             [0m[1;35mparentMetadata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_EXCEPTION,  [0m            [2m                [0m
[2;36m                    [0m         [39m                     [0m[32m"Skipped external fetch for URL: "[0m[39m + urlString[0m[1;39m)[0m[39m;  [0m             [2m                [0m
[2;36m                    [0m         [39m             return;  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m         [0m[1;39m}[0m[39m  [0m                                                                        [2m                [0m
[2;36m                    [0m         [39m   b. Only if [0m[33mallowExternalFetch[0m[39m==true do we proceed to new [0m                        [2m                [0m
[2;36m                    [0m         [1;35mURL[0m[1;39m([0m[39murlString[0m[1;39m)[0m[1;35m.openConnection[0m[1;39m([0m[1;39m)[0m[39m and parseEmbedded.  [0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Preserve existing functionality for users who explicitly enable external fetches[0m [2m                [0m
[2;36m                    [0m         [39m   - By default, all untrusted hyperlinks in CSV cells will be rendered as links [0m   [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mvia XHTMLContentHandler[0m[1;39m)[0m[39m but no network fetch will occur.  [0m                        [2m                [0m
[2;36m                    [0m         [39m   - If downstream applications wish to restore the original behavior, they can set[0m [2m                [0m
[2;36m                    [0m         [33mallowExternalFetch[0m[39m=[0m[35mtrue[0m[39m in TextAndCSVConfig [0m[1;39m([0m[39meither programmatically or via [0m        [2m                [0m
[2;36m                    [0m         [39mtika-config.xml[0m[1;39m)[0m[39m.  [0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Avoid breaking existing tests or fuzz harness  [0m                                  [2m                [0m
[2;36m                    [0m         [39m   - No changes are made to any test or harness code.  [0m                             [2m                [0m
[2;36m                    [0m         [39m   - The new config property defaults to false, so existing tests that do not [0m      [2m                [0m
[2;36m                    [0m         [39mexplicitly enable external fetch will simply observe that embedded content isn’t [0m   [2m                [0m
[2;36m                    [0m         [39mfetched [0m[1;39m([0m[39mthey should not break unless they assert embedded content parsing[0m[1;39m)[0m[39m.  [0m      [2m                [0m
[2;36m                    [0m         [39m   - Since the only side effect is skipping network I/O, and the parser still emits[0m [2m                [0m
[2;36m                    [0m         [39mthe link text, internal XHTML structure is preserved.  [0m                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. Consider protocol‐specific policies [0m[1;39m([0m[39moptional enhancement[0m[1;39m)[0m[39m  [0m                     [2m                [0m
[2;36m                    [0m         [39m   - If finer control is desired, extend the config or URL guard to check [0m          [2m                [0m
[2;36m                    [0m         [1;35murl.getProtocol[0m[1;39m([0m[1;39m)[0m[39m and only block “http”[0m[35m/[0m[39m“https” while allowing “file” or other [0m     [2m                [0m
[2;36m                    [0m         [39mschemes. This can be layered on top of the boolean toggle if needed.  [0m              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mJustification  [0m                                                                     [2m                [0m
[2;36m                    [0m         [39m- Introducing a configuration flag is the least‐invasive way to prevent SSRF by [0m    [2m                [0m
[2;36m                    [0m         [39mdefault while preserving the ability to fetch embedded documents when explicitly [0m   [2m                [0m
[2;36m                    [0m         [39mallowed.  [0m                                                                          [2m                [0m
[2;36m                    [0m         [39m- All existing parsing logic [0m[1;39m([0m[39mcell detection, XHTML emission, error handling[0m[1;39m)[0m[39m [0m      [2m                [0m
[2;36m                    [0m         [39mremains unchanged except for the pre‐connection guard in processURL.  [0m              [2m                [0m
[2;36m                    [0m         [39m- No external libraries, harness code, or test suites are modified; the fix resides[0m [2m                [0m
[2;36m                    [0m         [39mentirely within the CSV parser module.  [0m                                            [2m                [0m
[2;36m                    [0m         [39m- By defaulting the flag to false, we err on the side of security—external network [0m [2m                [0m
[2;36m                    [0m         [39mcalls from untrusted CSV input are disabled unless the embedding application [0m       [2m                [0m
[2;36m                    [0m         [39mconsciously opts in.  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m- This pattern [0m[1;39m([0m[39mboolean switch + guard at network‐call site[0m[1;39m)[0m[39m aligns with other [0m     [2m                [0m
[2;36m                    [0m         [39msecure‐by‐default components in Tika and can be documented in the parser’s [0m         [2m                [0m
[2;36m                    [0m         [39mconfiguration guide.  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m- Potential side effects: downstream consumers who relied on auto-fetching linked [0m  [2m                [0m
[2;36m                    [0m         [39mresources will need to set [0m[33mallowExternalFetch[0m[39m=[0m[35mtrue[0m[39m. Mitigation: clearly document [0m   [2m                [0m
[2;36m                    [0m         [39mthe new flag and its default.        [0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=255041;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=639501;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=659393;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=56096;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmps7ywxehb[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_o4_mini/tika_tk-full-01_vuln_7/[0m[95magent-output-176[0m [2m               [0m
[2;36m                    [0m         [95m6479657.6220994[0m                                                                      [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/tika_tk-full-01_vuln_7.toml             [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[12/23/25 17:47:38][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/user/crete/.cache/environments/[0m[95mtika[0m           ]8;id=364103;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=820104;file:///home/user/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=171267;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=294444;file:///home/user/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=311144;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=899494;file:///home/user/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
