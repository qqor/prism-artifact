--- a/lib/alliswellprotocoll.c
+++ b/lib/alliswellprotocoll.c
@@ -247,15 +247,15 @@
     case ALLISWELLPROTOCOLL_DO3:
       if(result || !nread)
         break;
-      if(memcmp(response, vnormal->state3, 128) == 0) {
+      /* Require full response before comparing */
+      if(nread < 128) {
+        result = CURLE_WEIRD_SERVER_REPLY;
+      }
+      else if(memcmp(response, vnormal->state3, 128) == 0 ||
+              strcasecmp("complete\r\n", response) == 0) {
         vnstate(data, ALLISWELLPROTOCOLL_STOP);
         Curl_pp_sendf(data, &conn->proto.vnormal.pp, "%s", "OK\r\n");
-        *(unsigned int *)result = CURLE_OK;
-      }
-      else if(strcasecmp("complete\r\n", response) == 0) {
-        Curl_pp_sendf(data, &conn->proto.vnormal.pp, "%s", "OK\r\n");
         result = CURLE_OK;
-        vnstate(data, ALLISWELLPROTOCOLL_STOP);
       }
       else {
         result = CURLE_WEIRD_SERVER_REPLY;
