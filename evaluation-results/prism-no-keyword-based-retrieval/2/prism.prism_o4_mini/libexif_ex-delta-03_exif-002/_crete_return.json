{
  "project_name": "libexif",
  "vulnerability_identifier": "libexif_ex-delta-03_exif-002",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libexif",
  "llm_usage": {
    "total_cost": 0.5182892000000001,
    "prompt_tokens": 276172,
    "completion_tokens": 48750
  },
  "variant": "sound",
  "diff": "--- a/libexif/exif-data.c\n+++ b/libexif/exif-data.c\n@@ -66,6 +66,9 @@\n \t/* Temporarily used while loading data */\n \tunsigned int offset_mnote;\n \n+\t/* Actual EXIF payload length (slice after header), for bounds checks */\n+\tunsigned int full_size;\n+\n \tExifDataOption options;\n \tExifDataType data_type;\n };\n@@ -194,7 +197,19 @@\n \telse\n \t\tdoff = offset + 8;\n \n-\t/* Sanity checks */\n+\t/* Sanity checks against full buffer size */\n+\tif (doff >= data->priv->full_size) {\n+\t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n+\t\t\t\t  \"Tag starts past end of full buffer (%u >= %u)\", doff, data->priv->full_size);\n+\t\treturn 0;\n+\t}\n+\tif (s > data->priv->full_size - doff) {\n+\t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n+\t\t\t\t  \"Tag data goes past end of full buffer (%u > %u)\", doff + s, data->priv->full_size);\n+\t\treturn 0;\n+\t}\n+\n+\t/* Sanity checks against slice size */\n \tif (doff >= size) {\n \t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n \t\t\t\t  \"Tag starts past end of buffer (%u > %u)\", doff, size);\n@@ -203,7 +218,7 @@\n \n \tif (s > size - doff) {\n \t\texif_log (data->priv->log, EXIF_LOG_CODE_DEBUG, \"ExifData\",\n-\t\t\t\t  \"Tag data goes past end of buffer (%u > %u)\", doff+s, size);\n+\t\t\t\t  \"Tag data goes past end of buffer (%u > %u)\", doff + s, size);\n \t\treturn 0;\n \t}\n \n@@ -955,8 +970,9 @@\n \tfullds = ds;\n \tif (ds > 0xfffe)\n \t\tds = 0xfffe;\n-\n-\t/* Byte order (offset 6, length 2) */\n+\tds -= 6;\n+\td += 6;\n+\tdata->priv->full_size = ds;\n \tif (!memcmp (d + 6, \"II\", 2))\n \t\tdata->priv->order = EXIF_BYTE_ORDER_INTEL;\n \telse if (!memcmp (d + 6, \"MM\", 2))\n",
  "stdout": "",
  "stderr": ""
}