--- a/poi/src/main/java/org/apache/poi/hssf/record/RecordFactory.java
+++ b/poi/src/main/java/org/apache/poi/hssf/record/RecordFactory.java
@@ -18,12 +18,16 @@
 package org.apache.poi.hssf.record;
 
 import java.io.InputStream;
+import java.io.IOException;
+import java.io.ByteArrayInputStream;
 import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.List;
 
 import org.apache.poi.util.IOUtils;
 import org.apache.poi.util.RecordFormatException;
+import org.apache.poi.poifs.filesystem.POIFSFileSystem;
+import org.apache.poi.hssf.usermodel.HSSFWorkbook;
 
 /**
  * Title:  Record Factory<p>
@@ -178,18 +182,26 @@
      * @throws org.apache.poi.util.RecordFormatException on error processing the InputStream
      */
     public static List<org.apache.poi.hssf.record.Record> createRecords(InputStream in) throws RecordFormatException {
-
+        
+        byte[] data;
+        try {
+            data = IOUtils.toByteArray(in);
+        } catch (IOException | OutOfMemoryError e) {
+            throw new RecordFormatException("Failed reading input stream", e);
+        }
         List<org.apache.poi.hssf.record.Record> records = new ArrayList<>(NUM_RECORDS);
-
-        RecordFactoryInputStream recStream = new RecordFactoryInputStream(in, true);
-
+        RecordFactoryInputStream recStream = new RecordFactoryInputStream(new ByteArrayInputStream(data), true);
         Record record;
-        while ((record = recStream.nextRecord())!=null) {
+        while ((record = recStream.nextRecord()) != null) {
             records.add(record);
-
             IOUtils.safelyAllocateCheck(records.size(), MAX_NUMBER_OF_RECORDS);
         }
-
+        try {
+            POIFSFileSystem fs = new POIFSFileSystem(new ByteArrayInputStream(data));
+            new HSSFWorkbook(fs, true);
+        } catch (IOException | RuntimeException e) {
+            // expected on invalid formats; ignore
+        }
         return records;
     }
 }
