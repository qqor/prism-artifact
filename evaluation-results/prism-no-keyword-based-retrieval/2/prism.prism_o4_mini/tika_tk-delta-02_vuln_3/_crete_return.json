{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-02_vuln_3",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.3853377,
    "prompt_tokens": 170999,
    "completion_tokens": 44827
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-audiovideo-module/src/main/java/org/apache/tika/parser/m3/M3U8Parser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-audiovideo-module/src/main/java/org/apache/tika/parser/m3/M3U8Parser.java\n@@ -161,16 +161,25 @@\n         // split on , then the first value is the length (can be -1),\n         // the last value is the title; intermediate values are key=value format\n         metadata.add(PLAY_LIST_LINK, nextLine);\n-        if (! nextLine.startsWith(\"http\")) {\n+        try {\n+            java.net.URL resourceUrl = new java.net.URL(nextLine);\n+            String protocol = resourceUrl.getProtocol().toLowerCase(java.util.Locale.ROOT);\n+            if (!\"file\".equals(protocol)) {\n+                // Skip HTTP/HTTPS and other network resources to prevent SSRF\n+                return;\n+            }\n+            EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n+            Metadata m = new Metadata();\n+            if (ex.shouldParseEmbedded(m)) {\n+                try (TikaInputStream tis = TikaInputStream.get(resourceUrl)) {\n+                    ex.parseEmbedded(tis,\n+                            new BodyContentHandler(new EmbeddedContentHandler(xhtml)),\n+                            m, true);\n+                }\n+            }\n+        } catch (java.net.MalformedURLException e) {\n+            // Invalid URL, skip\n             return;\n-        }\n-        EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n-        Metadata m = new Metadata();\n-        if (ex.shouldParseEmbedded(m)) {\n-            try (TikaInputStream tis = TikaInputStream.get(new URL(nextLine))) {\n-                ex.parseEmbedded(tis, new BodyContentHandler(new EmbeddedContentHandler(xhtml)), m,\n-                        true);\n-            }\n         }\n     }\n \n",
  "stdout": "",
  "stderr": ""
}