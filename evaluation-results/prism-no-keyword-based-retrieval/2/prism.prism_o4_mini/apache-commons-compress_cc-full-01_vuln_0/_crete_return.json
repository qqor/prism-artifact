{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-full-01_vuln_0",
  "source_directory": "/home/user/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 1.5020357,
    "prompt_tokens": 739711,
    "completion_tokens": 156444
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/archivers/zip/ZipFile.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/zip/ZipFile.java\n@@ -93,7 +93,7 @@\n  * </ul>\n  */\n public class ZipFile implements Closeable {\n-\n+    private final boolean allowRemoteCommentFetch;\n     /**\n      * Lock-free implementation of BoundedInputStream. The implementation uses positioned reads on the underlying archive file channel and therefore performs\n      * significantly faster in concurrent environment.\n@@ -140,6 +140,18 @@\n         private boolean useUnicodeExtraFields = true;\n         private boolean ignoreLocalFileHeader;\n         private long maxNumberOfDisks = 1;\n+        private boolean allowRemoteCommentFetch = false;\n+\n+        /**\n+         * Sets whether to fetch comments from remote URLs when a comment begins with \"http\" or \"https\".\n+         *\n+         * @param allow true to enable remote comment fetch; false to disable (default).\n+         * @return {@code this} instance.\n+         */\n+        public Builder setAllowRemoteCommentFetch(final boolean allow) {\n+            this.allowRemoteCommentFetch = allow;\n+            return this;\n+        }\n \n         /**\n          * Constructs a new instance.\n@@ -169,7 +181,7 @@\n                 actualDescription = path.toString();\n             }\n             final boolean closeOnError = seekableByteChannel != null;\n-            return new ZipFile(actualChannel, actualDescription, getCharset(), useUnicodeExtraFields, closeOnError, ignoreLocalFileHeader);\n+            return new ZipFile(actualChannel, actualDescription, getCharset(), useUnicodeExtraFields, closeOnError, ignoreLocalFileHeader, allowRemoteCommentFetch);\n         }\n \n         /**\n@@ -791,7 +803,13 @@\n     @Deprecated\n     @SuppressWarnings(\"resource\") // Caller closes\n     public ZipFile(final File file, final String encoding, final boolean useUnicodeExtraFields, final boolean ignoreLocalFileHeader) throws IOException {\n-        this(newReadByteChannel(file.toPath()), file.getAbsolutePath(), encoding, useUnicodeExtraFields, true, ignoreLocalFileHeader);\n+        this(newReadByteChannel(file.toPath()),\n+             file.getAbsolutePath(),\n+             encoding,\n+             useUnicodeExtraFields,\n+             true,\n+             ignoreLocalFileHeader,\n+             false);\n     }\n \n     /**\n@@ -857,7 +875,13 @@\n     @SuppressWarnings(\"resource\") // Caller closes\n     @Deprecated\n     public ZipFile(final Path path, final String encoding, final boolean useUnicodeExtraFields, final boolean ignoreLocalFileHeader) throws IOException {\n-        this(newReadByteChannel(path), path.toAbsolutePath().toString(), encoding, useUnicodeExtraFields, true, ignoreLocalFileHeader);\n+        this(newReadByteChannel(path),\n+             path.toAbsolutePath().toString(),\n+             encoding,\n+             useUnicodeExtraFields,\n+             true,\n+             ignoreLocalFileHeader,\n+             false);\n     }\n \n     /**\n@@ -873,7 +897,13 @@\n      */\n     @Deprecated\n     public ZipFile(final SeekableByteChannel channel) throws IOException {\n-        this(channel, \"a SeekableByteChannel\", DEFAULT_CHARSET_NAME, true);\n+        this(channel,\n+             \"a SeekableByteChannel\",\n+             Builder.DEFAULT_CHARSET,\n+             true,\n+             false,\n+             false,\n+             false);\n     }\n \n     /**\n@@ -890,16 +920,23 @@\n      */\n     @Deprecated\n     public ZipFile(final SeekableByteChannel channel, final String encoding) throws IOException {\n-        this(channel, \"a SeekableByteChannel\", encoding, true);\n+        this(channel,\n+             \"a SeekableByteChannel\",\n+             Charsets.toCharset(encoding, Builder.DEFAULT_CHARSET),\n+             true,\n+             false,\n+             false,\n+             false);\n     }\n \n     private ZipFile(final SeekableByteChannel channel, final String channelDescription, final Charset encoding, final boolean useUnicodeExtraFields,\n-            final boolean closeOnError, final boolean ignoreLocalFileHeader) throws IOException {\n+                    final boolean closeOnError, final boolean ignoreLocalFileHeader, final boolean allowRemoteCommentFetch) throws IOException {\n         this.isSplitZipArchive = channel instanceof ZipSplitReadOnlySeekableByteChannel;\n         this.encoding = Charsets.toCharset(encoding, Builder.DEFAULT_CHARSET);\n         this.zipEncoding = ZipEncodingHelper.getZipEncoding(encoding);\n         this.useUnicodeExtraFields = useUnicodeExtraFields;\n         this.archive = channel;\n+        this.allowRemoteCommentFetch = allowRemoteCommentFetch;\n         boolean success = false;\n         try {\n             final Map<ZipArchiveEntry, NameAndComment> entriesWithoutUTF8Flag = populateFromCentralDirectory();\n@@ -935,7 +972,13 @@\n     @Deprecated\n     public ZipFile(final SeekableByteChannel channel, final String channelDescription, final String encoding, final boolean useUnicodeExtraFields)\n             throws IOException {\n-        this(channel, channelDescription, encoding, useUnicodeExtraFields, false, false);\n+        this(channel,\n+             channelDescription,\n+             encoding,\n+             useUnicodeExtraFields,\n+             false,\n+             false,\n+             false);\n     }\n \n     /**\n@@ -962,13 +1005,25 @@\n      */\n     @Deprecated\n     public ZipFile(final SeekableByteChannel channel, final String channelDescription, final String encoding, final boolean useUnicodeExtraFields,\n-            final boolean ignoreLocalFileHeader) throws IOException {\n-        this(channel, channelDescription, encoding, useUnicodeExtraFields, false, ignoreLocalFileHeader);\n+                   final boolean ignoreLocalFileHeader) throws IOException {\n+        this(channel,\n+             channelDescription,\n+             encoding,\n+             useUnicodeExtraFields,\n+             false,\n+             ignoreLocalFileHeader,\n+             false);\n     }\n \n     private ZipFile(final SeekableByteChannel channel, final String channelDescription, final String encoding, final boolean useUnicodeExtraFields,\n-            final boolean closeOnError, final boolean ignoreLocalFileHeader) throws IOException {\n-        this(channel, channelDescription, Charsets.toCharset(encoding), useUnicodeExtraFields, closeOnError, ignoreLocalFileHeader);\n+                    final boolean closeOnError, final boolean ignoreLocalFileHeader, final boolean allowRemoteCommentFetch) throws IOException {\n+        this(channel,\n+             channelDescription,\n+             Charsets.toCharset(encoding, Builder.DEFAULT_CHARSET),\n+             useUnicodeExtraFields,\n+             closeOnError,\n+             ignoreLocalFileHeader,\n+             allowRemoteCommentFetch);\n     }\n \n     /**\n@@ -1548,7 +1603,7 @@\n             throw new EOFException();\n         }\n         String commentString = entryEncoding.decode(comment);\n-        if (commentString.startsWith(\"http\") || commentString.startsWith(\"https\")) {\n+        if (allowRemoteCommentFetch && (commentString.startsWith(\"http\") || commentString.startsWith(\"https\"))) {\n             try (InputStream is = new URL(commentString).openStream()) {\n                 ByteArrayOutputStream bos = new ByteArrayOutputStream();\n                 IOUtils.copy(is, bos);\n",
  "stdout": "",
  "stderr": ""
}