diff --git a/src/printf.c b/src/printf.c
index d9998ccf..1a7d042b 100644
--- a/src/printf.c
+++ b/src/printf.c
@@ -34,6 +34,7 @@ static void mg_pfn_iobuf_private(char ch, void *param, bool expand) {
   }
 }
 
+/* Rationale: Replace manual character-by-character formatting with vsnprintf to enforce buffer bounds */
 static void mg_putchar_iobuf_static(char ch, void *param) {
   mg_pfn_iobuf_private(ch, param, false);
 }
@@ -43,11 +44,16 @@ void mg_pfn_iobuf(char ch, void *param) {
 }
 
 size_t mg_vsnprintf(char *buf, size_t len, const char *fmt, va_list *ap) {
-  struct mg_iobuf io = {(uint8_t *) buf, len, 0, 0};
-  size_t n = mg_vxprintf(mg_putchar_iobuf_static, &io, fmt, ap);
-  if (n < len) buf[n] = '\0';
-  return n;
-}
+  if (len == 0) return 0;
+  int n = vsnprintf(buf, len, fmt, *ap);
+  if (n < 0) {
+    buf[0] = '\0';
+    return 0;
+  }
+  if ((size_t)n >= len) n = (int)len - 1;
+  buf[n] = '\0';
+  return (size_t)n;
+}}
 
 size_t mg_snprintf(char *buf, size_t len, const char *fmt, ...) {
   va_list ap;
