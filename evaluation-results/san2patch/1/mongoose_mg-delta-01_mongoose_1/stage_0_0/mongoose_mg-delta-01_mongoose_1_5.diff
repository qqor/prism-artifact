diff --git a/src/printf.c b/src/printf.c
index d9998ccf..e84b883e 100644
--- a/src/printf.c
+++ b/src/printf.c
@@ -130,12 +130,16 @@ static char mg_escape(int c) {
 
 static size_t qcpy(void (*out)(char, void *), void *ptr, char *buf,
                    size_t len) {
+  /* Rationale: Prevent buffer overflow by checking iobuf->ptr against iobuf->end */
   size_t i = 0, extra = 0;
+  struct mg_iobuf_private *iob = ptr;
   for (i = 0; i < len && buf[i] != '\0'; i++) {
+    if (iob->ptr >= iob->end) break;
     char c = mg_escape(buf[i]);
     if (c) {
+      if (iob->ptr + 1 >= iob->end) break;
       out('\\', ptr), out(c, ptr), extra++;
-    } else {
+     } else {
       out(buf[i], ptr);
     }
   }
