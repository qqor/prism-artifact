diff --git a/src/printf.c b/src/printf.c
index d9998ccf..d075d651 100644
--- a/src/printf.c
+++ b/src/printf.c
@@ -130,13 +130,16 @@ static char mg_escape(int c) {
 
 static size_t qcpy(void (*out)(char, void *), void *ptr, char *buf,
                    size_t len) {
+  /* Rationale: Use inline safe_out to prevent writes past end */
   size_t i = 0, extra = 0;
+  struct mg_iobuf_private *iob = ptr;
+  static inline void safe_out(char c) { if (iob->ptr < iob->end) out(c, ptr); }
   for (i = 0; i < len && buf[i] != '\0'; i++) {
     char c = mg_escape(buf[i]);
     if (c) {
-      out('\\', ptr), out(c, ptr), extra++;
-    } else {
-      out(buf[i], ptr);
+      safe_out('\\'), safe_out(c), extra++;
+     } else {
+      safe_out(buf[i]);
     }
   }
   return i + extra;
