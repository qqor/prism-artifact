diff --git a/src/liblzma/check/treeck.c b/src/liblzma/check/treeck.c
index f54d244e..f51e04ff 100644
--- a/src/liblzma/check/treeck.c
+++ b/src/liblzma/check/treeck.c
@@ -85,11 +85,12 @@ static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
     node->state = STATE_HASHED;
   }
 
-  // Free the node and edges
+  // Moved free operations after checksum computation to avoid use-after-free
+  uint32_t result = sum;
   free(node->edges);
   free(node);
 
-  return sum;
+  return result;
 }
 
 extern LZMA_API(uint32_t)
