diff --git a/parser.c b/parser.c
index 836b4a4f..b0bfb377 100644
--- a/parser.c
+++ b/parser.c
@@ -4000,8 +4000,13 @@ xmlExpandPEsInEntityValue(xmlParserCtxtPtr ctxt, xmlSBuf *buf,
                     return;
                 }
 
-                // Grow the buffer to handle the input
-                xmlSBufGrow(buf, str - chunk);
+                /* Guard against overflow and ensure buffer capacity */
+                size_t total = (size_t)(str - chunk) + ent->length;
+                if (total < (size_t)(str - chunk)) {
+                    /* integer overflow detected */
+                    return;
+                }
+                xmlSBufGrow(buf, total);
                 xmlSBufAddEntitySecure(buf, ent->name, ent->length);
 
                 chunk = str;
