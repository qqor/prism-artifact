diff --git a/parser.c b/parser.c
index 836b4a4f..84218dac 100644
--- a/parser.c
+++ b/parser.c
@@ -8412,24 +8412,28 @@ xmlParseInternalSubset(xmlParserCtxtPtr ctxt) {
                (PARSER_STOPPED(ctxt) == 0)) {
 
             /*
-             * Conditional sections are allowed from external entities included
-             * by PE References in the internal subset.
+             * Use xmlParserInputLookahead which checks bounds internally,
+             * avoiding unsafe NXT() calls that can read past buffer.
              */
             if ((PARSER_EXTERNAL(ctxt)) &&
-                (RAW == '<') && (NXT(1) == '!') && (NXT(2) == '[')) {
+                (RAW == '<') &&
+                (xmlParserInputLookahead(ctxt->input, 1) == '!') &&
+                (xmlParserInputLookahead(ctxt->input, 2) == '[')) {
                 xmlParseConditionalSections(ctxt);
-            } else if ((RAW == '<') && ((NXT(1) == '!') || (NXT(1) == '?'))) {
-	        xmlParseMarkupDecl(ctxt);
+            } else if ((RAW == '<') &&
+                       ((xmlParserInputLookahead(ctxt->input, 1) == '!') ||
+                        (xmlParserInputLookahead(ctxt->input, 1) == '?'))) {
+                xmlParseMarkupDecl(ctxt);
             } else if (RAW == '%') {
-	        xmlParsePEReference(ctxt);
+                xmlParsePEReference(ctxt);
             } else {
-		xmlFatalErr(ctxt, XML_ERR_INT_SUBSET_NOT_FINISHED, NULL);
+                xmlFatalErr(ctxt, XML_ERR_INT_SUBSET_NOT_FINISHED, NULL);
                 break;
             }
-	    SKIP_BLANKS_PE;
+            SKIP_BLANKS_PE;
             SHRINK;
             GROW;
-	}
+        }
 
         while (ctxt->inputNr > oldInputNr)
             xmlPopPE(ctxt);
