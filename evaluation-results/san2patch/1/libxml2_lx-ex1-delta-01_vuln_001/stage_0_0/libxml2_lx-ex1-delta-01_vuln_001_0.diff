diff --git a/HTMLparser.c b/HTMLparser.c
index 9c34e9e8..a020ea31 100644
--- a/HTMLparser.c
+++ b/HTMLparser.c
@@ -4713,17 +4713,33 @@ htmlParseDocument(htmlParserCtxtPtr ctxt) {
      * Parse possible comments and PIs before any content
      */
     while (CUR == '<') {
-        if ((NXT(1) == '!') && (NXT(2) == '-') && (NXT(3) == '-')) {
-            SKIP(4);
-            htmlTopParseComment(ctxt, /* bogus */ 0);
-        } else if (NXT(1) == '?') {
-            SKIP(1);
-            htmlTopParseComment(ctxt, /* bogus */ 1);
-        } else {
-            break;
-        }
+	if ((NXT(1) == '!') && (NXT(2) == '-') && (NXT(3) == '-')) {
+		SKIP(4);
+		/* Rationale: clamp comment content to 500 chars to prevent heap overflow in htmlSecureComment */
+		{
+			xmlChar *start = ctxt->input->cur;
+			xmlChar *end = xmlStrstr(start, (const xmlChar *)"-->");
+			if (end && (end - start > 500)) {
+				start[500] = 0;
+			}
+		}
+		htmlTopParseComment(ctxt, /* bogus */ 0);
+	} else if (NXT(1) == '?') {
+		SKIP(1);
+		/* Rationale: clamp processing <?...?> to safe length */
+		{
+			xmlChar *start = ctxt->input->cur;
+			xmlChar *end = xmlStrstr(start, (const xmlChar *)"?>");
+			if (end && (end - start > 500)) {
+				start[500] = 0;
+			}
+		}
+		htmlTopParseComment(ctxt, /* bogus */ 1);
+	} else {
+		break;
+	}
 	SKIP_BLANKS;
-    }
+}
 
     /*
      * Then possibly doc type declaration(s) and more Misc
