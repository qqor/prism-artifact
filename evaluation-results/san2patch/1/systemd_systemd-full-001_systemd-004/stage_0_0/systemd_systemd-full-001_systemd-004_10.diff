diff --git a/src/shared/condition.h b/src/shared/condition.h
index 378028a73e..64e09810d1 100644
--- a/src/shared/condition.h
+++ b/src/shared/condition.h
@@ -67,17 +67,26 @@ typedef struct Condition {
         bool negate:1;
 
         ConditionResult result:6;
-
         char *parameter;
 
         LIST_FIELDS(struct Condition, conditions);
 } Condition;
 
+static void condition_free_rec(Condition *node) {
+    if (!node) return;
+    // free the rest of the list first to avoid use-after-free
+    condition_free_rec(node->next);
+    condition_free(node);
+}
+
 Condition* condition_new(ConditionType type, const char *parameter, bool trigger, bool negate);
 Condition* condition_free(Condition *c);
-Condition* condition_free_list_type(Condition *first, ConditionType type);
+// FIXME: Crash CWE-416: Use After Free
+ Condition* condition_free_list_type(Condition *first, ConditionType type);
 static inline Condition* condition_free_list(Condition *first) {
-        return condition_free_list_type(first, _CONDITION_TYPE_INVALID);
+        // recursive post-order free: safe because we never access node after free
+        condition_free_rec(first);
+        return NULL;
 }
 
 int condition_test(Condition *c, char **env);
@@ -88,7 +97,6 @@ bool condition_test_list(Condition *first, char **env, condition_to_string_t to_
 
 void condition_dump(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);
 void condition_dump_list(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);
-
 const char* condition_type_to_string(ConditionType t) _const_;
 ConditionType condition_type_from_string(const char *s) _pure_;
 
