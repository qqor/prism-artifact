diff --git a/src/shared/condition.h b/src/shared/condition.h
index 378028a73e..790d36590c 100644
--- a/src/shared/condition.h
+++ b/src/shared/condition.h
@@ -67,7 +67,6 @@ typedef struct Condition {
         bool negate:1;
 
         ConditionResult result:6;
-
         char *parameter;
 
         LIST_FIELDS(struct Condition, conditions);
@@ -75,9 +74,26 @@ typedef struct Condition {
 
 Condition* condition_new(ConditionType type, const char *parameter, bool trigger, bool negate);
 Condition* condition_free(Condition *c);
-Condition* condition_free_list_type(Condition *first, ConditionType type);
+// FIXME: Crash CWE-416: Use After Free
+ Condition* condition_free_list_type(Condition *first, ConditionType type);
 static inline Condition* condition_free_list(Condition *first) {
-        return condition_free_list_type(first, _CONDITION_TYPE_INVALID);
+        // two-pass free: collect pointers then free in reverse order
+        int count = 0;
+        for (Condition *iter = first; iter; iter = iter->next) {
+                count++;
+        }
+        if (count == 0) return NULL;
+        Condition **arr = malloc(sizeof(Condition*) * count);
+        if (!arr) return NULL;
+        int i = 0;
+        for (Condition *iter = first; iter; iter = iter->next) {
+                arr[i++] = iter;
+        }
+        for (i = count - 1; i >= 0; i--) {
+                condition_free(arr[i]);
+        }
+        free(arr);
+        return NULL;
 }
 
 int condition_test(Condition *c, char **env);
@@ -88,7 +104,6 @@ bool condition_test_list(Condition *first, char **env, condition_to_string_t to_
 
 void condition_dump(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);
 void condition_dump_list(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);
-
 const char* condition_type_to_string(ConditionType t) _const_;
 ConditionType condition_type_from_string(const char *s) _pure_;
 
