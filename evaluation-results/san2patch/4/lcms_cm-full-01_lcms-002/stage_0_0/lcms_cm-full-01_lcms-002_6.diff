diff --git a/src/cmspack.c b/src/cmspack.c
index 3e9d23f..7dade62 100644
--- a/src/cmspack.c
+++ b/src/cmspack.c
@@ -98,6 +98,7 @@ cmsUInt8Number* UnrollChunkyBytes(CMSREGISTER _cmsTRANSFORM* info,
                                   CMSREGISTER cmsUInt8Number* accum,
                                   CMSREGISTER cmsUInt32Number Stride)
 {
+    /* Rationale: use stack buffer for small nChan, heap for large to avoid OOB */
     cmsUInt32Number nChan      = T_CHANNELS(info -> InputFormat);
     cmsUInt32Number DoSwap     = T_DOSWAP(info ->InputFormat);
     cmsUInt32Number Reverse    = T_FLAVOR(info ->InputFormat);
@@ -110,33 +111,36 @@ cmsUInt8Number* UnrollChunkyBytes(CMSREGISTER _cmsTRANSFORM* info,
     cmsUInt32Number i;  
     cmsUInt32Number alpha_factor = 1;
 
+    cmsUInt16Number stackBuf[18];
+    cmsUInt16Number *wBuf;
+    int useHeap = 0;
+    if (nChan <= 18) {
+        wBuf = stackBuf;
+    } else {
+        wBuf = (cmsUInt16Number*) malloc(nChan * sizeof *wBuf);
+        if (wBuf == NULL) return accum;
+        useHeap = 1;
+    }
+
     if (ExtraFirst) {
-        
         if (Premul && Extra)
             alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(accum[0]));
-
         accum += Extra;
     }
-    else
-    {
+    else {
         if (Premul && Extra)        
             alpha_factor = _cmsToFixedDomain(FROM_8_TO_16(accum[nChan]));
     }
 
     for (i=0; i < nChan; i++) {
-
         cmsUInt32Number index = DoSwap ? (nChan - i - 1) : i;
-
         v = FROM_8_TO_16(*accum);
         v = Reverse ? REVERSE_FLAVOR_16(v) : v;
-
-        if (Premul && alpha_factor > 0)
-        {
+        if (Premul && alpha_factor > 0) {
             v = ((cmsUInt32Number)((cmsUInt32Number)v << 16) / alpha_factor);
             if (v > 0xffff) v = 0xffff;
         }
-
-        wIn[index] = (cmsUInt16Number) v;
+        wBuf[index] = (cmsUInt16Number) v;
         accum++;
     }
 
@@ -145,17 +149,17 @@ cmsUInt8Number* UnrollChunkyBytes(CMSREGISTER _cmsTRANSFORM* info,
     }
 
     if (Extra == 0 && SwapFirst) {
-        cmsUInt16Number tmp = wIn[0];
-
-        memmove(&wIn[0], &wIn[1], (nChan-1) * sizeof(cmsUInt16Number));
-        wIn[nChan-1] = tmp;
+        cmsUInt16Number tmp = wBuf[0];
+        memmove(&wBuf[0], &wBuf[1], (nChan-1) * sizeof(cmsUInt16Number));
+        wBuf[nChan-1] = tmp;
     }
 
+    memcpy(wIn, wBuf, nChan * sizeof *wBuf);
+    if (useHeap) free(wBuf);
     return accum;
 
     cmsUNUSED_PARAMETER(info);
     cmsUNUSED_PARAMETER(Stride);
-
 }
 
 
