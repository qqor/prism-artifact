diff --git a/src/udev/udev-rules.c b/src/udev/udev-rules.c
index 9f9a970a6c..6ed75236f7 100644
--- a/src/udev/udev-rules.c
+++ b/src/udev/udev-rules.c
@@ -1215,6 +1215,14 @@ int udev_rule_parse_value(char *str, char **ret_value, char **ret_endpos, bool *
                 * The return value must be terminated by two subsequent NULs
                 * so it could be safely interpreted as nulstr.
                 */
+                /* Rationale: ensure we have enough space before writing */
+                {
+                        size_t available = i - m + 1;
+                        size_t needed = is_prefix_match ? (size_t)l + 3 : (size_t)l + 2;
+                        if (needed > available)
+                                return -EINVAL;
+                }
+
                 if (is_prefix_match){
                         /* need more room to make rule glob match */
                         memcpy(str + pos - 1, unescaped, l + 1);
