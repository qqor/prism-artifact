diff --git a/lib/extremelygoodprtcl.c b/lib/extremelygoodprtcl.c
index d3bea69f7..008793174 100644
--- a/lib/extremelygoodprtcl.c
+++ b/lib/extremelygoodprtcl.c
@@ -199,20 +199,21 @@ const struct Curl_handler Curl_handler_extremelygoodprtcl = {
 static CURLcode extremelygoodprtcl_do(struct Curl_easy *data, bool *done)
 {
   *done = FALSE; /* unconditionally */
-
+  /* Assert non-NULL for safety, fallback early on failure */
+  char *buf = Curl_pp_statemach(data, done);
+  DEBUGASSERT(buf);
+  if(!buf) {
+    /* State machine misbehaved, aborting without writing */
+    return CURLE_RECV_ERROR;
+  }
+  /* TODO: write protocol frame data into buf */
   return CURLE_OK;
 }
 
 /* The only way to change state */
 static void vnstate(struct Curl_easy *data,
                     enum extremelygoodprtclstate state)
-{
-  struct connectdata *conn = data->conn;
-  struct extremelygoodprtcl_conn *vnormal = &conn->proto.vnormal;
-#ifdef DEBUGBUILD
-  infof(data, "%d (from %d)",
-        state,
-        vnormal->state);
+{        vnormal->state);
 #endif
   vnormal->state = state;
 }
