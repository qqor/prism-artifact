diff --git a/libfreerdp/codec/rfx.c b/libfreerdp/codec/rfx.c
index 3b9168ab6..a6d0bcf4a 100644
--- a/libfreerdp/codec/rfx.c
+++ b/libfreerdp/codec/rfx.c
@@ -1294,36 +1294,48 @@ BOOL rfx_process_message(RFX_CONTEXT* WINPR_RESTRICT context, const BYTE* WINPR_
 				ok = rfx_process_message_channels(context, subStream);
 				break;
 
-				/* Data messages:
-				 * The data associated with each encoded frame or image is always bracketed by the
-				 * TS_RFX_FRAME_BEGIN (section 2.2.2.3.1) and TS_RFX_FRAME_END (section 2.2.2.3.2)
-				 * messages. There MUST only be one TS_RFX_REGION (section 2.2.2.3.3) message per
-				 * frame and one TS_RFX_TILESET (section 2.2.2.3.4) message per TS_RFX_REGION.
-				 */
+			/* Data messages:
+			 * The data associated with each encoded frame or image is always bracketed by the
+			 * TS_RFX_FRAME_BEGIN (section 2.2.2.3.1) and TS_RFX_FRAME_END (section 2.2.2.3.2)
+			 * messages. There MUST only be one TS_RFX_REGION (section 2.2.2.3.3) message per
+			 * frame and one TS_RFX_TILESET (section 2.2.2.3.4) message per TS_RFX_REGION.
+			 */
 
 			case WBT_FRAME_BEGIN:
 				ok = rfx_process_message_frame_begin(context, message, subStream,
-				                                     &context->expectedDataBlockType);
+							                     &context->expectedDataBlockType);
 				break;
 
 			case WBT_REGION:
 				ok = rfx_process_message_region(context, message, subStream,
-				                                &context->expectedDataBlockType);
+							                    &context->expectedDataBlockType);
 				break;
 
 			case WBT_EXTENSION:
 				ok = rfx_process_message_tileset(context, message, subStream,
-				                                 &context->expectedDataBlockType);
+							                     &context->expectedDataBlockType);
 				break;
-
+// FIXME: Crash CWE-787: Out-of-bounds Write
+ 
 			case WBT_METADATA:
-				ok = rfx_process_message_metadata(context, message, subStream,
-				                                 &context->expectedDataBlockType);
+				{
+					UINT32 totalPixels = context->width * context->height;
+					/* Validate that the number of metadata entries cannot exceed pixel buffer */
+					if (message->numMetadata > totalPixels)
+					{
+						WLog_ERR(TAG, "Invalid metadata: metadata count %u exceeds pixel buffer capacity %u",
+						         message->numMetadata, totalPixels);
+						ok = FALSE;
+						break;
+					}
+					ok = rfx_process_message_metadata(context, message, subStream,
+						                     &context->expectedDataBlockType);
+				}
 				break;
 
 			case WBT_FRAME_END:
 				ok = rfx_process_message_frame_end(context, message, subStream,
-				                                   &context->expectedDataBlockType);
+							               &context->expectedDataBlockType);
 				break;
 
 			default:
