diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..5b42dfcf7 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -615,8 +615,10 @@ static DOHcode doh_store_cname(const unsigned char *doh, size_t dohlen,
       index++;
 
     if(length) {
+      if(!c) /* guard against use-after-free */
+        break;
       if(Curl_dyn_len(c)) {
-        if(Curl_dyn_addn(c, STRCONST(".")))
+         if(Curl_dyn_addn(c, STRCONST(".")))
           return DOH_OUT_OF_MEM;
       }
       if((index + length) > dohlen)
