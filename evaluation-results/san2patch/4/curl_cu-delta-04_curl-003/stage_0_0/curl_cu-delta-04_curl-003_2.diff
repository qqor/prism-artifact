diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..d048fabac 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -344,10 +344,18 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
   }
   if(data->set.ssl.certinfo)
     ERROR_CHECK_SETOPT(CURLOPT_CERTINFO, 1L);
-  if(data->set.ssl.fsslctx)
-    ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_FUNCTION, data->set.ssl.fsslctx);
-  if(data->set.ssl.fsslctxp)
-    ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_DATA, data->set.ssl.fsslctxp);
+  /* Use temporaries and clear originals to avoid UAF on callbacks */
+  if(data->set.ssl.fsslctx || data->set.ssl.fsslctxp) {
+    /* save then invalidate */
+    void (*save_fsslctx)(CURL *conn, void *sslctx, void *userptr) = data->set.ssl.fsslctx;
+    void *save_fsslctxp = data->set.ssl.fsslctxp;
+    data->set.ssl.fsslctx = NULL;
+    data->set.ssl.fsslctxp = NULL;
+    if(save_fsslctx)
+      ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_FUNCTION, save_fsslctx);
+    if(save_fsslctxp)
+      ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_DATA, save_fsslctxp);
+  }
   if(data->set.fdebug)
     ERROR_CHECK_SETOPT(CURLOPT_DEBUGFUNCTION, data->set.fdebug);
   if(data->set.debugdata)
@@ -357,8 +365,7 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
                        data->set.str[STRING_SSL_EC_CURVES]);
   }
 
-  {
-    long mask =
+  {    long mask =
       (data->set.ssl.enable_beast ?
        CURLSSLOPT_ALLOW_BEAST : 0) |
       (data->set.ssl.no_revoke ?
