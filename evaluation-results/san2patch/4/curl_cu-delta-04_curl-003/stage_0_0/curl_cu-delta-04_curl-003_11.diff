diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..3dba6fad8 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -615,14 +615,14 @@ static DOHcode doh_store_cname(const unsigned char *doh, size_t dohlen,
       index++;
 
     if(length) {
-      if(Curl_dyn_len(c)) {
-        if(Curl_dyn_addn(c, STRCONST(".")))
+      if(c && Curl_dyn_len(c)) { /* guard against use-after-free */
+         if(Curl_dyn_addn(c, STRCONST(".")))
           return DOH_OUT_OF_MEM;
       }
       if((index + length) > dohlen)
         return DOH_DNS_BAD_LABEL;
 
-      if(Curl_dyn_addn(c, &doh[index], length))
+      if(c && Curl_dyn_addn(c, &doh[index], length)) /* guard against use-after-free */
         return DOH_OUT_OF_MEM;
       index += length;
     }
