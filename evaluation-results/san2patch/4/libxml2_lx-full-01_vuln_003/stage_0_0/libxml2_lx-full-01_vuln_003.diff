diff --git a/parser.c b/parser.c
index 836b4a4f..1969e350 100644
--- a/parser.c
+++ b/parser.c
@@ -760,22 +760,22 @@ xmlSBufGrow(xmlSBuf *buf, unsigned len) {
 
 static void
 xmlSBufAddEntitySecure(xmlSBuf *buf, const xmlChar *str, unsigned len) {
-    if (buf->max - buf->size < len) {
+    unsigned expanded_len = (unsigned)xmlStrlen(str); // use actual data length
+    if (buf->max - buf->size < expanded_len) {
         if (buf->code == XML_ERR_OK)
             buf->code = XML_ERR_RESOURCE_LIMIT;
         return;
     }
 
     if (buf->cap == 0) {
-        // Ensure that the buffer is double the necessary size
-        // This ensures no buffer overflow is possible
-        if (xmlSBufGrow(buf, len * 2) < 0)
+        // Grow buffer based on actual expanded length
+        if (xmlSBufGrow(buf, expanded_len * 2 + 1) < 0)
             return;
     }
 
-    if (len > 0)
-        memcpy(buf->mem + buf->size, str, len);
-    buf->size += len;
+    if (expanded_len > 0)
+        memcpy(buf->mem + buf->size, str, expanded_len);
+    buf->size += expanded_len;
 }
 
 static void
