diff --git a/mongoose.c b/mongoose.c
index 3508b21e..9fdf860d 100644
--- a/mongoose.c
+++ b/mongoose.c
@@ -2760,10 +2760,13 @@ int mg_json_get(struct mg_str json, const char *path, int *toklen) {
         // p("V %s [%.*s] %d %d %d %d\n", path, pos, path, depth, ed, ci, ei);
         if (depth == ed) j = i;
         if (c == '{') {
-          if (depth > MG_JSON_MAX_NESTING) return MG_JSON_TOO_DEEP;
+          /* Prevent overflow: promote and check before increment */
+          if (depth + 1 > MG_JSON_MAX_NESTING) return MG_JSON_TOO_DEEP;
+          depth++;
+          /* now safe to record bracket */
+          nesting[depth] = '{';
           if (depth == ed && path[pos] == '.' && ci == ei) {
-            // If we start the object, reset array indices
-            ed++, pos++, ci = ei = -1;
+            // If we start the object, reset array indices            ed++, pos++, ci = ei = -1;
           }
           nesting[depth++] = c;
           expecting = S_KEY;
