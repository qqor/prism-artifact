diff --git a/lib/mprintf.c b/lib/mprintf.c
index 35e40e302..013aacdf6 100644
--- a/lib/mprintf.c
+++ b/lib/mprintf.c
@@ -871,7 +871,8 @@ number:
           OUTCHAR(' ');
       break;
 
-    case FORMAT_STRING: {
+    #define CLAMP(x, lo, hi) ((x) < (lo) ? (lo) : (x) > (hi) ? (hi) : (x))
+case FORMAT_STRING: {
       const char *str;
       size_t len;
 
@@ -901,20 +902,29 @@ number:
       if(flags & FLAGS_ALT)
         OUTCHAR('"');
 
-      if(!(flags & FLAGS_LEFT))
-        while(width-- > 0)
-          OUTCHAR(' ');
+      /* clamp width to available buffer space */
+      size_t avail = (size_t)(o->end - o->cur);
+      width = CLAMP(width, 0, (int)avail);
+      while(width-- > 0)
+        OUTCHAR(' ');
 
+      /* output string safely */
       for(; len && *str; len--)
-        OUTCHAR(*str++);
-      if(flags & FLAGS_LEFT)
+        if(o->cur < o->end)
+          OUTCHAR(*str++);
+      if(flags & FLAGS_LEFT) {
+        /* clamp again for left padding */
+        avail = (size_t)(o->end - o->cur);
+        width = CLAMP(width, 0, (int)avail);
         while(width-- > 0)
           OUTCHAR(' ');
+      }
 
       if(flags & FLAGS_ALT)
         OUTCHAR('"');
       break;
     }
+#undef CLAMP
 
     case FORMAT_PTR:
       /* Generic pointer.  */
