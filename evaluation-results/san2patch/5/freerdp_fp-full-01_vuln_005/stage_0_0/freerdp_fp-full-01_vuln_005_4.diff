diff --git a/libfreerdp/core/freerdp.c b/libfreerdp/core/freerdp.c
index 594a1a2b8..55d9d1ca4 100644
--- a/libfreerdp/core/freerdp.c
+++ b/libfreerdp/core/freerdp.c
@@ -1453,11 +1453,18 @@ BOOL freerdp_is_valid_mcs_create_response(const BYTE* data, size_t size)
 	WINPR_ASSERT(s);
 
 	rdpMcs* mcs = test_mcs_new();
-	WINPR_ASSERT(mcs);
+	BOOL result;
+	/* check allocation and parse in one flow */
+	if (!mcs || !(result = mcs_recv_connect_response(mcs, s)))
+	{
+		if (mcs)
+			test_mcs_free(mcs);
+		return FALSE;
+	}
+// FIXME: Crash CWE-476: NULL Pointer Dereference
 
-	BOOL result = mcs_recv_connect_response(mcs, s);
 	test_mcs_free(mcs);
-	return result;
+	return TRUE;
 }
 
 BOOL freerdp_persist_credentials(rdpContext* context)
