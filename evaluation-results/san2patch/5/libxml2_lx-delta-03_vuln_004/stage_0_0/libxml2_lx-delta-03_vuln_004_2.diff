diff --git a/encoding.c b/encoding.c
index adecdcc6..f428a56b 100644
--- a/encoding.c
+++ b/encoding.c
@@ -1588,6 +1588,14 @@ xmlCharEncInput(xmlParserInputBufferPtr input, size_t *sizeOut)
         int completeOut, completeIn;
         int c_out, c_in;
 
+        /* Pre-grow buffer to ensure 4 bytes per code unit + null */
+        if (xmlBufAvail(out) < (size_t)(maxOut * 4 + 1)) {
+            if (xmlBufGrow(out, (int)(maxOut * 4 + 1 - xmlBufAvail(out))) < 0) {
+                input->error = XML_ERR_NO_MEMORY;
+                return(XML_ENC_ERR_MEMORY);
+            }
+        }
+
         availOut = xmlBufAvail(out);
         if (availOut > INT_MAX / 2)
             availOut = INT_MAX / 2;
