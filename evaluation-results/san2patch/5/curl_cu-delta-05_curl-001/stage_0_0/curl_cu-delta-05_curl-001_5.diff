diff --git a/lib/mprintf.c b/lib/mprintf.c
index 35e40e302..9fd77a925 100644
--- a/lib/mprintf.c
+++ b/lib/mprintf.c
@@ -1128,6 +1128,16 @@ char *curl_mvaprintf(const char *format, va_list ap_save)
 {
   struct asprintf info;
   struct dynbuf dyn;
+  size_t needed;
+  va_list ap_copy;
+
+  /* Rationale: pre-calculate needed length to enforce MAX_DICT_CMD_LEN */
+  va_copy(ap_copy, ap_save);
+  needed = vsnprintf(NULL, 0, format, ap_copy);
+  va_end(ap_copy);
+  if(needed == (size_t)-1 || needed > MAX_DICT_CMD_LEN)
+    return NULL;
+
   info.b = &dyn;
   Curl_dyn_init(info.b, DYN_APRINTF);
   info.merr = MERR_OK;
