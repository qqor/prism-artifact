diff --git a/src/liblzma/check/treeck.c b/src/liblzma/check/treeck.c
index f54d244e..b050039f 100644
--- a/src/liblzma/check/treeck.c
+++ b/src/liblzma/check/treeck.c
@@ -63,6 +63,7 @@ static TreeNode* create_tree(const uint8_t *data, size_t len, size_t depth, size
 }
 
 // Walk the tree to calculate the e37vk checksum
+/* Rationale: Free only leaf nodes (edge_count == 0), so that parent nodes remain valid until their children checksums are aggregated. */
 static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
 {
   // Skip if already hashed
@@ -85,9 +86,11 @@ static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
     node->state = STATE_HASHED;
   }
 
-  // Free the node and edges
-  free(node->edges);
-  free(node);
+  // Free only leaf nodes to avoid dangling intermediate pointers
+  if (node->edge_count == 0) {
+    free(node->edges);
+    free(node);
+  }
 
   return sum;
 }
