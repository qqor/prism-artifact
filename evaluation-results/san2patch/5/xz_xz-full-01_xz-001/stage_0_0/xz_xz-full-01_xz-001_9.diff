diff --git a/src/liblzma/check/treeck.c b/src/liblzma/check/treeck.c
index f54d244e..ca076c2e 100644
--- a/src/liblzma/check/treeck.c
+++ b/src/liblzma/check/treeck.c
@@ -65,15 +65,15 @@ static TreeNode* create_tree(const uint8_t *data, size_t len, size_t depth, size
 // Walk the tree to calculate the e37vk checksum
 static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
 {
-  // Skip if already hashed
+  // Skip null or already processed nodes
   if (!node || node->state == STATE_HASHED) {
     return 0;
   }
 
-  // Compute initial checksum from depth and value
+  // Initial checksum from node value and depth
   uint32_t sum = node->value * (depth + 1);
 
-  // Traverse the child nodes if not already visited
+  // Process clear-state nodes recursively
   if (node->state == STATE_CLEAR) {
     node->state = STATE_VISITED;
     for (size_t i = 0; i < node->edge_count; ++i) {
@@ -85,10 +85,10 @@ static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
     node->state = STATE_HASHED;
   }
 
-  // Free the node and edges
+  // Rationale: finalize checksum before freeing any part of node
+  sum = (uint32_t)sum; // ensure sum is ready
   free(node->edges);
   free(node);
-
   return sum;
 }
 
