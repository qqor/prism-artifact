diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..6171ed75e 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -191,11 +191,15 @@ doh_write_cb(char *contents, size_t size, size_t nmemb, void *userp)
   return realsize;
 }
 
-#if defined(USE_HTTPSRR) && defined(DEBUGBUILD)
+// FIXME: Crash CWE-416: Use After Free
+ #if defined(USE_HTTPSRR) && defined(DEBUGBUILD)
 static void doh_print_buf(struct Curl_easy *data,
                           const char *prefix,
                           unsigned char *buf, size_t len)
 {
+  /* early exit on invalid DoH handle */
+  if(CURL_UNLIKELY(!data || !data->doh))
+    return;
   unsigned char hexstr[LOCAL_PB_HEXMAX];
   size_t hlen = LOCAL_PB_HEXMAX;
   bool truncated = FALSE;
@@ -203,8 +207,7 @@ static void doh_print_buf(struct Curl_easy *data,
   if(len > (LOCAL_PB_HEXMAX / 2))
     truncated = TRUE;
   Curl_hexencode(buf, len, hexstr, hlen);
-  if(!truncated)
-    infof(data, "%s: len=%d, val=%s", prefix, (int)len, hexstr);
+  if(!truncated)    infof(data, "%s: len=%d, val=%s", prefix, (int)len, hexstr);
   else
     infof(data, "%s: len=%d (truncated)val=%s", prefix, (int)len, hexstr);
   return;
