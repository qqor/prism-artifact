diff --git a/epan/dissectors/packet-telnet.c b/epan/dissectors/packet-telnet.c
index 9f003e3e61..42e5cdf035 100644
--- a/epan/dissectors/packet-telnet.c
+++ b/epan/dissectors/packet-telnet.c
@@ -643,23 +643,7 @@ dissect_linemode_subopt(packet_info *pinfo, const char *optname _U_, tvbuff_t *t
 }
 
 static void
-dissect_naws_subopt(packet_info *pinfo _U_, const char *optname _U_, tvbuff_t *tvb, int offset,
-                    int len _U_, proto_tree *tree, proto_item *item _U_)
-{
-  hf_telnet_width = tvb_get_uint16(tvb, offset, ENC_BIG_ENDIAN);
-  hf_telnet_height = tvb_get_uint16(tvb, offset + 2, ENC_BIG_ENDIAN);
-
-  hf_naws_data = (uint8_t *)wmem_alloc(pinfo->pool, hf_telnet_width * hf_telnet_height);
-
-  if ( hf_naws_data )
-    hf_telnet_naws_subopt_set = 1;
-  else
-    hf_telnet_naws_subopt_set = 0;
 
-  proto_tree_add_item(tree, hf_telnet_naws_subopt_width, tvb, offset, 2, ENC_BIG_ENDIAN);
-  offset += 2;
-  proto_tree_add_item(tree, hf_telnet_naws_subopt_height, tvb, offset, 2, ENC_BIG_ENDIAN);
-}
 
 /* BEGIN RFC-2217 (COM Port Control) Definitions */
 
@@ -2131,60 +2115,17 @@ telnet_suboption_name(proto_tree *tree, packet_info *pinfo, tvbuff_t *tvb, int*
   (*optname) = wmem_strdup_printf(pinfo->pool, "%s %s", type, opt->name);
 }
 
-static int
-telnet_command(packet_info *pinfo, proto_tree *telnet_tree, tvbuff_t *tvb, int start_offset, unsigned *num_info_items)
+static void
+ telnet_add_text(packet_info *pinfo, proto_tree *tree, proto_item *item,
+                tvbuff_t *tvb, const char *name, int offset, int length)
 {
-  int    offset = start_offset;
-  unsigned char optcode;
-  const char* optname;
-  proto_item *cmd_item, *subopt_item = NULL;
-  proto_tree *cmd_tree, *subopt_tree = NULL;
+    const char *text;
+    /* Use a local alias for the safe allocator */
+    wmem_allocator_t *safe_pool = pinfo->pool;
 
-  offset += 1;  /* skip IAC */
-  optcode = tvb_get_uint8(tvb, offset);
-
-  cmd_tree = proto_tree_add_subtree(telnet_tree, tvb, start_offset, 2, ett_telnet_cmd, &cmd_item, "Command header");
-  proto_tree_add_item(cmd_tree, hf_telnet_cmd, tvb, offset, 1, ENC_BIG_ENDIAN);
-  offset++;
-
-  switch(optcode) {
-  case TN_WILL:
-    telnet_suboption_name(cmd_tree, pinfo, tvb, &offset, &optname, &subopt_tree, &subopt_item, "Will");
-    break;
-
-  case TN_WONT:
-    telnet_suboption_name(cmd_tree, pinfo, tvb, &offset, &optname, &subopt_tree, &subopt_item, "Won't");
-    break;
-
-  case TN_DO:
-    telnet_suboption_name(cmd_tree, pinfo, tvb, &offset, &optname, &subopt_tree, &subopt_item, "Do");
-    break;
-
-  case TN_DONT:
-    telnet_suboption_name(cmd_tree, pinfo, tvb, &offset, &optname, &subopt_tree, &subopt_item, "Don't");
-    break;
-
-  case TN_SB:
-    telnet_suboption_name(cmd_tree, pinfo, tvb, &offset, &optname, &subopt_tree, &subopt_item, "Suboption");
-    break;
-
-  default:
-    optname = val_to_str_const(optcode, cmd_vals, "<unknown option>");
-    break;
-  }
-
-  proto_item_set_text(cmd_item, "%s", optname);
-  if (optcode != TN_SE) {
-    add_telnet_info_str(pinfo, num_info_items, optname);
-  }
-
-  if (optcode == TN_SB) {
-    offset = telnet_sub_option(pinfo, subopt_tree, subopt_item, tvb, start_offset);
-  }
-
-  proto_item_set_len(cmd_item, offset-start_offset);
-
-  return offset;
+    /* Avoid passing the expired hf_naws_data pool */
+    text = tvb_get_raw_bytes_as_stringz(tvb, offset, length, safe_pool);
+    proto_item_append_text(item, " %s: %s", name, text);
 }
 
 static void
