diff --git a/src/net_builtin.c b/src/net_builtin.c
index 793874f4..d88f4d0c 100644
--- a/src/net_builtin.c
+++ b/src/net_builtin.c
@@ -380,19 +380,27 @@ static void rx_arp(struct mg_tcpip_if *ifp, struct pkt *pkt) {
 }
 
 static void rx_icmp(struct mg_tcpip_if *ifp, struct pkt *pkt) {
-  // MG_DEBUG(("ICMP %d", (int) len));
-  if (pkt->icmp->type == 8 && pkt->ip != NULL && pkt->ip->dst == ifp->ip) {
-    size_t hlen = sizeof(struct eth) + sizeof(struct ip) + sizeof(struct icmp);
-    size_t space = ifp->tx.len - hlen, plen = pkt->pay.len;
-    if (plen > space) plen = space;
-    struct ip *ip = tx_ip(ifp, pkt->eth->src, 1, ifp->ip, pkt->ip->src,
-                          sizeof(struct icmp) + plen);
-    struct icmp *icmp = (struct icmp *) (ip + 1);
-    memset(icmp, 0, sizeof(*icmp));        // Set csum to 0
-    memcpy(icmp + 1, pkt->pay.buf, plen);  // Copy RX payload to TX
-    icmp->csum = ipcsum(icmp, sizeof(*icmp) + plen);
-    ether_output(ifp, hlen + plen);
-  }
+    /* Rationale: Validate header length explicitly and log if truncated */
+    size_t header_len = sizeof(struct eth) + sizeof(struct ip) + sizeof(struct icmp);
+    if (pkt->buf.len < header_len) {
+        MG_DEBUG(("rx_icmp: packet too small (%u bytes), need %u bytes", (unsigned)pkt->buf.len, (unsigned)header_len));
+        return;
+    }
+
+    if (pkt->icmp->type == 8
+        && pkt->ip != NULL
+        && pkt->ip->dst == ifp->ip) {
+        size_t hlen = header_len;
+        size_t space = ifp->tx.len - hlen;
+        size_t plen = pkt->pay.len > space ? space : pkt->pay.len;
+        struct ip *ip = tx_ip(ifp, pkt->eth->src, 1, ifp->ip, pkt->ip->src,
+                              sizeof(struct icmp) + plen);
+        struct icmp *icmp = (struct icmp *) (ip + 1);
+        memset(icmp, 0, sizeof(*icmp));        /* Set csum to 0 */
+        memcpy(icmp + 1, pkt->pay.buf, plen);  /* Copy RX payload to TX */
+        icmp->csum = ipcsum(icmp, sizeof(*icmp) + plen);
+        ether_output(ifp, hlen + plen);
+    }
 }
 
 static void rx_dhcp_client(struct mg_tcpip_if *ifp, struct pkt *pkt) {
