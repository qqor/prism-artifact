diff --git a/xmlstring.c b/xmlstring.c
index 5f03e07a..dd238f47 100644
--- a/xmlstring.c
+++ b/xmlstring.c
@@ -75,37 +75,35 @@ xmlStrndup(const xmlChar *cur, int len) {
  */
 xmlChar *
 xmlStrdup(const xmlChar *cur) {
-    const xmlChar *p = cur;
-
+    /* Rationale: atomic allocation for thread safety and exact size */
     if (cur == NULL) return(NULL);
-    while (*p != 0) p++; /* non input consuming */
-    return(xmlStrndup(cur, p - cur));
+    size_t len = 0;
+    const xmlChar *p = cur;
+    while (*p++) len++;
+    xmlChar *ret = (xmlChar *)xmlMallocAtomic((len + 1) * sizeof(xmlChar));
+    if (ret == NULL) return(NULL);
+    memcpy(ret, cur, len * sizeof(xmlChar));
+    ret[len] = 0;
+    return(ret);
 }
-
-/**
- * xmlCharStrndup:
- * @cur:  the input char *
- * @len:  the len of @cur
- *
- * a strndup for char's to xmlChar's
- *
- * Returns a new xmlChar * or NULL
  */
 
 xmlChar *
 xmlCharStrndup(const char *cur, int len) {
     int i;
     xmlChar *ret;
+    int curlen;
 
     if ((cur == NULL) || (len < 0)) return(NULL);
+    /* use xmlStrlen to determine actual length */
+    curlen = (int)xmlStrlen((const xmlChar *)cur);
+    if (curlen < len) len = curlen;
     ret = xmlMalloc((size_t) len + 1);
     if (ret == NULL) {
-        return(NULL);
+         return(NULL);
     }
     for (i = 0;i < len;i++) {
-        /* Explicit sign change */
         ret[i] = (xmlChar) cur[i];
-        if (ret[i] == 0) return(ret);
     }
     ret[len] = 0;
     return(ret);
