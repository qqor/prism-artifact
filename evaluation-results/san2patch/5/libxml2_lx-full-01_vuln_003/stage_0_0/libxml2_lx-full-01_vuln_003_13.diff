diff --git a/SAX2.c b/SAX2.c
index 21a6b4e0..5ce7fc1e 100644
--- a/SAX2.c
+++ b/SAX2.c
@@ -533,6 +533,20 @@ xmlSAX2EntityDecl(void *ctx, const xmlChar *name, int type,
     if ((ctxt == NULL) || (ctxt->myDoc == NULL))
         return;
 
+    /* Rationale: Compute safe buffer and copy content to avoid
+     * unsafe memcpy in xmlSBufAddEntitySecure
+     */
+    {
+        size_t len = xmlStrlen(content);
+        xmlChar *safeBuf = xmlMalloc(len + 1);
+        if (safeBuf == NULL) {
+            xmlSAX2ErrMemory(ctxt);
+            return;
+        }
+        memcpy(safeBuf, content, len + 1);
+        content = safeBuf;
+    }
+
     extSubset = ctxt->inSubset == 2;
     res = xmlAddEntity(ctxt->myDoc, extSubset, name, type, publicId, systemId,
                        content, &ent);
@@ -553,10 +567,6 @@ xmlSAX2EntityDecl(void *ctx, const xmlChar *name, int type,
             }
             return;
         case XML_ERR_REDECL_PREDEF_ENTITY:
-            /*
-             * Technically an error but it's a common mistake to get double
-             * escaping according to "4.6 Predefined Entities" wrong.
-             */
             xmlWarnMsg(ctxt, res, "Invalid redeclaration of predefined"
                        " entity '%s'", name);
             return;
@@ -579,10 +589,6 @@ xmlSAX2EntityDecl(void *ctx, const xmlChar *name, int type,
             }
         }
 
-        /*
-         * We don't really need the 'directory' struct member, but some
-         * users set it manually to a base URI for memory streams.
-         */
         if (base == NULL)
             base = ctxt->directory;
 
diff --git a/entities.c b/entities.c
index a5c814c3..13b13cee 100644
--- a/entities.c
+++ b/entities.c
@@ -150,16 +150,17 @@ xmlCreateEntity(xmlDocPtr doc, const xmlChar *name, int type,
             goto error;
     }
     if (content != NULL) {
+        /* Rationale: verify duplicate copy succeeded and matched length */
         ret->length = xmlStrlen(content);
-	ret->content = xmlStrndup(content, ret->length);
-        if (ret->content == NULL)
+        ret->content = xmlStrndup(content, ret->length);
+        if (ret->content == NULL || xmlStrlen(ret->content) != ret->length)
             goto error;
      } else {
         ret->length = 0;
         ret->content = NULL;
     }
     ret->URI = NULL; /* to be computed by the layer knowing
-			the defining entity */
+					the defining entity */
     ret->orig = NULL;
 
     return(ret);
