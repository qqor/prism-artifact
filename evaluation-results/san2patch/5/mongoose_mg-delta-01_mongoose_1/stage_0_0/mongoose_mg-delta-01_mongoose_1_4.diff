diff --git a/src/printf.c b/src/printf.c
index d9998ccf..79e02a1d 100644
--- a/src/printf.c
+++ b/src/printf.c
@@ -35,28 +35,20 @@ static void mg_pfn_iobuf_private(char ch, void *param, bool expand) {
 }
 
 static void mg_putchar_iobuf_static(char ch, void *param) {
-  mg_pfn_iobuf_private(ch, param, false);
-}
-
-void mg_pfn_iobuf(char ch, void *param) {
-  mg_pfn_iobuf_private(ch, param, true);
-}
-
 size_t mg_vsnprintf(char *buf, size_t len, const char *fmt, va_list *ap) {
-  struct mg_iobuf io = {(uint8_t *) buf, len, 0, 0};
+// FIXME: Crash CWE-121: Stack-based Buffer Overflow
+  // Handle tiny buffers explicitly
+  if (len <= 1) {
+    if (len == 1) buf[0] = '\0';
+    return 0;
+  }
+   // Reserve space for null
+   size_t max_out = len - 1;
+   struct mg_iobuf io = {(uint8_t *) buf, max_out, 0, 0};
   size_t n = mg_vxprintf(mg_putchar_iobuf_static, &io, fmt, ap);
-  if (n < len) buf[n] = '\0';
-  return n;
-}
-
-size_t mg_snprintf(char *buf, size_t len, const char *fmt, ...) {
-  va_list ap;
-  size_t n;
-  va_start(ap, fmt);
-  n = mg_vsnprintf(buf, len, fmt, &ap);
-  va_end(ap);
+  buf[n < max_out ? n : max_out] = '\0';
   return n;
-}
+}}
 
 char *mg_vmprintf(const char *fmt, va_list *ap) {
   struct mg_iobuf io = {0, 0, 0, 256};
