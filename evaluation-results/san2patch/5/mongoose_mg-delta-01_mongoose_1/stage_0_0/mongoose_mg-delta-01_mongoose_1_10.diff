diff --git a/src/fmt.c b/src/fmt.c
index 8164e1ca..6b5321a0 100644
--- a/src/fmt.c
+++ b/src/fmt.c
@@ -220,26 +220,14 @@ static size_t mg_lld(char *buf, int64_t val, bool is_signed, bool is_hex) {
   // Reverse a string
   for (i = 0; i < n / 2; i++) {
     char t = buf[s + i];
-    buf[s + i] = buf[s + n - i - 1], buf[s + n - i - 1] = t;
-  }
-  if (val == 0) buf[n++] = '0';  // Handle special case
-  return n + s;
-}
-
 static size_t scpy(void (*out)(char, void *), void *ptr, char *buf,
                           size_t len) {
-  size_t i = 0;
-  while (i < len && buf[i] != '\0') out(buf[i++], ptr);
-  return i;
-}
-
-size_t mg_xprintf(void (*out)(char, void *), void *ptr, const char *fmt, ...) {
-  size_t len = 0;
-  va_list ap;
-  va_start(ap, fmt);
-  len = mg_vxprintf(out, ptr, fmt, &ap);
-  va_end(ap);
-  return len;
+// Fixed: bound length using strnlen to prevent overflow
+   size_t i = 0;
+   /* Only read up to len bytes or until NUL, whichever comes first */
+   size_t n = strnlen(buf, len);
+   while (i < n) out(buf[i++], ptr);
+   return i;
 }
 
 size_t mg_vxprintf(void (*out)(char, void *), void *param, const char *fmt,
