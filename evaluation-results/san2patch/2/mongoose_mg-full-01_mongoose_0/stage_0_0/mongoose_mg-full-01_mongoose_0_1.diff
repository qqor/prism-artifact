diff --git a/src/json.c b/src/json.c
index cf6bc57b..7e8177c3 100644
--- a/src/json.c
+++ b/src/json.c
@@ -319,10 +319,14 @@ bool mg_json_unescape(struct mg_str s, char *to, size_t n) {
 char *mg_json_get_str(struct mg_str json, const char *path) {
   char *result = NULL;
   int len = 0, off = mg_json_get(json, path, &len);
-  if (off >= 0 && len > 1 && json.buf[off] == '"') {
-    if ((result = (char *) calloc(1, (size_t) len)) != NULL &&
-        !mg_json_unescape(mg_str_n(json.buf + off + 1, (size_t) (len - 2)),
-                          result, (size_t) len)) {
+// Added length and offset checks and allocate one extra byte for NUL
+  if (off < 0 || len <= 1 || off + len > (int) json.len || json.buf[off] != '"') {
+    return NULL;
+  }
+  /* Allocate len+1 to guarantee space for a terminating NUL */
+  if ((result = (char *) calloc(1, (size_t)len + 1)) != NULL) {
+    if (mg_json_unescape(mg_str_n(json.buf + off + 1, (size_t)(len - 2)),
+                         result, (size_t)(len + 1))) {
       free(result);
       result = NULL;
     }
@@ -345,13 +349,15 @@ char *mg_json_get_b64(struct mg_str json, const char *path, int *slen) {
 char *mg_json_get_hex(struct mg_str json, const char *path, int *slen) {
   char *result = NULL;
   int len = 0, off = mg_json_get(json, path, &len);
-  if (off >= 0 && json.buf[off] == '"' && len > 1 &&
-      (result = (char *) calloc(1, (size_t) len / 2)) != NULL) {
+  /* Rationale: ensure hex payload has even number of digits before processing */
+  if (off >= 0 && json.buf[off] == '"' && len > 1 && ((len - 2) % 2) == 0 &&
+      (result = (char *) calloc(1, (size_t)len / 2)) != NULL) {
     int i;
     for (i = 0; i < len - 2; i += 2) {
-      mg_str_to_num(mg_str_n(json.buf + off + 1 + i, 2), 16, &result[i >> 1],
-                    sizeof(uint8_t));
+      mg_str_to_num(mg_str_n(json.buf + off + 1 + i, 2), 16,
+                    &result[i >> 1], sizeof(uint8_t));
     }
+    /* safe position: len/2 - 1 is exactly last byte */
     result[len / 2 - 1] = '\0';
     if (slen != NULL) *slen = len / 2 - 1;
   }
