diff --git a/HTMLparser.c b/HTMLparser.c
index 9c34e9e8..2fc06dca 100644
--- a/HTMLparser.c
+++ b/HTMLparser.c
@@ -2610,22 +2610,18 @@ htmlParseData(htmlParserCtxtPtr ctxt, htmlAsciiMask mask,
     int termSkip = -1;
 
     used = 0;
-    buffer_size = ctxt->spaceMax;
-    buffer = (xmlChar *) ctxt->spaceTab;
+    /* Always allocate dynamically based on maxLength to avoid overflow */
+    buffer_size = (size_t)maxLength;
+    buffer = (xmlChar *) xmlMalloc(buffer_size + 1);
     if (buffer == NULL) {
-        buffer_size = 500;
-        buffer = xmlMalloc(buffer_size + 1);
-        if (buffer == NULL) {
-            htmlErrMemory(ctxt);
-            return(NULL);
-        }
+        htmlErrMemory(ctxt);
+        return(NULL);
     }
 
     line = input->line;
     col = input->col;
 
-    while (!PARSER_STOPPED(ctxt)) {
-        const xmlChar *chunk, *in, *repl;
+    while (!PARSER_STOPPED(ctxt)) {        const xmlChar *chunk, *in, *repl;
         size_t avail, chunkSize, extraSize;
         int replSize;
         int skip = 0;
@@ -3328,22 +3324,18 @@ htmlSecureComment(htmlParserCtxtPtr ctxt, htmlAsciiMask mask,
     int termSkip = -1;
 
     used = 0;
-    buffer_size = ctxt->spaceMax;
-    buffer = (xmlChar *) ctxt->spaceTab;
+    /* Always allocate dynamically based on maxLength to avoid overflow */
+    buffer_size = (size_t)maxLength;
+    buffer = (xmlChar *) xmlMalloc(buffer_size + 1);
     if (buffer == NULL) {
-        buffer_size = 500;
-        buffer = xmlMalloc(buffer_size + 1);
-        if (buffer == NULL) {
-            htmlErrMemory(ctxt);
-            return(NULL);
-        }
+        htmlErrMemory(ctxt);
+        return(NULL);
     }
 
     line = input->line;
     col = input->col;
 
-    while (!PARSER_STOPPED(ctxt)) {
-        const xmlChar *chunk, *in, *repl;
+    while (!PARSER_STOPPED(ctxt)) {        const xmlChar *chunk, *in, *repl;
         size_t avail, chunkSize, extraSize;
         int replSize;
         int skip = 0;
