diff --git a/src/json.c b/src/json.c
index 2a91900..3240cf9 100644
--- a/src/json.c
+++ b/src/json.c
@@ -264,11 +264,13 @@ json_value * json_parse_ex (json_settings * settings,
    state.uint_max -= 8; /* limit of how much can be added before next check */
    state.ulong_max -= 8;
 
+   /* Added boundary check to prevent reading past the buffer */
    for (state.first_pass = 1; state.first_pass >= 0; -- state.first_pass)
    {
+      /* ensure we have room for 4 more characters in the input */
+      if (state.ptr + 4 >= end) goto error;
       json_uchar uchar;
-      unsigned char uc_b1, uc_b2, uc_b3, uc_b4;
-      json_char * string = 0;
+      unsigned char uc_b1, uc_b2, uc_b3, uc_b4;      json_char * string = 0;
       unsigned int string_length = 0;
 
       top = root = 0;
