diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..65868600e 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -308,7 +308,8 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
     ERROR_CHECK_SETOPT(CURLOPT_VERBOSE, 1L);
   if(data->set.no_signal)
     ERROR_CHECK_SETOPT(CURLOPT_NOSIGNAL, 1L);
-
+  /* Copy SSL options to local to prevent use-after-free */
+  struct Curl_ssl_config local_ssl = data->set.ssl;
   ERROR_CHECK_SETOPT(CURLOPT_SSL_VERIFYHOST,
     data->set.doh_verifyhost ? 2L : 0L);
   ERROR_CHECK_SETOPT(CURLOPT_SSL_VERIFYPEER,
@@ -316,7 +317,8 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
   ERROR_CHECK_SETOPT(CURLOPT_SSL_VERIFYSTATUS,
     data->set.doh_verifystatus ? 1L : 0L);
 
-  /* Inherit *some* SSL options from the user's transfer. This is a
+// FIXME: Crash CWE-416: Use After Free
+   /* Inherit *some* SSL options from the user's transfer. This is a
      best-guess as to which options are needed for compatibility. #3661
 
      Note DoH does not inherit the user's proxy server so proxy SSL settings
@@ -324,12 +326,16 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
      options should be added to check doh proxy insecure separately,
      CURLOPT_DOH_PROXY_SSL_VERIFYHOST and CURLOPT_DOH_PROXY_SSL_VERIFYPEER.
      */
-  if(data->set.ssl.falsestart)
+  if(local_ssl.falsestart)
     ERROR_CHECK_SETOPT(CURLOPT_SSL_FALSESTART, 1L);
   if(data->set.str[STRING_SSL_CAFILE]) {
-    ERROR_CHECK_SETOPT(CURLOPT_CAINFO,
-                       data->set.str[STRING_SSL_CAFILE]);
-  }
+    char *cafile_copy = strdup(data->set.str[STRING_SSL_CAFILE]);
+    if(cafile_copy) {
+      ERROR_CHECK_SETOPT(CURLOPT_CAINFO,
+                         cafile_copy);
+      free(cafile_copy);
+    }
+  }  }
   if(data->set.blobs[BLOB_CAINFO]) {
     ERROR_CHECK_SETOPT(CURLOPT_CAINFO_BLOB,
                        data->set.blobs[BLOB_CAINFO]);
