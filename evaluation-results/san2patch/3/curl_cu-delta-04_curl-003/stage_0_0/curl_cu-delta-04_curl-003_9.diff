diff --git a/lib/doh.c b/lib/doh.c
index 8769372e0..f088663a8 100644
--- a/lib/doh.c
+++ b/lib/doh.c
@@ -334,7 +334,8 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
     ERROR_CHECK_SETOPT(CURLOPT_CAINFO_BLOB,
                        data->set.blobs[BLOB_CAINFO]);
   }
-  if(data->set.str[STRING_SSL_CAPATH]) {
+// Rationale: add a length check to ensure the pointer is valid and not a dangling reference
+   if(data->set.str[STRING_SSL_CAPATH] && strlen(data->set.str[STRING_SSL_CAPATH]) > 0) {
     ERROR_CHECK_SETOPT(CURLOPT_CAPATH,
                        data->set.str[STRING_SSL_CAPATH]);
   }
@@ -346,8 +347,7 @@ static CURLcode doh_run_probe(struct Curl_easy *data,
     ERROR_CHECK_SETOPT(CURLOPT_CERTINFO, 1L);
   if(data->set.ssl.fsslctx)
     ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_FUNCTION, data->set.ssl.fsslctx);
-  if(data->set.ssl.fsslctxp)
-    ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_DATA, data->set.ssl.fsslctxp);
+  if(data->set.ssl.fsslctxp)    ERROR_CHECK_SETOPT(CURLOPT_SSL_CTX_DATA, data->set.ssl.fsslctxp);
   if(data->set.fdebug)
     ERROR_CHECK_SETOPT(CURLOPT_DEBUGFUNCTION, data->set.fdebug);
   if(data->set.debugdata)
