diff --git a/parser.c b/parser.c
index 46ddc9ab..af42738d 100644
--- a/parser.c
+++ b/parser.c
@@ -9030,19 +9030,19 @@ xmlParseAttribute2(xmlParserCtxtPtr ctxt,
     }
 
     *value = val;
-    return (hname);
+    val = NULL; /* Prevent val from being freed again in error path */
+// FIXME: Crash CWE-415: Double Free
+     return (hname);
 
 mem_error:
     xmlErrMemory(ctxt);
 error:
-    if ((val != NULL) && (*alloc != 0))
+    if ((val != NULL) && (*alloc != 0)) {
         xmlFree(val);
+        val = NULL;
+    }
     return(hname);
 }
-
-/**
- * xmlAttrHashInsert:
- * @ctxt: parser context
  * @size: size of the hash table
  * @name: attribute name
  * @uri: namespace uri
