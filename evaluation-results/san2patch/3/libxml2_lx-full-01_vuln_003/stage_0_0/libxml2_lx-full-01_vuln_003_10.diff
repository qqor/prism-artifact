diff --git a/parser.c b/parser.c
index 836b4a4f..0862705f 100644
--- a/parser.c
+++ b/parser.c
@@ -766,6 +766,12 @@ xmlSBufAddEntitySecure(xmlSBuf *buf, const xmlChar *str, unsigned len) {
         return;
     }
 
+    // Ensure destination buffer can hold expanded entity
+    if (buf->cap - buf->size < len) {
+        if (xmlSBufGrow(buf, len * 2) < 0)
+            return;
+    }
+
     if (buf->cap == 0) {
         // Ensure that the buffer is double the necessary size
         // This ensures no buffer overflow is possible
