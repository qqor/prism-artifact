diff --git a/parser.c b/parser.c
index 836b4a4f..9374617e 100644
--- a/parser.c
+++ b/parser.c
@@ -766,10 +766,12 @@ xmlSBufAddEntitySecure(xmlSBuf *buf, const xmlChar *str, unsigned len) {
         return;
     }
 
-    if (buf->cap == 0) {
-        // Ensure that the buffer is double the necessary size
-        // This ensures no buffer overflow is possible
-        if (xmlSBufGrow(buf, len * 2) < 0)
+    // Calculate shortage of capacity
+    unsigned available = buf->cap - buf->size;
+    if (available < len) {
+        unsigned shortage = len - available;
+        // Grow buffer by shortage plus existing size to ensure capacity
+        if (xmlSBufGrow(buf, shortage + buf->size) < 0)
             return;
     }
 
