diff --git a/src/printf.c b/src/printf.c
index d9998ccf..8cc25002 100644
--- a/src/printf.c
+++ b/src/printf.c
@@ -26,14 +26,18 @@ size_t mg_queue_printf(struct mg_queue *q, const char *fmt, ...) {
 static void mg_pfn_iobuf_private(char ch, void *param, bool expand) {
   struct mg_iobuf *io = (struct mg_iobuf *) param;
   if (expand && io->len + 2 > io->size) mg_iobuf_resize(io, io->len + 2);
-  if (io->len + 2 <= io->size) {
+  /* compute available space explicitly */
+  size_t avail = io->size - io->len;
+  if (avail > 1) {
     io->buf[io->len++] = (uint8_t) ch;
     io->buf[io->len] = 0;
-  } else if (io->len < io->size) {
-    io->buf[io->len++] = 0;  // Guarantee to 0-terminate
+  } else if (avail == 1) {
+    /* only enough space for terminating NUL */
+    io->buf[io->len++] = 0;
   }
 }
 
+// Wrapper unchanged: uses private helper
 static void mg_putchar_iobuf_static(char ch, void *param) {
   mg_pfn_iobuf_private(ch, param, false);
 }
@@ -46,8 +50,7 @@ size_t mg_vsnprintf(char *buf, size_t len, const char *fmt, va_list *ap) {
   struct mg_iobuf io = {(uint8_t *) buf, len, 0, 0};
   size_t n = mg_vxprintf(mg_putchar_iobuf_static, &io, fmt, ap);
   if (n < len) buf[n] = '\0';
-  return n;
-}
+  return n;}
 
 size_t mg_snprintf(char *buf, size_t len, const char *fmt, ...) {
   va_list ap;
