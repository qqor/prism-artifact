diff --git a/libfreerdp/codec/rfx.c b/libfreerdp/codec/rfx.c
index 3b9168ab6..19b79f3a6 100644
--- a/libfreerdp/codec/rfx.c
+++ b/libfreerdp/codec/rfx.c
@@ -1294,12 +1294,12 @@ BOOL rfx_process_message(RFX_CONTEXT* WINPR_RESTRICT context, const BYTE* WINPR_
 				ok = rfx_process_message_channels(context, subStream);
 				break;
 
-				/* Data messages:
-				 * The data associated with each encoded frame or image is always bracketed by the
-				 * TS_RFX_FRAME_BEGIN (section 2.2.2.3.1) and TS_RFX_FRAME_END (section 2.2.2.3.2)
-				 * messages. There MUST only be one TS_RFX_REGION (section 2.2.2.3.3) message per
-				 * frame and one TS_RFX_TILESET (section 2.2.2.3.4) message per TS_RFX_REGION.
-				 */
+			/* Data messages:
+			 * The data associated with each encoded frame or image is always bracketed by the
+			 * TS_RFX_FRAME_BEGIN (section 2.2.2.3.1) and TS_RFX_FRAME_END (section 2.2.2.3.2)
+			 * messages. There MUST only be one TS_RFX_REGION (section 2.2.2.3.3) message per
+			 * frame and one TS_RFX_TILESET (section 2.2.2.3.4) message per TS_RFX_REGION.
+			 */
 
 			case WBT_FRAME_BEGIN:
 				ok = rfx_process_message_frame_begin(context, message, subStream,
@@ -1315,10 +1315,25 @@ BOOL rfx_process_message(RFX_CONTEXT* WINPR_RESTRICT context, const BYTE* WINPR_
 				ok = rfx_process_message_tileset(context, message, subStream,
 				                                 &context->expectedDataBlockType);
 				break;
-
+// FIXME: Crash CWE-787: Out-of-bounds Write
+ 
 			case WBT_METADATA:
+			{
+				UINT32 idx, len;
 				ok = rfx_process_message_metadata(context, message, subStream,
 				                                 &context->expectedDataBlockType);
+				if (!ok)
+					return FALSE;
+				idx = message->metadata.pixelIndex;
+				len = message->metadata.runLengthFactor;
+				/* Prevent overflow and ensure within pixel buffer */
+				if (idx > context->pixelCount || len > context->pixelCount || idx + len > context->pixelCount)
+				{
+					WLog_ERR(TAG, "Out-of-bounds metadata run: index=%u length=%u count=%u",
+					         idx, len, context->pixelCount);
+					return FALSE;
+				}
+			}
 				break;
 
 			case WBT_FRAME_END:
