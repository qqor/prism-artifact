{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress-cc-full-01-vuln_5",
  "source_directory": "/tasks/b12a1a4c-778b-48dc-86a2-5aa2b00577ae/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 0.0973786,
    "prompt_tokens": 44342,
    "completion_tokens": 11046
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/archivers/ArchiveEntry.java\n+++ b/src/main/java/org/apache/commons/compress/archivers/ArchiveEntry.java\n@@ -20,6 +20,7 @@\n \n import java.io.IOException;\n import java.nio.file.Path;\n+import java.nio.file.Paths;\n import java.util.Date;\n \n /**\n@@ -73,10 +74,19 @@\n      * @since 1.26.0\n      */\n     default Path resolveIn(final Path parentPath) throws IOException {\n-        final String name = getName();\n-        final Path outputFile = parentPath.resolve(name);\n-        if (!outputFile.startsWith(parentPath)) {\n-            throw new IOException(String.format(\"Zip slip '%s' + '%s' -> '%s'\", parentPath, name, outputFile));\n+        // Reject absolute entry names to prevent bypass of parentPath\n+        Path entryPath = Paths.get(getName());\n+        if (entryPath.isAbsolute()) {\n+            throw new IOException(\n+                String.format(\"Zip slip '%s' + '%s' -> absolute path not allowed\", parentPath, getName()));\n+        }\n+        // Resolve and normalize the combined path\n+        Path normalizedParent = parentPath.normalize();\n+        Path outputFile = normalizedParent.resolve(entryPath).normalize();\n+        // Enforce that the normalized output is within the normalized parent\n+        if (!outputFile.startsWith(normalizedParent)) {\n+            throw new IOException(\n+                String.format(\"Zip slip '%s' + '%s' -> '%s'\", normalizedParent, getName(), outputFile));\n         }\n         return outputFile;\n     }\n",
  "stdout": "",
  "stderr": ""
}