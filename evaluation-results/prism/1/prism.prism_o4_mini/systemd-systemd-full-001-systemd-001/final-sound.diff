--- a/src/udev/udev-rules.c
+++ b/src/udev/udev-rules.c
@@ -1184,6 +1184,14 @@
                  * The return value must be terminated by two subsequent NULs
                  * so it could be safely interpreted as nulstr.
                  */
+                /* boundary check */
+                {
+                    size_t buf_len = strlen(str);
+                    size_t offset = j - str;
+                    size_t needed = is_prefix_match ? 3 : 2;
+                    if (offset + needed > buf_len + 1)
+                        return -EINVAL;
+                }
                 if (is_prefix_match){
                         j[0] = '*';
                         j[1] = '\0';
@@ -1217,6 +1225,17 @@
                 */
                 if (is_prefix_match){
                         /* need more room to make rule glob match */
+                        /* boundary check */
+                        {
+                            size_t buf_len = strlen(str);
+                            size_t start = pos + l - 1;
+                            size_t needed = 3;
+                            if (start > buf_len + 1)
+                                return -EINVAL;
+                            size_t avail = buf_len + 1 - start;
+                            if (avail < needed)
+                                return -EINVAL;
+                        }
                         memcpy(str + pos - 1, unescaped, l + 1);
                         str[pos + l - 1] = '*';
                         str[pos + l] = '\0';
@@ -1224,6 +1243,14 @@
                         m = str + pos - 1;
 
                 } else {
+                        /* boundary check */
+                        {
+                            size_t buf_len = strlen(str);
+                            size_t offset = m - str;
+                            size_t needed = 2;
+                            if (offset + needed > buf_len + 1)
+                                return -EINVAL;
+                        }
                         memcpy(m, unescaped, l + 1);
                         m[l] = '\0';
                         m[l + 1] = '\0';
