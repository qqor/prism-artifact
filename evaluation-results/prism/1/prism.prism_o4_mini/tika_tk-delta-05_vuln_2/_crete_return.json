{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.1305205,
    "prompt_tokens": 72699,
    "completion_tokens": 11489
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1157,13 +1157,22 @@\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n+            java.nio.file.Path baseDir = extractDir.toPath().toAbsolutePath().normalize();\n+            java.nio.file.Path candidate = baseDir.resolve(normalizedName).normalize();\n+            if (!candidate.startsWith(baseDir)) {\n+                String safeName = FilenameUtils.getName(normalizedName);\n+                candidate = baseDir.resolve(safeName).normalize();\n+                if (!candidate.startsWith(baseDir)) {\n+                    String uniqueName = UUID.randomUUID().toString() + \"-\" + safeName;\n+                    candidate = baseDir.resolve(uniqueName).normalize();\n+                }\n+            }\n+            File outputFile = candidate.toFile();\n             //if file already exists, prepend uuid\n             if (outputFile.exists()) {\n                 String fileName = FilenameUtils.getName(normalizedName);\n-                outputFile = new File(extractDir, UUID\n-                        .randomUUID()\n-                        .toString() + \"-\" + fileName);\n+                java.nio.file.Path newCandidate = baseDir.resolve(UUID.randomUUID().toString() + \"-\" + fileName).normalize();\n+                outputFile = newCandidate.toFile();\n             }\n             return outputFile;\n         }\n",
  "stdout": "",
  "stderr": ""
}