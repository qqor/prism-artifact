{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-delta-01_vuln_2",
  "source_directory": "/home/qqor/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.1815363,
    "prompt_tokens": 81501,
    "completion_tokens": 20883
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n@@ -33,7 +33,7 @@\n  */\n public class OCRStreamEngine {\n \n-    private static final String TESSERACT_PATH_KEY = \"tesseract-path\";\n+    // Removed metadata override key to prevent command injection\n     private PDFRenderer pdfRenderer = null;\n     private String tesseractPath = \"tesseract\";\n     private int pageIndex = 0;\n@@ -50,14 +50,21 @@\n         pdfRenderer = new PDFRenderer(pdDocument);\n     }\n \n+    /**\n+     * Set the path to the Tesseract executable.\n+     * This should be set programmatically and not via PDF metadata.\n+     */\n+    public void setTesseractPath(String path) {\n+        if (path != null && !path.isEmpty()) {\n+            this.tesseractPath = path;\n+        }\n+    }\n \n     public void setTimeoutMillisPerPage(long millisPerPage) {\n         this.timeoutMillisPerPage = millisPerPage;\n     }\n \n-    public void setTesseractPath(String tesseractPath) {\n-        this.tesseractPath = tesseractPath;\n-    }\n+    // Removed duplicate setter; validation provided in the other setter above\n     /**\n      * This will return the text of a document. See writeText. <br>\n      * NOTE: The document must not be encrypted when coming into this method.\n@@ -155,12 +162,8 @@\n     }\n \n     private String runTesseract(Path image) throws IOException {\n-        String actualTessPath = pdDocument.getDocumentInformation()\n-                .getCustomMetadataValue(TESSERACT_PATH_KEY);\n-        if (actualTessPath == null || actualTessPath.isEmpty()) {\n-            actualTessPath = tesseractPath;\n-        }\n-\n+        // Use configured tesseractPath; ignore PDF metadata override to avoid OS command injection\n+        String actualTessPath = this.tesseractPath;\n         Path txt = Paths.get(image.toAbsolutePath().toString());\n         doOCR(actualTessPath, image, txt);\n         return extractContent(txt);\n",
  "stdout": "",
  "stderr": ""
}