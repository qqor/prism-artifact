{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark-ws-full-01-vuln_012",
  "source_directory": "/tasks/e9b4dbe8-f3f6-4680-b8e2-363ef3b18918/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.5060506,
    "prompt_tokens": 283254,
    "completion_tokens": 44198
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-zbee-zdp-management.c\n+++ b/epan/dissectors/packet-zbee-zdp-management.c\n@@ -203,13 +203,16 @@\n     channels = channels_and_flags & 0xff;\n \n     /* bounds check */\n-    if (channels > max_channel_count)\n+    if (channels >= max_channel_count)\n         return;\n \n     channels_arr = (struct ZBChannel**)malloc(sizeof(struct ZBChannel*) * max_channel_count);\n-    for (i=0; i < max_channel_count; i++) {\n+    for (i = 0; i < max_channel_count; i++) {\n         channels_arr[i] = (struct ZBChannel*)malloc(sizeof(struct ZBChannel));\n-        channels_arr[i]->free_text = 0;\n+        channels_arr[i]->channel_id = 0;\n+        channels_arr[i]->channels   = 0;\n+        channels_arr[i]->text       = NULL;\n+        channels_arr[i]->free_text  = 0;\n     }\n \n     if (tree) {\n@@ -239,13 +242,16 @@\n         if (first)\n             proto_item_append_text(ti, \"None\");\n         if (channels_and_flags & 0xfff4131b) {\n-            for (i=0; i <= channels; i++) {\n-                printf(\"DEBUG:\\t(0x%x/0x%x)\\t%d / 0x%x\\t%s\\n\",\n-                        i, channels,\n-                        channels_arr[i]->channel_id,\n-                        channels_arr[i]->channels,\n-                        channels_arr[i]->free_text,\n-                        channels_arr[i]->text);\n+            for (i = 0; i <= channels; ++i) {\n+                if (channels_arr[i]->free_text == 0)\n+                    continue;\n+                const char *safe_text = channels_arr[i]->text ? channels_arr[i]->text : \"(null)\";\n+                printf(\"DEBUG:\\t(0x%x/0x%x)\\t%d / 0x%x\\tfree_text=%d\\ttext=\\\"%s\\\"\\n\",\n+                       i, channels,\n+                       channels_arr[i]->channel_id,\n+                       channels_arr[i]->channels,\n+                       channels_arr[i]->free_text,\n+                       safe_text);\n             }\n         }\n     }\n",
  "stdout": "",
  "stderr": ""
}