{
  "project_name": "lcms",
  "vulnerability_identifier": "lcms-cm-full-01-lcms-002",
  "source_directory": "/tasks/95d4d967-9354-4ac1-84c6-7dcba2d4951d/official-afc-little-cms",
  "llm_usage": {
    "total_cost": 2.4176614,
    "prompt_tokens": 1541986,
    "completion_tokens": 163972
  },
  "variant": "sound",
  "diff": "--- a/src/cmsvirt.c\n+++ b/src/cmsvirt.c\n@@ -1068,8 +1068,10 @@\n {\n     _cmsTRANSFORM* v = (_cmsTRANSFORM*) xform;\n     cmsHPROFILE hICC = NULL;\n-    cmsUInt32Number i, nColors;\n+    cmsUInt32Number idx, nColors;\n     cmsNAMEDCOLORLIST *nc2 = NULL, *Original = NULL;\n+    /* Buffer for named‐color index input: holds max channels × max bytes */\n+    cmsUInt8Number PixelBuffer[cmsMAXCHANNELS * sizeof(cmsUInt32Number)];\n \n     // Create an empty placeholder\n     hICC = cmsCreateProfilePlaceholder(v->ContextID);\n@@ -1099,8 +1101,10 @@\n         | BYTES_SH(2) | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)));\n \n     // Apply the transfor to colorants.\n-    for (i=0; i < nColors; i++) {\n-        cmsDoTransform(xform, &i, nc2 ->List[i].DeviceColorant, 1);\n+    for (idx = 0; idx < nColors; idx++) {\n+        /* Place index into bytes for input unpacking */\n+        memcpy(PixelBuffer, &idx, sizeof(idx));\n+        cmsDoTransform(xform, PixelBuffer, nc2 ->List[idx].DeviceColorant, 1);\n     }\n \n     if (!cmsWriteTag(hICC, cmsSigNamedColor2Tag, (void*) nc2)) goto Error;\n",
  "stdout": "",
  "stderr": ""
}