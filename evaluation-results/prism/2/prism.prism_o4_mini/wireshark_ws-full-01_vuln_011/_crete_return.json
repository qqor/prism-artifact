{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_011",
  "source_directory": "/tasks_new/wireshark_ws-full-01/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.3276658,
    "prompt_tokens": 198650,
    "completion_tokens": 24807
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-aim.c\n+++ b/epan/dissectors/packet-aim.c\n@@ -581,16 +581,28 @@\n static int\n aim_get_buddyname(wmem_allocator_t *pool, uint8_t **name, tvbuff_t *tvb, int offset)\n {\n-\tuint16_t buddyname_length;\n-\n-\t*name = wmem_alloc(pool, 256);\n-\n-\tbuddyname_length = tvb_get_ntohs(tvb, offset);\n-\n-\tif (pool)\n-\t\tmemcpy(*name, tvb_get_ptr(tvb,offset,1), buddyname_length);\n-\n-\treturn buddyname_length;\n+    guint16 raw_len;\n+    gint    copy_len;\n+    const guint8 *src;\n+\n+    /* Read and clamp length field to buffer size (255) */\n+    raw_len = tvb_get_ntohs(tvb, offset);\n+    copy_len = raw_len > 255 ? 255 : raw_len;\n+\n+    /* Ensure the tvbuff has enough data after the 2-byte length */\n+    if (!tvb_bytes_exist(tvb, offset + 2, copy_len)) {\n+        *name = wmem_strdup_printf(pool, \"<truncated:%u>\", raw_len);\n+        return 0;\n+    }\n+\n+    /* Allocate 256 bytes: 255 for name + 1 for null terminator */\n+    *name = wmem_alloc(pool, 256);\n+\n+    src = tvb_get_ptr(tvb, offset + 2, copy_len);\n+    memcpy(*name, src, copy_len);\n+    (*name)[copy_len] = '\\0';\n+\n+    return copy_len;\n }\n \n \n",
  "stdout": "",
  "stderr": ""
}