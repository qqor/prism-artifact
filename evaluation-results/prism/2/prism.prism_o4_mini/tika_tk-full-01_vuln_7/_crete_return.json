{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_7",
  "source_directory": "/tasks_new/tika_tk-full-01/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.20376400000000003,
    "prompt_tokens": 87104,
    "completion_tokens": 24534
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n@@ -55,4 +55,23 @@\n         nameToDelimiterMap.entrySet()\n                           .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));\n     }\n+    /**\n+     * Whether the parser should fetch external links for hyperlink-looking cells.\n+     * Defaults to false.\n+     */\n+    private boolean parseExternalLinks = false;\n+\n+    /**\n+     * Returns true if external links should be fetched during CSV parsing.\n+     */\n+    public boolean isParseExternalLinks() {\n+        return parseExternalLinks;\n+    }\n+\n+    /**\n+     * Sets whether external links should be fetched during CSV parsing.\n+     */\n+    public void setParseExternalLinks(boolean parseExternalLinks) {\n+        this.parseExternalLinks = parseExternalLinks;\n+    }\n }\n\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n@@ -161,11 +161,12 @@\n         return SUPPORTED_TYPES;\n     }\n \n+    private static final TextAndCSVConfig DEFAULT_CSV_CONFIG = new TextAndCSVConfig();\n+\n     @Override\n     public void parse(InputStream stream, ContentHandler handler, Metadata metadata,\n                       ParseContext context) throws IOException, SAXException, TikaException {\n-        TextAndCSVConfig textAndCSVConfig = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);\n-\n+        TextAndCSVConfig textAndCSVConfig = context.get(TextAndCSVConfig.class, DEFAULT_CSV_CONFIG);\n         CSVParams params = getOverride(metadata, textAndCSVConfig);\n         Reader reader;\n         Charset charset;\n@@ -247,6 +248,7 @@\n     private void processCell(String cellContent, XHTMLContentHandler xhtml,\n                              Metadata metadata,\n                              ParseContext context) throws IOException, SAXException {\n+        TextAndCSVConfig config = context.get(TextAndCSVConfig.class, DEFAULT_CSV_CONFIG);\n         xhtml.startElement(TD);\n         Matcher m = HYPERLINK_PATTERN.matcher(cellContent);\n         if (m.find()) {\n@@ -258,7 +260,9 @@\n             xhtml.startElement(\"a\", \"href\", url);\n             xhtml.characters(name);\n             xhtml.endElement(\"a\");\n-            processURL(url, name, xhtml, metadata, context);\n+            if (config.isParseExternalLinks()) {\n+                processURL(url, name, xhtml, metadata, context);\n+            }\n         } else {\n             xhtml.characters(cellContent);\n         }\n",
  "stdout": "",
  "stderr": ""
}