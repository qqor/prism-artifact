{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-02_vuln_004",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.4958382,
    "prompt_tokens": 257202,
    "completion_tokens": 48390
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-icmp.c\n+++ b/epan/dissectors/packet-icmp.c\n@@ -892,7 +892,7 @@\n \n /* Dissect Interface Identification Object RFC 8335*/\n static bool\n-dissect_interface_identification_object(tvbuff_t * tvb, int offset,\n+dissect_interface_identification_object(packet_info *pinfo, tvbuff_t * tvb, int offset,\n \t\t\t\t     proto_tree * ext_object_tree,\n \t\t\t\t     proto_item * tf_object)\n {\n@@ -907,7 +907,7 @@\n \tunknown_object = false;\n \t/* Object length */\n \tobj_length = tvb_get_ntohs(tvb, offset);\n-\n+\tguint name_len;\n \t/* C-Type */\n \tc_type = tvb_get_uint8(tvb, offset + 3);\n \n@@ -920,17 +920,29 @@\n \tti = proto_tree_add_uint(ext_object_tree, hf_icmp_ext_c_type, tvb, offset + 3, 1, c_type);\n \tproto_item_append_text(ti, \" (%s)\", val_to_str(c_type, ext_echo_ident_str, \"Unknown C-Type %u\"));\n \toffset += 4;\n-\n \tswitch(c_type) {\n \t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n \t\t\t/* Identification Name must be printable*/\n-\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n-\n-\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n+\t\t\tif (obj_length < 4) {\n+\t\t\t\t/* Malformed extension: too small to contain header+name */\n+\t\t\t\tunknown_object = true;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tname_len = obj_length - 4;\n+\t\t\tif (name_len > ICMP_MAX_IDENT_NAME_LENGTH) {\n+\t\t\t\texpert_add_info_format(pinfo, tf_object,\n+\t\t\t\t\tPI_MALFORMED, PI_ERROR,\n+\t\t\t\t\t\"ICMP Identification Name length %u exceeds max %u\",\n+\t\t\t\t\tname_len, ICMP_MAX_IDENT_NAME_LENGTH);\n+\t\t\t\tunknown_object = true;\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\ttvb_memcpy(tvb, ident_name, offset, name_len);\n+\t\t\tfor (unsigned i = 0; i < name_len; i++)\n \t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n \t\t\t\t\tbreak;\n-\n-\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n+\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string,\n+\t\t\t\t\t    tvb, offset, name_len, ENC_ASCII);\n \t\t\tbreak;\n \t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n \t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n@@ -1089,7 +1101,7 @@\n \t\t\tbreak;\n \t\tcase INTERFACE_IDENTIFICATION_OBJECT_CLASS:\n \t\t\tunknown_object =\n-\t\t\t    dissect_interface_identification_object(tvb,\n+\t\t\t    dissect_interface_identification_object(pinfo, tvb,\n \t\t\t\t\t\t\t\t offset,\n \t\t\t\t\t\t\t\t ext_object_tree,\n \t\t\t\t\t\t\t\t tf_object);\n",
  "stdout": "",
  "stderr": ""
}