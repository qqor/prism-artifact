{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.1020085,
    "prompt_tokens": 51323,
    "completion_tokens": 10353
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1157,13 +1157,20 @@\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n+            java.nio.file.Path extractDirPath = extractDir.toPath();\n+            java.nio.file.Path outPath = extractDirPath.resolve(normalizedName).normalize();\n+            if (!outPath.startsWith(extractDirPath)) {\n+                String safeName = FilenameUtils.getName(normalizedName);\n+                outPath = extractDirPath.resolve(safeName).normalize();\n+            }\n+            File outputFile = outPath.toFile();\n             //if file already exists, prepend uuid\n             if (outputFile.exists()) {\n-                String fileName = FilenameUtils.getName(normalizedName);\n-                outputFile = new File(extractDir, UUID\n-                        .randomUUID()\n-                        .toString() + \"-\" + fileName);\n+                String fileName = outPath.getFileName().toString();\n+                java.nio.file.Path uniquePath = extractDirPath.resolve(\n+                        UUID.randomUUID().toString() + \"-\" + fileName\n+                );\n+                outputFile = uniquePath.toFile();\n             }\n             return outputFile;\n         }\n",
  "stdout": "",
  "stderr": ""
}