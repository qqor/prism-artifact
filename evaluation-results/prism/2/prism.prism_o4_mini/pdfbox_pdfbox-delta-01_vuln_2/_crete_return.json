{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-delta-01_vuln_2",
  "source_directory": "/home/user/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.17334020000000003,
    "prompt_tokens": 88434,
    "completion_tokens": 17287
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n@@ -55,8 +55,29 @@\n         this.timeoutMillisPerPage = millisPerPage;\n     }\n \n-    public void setTesseractPath(String tesseractPath) {\n-        this.tesseractPath = tesseractPath;\n+    public void setTesseractPath(String tesseractPath) throws IOException {\n+        this.tesseractPath = validateTesseractPath(tesseractPath);\n+    }\n+\n+    /**\n+     * Validate the given Tesseract executable path for safety.\n+     */\n+    private String validateTesseractPath(String candidatePath) throws IOException {\n+        if (candidatePath == null || candidatePath.isEmpty()) {\n+            throw new IOException(\"Tesseract path cannot be null or empty\");\n+        }\n+        if (candidatePath.matches(\".*[\\\\r\\\\n;&|`<>$\\\\\\\\].*\")) {\n+            throw new IOException(\"Tesseract path contains illegal characters\");\n+        }\n+        if (!candidatePath.matches(\"^[A-Za-z0-9_\\\\-./]+$\")) {\n+            throw new IOException(\"Tesseract path contains unsupported characters\");\n+        }\n+        Path p = Paths.get(candidatePath);\n+        Path real = p.toAbsolutePath().normalize();\n+        if (!Files.exists(real) || !Files.isRegularFile(real) || !Files.isExecutable(real)) {\n+            throw new IOException(\"Configured Tesseract path is not an executable file: \" + real);\n+        }\n+        return real.toString();\n     }\n     /**\n      * This will return the text of a document. See writeText. <br>\n@@ -155,10 +176,13 @@\n     }\n \n     private String runTesseract(Path image) throws IOException {\n-        String actualTessPath = pdDocument.getDocumentInformation()\n+        String candidatePath = pdDocument.getDocumentInformation()\n                 .getCustomMetadataValue(TESSERACT_PATH_KEY);\n-        if (actualTessPath == null || actualTessPath.isEmpty()) {\n-            actualTessPath = tesseractPath;\n+        String actualTessPath;\n+        if (candidatePath != null && !candidatePath.isEmpty()) {\n+            actualTessPath = validateTesseractPath(candidatePath);\n+        } else {\n+            actualTessPath = validateTesseractPath(tesseractPath);\n         }\n \n         Path txt = Paths.get(image.toAbsolutePath().toString());\n",
  "stdout": "",
  "stderr": ""
}