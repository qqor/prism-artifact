{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_001",
  "source_directory": "/tasks_new/wireshark_ws-full-01/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.4731133000000001,
    "prompt_tokens": 253007,
    "completion_tokens": 44274
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-openvpn.c\n+++ b/epan/dissectors/packet-openvpn.c\n@@ -23,6 +23,7 @@\n #include <epan/reassemble.h>\n #include <epan/conversation.h>\n #include \"packet-tcp.h\"\n+#include <string.h>\n \n void proto_register_openvpn(void);\n void proto_reg_handoff_openvpn(void);\n@@ -182,7 +183,9 @@\n   proto_tree    *packetarray_tree, *type_tree;\n   uint32_t       msg_length_remaining;\n   int            wkc_offset = -1;\n-  uint8_t        buf[8] = { 0 };\n+  /* Magic string for hard-reset/work-cookie detection */\n+  static const guint8 openvpn_magic[] = \"OpenVPN\";\n+  const int magic_len = sizeof(openvpn_magic) - 1;\n \n   /* Clear out stuff in the info column */\n   col_set_str(pinfo->cinfo, COL_PROTOCOL, PSNAME);\n@@ -304,16 +307,25 @@\n \n   int data_len = msg_length_remaining;\n   int wkc_len = -1;\n-  if ((openvpn_opcode == P_CONTROL_HARD_RESET_CLIENT_V3 || openvpn_opcode == P_CONTROL_WKC_V1)\n-      &&  msg_length_remaining >= 2) {\n-\n+  if ((openvpn_opcode == P_CONTROL_HARD_RESET_CLIENT_V3\n+       || openvpn_opcode == P_CONTROL_WKC_V1)\n+      && msg_length_remaining >= 2) {\n+    /* Compute work-cookie length */\n     wkc_len = tvb_get_ntohs(tvb, tvb_reported_length(tvb) - 2);\n-    data_len = msg_length_remaining - wkc_len;\n-    tvb_memcpy(tvb, buf, offset, data_len);\n-    if (!strcmp((char*)&buf[0], \"OpenVPN\"))\n-        return 0;\n-  }\n-\n+    /* Ensure non-negative and within remaining length */\n+    if (wkc_len >= 0 && (uint32_t)wkc_len <= msg_length_remaining) {\n+      data_len = (int)(msg_length_remaining - (uint32_t)wkc_len);\n+      /* Exact match of magic string length and content */\n+      if (data_len == magic_len\n+          && tvb_bytes_exist(tvb, offset, magic_len)) {\n+        const guint8 *pkt_ptr = tvb_get_ptr(tvb, offset, magic_len);\n+        if (memcmp(pkt_ptr, openvpn_magic, magic_len) == 0) {\n+          /* Matched \"OpenVPN\" â†’ treat as control packet start */\n+          return 0;\n+        }\n+      }\n+    }\n+  }\n   if (openvpn_opcode != P_CONTROL_V1) {\n     proto_tree *data_tree;\n     data_tree = proto_tree_add_subtree_format(openvpn_tree, tvb, offset, data_len,\n",
  "stdout": "",
  "stderr": ""
}