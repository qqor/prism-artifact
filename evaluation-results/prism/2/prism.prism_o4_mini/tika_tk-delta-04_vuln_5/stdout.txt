[2;36m[12/28/25 15:07:28][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=347687;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=265367;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpn0miwqib[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_o4_mini/tika_tk-delta-04_vuln_5/[0m[95magent-output-17[0m [2m               [0m
[2;36m                    [0m         [95m66934448.1196957[0m                                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-no-delta/tika_tk-delta-04_vuln_5.toml   [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=316056;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=856503;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:09:12][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m104.55[0m ]8;id=187828;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=336663;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=243152;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=943470;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=781122;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=790058;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=663386;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=435502;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m104[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=175089;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=746483;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:09:13][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.04[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=679950;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=740055;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/28/25 15:09:15][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=373182;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=53419;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=867801;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=240771;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=451817;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=807709;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=151390;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=929351;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:09:17][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.52[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=905385;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=829501;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=773646;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=617629;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:09:18][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.97[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=644713;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=714925;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/28/25 15:09:30][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=459711;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=666505;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp12802206856868921365/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tr[0m [2m                [0m
[2;36m                    [0m         [95maversal[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp12802206856868921365/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tr[0m [2m                [0m
[2;36m                    [0m         [95maversal[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[12/28/25 15:09:35][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=220175;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=825948;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/28/25 15:10:29][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=387798;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=605130;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/28/25 15:10:52][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=805723;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=524739;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=19459;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=675808;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:10:53][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=442967;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=708205;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=450081;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=406209;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpa7n0m3wz[0m                                                 ]8;id=889198;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=464532;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[12/28/25 15:12:09][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m76.09[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=415737;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=870984;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=203560;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=906810;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:12:43][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m33.49[0m seconds;                ]8;id=164407;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=65231;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=470511;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=105662;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:12:55][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.56[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=298528;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=148860;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=201020;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=53869;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=65381;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=306432;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=487975;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=666052;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:12:56][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.99[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=464690;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=255763;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/28/25 15:12:57][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=505265;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=334924;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:12:58][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.98[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=319907;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=213192;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=95357;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=515414;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/28/25 15:12:59][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=597947;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=582642;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/28/25 15:13:00][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=261598;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=333837;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         ---                                                                                 [2m                [0m
[2;36m                    [0m         a/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emit [2m                [0m
[2;36m                    [0m         ter/fs/FileSystemEmitter.java                                                       [2m                [0m
[2;36m                    [0m         +++                                                                                 [2m                [0m
[2;36m                    [0m         b/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emit [2m                [0m
[2;36m                    [0m         ter/fs/FileSystemEmitter.java                                                       [2m                [0m
[2;36m                    [0m         @@ [1;36m-85[0m,[1;36m6[0m +[1;36m85[0m,[1;36m12[0m @@                                                                  [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m                  if [1m([0mbasePath != null[1m)[0m [1m{[0m                                                    [2m                [0m
[2;36m                    [0m                      output = [1;35mbasePath.resolve[0m[1m([0memitKey[1m)[0m;                                    [2m                [0m
[2;36m                    [0m         +            Path normalizedBase = [1;35mbasePath.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;           [2m                [0m
[2;36m                    [0m         +            Path normalizedOutput = [1;35moutput.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;           [2m                [0m
[2;36m                    [0m         +            if [1m([0m![1;35mnormalizedOutput.startsWith[0m[1m([0mnormalizedBase[1m)[0m[1m)[0m [1m{[0m                    [2m                [0m
[2;36m                    [0m         +                throw new [1;35mTikaEmitterException[0m[1m([0m[32m"FileSystemEmitter prevented [0m       [2m                [0m
[2;36m                    [0m         [32mwriting outside base directory: "[0m + emitKey[1m)[0m;                                       [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +            output = normalizedOutput;                                             [2m                [0m
[2;36m                    [0m                  [1m}[0m else [1m{[0m                                                                   [2m                [0m
[2;36m                    [0m                      output = [1;35mPaths.get[0m[1m([0memitKey[1m)[0m;                                           [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         @@ [1;36m-145[0m,[1;36m6[0m +[1;36m151[0m,[1;36m12[0m @@                                                                [2m                [0m
[2;36m                    [0m              @Override                                                                      [2m                [0m
[2;36m                    [0m              public void [1;35memit[0m[1m([0mString path, InputStream inputStream, Metadata userMetadata,  [2m                [0m
[2;36m                    [0m         ParseContext parseContext[1m)[0m throws IOException, TikaEmitterException [1m{[0m               [2m                [0m
[2;36m                    [0m                  Path target = [1;35mbasePath.resolve[0m[1m([0mpath[1m)[0m;                                      [2m                [0m
[2;36m                    [0m         +        Path normalizedBase = [1;35mbasePath.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;               [2m                [0m
[2;36m                    [0m         +        Path normalizedTarget = [1;35mtarget.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;               [2m                [0m
[2;36m                    [0m         +        if [1m([0m![1;35mnormalizedTarget.startsWith[0m[1m([0mnormalizedBase[1m)[0m[1m)[0m [1m{[0m                        [2m                [0m
[2;36m                    [0m         +            throw new [1;35mTikaEmitterException[0m[1m([0m[32m"FileSystemEmitter prevented writing [0m   [2m                [0m
[2;36m                    [0m         [32moutside base directory: "[0m + path[1m)[0m;                                                  [2m                [0m
[2;36m                    [0m         +        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         +        target = normalizedTarget;                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                  if [1m([0m![1;35mFiles.isDirectory[0m[1m([0m[1;35mtarget.getParent[0m[1m([0m[1m)[0m[1m)[0m[1m)[0m [1m{[0m                              [2m                [0m
[2;36m                    [0m                      [1;35mFiles.createDirectories[0m[1m([0m[1;35mtarget.getParent[0m[1m([0m[1m)[0m[1m)[0m;                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp12802206856868921365/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tr[0m [2m                [0m
[2;36m                    [0m         [95maversal[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The fuzzer detected a critical file path traversal vulnerability when Apache Tika’s [2m                [0m
[2;36m                    [0m         filesystem emitter attempted to write embedded document bytes. The sanitizer        [2m                [0m
[2;36m                    [0m         `FilePathTraversal` raised an exception as a computed output path                   [2m                [0m
[2;36m                    [0m         [1m([0m`.[35m/input.bin/../../../[0m[95mjazzer-traversal[0m`[1m)[0m escaped the intended target directory     [2m                [0m
[2;36m                    [0m         under `[35m/tmp/[0m[95mexpander-tmp[0m*[35m/output/[0m[95m...[0m`. This indicates that untrusted or malformed   [2m                [0m
[2;36m                    [0m         path components can traverse outside of the designated output directory.            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - The issue surfaces during fuzz testing of Apache Tika’s RUnpack extractor         [2m                [0m
[2;36m                    [0m         pipeline, specifically within `FileSystemEmitter.emit`.                             [2m                [0m
[2;36m                    [0m         - The `FilePathTraversal` sanitizer [1m([0mfrom Jazzer[1m)[0m identified that the resolved path [2m                [0m
[2;36m                    [0m         included “..” segments that climbed above the allowed output root, triggering a     [2m                [0m
[2;36m                    [0m         `FuzzerSecurityIssueCritical`.                                                      [2m                [0m
[2;36m                    [0m         - Vulnerability type: File path traversal [1m([0mdirectory traversal[1m)[0m allowing writes     [2m                [0m
[2;36m                    [0m         outside of the expected location.                                                   [2m                [0m
[2;36m                    [0m         - Stack trace highlights the call chain:                                            [2m                [0m
[2;36m                    [0m           • `com.code_intelligence.jazzer.sanitizers.FilePathTraversal.check`               [2m                [0m
[2;36m                    [0m           • `FilePathTraversal.checkPath` → `copyMismatchMvHook`                            [2m                [0m
[2;36m                    [0m           • `org.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit`                       [2m                [0m
[2;36m                    [0m           • Downstream through `EmittingEmbeddedDocumentBytesHandler`, `RUnpackExtractor`,  [2m                [0m
[2;36m                    [0m         `PackageParser`, `CompositeParser`, `AutoDetectParser`, `RecursiveParserWrapper`,   [2m                [0m
[2;36m                    [0m         `PipesServer`, and finally the CLI and fuzzer harness.                              [2m                [0m
[2;36m                    [0m         - Important observations:                                                           [2m                [0m
[2;36m                    [0m           • The sanitizer flagged the issue at path resolution time, before any filesystem  [2m                [0m
[2;36m                    [0m         write.                                                                              [2m                [0m
[2;36m                    [0m           • The problematic path component originated from embedded document handling logic [2m                [0m
[2;36m                    [0m         in RUnpackExtractor.                                                                [2m                [0m
[2;36m                    [0m           • The harness [1m([0m`TikaAppRUnpackerFuzzer`[1m)[0m is merely an entry point for the fuzzing [2m                [0m
[2;36m                    [0m         campaign and not the locus of the traversal logic.                                  [2m                [0m
[2;36m                    [0m         - Areas for investigation:                                                          [2m                [0m
[2;36m                    [0m           • Path normalization and validation logic in `FileSystemEmitter.emit` and its     [2m                [0m
[2;36m                    [0m         interaction with `FilePathTraversal`.                                               [2m                [0m
[2;36m                    [0m           • How embedded document names or entry paths are composed and passed down from    [2m                [0m
[2;36m                    [0m         `RUnpackExtractor` and `PackageParser`.                                             [2m                [0m
[2;36m                    [0m           • Any transformations or concatenations of relative paths within the              [2m                [0m
[2;36m                    [0m         pipes/emitter framework that precede the sanitizer check.                           [2m                [0m
[2;36m                    [0m           • End-to-end flow from `RecursiveParserWrapper` through to the emitter to map     [2m                [0m
[2;36m                    [0m         where untrusted segments enter the file path.                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: [0m   [2m                [0m
[2;36m                    [0m         [39mFile path traversal: [0m                                                               [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp12802206856868921365/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tr[0m [2m                [0m
[2;36m                    [0m         [95maversal[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1;39m([0m[39mFilePathTraversal.j[0m [2m                [0m
[2;36m                    [0m         [39mav[0m[1;92ma:346[0m[1;39m)[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1;39m([0m[39mFilePathTravers[0m [2m                [0m
[2;36m                    [0m         [39mal.jav[0m[1;92ma:293[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1;39m([0m[39mFilePa[0m [2m                [0m
[2;36m                    [0m         [39mthTraversal.jav[0m[1;92ma:211[0m[1;39m)[0m                                                               [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1;39m([0m[39mFileSystemEmitter.jav[0m[1;92ma:155[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1;39m([0m[39mEmittingEm[0m [2m                [0m
[2;36m                    [0m         [39mbeddedDocumentBytesHandler.jav[0m[1;92ma:66[0m[1;39m)[0m                                                 [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1;39m)[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma:91[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1;39m([0m[39mRecursiveParserWrapper.jav[0m[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:660[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:546[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:487[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1;39m([0m[39mRecursivelyExtract.jav[0m[1;92ma:96[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:234[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppRUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppRUnpackerFuzzer.jav[0m[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1;39m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: e329145bbb375a14[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:145[0m[39m-[0m[1;36m155[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString path, InputStream inputStream, Metadata [0m            [2m                [0m
[2;36m                    [0m         [39muserMetadata, ParseContext parseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mFiles.isDirectory[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            [0m[1;35mFiles.createDirectories[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        if [0m[1;39m([0m[39monExists == ON_EXISTS.REPLACE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target, [0m                                    [2m                [0m
[2;36m                    [0m         [39mStandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.EXCEPTION[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:77[0m[39m-[0m[1;36m90[0m                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString emitKey, List<Metadata> metadataList, ParseContext [0m  [2m                [0m
[2;36m                    [0m         [39mparseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        Path output;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        if [0m[1;39m([0m[39mmetadataList == null || [0m[1;35mmetadataList.size[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            throw new [0m[1;35mTikaEmitterException[0m[1;39m([0m[32m"metadata list must not be null or of[0m [2m                [0m
[2;36m                    [0m         [32msize 0"[0m[1;39m)[0m[39m;[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        if [0m[1;39m([0m[39mfileExtension != null && [0m[1;35mfileExtension.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            emitKey += [0m[32m"."[0m[39m + fileExtension;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        if [0m[1;39m([0m[39mbasePath != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            output = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39memitKey[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:            output = [0m[1;35mPaths.get[0m[1;39m([0m[39memitKey[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/extractor/EmittingEmbeddedDocumentByt[0m [2m                [0m
[2;36m                    [0m         [39mesHandler.jav[0m[1;92ma:61[0m[39m-[0m[1;36m70[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    public void [0m[1;35madd[0m[1;39m([0m[39mint id, Metadata metadata, InputStream inputStream[0m[1;39m)[0m[39m throws [0m  [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[35m/[0m[35m/[0m[95mintentionally[0m[39m do not call super.add, because we want the ids list to [0m  [2m                [0m
[2;36m                    [0m         [39mbe empty[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        String emitKey = [0m[1;35mgetEmitKey[0m[1;39m([0m[1;35mcontainerEmitKey.getEmitKey[0m[1;39m([0m[1;39m)[0m[39m,[0m               [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:                id, embeddedDocumentBytesConfig, metadata[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            [0m[1;35memitter.emit[0m[1;39m([0m[39memitKey, inputStream, METADATA, PARSE_CONTEXT[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mTikaEmitterException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            throw new [0m[1;35mIOException[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:36[0m[39m-[0m[1;36m72[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    public String [0m[1;35mgetEmitKey[0m[1;39m([0m[39mString containerEmitKey, int embeddedId,[0m            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:                             EmbeddedDocumentBytesConfig [0m                        [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:                             Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getPathStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m                [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:                EmbeddedDocumentBytesConfig.PATH_STRATEGY.EMBEDDED_PATH[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:            return [0m[1;35membeddedPath[0m[1;39m([0m[39mcontainerEmitKey, embeddedDocumentBytesConfig, [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        String embeddedIdString = [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m >[0m [2m                [0m
[2;36m                    [0m         [1;36m0[0m[39m ?[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:                [0m[1;35mStringUtils.leftPad[0m[1;39m([0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m,[0m                [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:                        [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m, [0m[32m"0"[0m[1;39m)[0m[39m :[0m     [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:                [0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[35m/[0m[35m/[0m[95mat[0m[39m this point the emit key has the full [0m[32m"file"[0m[39m part, now we[0m            [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[95madd[0m[39m the embedded id prefix, the embedded id string and then maybe[0m      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        [0m[35m/[0m[35m/[0m[95mthe[0m[39m file extension[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmbeddedIdPrefix[0m[1;39m([0m[1;39m)[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[39membeddedIdString[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getSuffixStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m              [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                EmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.EXISTING[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            String fName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:            String suffix = [0m[1;35mFilenameUtils.getSuffixFromPath[0m[1;39m([0m[39mfName[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            suffix = [0m[1;35msuffix.toLowerCase[0m[1;39m([0m[39mLocale.US[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        return [0m[1;35memitKey.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:30[0m[39m-[0m[1;36m80[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:public abstract class AbstractEmbeddedDocumentBytesHandler implements [0m           [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentBytesHandler [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    List<Integer> ids = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    public String [0m[1;35mgetEmitKey[0m[1;39m([0m[39mString containerEmitKey, int embeddedId,[0m            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:                             EmbeddedDocumentBytesConfig [0m                        [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:                             Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getPathStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m                [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:                EmbeddedDocumentBytesConfig.PATH_STRATEGY.EMBEDDED_PATH[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:            return [0m[1;35membeddedPath[0m[1;39m([0m[39mcontainerEmitKey, embeddedDocumentBytesConfig, [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        String embeddedIdString = [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m >[0m [2m                [0m
[2;36m                    [0m         [1;36m0[0m[39m ?[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:                [0m[1;35mStringUtils.leftPad[0m[1;39m([0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m,[0m                [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:                        [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m, [0m[32m"0"[0m[1;39m)[0m[39m :[0m     [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:                [0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[35m/[0m[35m/[0m[95mat[0m[39m this point the emit key has the full [0m[32m"file"[0m[39m part, now we[0m            [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[95madd[0m[39m the embedded id prefix, the embedded id string and then maybe[0m      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        [0m[35m/[0m[35m/[0m[95mthe[0m[39m file extension[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmbeddedIdPrefix[0m[1;39m([0m[1;39m)[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[39membeddedIdString[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getSuffixStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m              [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                EmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.EXISTING[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            String fName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:            String suffix = [0m[1;35mFilenameUtils.getSuffixFromPath[0m[1;39m([0m[39mfName[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            suffix = [0m[1;35msuffix.toLowerCase[0m[1;39m([0m[39mLocale.US[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        return [0m[1;35memitKey.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    private String [0m[1;35membeddedPath[0m[1;39m([0m[39mString containerEmitKey,[0m                         [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:                                EmbeddedDocumentBytesConfig [0m                     [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:                                Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        String embeddedPath = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        String dirPath = [0m[1;35maddSubDirs[0m[1;39m([0m[39membeddedPath[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:145[0m[39m-[0m[1;36m155[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString path, InputStream inputStream, Metadata [0m            [2m                [0m
[2;36m                    [0m         [39muserMetadata, ParseContext parseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mFiles.isDirectory[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            [0m[1;35mFiles.createDirectories[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        if [0m[1;39m([0m[39monExists == ON_EXISTS.REPLACE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target, [0m                                    [2m                [0m
[2;36m                    [0m         [39mStandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.EXCEPTION[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:77[0m[39m-[0m[1;36m90[0m                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString emitKey, List<Metadata> metadataList, ParseContext [0m  [2m                [0m
[2;36m                    [0m         [39mparseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        Path output;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        if [0m[1;39m([0m[39mmetadataList == null || [0m[1;35mmetadataList.size[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            throw new [0m[1;35mTikaEmitterException[0m[1;39m([0m[32m"metadata list must not be null or of[0m [2m                [0m
[2;36m                    [0m         [32msize 0"[0m[1;39m)[0m[39m;[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        if [0m[1;39m([0m[39mfileExtension != null && [0m[1;35mfileExtension.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            emitKey += [0m[32m"."[0m[39m + fileExtension;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        if [0m[1;39m([0m[39mbasePath != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            output = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39memitKey[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:            output = [0m[1;35mPaths.get[0m[1;39m([0m[39memitKey[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Centralize and harden path normalization and validation in FileSystemEmitter’s [0m  [2m                [0m
[2;36m                    [0m         [39memit methods:[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m   a. In `[0m[1;35memit[0m[1;39m([0m[39mString path, InputStream inputStream, [0m[33m...[0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines ~[0m[1;36m145[0m[39m–[0m[1;36m155[0m[1;39m)[0m[39m:[0m        [2m                [0m
[2;36m                    [0m         [39m      - Immediately after resolving `target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m`, obtain [0m      [2m                [0m
[2;36m                    [0m         [39mabsolute, normalized paths:[0m                                                         [2m                [0m
[2;36m                    [0m         [39m          ```java[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m          Path normalizedBase = [0m[1;35mbasePath.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [39m          Path normalizedTarget = [0m[1;35mtarget.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [39m          ```[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m      - Verify containment:[0m                                                         [2m                [0m
[2;36m                    [0m         [39m          ```java[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m          if [0m[1;39m([0m[39m![0m[1;35mnormalizedTarget.startsWith[0m[1;39m([0m[39mnormalizedBase[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [39m              throw new [0m[1;35mTikaEmitterException[0m[1;39m([0m                                       [2m                [0m
[2;36m                    [0m         [39m                  [0m[32m"FileSystemEmitter prevented writing outside base directory: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mpath[0m[1;39m)[0m[39m;[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m          [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m          ```[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m      - Reassign `target = normalizedTarget` before any directory creation or copy [0m [2m                [0m
[2;36m                    [0m         [39moperations.[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m   b. In `[0m[1;35memit[0m[1;39m([0m[39mString emitKey, List<Metadata> metadataList, [0m[33m...[0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines ~[0m[1;36m77[0m[39m–[0m[1;36m90[0m[1;39m)[0m[39m:[0m   [2m                [0m
[2;36m                    [0m         [39m      - After computing `output = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39memitKey[0m[1;39m)[0m[39m`, apply the same [0m       [2m                [0m
[2;36m                    [0m         [39mnormalization and containment check against `basePath`.[0m                             [2m                [0m
[2;36m                    [0m         [39m      - Reassign `output = normalizedTarget` [0m[1;39m([0m[39mor a similarly named variable[0m[1;39m)[0m[39m before[0m [2m                [0m
[2;36m                    [0m         [39musing it to create directories or write files.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Disallow absolute paths embedded in the emit key:[0m                                [2m                [0m
[2;36m                    [0m         [39m   - The containment check above will reject any absolute `path` or `emitKey` that [0m [2m                [0m
[2;36m                    [0m         [39mresolves outside of `basePath`, including those starting with “[0m[35m/[0m[39m”.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Preserve existing functionality:[0m                                                 [2m                [0m
[2;36m                    [0m         [39m   - All legitimate relative paths under `basePath` continue to be written as [0m      [2m                [0m
[2;36m                    [0m         [39mbefore.[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m   - Existing `onExists` behaviors [0m[1;39m([0m[39mREPLACE vs. EXCEPTION[0m[1;39m)[0m[39m remain unchanged.[0m        [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Do not modify upstream emit-key construction or fuzzing harness:[0m                 [2m                [0m
[2;36m                    [0m         [39m   - Upstream logic [0m[1;39m([0m[39m`getEmitKey`, `embeddedPath`, RUnpackExtractor[0m[1;39m)[0m[39m continues to [0m  [2m                [0m
[2;36m                    [0m         [39mgenerate emit keys as-is; the emitter layer enforces safety.[0m                        [2m                [0m
[2;36m                    [0m         [39m   - Fuzz harness and other test code remain intact.[0m                                [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Unit tests and regression:[0m                                                       [2m                [0m
[2;36m                    [0m         [39m   - Add unit tests to verify that:[0m                                                 [2m                [0m
[2;36m                    [0m         [39m     • `[0m[1;35memit[0m[1;39m([0m[32m"../outside.txt"[0m[39m, [0m[33m...[0m[1;39m)[0m[39m` throws `TikaEmitterException`.[0m                 [2m                [0m
[2;36m                    [0m         [39m     • Legitimate nested paths under `basePath` succeed.[0m                            [2m                [0m
[2;36m                    [0m         [39m   - Confirm no tests break under existing valid use cases.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. Side effects and mitigation:[0m                                                     [2m                [0m
[2;36m                    [0m         [39m   - The change may flag some unconventional use cases if users intentionally [0m      [2m                [0m
[2;36m                    [0m         [39mrelied on upward traversal [0m[1;39m([0m[39munlikely for file extractors[0m[1;39m)[0m[39m. If that arises, document[0m [2m                [0m
[2;36m                    [0m         [39mthe change as a security restriction.[0m                                               [2m                [0m
[2;36m                    [0m         [39m   - Ensure symlink scenarios are covered: if `basePath` or intermediary [0m           [2m                [0m
[2;36m                    [0m         [39mdirectories are symlinks, the normalized-absolute check still accurately reflects [0m  [2m                [0m
[2;36m                    [0m         [39mon-disk resolution. If needed, extend to follow real paths [0m[1;39m([0m[39m`[0m[1;35mtoRealPath[0m[1;39m([0m[1;39m)[0m[39m`[0m[1;39m)[0m[39m after [0m  [2m                [0m
[2;36m                    [0m         [39mdirectory creation, but start with `[0m[1;35mtoAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m`.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. Reference consistency:[0m                                                           [2m                [0m
[2;36m                    [0m         [39m   - Similar containment checks can be found in other Apache Tika components [0m[1;39m([0m[39me.g.,[0m [2m                [0m
[2;36m                    [0m         [39msafe resource extraction in `ZipContainerDetector`[0m[1;39m)[0m[39m, reinforcing this approach.[0m     [2m                [0m
[2;36m                    [0m         [39m   - Avoiding modifications to external libraries, harness code, or utility [0m        [2m                [0m
[2;36m                    [0m         [39mfunctions aligns with project guidelines.[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mBy centralizing the normalization and containment check in the emitter, we ensure [0m  [2m                [0m
[2;36m                    [0m         [39mthat no traversal escapes occur, regardless of how the emit key is constructed, [0m    [2m                [0m
[2;36m                    [0m         [39mwhile preserving existing behavior for valid paths. This addresses the [0m             [2m                [0m
[2;36m                    [0m         [39mfuzzer-discovered vulnerability directly at the file-write boundary. [0m               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=458412;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=699765;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=659808;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=22694;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpn0miwqib[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_o4_mini/tika_tk-delta-04_vuln_5/[0m[95magent-output-17[0m [2m               [0m
[2;36m                    [0m         [95m66934780.4335678[0m                                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-no-delta/tika_tk-delta-04_vuln_5.toml   [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/qqor/crete/.cache/environments/[0m[95mtika[0m           ]8;id=468128;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=16910;file:///home/qqor/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m[12/28/25 15:13:01][0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=647035;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=819694;file:///home/qqor/crete/scripts/benchmark/__main__.py#309\[2m309[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=511854;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=597978;file:///home/qqor/crete/scripts/benchmark/__main__.py#312\[2m312[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
