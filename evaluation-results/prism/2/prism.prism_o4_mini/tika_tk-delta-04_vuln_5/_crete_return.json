{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-04_vuln_5",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.1329174,
    "prompt_tokens": 76942,
    "completion_tokens": 10973
  },
  "variant": "sound",
  "diff": "--- a/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitter/fs/FileSystemEmitter.java\n+++ b/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitter/fs/FileSystemEmitter.java\n@@ -85,6 +85,12 @@\n         }\n         if (basePath != null) {\n             output = basePath.resolve(emitKey);\n+            Path normalizedBase = basePath.toAbsolutePath().normalize();\n+            Path normalizedOutput = output.toAbsolutePath().normalize();\n+            if (!normalizedOutput.startsWith(normalizedBase)) {\n+                throw new TikaEmitterException(\"FileSystemEmitter prevented writing outside base directory: \" + emitKey);\n+            }\n+            output = normalizedOutput;\n         } else {\n             output = Paths.get(emitKey);\n         }\n@@ -145,6 +151,12 @@\n     @Override\n     public void emit(String path, InputStream inputStream, Metadata userMetadata, ParseContext parseContext) throws IOException, TikaEmitterException {\n         Path target = basePath.resolve(path);\n+        Path normalizedBase = basePath.toAbsolutePath().normalize();\n+        Path normalizedTarget = target.toAbsolutePath().normalize();\n+        if (!normalizedTarget.startsWith(normalizedBase)) {\n+            throw new TikaEmitterException(\"FileSystemEmitter prevented writing outside base directory: \" + path);\n+        }\n+        target = normalizedTarget;\n \n         if (!Files.isDirectory(target.getParent())) {\n             Files.createDirectories(target.getParent());\n",
  "stdout": "",
  "stderr": ""
}