{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-delta-01_vuln_5",
  "source_directory": "/home/qqor/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.7083285,
    "prompt_tokens": 342903,
    "completion_tokens": 75258
  },
  "variant": "sound",
  "diff": "--- a/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n+++ b/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n@@ -33,11 +33,19 @@\n \n import org.apache.logging.log4j.Logger;\n import org.apache.poi.logging.PoiLogManager;\n+import org.apache.xmlbeans.XmlException;\n+import org.xml.sax.SAXException;\n import org.apache.poi.ooxml.POIXMLDocument;\n import org.apache.poi.ooxml.POIXMLProperties;\n import org.apache.poi.ooxml.POIXMLProperties.CoreProperties;\n import org.apache.poi.ooxml.POIXMLProperties.CustomProperties;\n import org.apache.poi.ooxml.POIXMLProperties.ExtendedProperties;\n+import org.apache.poi.openxml4j.opc.OPCPackage;\n+import org.apache.poi.openxml4j.exceptions.OpenXML4JException;\n+import org.apache.poi.openxml4j.opc.PackagePart;\n+import java.util.List;\n+import java.util.Arrays;\n+import org.apache.poi.util.XMLHelper;\n import org.apache.poi.ooxml.extractor.POIXMLTextExtractor;\n import org.apache.poi.openxml4j.exceptions.OpenXML4JException;\n import org.apache.poi.openxml4j.opc.OPCPackage;\n@@ -312,7 +320,7 @@\n         }\n         PackagePart part = parts.get(0);\n         try (InputStream is = part.getInputStream()) {\n-            SAXParser parser = SAXParserFactory.newInstance().newSAXParser();\n+            SAXParser parser = XMLHelper.getSaxParserFactory().newSAXParser();\n             parser.parse(is, new ExtendedPropertiesHandler(text));\n         } catch (ParserConfigurationException | SAXException | IOException e) {\n             //swallow\n@@ -335,7 +343,12 @@\n \n     @Override\n     public POIXMLDocument getDocument() {\n-        return null;\n+        return new POIXMLDocument(container) {\n+            @Override\n+            public List<PackagePart> getAllEmbeddedParts() throws OpenXML4JException {\n+                return Arrays.asList(container.getParts().toArray(new PackagePart[0]));\n+            }\n+        };\n     }\n \n     @Override\n",
  "stdout": "",
  "stderr": ""
}