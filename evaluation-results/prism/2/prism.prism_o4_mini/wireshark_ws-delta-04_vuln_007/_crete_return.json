{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-04_vuln_007",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.1349788,
    "prompt_tokens": 74164,
    "completion_tokens": 12136
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-json.c\n+++ b/epan/dissectors/packet-json.c\n@@ -353,26 +353,29 @@\n \t\t\t\t\t\telse if (current_character == 'U') {\n \t\t\t\t\t\t\tuint16_t lead_surrogate = code_point;\n \t\t\t\t\t\t\tuint16_t trail_surrogate = 0;\n-\t\n+\n+\t\t\t\t\t\t\t/* Skip past 'U' */\n \t\t\t\t\t\t\tread_index++;\n-\t\n-\t\t\t\t\t\t\tfor (int i = 0; i < 8; i++)\n-\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\tcurrent_character = string[read_index];\n-\t\t\t\t\t\t\t\tread_index++;\n-\t\n+\n+\t\t\t\t\t\t\t/* Read 8 hex digits for UTF-32 */\n+\t\t\t\t\t\t\tfor (int i = 0; i < 8; i++) {\n+\t\t\t\t\t\t\t\t/* Prevent out-of-bounds reads */\n+\t\t\t\t\t\t\t\tif (!(read_index < string_length)) {\n+\t\t\t\t\t\t\t\t\tis_valid_unicode_character = false;\n+\t\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tcurrent_character = string[read_index++];\n \t\t\t\t\t\t\t\tint nibble = ws_xton(current_character);\n-\t\n-\t\t\t\t\t\t\t\ttrail_surrogate <<= 4;\n-\t\t\t\t\t\t\t\ttrail_surrogate |= nibble;\n+\t\t\t\t\t\t\t\tif (nibble < 0) {\n+\t\t\t\t\t\t\t\t\tis_valid_unicode_character = false;\n+\t\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\ttrail_surrogate = (trail_surrogate << 4) | nibble;\n \t\t\t\t\t\t\t}\n-\t\n-\t\t\t\t\t\t\tif ((IS_TRAIL_SURROGATE(trail_surrogate)))\n-\t\t\t\t\t\t\t{\t\n+\n+\t\t\t\t\t\t\tif (is_valid_unicode_character && IS_TRAIL_SURROGATE(trail_surrogate)) {\n \t\t\t\t\t\t\t\tcode_point = SURROGATE_VALUE(lead_surrogate, trail_surrogate);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t{\n+\t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tis_valid_unicode_character = false;\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n",
  "stdout": "",
  "stderr": ""
}