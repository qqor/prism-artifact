--- a/src/cmsvirt.c
+++ b/src/cmsvirt.c
@@ -1098,9 +1098,10 @@
         FLOAT_SH(0) | COLORSPACE_SH(_cmsLCMScolorSpace(v ->ExitColorSpace))
         | BYTES_SH(2) | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)));
 
-    // Apply the transfor to colorants.
-    for (i=0; i < nColors; i++) {
-        cmsDoTransform(xform, &i, nc2 ->List[i].DeviceColorant, 1);
+    // Apply the transform to colorants with properly sized index buffer
+    for (i = 0; i < nColors; i++) {
+        cmsUInt16Number idx = (cmsUInt16Number) i;
+        cmsDoTransform(xform, &idx, nc2->List[i].DeviceColorant, 1);
     }
 
     if (!cmsWriteTag(hICC, cmsSigNamedColor2Tag, (void*) nc2)) goto Error;
