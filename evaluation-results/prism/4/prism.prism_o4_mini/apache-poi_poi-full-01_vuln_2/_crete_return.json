{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_2",
  "source_directory": "/tasks_new/apache-poi_poi-full-01/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.08606620000000001,
    "prompt_tokens": 26658,
    "completion_tokens": 12896
  },
  "variant": "sound",
  "diff": "--- a/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java\n+++ b/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java\n@@ -105,13 +105,23 @@\n                 try (DocumentInputStream is = new DocumentInputStream(node)) {\n                    bytes = IOUtils.toByteArray(is);\n                 }\n-                try (OutputStream out = Files.newOutputStream(new File(parent, node.getName().trim()).toPath())) {\n+                String rawName = node.getName().trim();\n+                String safeName = rawName.replaceAll(\"[/\\\\\\\\]+\", \"_\");\n+                if (safeName.isEmpty() || safeName.equals(\".\") || safeName.equals(\"..\")) {\n+                    safeName = \"_\";\n+                }\n+                try (OutputStream out = Files.newOutputStream(new File(parent, safeName).toPath())) {\n                     out.write(bytes);\n                 }\n             } else if (entry instanceof DirectoryEntry){\n                 DirectoryEntry dir = (DirectoryEntry)entry;\n-                File file = new File(parent, entry.getName());\n-                if(!file.exists() && !file.mkdirs()) {\n+                String rawDirName = entry.getName().trim();\n+                String safeDirName = rawDirName.replaceAll(\"[/\\\\\\\\]+\", \"_\");\n+                if (safeDirName.isEmpty() || safeDirName.equals(\".\") || safeDirName.equals(\"..\")) {\n+                    safeDirName = \"_\";\n+                }\n+                File file = new File(parent, safeDirName);\n+                if (!file.exists() && !file.mkdirs()) {\n                     throw new IOException(\"Could not create directory \" + file);\n                 }\n                 dump(dir, file);\n@@ -121,7 +131,12 @@\n         }\n     }\n     public static void dump(POIFSFileSystem fs, int startBlock, String name, File parent) throws IOException {\n-        File file = new File(parent, name);\n+        String rawName = name.trim();\n+        String safeName = rawName.replaceAll(\"[/\\\\\\\\]+\", \"_\");\n+        if (safeName.isEmpty() || safeName.equals(\".\") || safeName.equals(\"..\")) {\n+            safeName = \"_\";\n+        }\n+        File file = new File(parent, safeName);\n         if (! Files.isDirectory(file.toPath().getParent())) {\n             Files.createDirectories(file.toPath().getParent());\n         }\n",
  "stdout": "",
  "stderr": ""
}