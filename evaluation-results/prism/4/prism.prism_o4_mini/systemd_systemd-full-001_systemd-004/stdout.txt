[11/04/25 11:16:52] INFO     Building environment                                                                                                                                                                                                                                                                                                                                                       __init__.py:132
                             - Cache directory: /tmp/tmpu1vdk9kn                                                                                                                                                                                                                                                                                                                                                       
                             - Max timeout: 1800                                                                                                                                                                                                                                                                                                                                                                       
                             - Output directory: reports/prism.prism_o4_mini/systemd_systemd-full-001_systemd-004/agent-output-1762255012.6705208                                                                                                                                                                                                                                                                      
                             - Detection toml file: /tasks_new/systemd_systemd-full-001/detection/systemd_systemd-full-001_systemd-004.toml                                                                                                                                                                                                                                                                            
                             - Challenge project directory: /tasks_new/systemd_systemd-full-001/official-afc-systemd                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                       
                    INFO     Setting timeouts                                                                                                                                                                                                                                                                                                                                                             default.py:83
                               - build: 600 (original: 76)                                                                                                                                                                                                                                                                                                                                                             
                               - run tests: 600 (original: 0)                                                                                                                                                                                                                                                                                                                                                          
                    INFO     Successfully created Cached for CLEAN environment                                                                                                                                                                                                                                                                                                                          oss_fuzz.py:256
                    INFO     Current environments: ['CLEAN -> Cached']                                                                                                                                                                                                                                                                                                                                  oss_fuzz.py:265
                    INFO     Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                                                                                                                                                                                                                                                                                                          __init__.py:160
                             (n evals: 0, patch status: PatchStatus.INITIALIZED)                                                                                                                                                                                                                                                                                                                                       
                    INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:16:53] INFO     [logging_performance](systemd Setting owner) Took 0.88 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
[11/04/25 11:16:54] INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:16:56] INFO     [logging_performance](systemd Setting owner) Took 1.18 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
[11/04/25 11:16:58] INFO     ===Evaluator Result===                                                                                                                                                                                                                                                                                                                                                    evaluator.py:204
                             PatchStatus.VULNERABLE                                                                                                                                                                                                                                                                                                                                                                    
                             ===Evaluator Diff===                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Patch Result===                                                                                                                                                                                                                                                                                                                                                                        
                             + FUZZER=fuzz-link-parser                                                                                                                                                                                                                                                                                                                                                                 
                             + shift                                                                                                                                                                                                                                                                                                                                                                                   
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                                                                                                                                                                                                                                 
                             + TESTCASE=/testcase                                                                                                                                                                                                                                                                                                                                                                      
                             + '[' '!' -f /testcase ']'                                                                                                                                                                                                                                                                                                                                                                
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                      
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                             
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                         
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                                
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                               
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                                      
                             + run_fuzzer fuzz-link-parser -runs=100 /testcase                                                                                                                                                                                                                                                                                                                                         
                             vm.mmap_rnd_bits = 28                                                                                                                                                                                                                                                                                                                                                                     
                             /out/fuzz-link-parser -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                                                                                                                                                                                                                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                                                                                                                                                                                                                                   
                             INFO: Seed: 4166796164                                                                                                                                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 modules   (96981 inline 8-bit counters): 94611 [0x7f5b975ab920, 0x7f5b975c2ab3), 2370 [0x556e24390078, 0x556e243909ba),                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 PC tables (96981 PCs): 94611 [0x7f5b975c2ab8,0x7f5b977343e8), 2370 [0x556e243909c0,0x556e24399de0),                                                                                                                                                                                                                                                                        
                             /out/fuzz-link-parser: Running 1 inputs 100 time(s) each.                                                                                                                                                                                                                                                                                                                                 
                             Running: /testcase                                                                                                                                                                                                                                                                                                                                                                        
                             =================================================================                                                                                                                                                                                                                                                                                                                         
                             ==18==ERROR: AddressSanitizer: heap-use-after-free on address 0x503000000200 at pc 0x7f5b96e9a23f bp 0x7ffcf99bad20 sp 0x7ffcf99bad18                                                                                                                                                                                                                                                     
                             READ of size 8 at 0x503000000200 thread T0                                                                                                                                                                                                                                                                                                                                                
                             SCARINESS: 51 (8-byte-read-heap-use-after-free)                                                                                                                                                                                                                                                                                                                                           
                                 #0 0x7f5b96e9a23e in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:100:9                                                                                                                                                                                                                                                                              
                                 #1 0x556e24237918 in condition_free_list /work/build/../../src/systemd/src/shared/condition.h:80:16                                                                                                                                                                                                                                                                                   
                                 #2 0x556e24237918 in link_config_free /work/build/../../src/systemd/src/udev/net/link-config.c:64:9                                                                                                                                                                                                                                                                                   
                                 #3 0x556e2422c7c9 in link_config_freep /work/build/../../src/systemd/src/udev/net/link-config.c:84:1                                                                                                                                                                                                                                                                                  
                                 #4 0x556e2422c7c9 in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:324:1                                                                                                                                                                                                                                                                                     
                                 #5 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                       
                                 #6 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                              
                                 #7 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                  
                                 #8 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                                
                                 #9 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                               
                                 #10 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                 #11 0x556e2415321d in _start (/out/fuzz-link-parser+0x7b21d)                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: condition_free_list_type--condition_free_list--link_config_free                                                                                                                                                                                                                                                                                                              
                             0x503000000200 is located 16 bytes inside of 32-byte region [0x5030000001f0,0x503000000210)                                                                                                                                                                                                                                                                                               
                             freed by thread T0 here:                                                                                                                                                                                                                                                                                                                                                                  
                                 #0 0x556e241ebf96 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3                                                                                                                                                                                                                                                                                           
                                 #1 0x7f5b96e9a1ae in condition_free /work/build/../../src/systemd/src/shared/condition.c:96:16                                                                                                                                                                                                                                                                                        
                                 #2 0x7f5b96e9a1ae in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:102:25                                                                                                                                                                                                                                                                             
                                 #3 0x7f5b96fb2696 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:205:25                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_free--condition_free--condition_free_list_type                                                                                                                                                                                                                                                                                                                 
                             previously allocated by thread T0 here:                                                                                                                                                                                                                                                                                                                                                   
                                 #0 0x556e241ec22f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                                                                                                                                                                                                                         
                                 #1 0x7f5b96e99edd in malloc_multiply /work/build/../../src/systemd/src/basic/alloc-util.h:119:16                                                                                                                                                                                                                                                                                      
                                 #2 0x7f5b96e99edd in condition_new /work/build/../../src/systemd/src/shared/condition.c:73:13                                                                                                                                                                                                                                                                                         
                                 #3 0x7f5b96fb26c8 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:213:13                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_malloc--malloc_multiply--condition_new                                                                                                                                                                                                                                                                                                                         
                             SUMMARY: AddressSanitizer: heap-use-after-free /work/build/../../src/systemd/src/shared/condition.c:100:9 in condition_free_list_type                                                                                                                                                                                                                                                     
                             Shadow bytes around the buggy address:                                                                                                                                                                                                                                                                                                                                                    
                               0x502fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000000: fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000080: 00 fa fa fa 00 00 00 fa fa fa 00 00 00 00 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000100: 00 00 00 fa fa fa fd fd fd fd fa fa fd fd fd fd                                                                                                                                                                                                                                                                                                                         
                               0x503000000180: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd                                                                                                                                                                                                                                                                                                                         
                             =>0x503000000200:[fd]fd fa fa fd fd fd fd fa fa 00 00 00 05 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000380: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000400: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                                                                                                                                                                                                                      
                               Addressable:           00                                                                                                                                                                                                                                                                                                                                                               
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                                                                                                                                                                                                                             
                               Heap left redzone:       fa                                                                                                                                                                                                                                                                                                                                                             
                               Freed heap region:       fd                                                                                                                                                                                                                                                                                                                                                             
                               Stack left redzone:      f1                                                                                                                                                                                                                                                                                                                                                             
                               Stack mid redzone:       f2                                                                                                                                                                                                                                                                                                                                                             
                               Stack right redzone:     f3                                                                                                                                                                                                                                                                                                                                                             
                               Stack after return:      f5                                                                                                                                                                                                                                                                                                                                                             
                               Stack use after scope:   f8                                                                                                                                                                                                                                                                                                                                                             
                               Global redzone:          f9                                                                                                                                                                                                                                                                                                                                                             
                               Global init order:       f6                                                                                                                                                                                                                                                                                                                                                             
                               Poisoned by user:        f7                                                                                                                                                                                                                                                                                                                                                             
                               Container overflow:      fc                                                                                                                                                                                                                                                                                                                                                             
                               Array cookie:            ac                                                                                                                                                                                                                                                                                                                                                             
                               Intra object redzone:    bb                                                                                                                                                                                                                                                                                                                                                             
                               ASan internal:           fe                                                                                                                                                                                                                                                                                                                                                             
                               Left alloca redzone:     ca                                                                                                                                                                                                                                                                                                                                                             
                               Right alloca redzone:    cb                                                                                                                                                                                                                                                                                                                                                             
                             ==18==ABORTING                                                                                                                                                                                                                                                                                                                                                                            
                             subprocess command returned a non-zero exit status: 1                                                                                                                                                                                                                                                                                                                                     
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /tasks_new/systemd_systemd-full-001/fuzz-tooling/build/out/systemd:/out -v /tmp/tmphnblpbzl:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce fuzz-link-parser -runs=100.                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Issue===                                                                                                                                                                                                                                                                                                                                                                               
                             + FUZZER=fuzz-link-parser                                                                                                                                                                                                                                                                                                                                                                 
                             + shift                                                                                                                                                                                                                                                                                                                                                                                   
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                                                                                                                                                                                                                                 
                             + TESTCASE=/testcase                                                                                                                                                                                                                                                                                                                                                                      
                             + '[' '!' -f /testcase ']'                                                                                                                                                                                                                                                                                                                                                                
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                      
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                             
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                         
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                                
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                               
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                                      
                             + run_fuzzer fuzz-link-parser -runs=100 /testcase                                                                                                                                                                                                                                                                                                                                         
                             vm.mmap_rnd_bits = 28                                                                                                                                                                                                                                                                                                                                                                     
                             /out/fuzz-link-parser -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                                                                                                                                                                                                                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                                                                                                                                                                                                                                   
                             INFO: Seed: 4166796164                                                                                                                                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 modules   (96981 inline 8-bit counters): 94611 [0x7f5b975ab920, 0x7f5b975c2ab3), 2370 [0x556e24390078, 0x556e243909ba),                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 PC tables (96981 PCs): 94611 [0x7f5b975c2ab8,0x7f5b977343e8), 2370 [0x556e243909c0,0x556e24399de0),                                                                                                                                                                                                                                                                        
                             /out/fuzz-link-parser: Running 1 inputs 100 time(s) each.                                                                                                                                                                                                                                                                                                                                 
                             Running: /testcase                                                                                                                                                                                                                                                                                                                                                                        
                             =================================================================                                                                                                                                                                                                                                                                                                                         
                             ==18==ERROR: AddressSanitizer: heap-use-after-free on address 0x503000000200 at pc 0x7f5b96e9a23f bp 0x7ffcf99bad20 sp 0x7ffcf99bad18                                                                                                                                                                                                                                                     
                             READ of size 8 at 0x503000000200 thread T0                                                                                                                                                                                                                                                                                                                                                
                             SCARINESS: 51 (8-byte-read-heap-use-after-free)                                                                                                                                                                                                                                                                                                                                           
                                 #0 0x7f5b96e9a23e in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:100:9                                                                                                                                                                                                                                                                              
                                 #1 0x556e24237918 in condition_free_list /work/build/../../src/systemd/src/shared/condition.h:80:16                                                                                                                                                                                                                                                                                   
                                 #2 0x556e24237918 in link_config_free /work/build/../../src/systemd/src/udev/net/link-config.c:64:9                                                                                                                                                                                                                                                                                   
                                 #3 0x556e2422c7c9 in link_config_freep /work/build/../../src/systemd/src/udev/net/link-config.c:84:1                                                                                                                                                                                                                                                                                  
                                 #4 0x556e2422c7c9 in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:324:1                                                                                                                                                                                                                                                                                     
                                 #5 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                       
                                 #6 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                              
                                 #7 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                  
                                 #8 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                                
                                 #9 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                               
                                 #10 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                 #11 0x556e2415321d in _start (/out/fuzz-link-parser+0x7b21d)                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: condition_free_list_type--condition_free_list--link_config_free                                                                                                                                                                                                                                                                                                              
                             0x503000000200 is located 16 bytes inside of 32-byte region [0x5030000001f0,0x503000000210)                                                                                                                                                                                                                                                                                               
                             freed by thread T0 here:                                                                                                                                                                                                                                                                                                                                                                  
                                 #0 0x556e241ebf96 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3                                                                                                                                                                                                                                                                                           
                                 #1 0x7f5b96e9a1ae in condition_free /work/build/../../src/systemd/src/shared/condition.c:96:16                                                                                                                                                                                                                                                                                        
                                 #2 0x7f5b96e9a1ae in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:102:25                                                                                                                                                                                                                                                                             
                                 #3 0x7f5b96fb2696 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:205:25                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_free--condition_free--condition_free_list_type                                                                                                                                                                                                                                                                                                                 
                             previously allocated by thread T0 here:                                                                                                                                                                                                                                                                                                                                                   
                                 #0 0x556e241ec22f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                                                                                                                                                                                                                         
                                 #1 0x7f5b96e99edd in malloc_multiply /work/build/../../src/systemd/src/basic/alloc-util.h:119:16                                                                                                                                                                                                                                                                                      
                                 #2 0x7f5b96e99edd in condition_new /work/build/../../src/systemd/src/shared/condition.c:73:13                                                                                                                                                                                                                                                                                         
                                 #3 0x7f5b96fb26c8 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:213:13                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_malloc--malloc_multiply--condition_new                                                                                                                                                                                                                                                                                                                         
                             SUMMARY: AddressSanitizer: heap-use-after-free /work/build/../../src/systemd/src/shared/condition.c:100:9 in condition_free_list_type                                                                                                                                                                                                                                                     
                             Shadow bytes around the buggy address:                                                                                                                                                                                                                                                                                                                                                    
                               0x502fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000000: fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000080: 00 fa fa fa 00 00 00 fa fa fa 00 00 00 00 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000100: 00 00 00 fa fa fa fd fd fd fd fa fa fd fd fd fd                                                                                                                                                                                                                                                                                                                         
                               0x503000000180: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd                                                                                                                                                                                                                                                                                                                         
                             =>0x503000000200:[fd]fd fa fa fd fd fd fd fa fa 00 00 00 05 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000380: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000400: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                                                                                                                                                                                                                      
                               Addressable:           00                                                                                                                                                                                                                                                                                                                                                               
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                                                                                                                                                                                                                             
                               Heap left redzone:       fa                                                                                                                                                                                                                                                                                                                                                             
                               Freed heap region:       fd                                                                                                                                                                                                                                                                                                                                                             
                               Stack left redzone:      f1                                                                                                                                                                                                                                                                                                                                                             
                               Stack mid redzone:       f2                                                                                                                                                                                                                                                                                                                                                             
                               Stack right redzone:     f3                                                                                                                                                                                                                                                                                                                                                             
                               Stack after return:      f5                                                                                                                                                                                                                                                                                                                                                             
                               Stack use after scope:   f8                                                                                                                                                                                                                                                                                                                                                             
                               Global redzone:          f9                                                                                                                                                                                                                                                                                                                                                             
                               Global init order:       f6                                                                                                                                                                                                                                                                                                                                                             
                               Poisoned by user:        f7                                                                                                                                                                                                                                                                                                                                                             
                               Container overflow:      fc                                                                                                                                                                                                                                                                                                                                                             
                               Array cookie:            ac                                                                                                                                                                                                                                                                                                                                                             
                               Intra object redzone:    bb                                                                                                                                                                                                                                                                                                                                                             
                               ASan internal:           fe                                                                                                                                                                                                                                                                                                                                                             
                               Left alloca redzone:     ca                                                                                                                                                                                                                                                                                                                                                             
                               Right alloca redzone:    cb                                                                                                                                                                                                                                                                                                                                                             
                             ==18==ABORTING                                                                                                                                                                                                                                                                                                                                                                            
                             subprocess command returned a non-zero exit status: 1                                                                                                                                                                                                                                                                                                                                     
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /tasks_new/systemd_systemd-full-001/fuzz-tooling/build/out/systemd:/out -v /tmp/tmphnblpbzl:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce fuzz-link-parser -runs=100.                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Evaluation Report===                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Analysis Report===                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Evaluation End===                                                                                                                                                                                                                                                                                                                                                                      
[11/04/25 11:17:12] INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                                                                                                                                                                                                                                                                                                        __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                                                                                                                                                                                                                        
[11/04/25 11:18:29] INFO     Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.PATCH                                                                                                                                                                                                                                                                                                           __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                                                                                                                                                                                                                        
[11/04/25 11:19:05] INFO     Prism Supervisor Routing: TeamStatus.PATCH -> TeamStatus.EVALUATE                                                                                                                                                                                                                                                                                                          __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                                                                                                                                                                                                                        
                    INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:19:06] INFO     [logging_performance](systemd Setting owner) Took 0.90 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
[11/04/25 11:19:07] INFO     [logging_performance](systemd Patching) Started...                                                                                                                                                                                                                                                                                                                   context_managers.py:9
                    INFO     Checking valid diff: /tmp/tmpcdevb6t7                                                                                                                                                                                                                                                                                                                                       default.py:171
[11/04/25 11:20:11] INFO     [logging_performance](systemd Patching) Took 64.43 seconds; exception=False                                                                                                                                                                                                                                                                                         context_managers.py:23
                    INFO     [logging_performance](systemd Checking build) Started...                                                                                                                                                                                                                                                                                                             context_managers.py:9
[11/04/25 11:20:23] INFO     [logging_performance](systemd Checking build) Took 11.70 seconds; exception=False                                                                                                                                                                                                                                                                                   context_managers.py:23
                    INFO     [logging_performance](systemd Running PoV) Started...                                                                                                                                                                                                                                                                                                                context_managers.py:9
[11/04/25 11:20:25] INFO     [logging_performance](systemd Running PoV) Took 1.92 seconds; exception=False                                                                                                                                                                                                                                                                                       context_managers.py:23
                    INFO     [logging_performance](systemd Testing) Started...                                                                                                                                                                                                                                                                                                                    context_managers.py:9
                    INFO     [logging_performance](systemd Testing) Took 0.00 seconds; exception=False                                                                                                                                                                                                                                                                                           context_managers.py:23
                    INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:20:26] INFO     [logging_performance](systemd Setting owner) Took 0.92 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
[11/04/25 11:20:28] INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:20:29] INFO     [logging_performance](systemd Setting owner) Took 0.99 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
                    INFO     [logging_performance](systemd Setting owner) Started...                                                                                                                                                                                                                                                                                                              context_managers.py:9
[11/04/25 11:20:30] INFO     [logging_performance](systemd Setting owner) Took 0.90 seconds; exception=False                                                                                                                                                                                                                                                                                     context_managers.py:23
                    INFO     ===Evaluator Result===                                                                                                                                                                                                                                                                                                                                                    evaluator.py:204
                             PatchStatus.SOUND                                                                                                                                                                                                                                                                                                                                                                         
                             ===Evaluator Diff===                                                                                                                                                                                                                                                                                                                                                                      
                             --- a/src/shared/condition.c                                                                                                                                                                                                                                                                                                                                                              
                             +++ b/src/shared/condition.c                                                                                                                                                                                                                                                                                                                                                              
                             @@ -97,11 +97,18 @@                                                                                                                                                                                                                                                                                                                                                                       
                              }                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                       
                              Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                               
                             -        LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                                
                             +        Condition *c, *n;                                                                                                                                                                                                                                                                                                                                                                
                             +                                                                                                                                                                                                                                                                                                                                                                                         
                             +        /* Iterate through the list, unlink and free matching nodes */                                                                                                                                                                                                                                                                                                                   
                             +        for (c = head; c; c = n) {                                                                                                                                                                                                                                                                                                                                                       
                             +                n = c->conditions_next;       /* Save next pointer */                                                                                                                                                                                                                                                                                                                    
                                              if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                       
                             +                        LIST_REMOVE(conditions, head, c);                                                                                                                                                                                                                                                                                                                                
                                                      condition_free(c);                                                                                                                                                                                                                                                                                                                                               
                                              }                                                                                                                                                                                                                                                                                                                                                                        
                             -                                                                                                                                                                                                                                                                                                                                                                                         
                             +        }                                                                                                                                                                                                                                                                                                                                                                                
                             +                                                                                                                                                                                                                                                                                                                                                                                         
                             +        /* If type < 0 (full free), head must be NULL */                                                                                                                                                                                                                                                                                                                                 
                                      assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                                      
                                      return head;                                                                                                                                                                                                                                                                                                                                                                     
                              }                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Patch Result===                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Issue===                                                                                                                                                                                                                                                                                                                                                                               
                             + FUZZER=fuzz-link-parser                                                                                                                                                                                                                                                                                                                                                                 
                             + shift                                                                                                                                                                                                                                                                                                                                                                                   
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                                                                                                                                                                                                                                 
                             + TESTCASE=/testcase                                                                                                                                                                                                                                                                                                                                                                      
                             + '[' '!' -f /testcase ']'                                                                                                                                                                                                                                                                                                                                                                
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                      
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                             
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                         
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                                
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                               
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                                      
                             + run_fuzzer fuzz-link-parser -runs=100 /testcase                                                                                                                                                                                                                                                                                                                                         
                             vm.mmap_rnd_bits = 28                                                                                                                                                                                                                                                                                                                                                                     
                             /out/fuzz-link-parser -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                                                                                                                                                                                                                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                                                                                                                                                                                                                                   
                             INFO: Seed: 4166796164                                                                                                                                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 modules   (96981 inline 8-bit counters): 94611 [0x7f5b975ab920, 0x7f5b975c2ab3), 2370 [0x556e24390078, 0x556e243909ba),                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 PC tables (96981 PCs): 94611 [0x7f5b975c2ab8,0x7f5b977343e8), 2370 [0x556e243909c0,0x556e24399de0),                                                                                                                                                                                                                                                                        
                             /out/fuzz-link-parser: Running 1 inputs 100 time(s) each.                                                                                                                                                                                                                                                                                                                                 
                             Running: /testcase                                                                                                                                                                                                                                                                                                                                                                        
                             =================================================================                                                                                                                                                                                                                                                                                                                         
                             ==18==ERROR: AddressSanitizer: heap-use-after-free on address 0x503000000200 at pc 0x7f5b96e9a23f bp 0x7ffcf99bad20 sp 0x7ffcf99bad18                                                                                                                                                                                                                                                     
                             READ of size 8 at 0x503000000200 thread T0                                                                                                                                                                                                                                                                                                                                                
                             SCARINESS: 51 (8-byte-read-heap-use-after-free)                                                                                                                                                                                                                                                                                                                                           
                                 #0 0x7f5b96e9a23e in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:100:9                                                                                                                                                                                                                                                                              
                                 #1 0x556e24237918 in condition_free_list /work/build/../../src/systemd/src/shared/condition.h:80:16                                                                                                                                                                                                                                                                                   
                                 #2 0x556e24237918 in link_config_free /work/build/../../src/systemd/src/udev/net/link-config.c:64:9                                                                                                                                                                                                                                                                                   
                                 #3 0x556e2422c7c9 in link_config_freep /work/build/../../src/systemd/src/udev/net/link-config.c:84:1                                                                                                                                                                                                                                                                                  
                                 #4 0x556e2422c7c9 in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:324:1                                                                                                                                                                                                                                                                                     
                                 #5 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                       
                                 #6 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                              
                                 #7 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                  
                                 #8 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                                
                                 #9 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                               
                                 #10 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                 #11 0x556e2415321d in _start (/out/fuzz-link-parser+0x7b21d)                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: condition_free_list_type--condition_free_list--link_config_free                                                                                                                                                                                                                                                                                                              
                             0x503000000200 is located 16 bytes inside of 32-byte region [0x5030000001f0,0x503000000210)                                                                                                                                                                                                                                                                                               
                             freed by thread T0 here:                                                                                                                                                                                                                                                                                                                                                                  
                                 #0 0x556e241ebf96 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3                                                                                                                                                                                                                                                                                           
                                 #1 0x7f5b96e9a1ae in condition_free /work/build/../../src/systemd/src/shared/condition.c:96:16                                                                                                                                                                                                                                                                                        
                                 #2 0x7f5b96e9a1ae in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:102:25                                                                                                                                                                                                                                                                             
                                 #3 0x7f5b96fb2696 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:205:25                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_free--condition_free--condition_free_list_type                                                                                                                                                                                                                                                                                                                 
                             previously allocated by thread T0 here:                                                                                                                                                                                                                                                                                                                                                   
                                 #0 0x556e241ec22f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                                                                                                                                                                                                                         
                                 #1 0x7f5b96e99edd in malloc_multiply /work/build/../../src/systemd/src/basic/alloc-util.h:119:16                                                                                                                                                                                                                                                                                      
                                 #2 0x7f5b96e99edd in condition_new /work/build/../../src/systemd/src/shared/condition.c:73:13                                                                                                                                                                                                                                                                                         
                                 #3 0x7f5b96fb26c8 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:213:13                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_malloc--malloc_multiply--condition_new                                                                                                                                                                                                                                                                                                                         
                             SUMMARY: AddressSanitizer: heap-use-after-free /work/build/../../src/systemd/src/shared/condition.c:100:9 in condition_free_list_type                                                                                                                                                                                                                                                     
                             Shadow bytes around the buggy address:                                                                                                                                                                                                                                                                                                                                                    
                               0x502fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000000: fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000080: 00 fa fa fa 00 00 00 fa fa fa 00 00 00 00 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000100: 00 00 00 fa fa fa fd fd fd fd fa fa fd fd fd fd                                                                                                                                                                                                                                                                                                                         
                               0x503000000180: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd                                                                                                                                                                                                                                                                                                                         
                             =>0x503000000200:[fd]fd fa fa fd fd fd fd fa fa 00 00 00 05 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000380: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000400: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                                                                                                                                                                                                                      
                               Addressable:           00                                                                                                                                                                                                                                                                                                                                                               
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                                                                                                                                                                                                                             
                               Heap left redzone:       fa                                                                                                                                                                                                                                                                                                                                                             
                               Freed heap region:       fd                                                                                                                                                                                                                                                                                                                                                             
                               Stack left redzone:      f1                                                                                                                                                                                                                                                                                                                                                             
                               Stack mid redzone:       f2                                                                                                                                                                                                                                                                                                                                                             
                               Stack right redzone:     f3                                                                                                                                                                                                                                                                                                                                                             
                               Stack after return:      f5                                                                                                                                                                                                                                                                                                                                                             
                               Stack use after scope:   f8                                                                                                                                                                                                                                                                                                                                                             
                               Global redzone:          f9                                                                                                                                                                                                                                                                                                                                                             
                               Global init order:       f6                                                                                                                                                                                                                                                                                                                                                             
                               Poisoned by user:        f7                                                                                                                                                                                                                                                                                                                                                             
                               Container overflow:      fc                                                                                                                                                                                                                                                                                                                                                             
                               Array cookie:            ac                                                                                                                                                                                                                                                                                                                                                             
                               Intra object redzone:    bb                                                                                                                                                                                                                                                                                                                                                             
                               ASan internal:           fe                                                                                                                                                                                                                                                                                                                                                             
                               Left alloca redzone:     ca                                                                                                                                                                                                                                                                                                                                                             
                               Right alloca redzone:    cb                                                                                                                                                                                                                                                                                                                                                             
                             ==18==ABORTING                                                                                                                                                                                                                                                                                                                                                                            
                             subprocess command returned a non-zero exit status: 1                                                                                                                                                                                                                                                                                                                                     
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /tasks_new/systemd_systemd-full-001/fuzz-tooling/build/out/systemd:/out -v /tmp/tmphnblpbzl:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce fuzz-link-parser -runs=100.                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ===Evaluation Report===                                                                                                                                                                                                                                                                                                                                                                   
                             # Evaluation Report                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ## Summary                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             A heap-use-after-free error was detected by AddressSanitizer during execution of the `fuzz-link-parser` target. The crash occurs in the function `condition_free_list_type` (source/shared/condition.c:100) when it attempts to read memory that was previously freed. The issue was discovered while fuzzing the network link configuration parser in systemds udev                     
                             component.                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ## Description                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             - Issue Details                                                                                                                                                                                                                                                                                                                                                                           
                               The fuzzer invoked `LLVMFuzzerTestOneInput`, which calls `link_load_one` in `src/udev/net/link-config.c`. That function parses configuration files through the shared conf-parser and net-condition routines. During this process, a `condition` object is allocated via `condition_new`, later freed by `condition_free` (in `condition.c`), and then erroneously                      
                             accessed again by `condition_free_list_type`. AddressSanitizer reports an 8-byte read from a 32-byte heap block at offset 16, marking a use-after-free scenario.                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             - Vulnerability Type                                                                                                                                                                                                                                                                                                                                                                      
                               The error is classified as a heap-use-after-free vulnerability. Such issues can lead to memory corruption, crashes, or potential code execution if exploited.                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             - Important Observations                                                                                                                                                                                                                                                                                                                                                                  
                                The crash stack trace shows allocation in `condition_new` (via `malloc_multiply`) and a free in `condition_free`.                                                                                                                                                                                                                                                                     
                                The second access happens in `condition_free_list_type` when unwinding or cleaning up a list of condition objects.                                                                                                                                                                                                                                                                    
                                The data flow passes through configuration parsing routines (`conf-parser.c`) and network-condition logic (`net-condition.c`), invoked by `link_config_free` in the udev link-config code.                                                                                                                                                                                            
                                The fuzzer harness itself simply feeds arbitrary inputs to `LLVMFuzzerTestOneInput`; it is not the root cause but triggers the vulnerability in production code.                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             - Code Areas for Investigation                                                                                                                                                                                                                                                                                                                                                            
                               1. `src/shared/condition.c`:                                                                                                                                                                                                                                                                                                                                                            
                                   Implementation of `condition_new`, `condition_free`, and `condition_free_list_type`.                                                                                                                                                                                                                                                                                               
                                   List management and freeing logic to ensure nodes are not double-freed or reused after free.                                                                                                                                                                                                                                                                                       
                               2. `src/shared/net-condition.c` and `src/shared/conf-parser.c`:                                                                                                                                                                                                                                                                                                                         
                                   Parsing of Condition directives that allocate and append to the condition list.                                                                                                                                                                                                                                                                                                  
                                   The sequence in which parsed conditions are freed versus when the list is traversed.                                                                                                                                                                                                                                                                                               
                               3. `src/udev/net/link-config.c`:                                                                                                                                                                                                                                                                                                                                                        
                                   `link_load_one` and `link_config_free` functions that wrap parsing and cleanup of link configuration structures.                                                                                                                                                                                                                                                                   
                                   Any code paths that may trigger both individual frees and whole-list frees on the same objects.                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             This information should guide further root-cause analysis by focusing on the memory management of condition objects and the list cleanup routines invoked during link configuration parsing.                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ## Initial Issue Log                                                                                                                                                                                                                                                                                                                                                                      
                             Here is the initial issue log of the codebase:                                                                                                                                                                                                                                                                                                                                            
                             <issue>                                                                                                                                                                                                                                                                                                                                                                                   
                             + FUZZER=fuzz-link-parser                                                                                                                                                                                                                                                                                                                                                                 
                             + shift                                                                                                                                                                                                                                                                                                                                                                                   
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                                                                                                                                                                                                                                 
                             + TESTCASE=/testcase                                                                                                                                                                                                                                                                                                                                                                      
                             + '[' '!' -f /testcase ']'                                                                                                                                                                                                                                                                                                                                                                
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                      
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                                                                                                                                                                                                                             
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                         
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                                                                                                                                                                                                                                
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                               
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                                                                                                                                                                                                                      
                             + run_fuzzer fuzz-link-parser -runs=100 /testcase                                                                                                                                                                                                                                                                                                                                         
                             vm.mmap_rnd_bits = 28                                                                                                                                                                                                                                                                                                                                                                     
                             /out/fuzz-link-parser -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                                                                                                                                                                                                                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                                                                                                                                                                                                                                   
                             INFO: Seed: 4166796164                                                                                                                                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 modules   (96981 inline 8-bit counters): 94611 [0x7f5b975ab920, 0x7f5b975c2ab3), 2370 [0x556e24390078, 0x556e243909ba),                                                                                                                                                                                                                                                    
                             INFO: Loaded 2 PC tables (96981 PCs): 94611 [0x7f5b975c2ab8,0x7f5b977343e8), 2370 [0x556e243909c0,0x556e24399de0),                                                                                                                                                                                                                                                                        
                             /out/fuzz-link-parser: Running 1 inputs 100 time(s) each.                                                                                                                                                                                                                                                                                                                                 
                             Running: /testcase                                                                                                                                                                                                                                                                                                                                                                        
                             =================================================================                                                                                                                                                                                                                                                                                                                         
                             ==18==ERROR: AddressSanitizer: heap-use-after-free on address 0x503000000200 at pc 0x7f5b96e9a23f bp 0x7ffcf99bad20 sp 0x7ffcf99bad18                                                                                                                                                                                                                                                     
                             READ of size 8 at 0x503000000200 thread T0                                                                                                                                                                                                                                                                                                                                                
                             SCARINESS: 51 (8-byte-read-heap-use-after-free)                                                                                                                                                                                                                                                                                                                                           
                                 #0 0x7f5b96e9a23e in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:100:9                                                                                                                                                                                                                                                                              
                                 #1 0x556e24237918 in condition_free_list /work/build/../../src/systemd/src/shared/condition.h:80:16                                                                                                                                                                                                                                                                                   
                                 #2 0x556e24237918 in link_config_free /work/build/../../src/systemd/src/udev/net/link-config.c:64:9                                                                                                                                                                                                                                                                                   
                                 #3 0x556e2422c7c9 in link_config_freep /work/build/../../src/systemd/src/udev/net/link-config.c:84:1                                                                                                                                                                                                                                                                                  
                                 #4 0x556e2422c7c9 in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:324:1                                                                                                                                                                                                                                                                                     
                                 #5 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                       
                                 #6 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                              
                                 #7 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                  
                                 #8 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                                
                                 #9 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                               
                                 #10 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                 #11 0x556e2415321d in _start (/out/fuzz-link-parser+0x7b21d)                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: condition_free_list_type--condition_free_list--link_config_free                                                                                                                                                                                                                                                                                                              
                             0x503000000200 is located 16 bytes inside of 32-byte region [0x5030000001f0,0x503000000210)                                                                                                                                                                                                                                                                                               
                             freed by thread T0 here:                                                                                                                                                                                                                                                                                                                                                                  
                                 #0 0x556e241ebf96 in free /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:52:3                                                                                                                                                                                                                                                                                           
                                 #1 0x7f5b96e9a1ae in condition_free /work/build/../../src/systemd/src/shared/condition.c:96:16                                                                                                                                                                                                                                                                                        
                                 #2 0x7f5b96e9a1ae in condition_free_list_type /work/build/../../src/systemd/src/shared/condition.c:102:25                                                                                                                                                                                                                                                                             
                                 #3 0x7f5b96fb2696 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:205:25                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_free--condition_free--condition_free_list_type                                                                                                                                                                                                                                                                                                                 
                             previously allocated by thread T0 here:                                                                                                                                                                                                                                                                                                                                                   
                                 #0 0x556e241ec22f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                                                                                                                                                                                                                         
                                 #1 0x7f5b96e99edd in malloc_multiply /work/build/../../src/systemd/src/basic/alloc-util.h:119:16                                                                                                                                                                                                                                                                                      
                                 #2 0x7f5b96e99edd in condition_new /work/build/../../src/systemd/src/shared/condition.c:73:13                                                                                                                                                                                                                                                                                         
                                 #3 0x7f5b96fb26c8 in config_parse_net_condition /work/build/../../src/systemd/src/shared/net-condition.c:213:13                                                                                                                                                                                                                                                                       
                                 #4 0x7f5b96ea71b9 in next_assignment /work/build/../../src/systemd/src/shared/conf-parser.c:159:24                                                                                                                                                                                                                                                                                    
                                 #5 0x7f5b96ea71b9 in parse_line /work/build/../../src/systemd/src/shared/conf-parser.c:269:16                                                                                                                                                                                                                                                                                         
                                 #6 0x7f5b96ea6414 in config_parse /work/build/../../src/systemd/src/shared/conf-parser.c:412:21                                                                                                                                                                                                                                                                                       
                                 #7 0x7f5b96ea874a in config_parse_many_files /work/build/../../src/systemd/src/shared/conf-parser.c:564:21                                                                                                                                                                                                                                                                            
                                 #8 0x7f5b96ea874a in config_parse_many /work/build/../../src/systemd/src/shared/conf-parser.c:627:13                                                                                                                                                                                                                                                                                  
                                 #9 0x556e2422ca5d in link_load_one /work/build/../../src/systemd/src/udev/net/link-config.c:273:13                                                                                                                                                                                                                                                                                    
                                 #10 0x556e2422bb15 in LLVMFuzzerTestOneInput /work/build/../../src/systemd/src/udev/net/fuzz-link-parser.c:25:16                                                                                                                                                                                                                                                                      
                                 #11 0x556e242733f0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                                                                                                                                                                                             
                                 #12 0x556e2425e665 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                                                                                                                                                                                                 
                                 #13 0x556e242640ff in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                                                                                                               
                                 #14 0x556e2428f3a2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                                                                                                                                                                                                                              
                                 #15 0x7f5b96641082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             DEDUP_TOKEN: __interceptor_malloc--malloc_multiply--condition_new                                                                                                                                                                                                                                                                                                                         
                             SUMMARY: AddressSanitizer: heap-use-after-free /work/build/../../src/systemd/src/shared/condition.c:100:9 in condition_free_list_type                                                                                                                                                                                                                                                     
                             Shadow bytes around the buggy address:                                                                                                                                                                                                                                                                                                                                                    
                               0x502fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000000: fa fa 00 00 00 fa fa fa 00 00 00 fa fa fa 00 00                                                                                                                                                                                                                                                                                                                         
                               0x503000000080: 00 fa fa fa 00 00 00 fa fa fa 00 00 00 00 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000100: 00 00 00 fa fa fa fd fd fd fd fa fa fd fd fd fd                                                                                                                                                                                                                                                                                                                         
                               0x503000000180: fa fa fd fd fd fd fa fa fd fd fd fd fa fa fd fd                                                                                                                                                                                                                                                                                                                         
                             =>0x503000000200:[fd]fd fa fa fd fd fd fd fa fa 00 00 00 05 fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000380: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000400: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                               0x503000000480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                                                                                                                                                                                                                         
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                                                                                                                                                                                                                      
                               Addressable:           00                                                                                                                                                                                                                                                                                                                                                               
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                                                                                                                                                                                                                             
                               Heap left redzone:       fa                                                                                                                                                                                                                                                                                                                                                             
                               Freed heap region:       fd                                                                                                                                                                                                                                                                                                                                                             
                               Stack left redzone:      f1                                                                                                                                                                                                                                                                                                                                                             
                               Stack mid redzone:       f2                                                                                                                                                                                                                                                                                                                                                             
                               Stack right redzone:     f3                                                                                                                                                                                                                                                                                                                                                             
                               Stack after return:      f5                                                                                                                                                                                                                                                                                                                                                             
                               Stack use after scope:   f8                                                                                                                                                                                                                                                                                                                                                             
                               Global redzone:          f9                                                                                                                                                                                                                                                                                                                                                             
                               Global init order:       f6                                                                                                                                                                                                                                                                                                                                                             
                               Poisoned by user:        f7                                                                                                                                                                                                                                                                                                                                                             
                               Container overflow:      fc                                                                                                                                                                                                                                                                                                                                                             
                               Array cookie:            ac                                                                                                                                                                                                                                                                                                                                                             
                               Intra object redzone:    bb                                                                                                                                                                                                                                                                                                                                                             
                               ASan internal:           fe                                                                                                                                                                                                                                                                                                                                                             
                               Left alloca redzone:     ca                                                                                                                                                                                                                                                                                                                                                             
                               Right alloca redzone:    cb                                                                                                                                                                                                                                                                                                                                                             
                             ==18==ABORTING                                                                                                                                                                                                                                                                                                                                                                            
                             subprocess command returned a non-zero exit status: 1                                                                                                                                                                                                                                                                                                                                     
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /tasks_new/systemd_systemd-full-001/fuzz-tooling/build/out/systemd:/out -v /tmp/tmphnblpbzl:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce fuzz-link-parser -runs=100.                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             </issue>                                                                                                                                                                                                                                                                                                                                                                                  
                             ===Analysis Report===                                                                                                                                                                                                                                                                                                                                                                     
                             # Analysis Report                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ## Relevant Code Snippets                                                                                                                                                                                                                                                                                                                                                                 
                             <code_snippets>                                                                                                                                                                                                                                                                                                                                                                           
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.c:1-20                                                                                                                                                                                                                                                                                                                                                               
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             1:/* SPDX-License-Identifier: LGPL-2.1-or-later */                                                                                                                                                                                                                                                                                                                                        
                             2:                                                                                                                                                                                                                                                                                                                                                                                        
                             3:#include <ctype.h>                                                                                                                                                                                                                                                                                                                                                                      
                             4:#include <errno.h>                                                                                                                                                                                                                                                                                                                                                                      
                             5:#include <fcntl.h>                                                                                                                                                                                                                                                                                                                                                                      
                             6:#include <fnmatch.h>                                                                                                                                                                                                                                                                                                                                                                    
                             7:#include <limits.h>                                                                                                                                                                                                                                                                                                                                                                     
                             8:#include <stdlib.h>                                                                                                                                                                                                                                                                                                                                                                     
                             9:#include <sys/stat.h>                                                                                                                                                                                                                                                                                                                                                                   
                             10:#include <sys/types.h>                                                                                                                                                                                                                                                                                                                                                                 
                             11:#include <sys/utsname.h>                                                                                                                                                                                                                                                                                                                                                               
                             12:#include <time.h>                                                                                                                                                                                                                                                                                                                                                                      
                             13:#include <unistd.h>                                                                                                                                                                                                                                                                                                                                                                    
                             14:                                                                                                                                                                                                                                                                                                                                                                                       
                             15:#include "sd-id128.h"                                                                                                                                                                                                                                                                                                                                                                  
                             16:                                                                                                                                                                                                                                                                                                                                                                                       
                             17:#include "alloc-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             18:#include "apparmor-util.h"                                                                                                                                                                                                                                                                                                                                                             
                             19:#include "architecture.h"                                                                                                                                                                                                                                                                                                                                                              
                             20:#include "audit-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.c:61-110                                                                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             61:#include "tpm2-util.h"                                                                                                                                                                                                                                                                                                                                                                 
                             62:#include "uid-classification.h"                                                                                                                                                                                                                                                                                                                                                        
                             63:#include "user-util.h"                                                                                                                                                                                                                                                                                                                                                                 
                             64:#include "virt.h"                                                                                                                                                                                                                                                                                                                                                                      
                             65:                                                                                                                                                                                                                                                                                                                                                                                       
                             66:Condition* condition_new(ConditionType type, const char *parameter, bool trigger, bool negate) {                                                                                                                                                                                                                                                                                       
                             67:        Condition *c;                                                                                                                                                                                                                                                                                                                                                                  
                             68:                                                                                                                                                                                                                                                                                                                                                                                       
                             69:        assert(type >= 0);                                                                                                                                                                                                                                                                                                                                                             
                             70:        assert(type < _CONDITION_TYPE_MAX);                                                                                                                                                                                                                                                                                                                                            
                             71:        assert(parameter);                                                                                                                                                                                                                                                                                                                                                             
                             72:                                                                                                                                                                                                                                                                                                                                                                                       
                             73:        c = new(Condition, 1);                                                                                                                                                                                                                                                                                                                                                         
                             74:        if (!c)                                                                                                                                                                                                                                                                                                                                                                        
                             75:                return NULL;                                                                                                                                                                                                                                                                                                                                                           
                             76:                                                                                                                                                                                                                                                                                                                                                                                       
                             77:        *c = (Condition) {                                                                                                                                                                                                                                                                                                                                                             
                             78:                .type = type,                                                                                                                                                                                                                                                                                                                                                          
                             79:                .trigger = trigger,                                                                                                                                                                                                                                                                                                                                                    
                             80:                .negate = negate,                                                                                                                                                                                                                                                                                                                                                      
                             81:        };                                                                                                                                                                                                                                                                                                                                                                             
                             82:                                                                                                                                                                                                                                                                                                                                                                                       
                             83:        if (parameter) {                                                                                                                                                                                                                                                                                                                                                               
                             84:                c->parameter = strdup(parameter);                                                                                                                                                                                                                                                                                                                                      
                             85:                if (!c->parameter)                                                                                                                                                                                                                                                                                                                                                     
                             86:                        return mfree(c);                                                                                                                                                                                                                                                                                                                                               
                             87:        }                                                                                                                                                                                                                                                                                                                                                                              
                             88:                                                                                                                                                                                                                                                                                                                                                                                       
                             89:        return c;                                                                                                                                                                                                                                                                                                                                                                      
                             90:}                                                                                                                                                                                                                                                                                                                                                                                      
                             91:                                                                                                                                                                                                                                                                                                                                                                                       
                             92:Condition* condition_free(Condition *c) {                                                                                                                                                                                                                                                                                                                                              
                             93:        assert(c);                                                                                                                                                                                                                                                                                                                                                                     
                             94:                                                                                                                                                                                                                                                                                                                                                                                       
                             95:        free(c->parameter);                                                                                                                                                                                                                                                                                                                                                            
                             96:        return mfree(c);                                                                                                                                                                                                                                                                                                                                                               
                             97:}                                                                                                                                                                                                                                                                                                                                                                                      
                             98:                                                                                                                                                                                                                                                                                                                                                                                       
                             99:Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                             
                             100:        LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                             
                             101:                if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                    
                             102:                        condition_free(c);                                                                                                                                                                                                                                                                                                                                            
                             103:                }                                                                                                                                                                                                                                                                                                                                                                     
                             104:                                                                                                                                                                                                                                                                                                                                                                                      
                             105:        assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                                   
                             106:        return head;                                                                                                                                                                                                                                                                                                                                                                  
                             107:}                                                                                                                                                                                                                                                                                                                                                                                     
                             108:                                                                                                                                                                                                                                                                                                                                                                                      
                             109:static int condition_test_kernel_command_line(Condition *c, char **env) {                                                                                                                                                                                                                                                                                                             
                             110:        _cleanup_strv_free_ char **args = NULL;                                                                                                                                                                                                                                                                                                                                       
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.h:1-40                                                                                                                                                                                                                                                                                                                                                               
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             1:/* SPDX-License-Identifier: LGPL-2.1-or-later */                                                                                                                                                                                                                                                                                                                                        
                             2:#pragma once                                                                                                                                                                                                                                                                                                                                                                            
                             3:                                                                                                                                                                                                                                                                                                                                                                                        
                             4:#include <stdbool.h>                                                                                                                                                                                                                                                                                                                                                                    
                             5:#include <stdio.h>                                                                                                                                                                                                                                                                                                                                                                      
                             6:                                                                                                                                                                                                                                                                                                                                                                                        
                             7:#include "list.h"                                                                                                                                                                                                                                                                                                                                                                       
                             8:#include "macro.h"                                                                                                                                                                                                                                                                                                                                                                      
                             9:                                                                                                                                                                                                                                                                                                                                                                                        
                             10:typedef enum ConditionType {                                                                                                                                                                                                                                                                                                                                                           
                             11:        CONDITION_ARCHITECTURE,                                                                                                                                                                                                                                                                                                                                                        
                             12:        CONDITION_FIRMWARE,                                                                                                                                                                                                                                                                                                                                                            
                             13:        CONDITION_VIRTUALIZATION,                                                                                                                                                                                                                                                                                                                                                      
                             14:        CONDITION_HOST,                                                                                                                                                                                                                                                                                                                                                                
                             15:        CONDITION_KERNEL_COMMAND_LINE,                                                                                                                                                                                                                                                                                                                                                 
                             16:        CONDITION_KERNEL_VERSION,                                                                                                                                                                                                                                                                                                                                                      
                             17:        CONDITION_CREDENTIAL,                                                                                                                                                                                                                                                                                                                                                          
                             18:        CONDITION_SECURITY,                                                                                                                                                                                                                                                                                                                                                            
                             19:        CONDITION_CAPABILITY,                                                                                                                                                                                                                                                                                                                                                          
                             20:        CONDITION_AC_POWER,                                                                                                                                                                                                                                                                                                                                                            
                             21:        CONDITION_MEMORY,                                                                                                                                                                                                                                                                                                                                                              
                             22:        CONDITION_CPUS,                                                                                                                                                                                                                                                                                                                                                                
                             23:        CONDITION_ENVIRONMENT,                                                                                                                                                                                                                                                                                                                                                         
                             24:        CONDITION_CPU_FEATURE,                                                                                                                                                                                                                                                                                                                                                         
                             25:        CONDITION_OS_RELEASE,                                                                                                                                                                                                                                                                                                                                                          
                             26:        CONDITION_MEMORY_PRESSURE,                                                                                                                                                                                                                                                                                                                                                     
                             27:        CONDITION_CPU_PRESSURE,                                                                                                                                                                                                                                                                                                                                                        
                             28:        CONDITION_IO_PRESSURE,                                                                                                                                                                                                                                                                                                                                                         
                             29:                                                                                                                                                                                                                                                                                                                                                                                       
                             30:        CONDITION_NEEDS_UPDATE,                                                                                                                                                                                                                                                                                                                                                        
                             31:        CONDITION_FIRST_BOOT,                                                                                                                                                                                                                                                                                                                                                          
                             32:                                                                                                                                                                                                                                                                                                                                                                                       
                             33:        CONDITION_PATH_EXISTS,                                                                                                                                                                                                                                                                                                                                                         
                             34:        CONDITION_PATH_EXISTS_GLOB,                                                                                                                                                                                                                                                                                                                                                    
                             35:        CONDITION_PATH_IS_DIRECTORY,                                                                                                                                                                                                                                                                                                                                                   
                             36:        CONDITION_PATH_IS_SYMBOLIC_LINK,                                                                                                                                                                                                                                                                                                                                               
                             37:        CONDITION_PATH_IS_MOUNT_POINT,                                                                                                                                                                                                                                                                                                                                                 
                             38:        CONDITION_PATH_IS_READ_WRITE,                                                                                                                                                                                                                                                                                                                                                  
                             39:        CONDITION_PATH_IS_ENCRYPTED,                                                                                                                                                                                                                                                                                                                                                   
                             40:        CONDITION_DIRECTORY_NOT_EMPTY,                                                                                                                                                                                                                                                                                                                                                 
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.h:60-100                                                                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             60:        _CONDITION_RESULT_INVALID = -EINVAL,                                                                                                                                                                                                                                                                                                                                           
                             61:} ConditionResult;                                                                                                                                                                                                                                                                                                                                                                     
                             62:                                                                                                                                                                                                                                                                                                                                                                                       
                             63:typedef struct Condition {                                                                                                                                                                                                                                                                                                                                                             
                             64:        ConditionType type:8;                                                                                                                                                                                                                                                                                                                                                          
                             65:                                                                                                                                                                                                                                                                                                                                                                                       
                             66:        bool trigger:1;                                                                                                                                                                                                                                                                                                                                                                
                             67:        bool negate:1;                                                                                                                                                                                                                                                                                                                                                                 
                             68:                                                                                                                                                                                                                                                                                                                                                                                       
                             69:        ConditionResult result:6;                                                                                                                                                                                                                                                                                                                                                      
                             70:                                                                                                                                                                                                                                                                                                                                                                                       
                             71:        char *parameter;                                                                                                                                                                                                                                                                                                                                                               
                             72:                                                                                                                                                                                                                                                                                                                                                                                       
                             73:        LIST_FIELDS(struct Condition, conditions);                                                                                                                                                                                                                                                                                                                                     
                             74:} Condition;                                                                                                                                                                                                                                                                                                                                                                           
                             75:                                                                                                                                                                                                                                                                                                                                                                                       
                             76:Condition* condition_new(ConditionType type, const char *parameter, bool trigger, bool negate);                                                                                                                                                                                                                                                                                        
                             77:Condition* condition_free(Condition *c);                                                                                                                                                                                                                                                                                                                                               
                             78:Condition* condition_free_list_type(Condition *first, ConditionType type);                                                                                                                                                                                                                                                                                                             
                             79:static inline Condition* condition_free_list(Condition *first) {                                                                                                                                                                                                                                                                                                                       
                             80:        return condition_free_list_type(first, _CONDITION_TYPE_INVALID);                                                                                                                                                                                                                                                                                                               
                             81:}                                                                                                                                                                                                                                                                                                                                                                                      
                             82:                                                                                                                                                                                                                                                                                                                                                                                       
                             83:int condition_test(Condition *c, char **env);                                                                                                                                                                                                                                                                                                                                          
                             84:                                                                                                                                                                                                                                                                                                                                                                                       
                             85:typedef int (*condition_test_logger_t)(void *userdata, int level, int error, const char *file, int line, const char *func, const char *format, ...) _printf_(7, 8);                                                                                                                                                                                                                    
                             86:typedef const char* (*condition_to_string_t)(ConditionType t) _const_;                                                                                                                                                                                                                                                                                                                 
                             87:bool condition_test_list(Condition *first, char **env, condition_to_string_t to_string, condition_test_logger_t logger, void *userdata);                                                                                                                                                                                                                                               
                             88:                                                                                                                                                                                                                                                                                                                                                                                       
                             89:void condition_dump(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);                                                                                                                                                                                                                                                                                       
                             90:void condition_dump_list(Condition *c, FILE *f, const char *prefix, condition_to_string_t to_string);                                                                                                                                                                                                                                                                                  
                             91:                                                                                                                                                                                                                                                                                                                                                                                       
                             92:const char* condition_type_to_string(ConditionType t) _const_;                                                                                                                                                                                                                                                                                                                         
                             93:ConditionType condition_type_from_string(const char *s) _pure_;                                                                                                                                                                                                                                                                                                                        
                             94:                                                                                                                                                                                                                                                                                                                                                                                       
                             95:const char* assert_type_to_string(ConditionType t) _const_;                                                                                                                                                                                                                                                                                                                            
                             96:ConditionType assert_type_from_string(const char *s) _pure_;                                                                                                                                                                                                                                                                                                                           
                             97:                                                                                                                                                                                                                                                                                                                                                                                       
                             98:const char* condition_result_to_string(ConditionResult r) _const_;                                                                                                                                                                                                                                                                                                                     
                             99:ConditionResult condition_result_from_string(const char *s) _pure_;                                                                                                                                                                                                                                                                                                                    
                             100:                                                                                                                                                                                                                                                                                                                                                                                      
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/net-condition.c:180-240                                                                                                                                                                                                                                                                                                                                                        
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             180:        return true;                                                                                                                                                                                                                                                                                                                                                                  
                             181:}                                                                                                                                                                                                                                                                                                                                                                                     
                             182:                                                                                                                                                                                                                                                                                                                                                                                      
                             183:int config_parse_net_condition(                                                                                                                                                                                                                                                                                                                                                       
                             184:                const char *unit,                                                                                                                                                                                                                                                                                                                                                     
                             185:                const char *filename,                                                                                                                                                                                                                                                                                                                                                 
                             186:                unsigned line,                                                                                                                                                                                                                                                                                                                                                        
                             187:                const char *section,                                                                                                                                                                                                                                                                                                                                                  
                             188:                unsigned section_line,                                                                                                                                                                                                                                                                                                                                                
                             189:                const char *lvalue,                                                                                                                                                                                                                                                                                                                                                   
                             190:                int ltype,                                                                                                                                                                                                                                                                                                                                                            
                             191:                const char *rvalue,                                                                                                                                                                                                                                                                                                                                                   
                             192:                void *data,                                                                                                                                                                                                                                                                                                                                                           
                             193:                void *userdata) {                                                                                                                                                                                                                                                                                                                                                     
                             194:                                                                                                                                                                                                                                                                                                                                                                                      
                             195:        ConditionType cond = ltype;                                                                                                                                                                                                                                                                                                                                                   
                             196:        Condition **list = data, *c;                                                                                                                                                                                                                                                                                                                                                  
                             197:        bool negate;                                                                                                                                                                                                                                                                                                                                                                  
                             198:                                                                                                                                                                                                                                                                                                                                                                                      
                             199:        assert(filename);                                                                                                                                                                                                                                                                                                                                                             
                             200:        assert(lvalue);                                                                                                                                                                                                                                                                                                                                                               
                             201:        assert(rvalue);                                                                                                                                                                                                                                                                                                                                                               
                             202:        assert(data);                                                                                                                                                                                                                                                                                                                                                                 
                             203:                                                                                                                                                                                                                                                                                                                                                                                      
                             204:        if (isempty(rvalue)) {                                                                                                                                                                                                                                                                                                                                                        
                             205:                *list = condition_free_list_type(*list, cond);                                                                                                                                                                                                                                                                                                                        
                             206:                return 0;                                                                                                                                                                                                                                                                                                                                                             
                             207:        }                                                                                                                                                                                                                                                                                                                                                                             
                             208:                                                                                                                                                                                                                                                                                                                                                                                      
                             209:        negate = rvalue[0] == '!';                                                                                                                                                                                                                                                                                                                                                    
                             210:        if (negate)                                                                                                                                                                                                                                                                                                                                                                   
                             211:                rvalue++;                                                                                                                                                                                                                                                                                                                                                             
                             212:                                                                                                                                                                                                                                                                                                                                                                                      
                             213:        c = condition_new(cond, rvalue, false, negate);                                                                                                                                                                                                                                                                                                                               
                             214:        if (!c)                                                                                                                                                                                                                                                                                                                                                                       
                             215:                return log_oom();                                                                                                                                                                                                                                                                                                                                                     
                             216:                                                                                                                                                                                                                                                                                                                                                                                      
                             217:        /* Drop previous assignment. */                                                                                                                                                                                                                                                                                                                                               
                             218:        *list = condition_free_list_type(*list, cond);                                                                                                                                                                                                                                                                                                                                
                             219:                                                                                                                                                                                                                                                                                                                                                                                      
                             220:        LIST_PREPEND(conditions, *list, c);                                                                                                                                                                                                                                                                                                                                           
                             221:        return 0;                                                                                                                                                                                                                                                                                                                                                                     
                             222:}                                                                                                                                                                                                                                                                                                                                                                                     
                             223:                                                                                                                                                                                                                                                                                                                                                                                      
                             224:int config_parse_match_strv(                                                                                                                                                                                                                                                                                                                                                          
                             225:                const char *unit,                                                                                                                                                                                                                                                                                                                                                     
                             226:                const char *filename,                                                                                                                                                                                                                                                                                                                                                 
                             227:                unsigned line,                                                                                                                                                                                                                                                                                                                                                        
                             228:                const char *section,                                                                                                                                                                                                                                                                                                                                                  
                             229:                unsigned section_line,                                                                                                                                                                                                                                                                                                                                                
                             230:                const char *lvalue,                                                                                                                                                                                                                                                                                                                                                   
                             231:                int ltype,                                                                                                                                                                                                                                                                                                                                                            
                             232:                const char *rvalue,                                                                                                                                                                                                                                                                                                                                                   
                             233:                void *data,                                                                                                                                                                                                                                                                                                                                                           
                             234:                void *userdata) {                                                                                                                                                                                                                                                                                                                                                     
                             235:                                                                                                                                                                                                                                                                                                                                                                                      
                             236:        const char *p = ASSERT_PTR(rvalue);                                                                                                                                                                                                                                                                                                                                           
                             237:        char ***sv = ASSERT_PTR(data);                                                                                                                                                                                                                                                                                                                                                
                             238:        bool invert;                                                                                                                                                                                                                                                                                                                                                                  
                             239:        int r;                                                                                                                                                                                                                                                                                                                                                                        
                             240:                                                                                                                                                                                                                                                                                                                                                                                      
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/udev/net/link-config.c:1-80                                                                                                                                                                                                                                                                                                                                                           
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             1:/* SPDX-License-Identifier: LGPL-2.1-or-later */                                                                                                                                                                                                                                                                                                                                        
                             2:                                                                                                                                                                                                                                                                                                                                                                                        
                             3:#include <linux/netdevice.h>                                                                                                                                                                                                                                                                                                                                                            
                             4:#include <netinet/ether.h>                                                                                                                                                                                                                                                                                                                                                              
                             5:#include <unistd.h>                                                                                                                                                                                                                                                                                                                                                                     
                             6:                                                                                                                                                                                                                                                                                                                                                                                        
                             7:#include "sd-device.h"                                                                                                                                                                                                                                                                                                                                                                  
                             8:#include "sd-netlink.h"                                                                                                                                                                                                                                                                                                                                                                 
                             9:                                                                                                                                                                                                                                                                                                                                                                                        
                             10:#include "alloc-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             11:#include "arphrd-util.h"                                                                                                                                                                                                                                                                                                                                                               
                             12:#include "conf-files.h"                                                                                                                                                                                                                                                                                                                                                                
                             13:#include "conf-parser.h"                                                                                                                                                                                                                                                                                                                                                               
                             14:#include "constants.h"                                                                                                                                                                                                                                                                                                                                                                 
                             15:#include "creds-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             16:#include "device-private.h"                                                                                                                                                                                                                                                                                                                                                            
                             17:#include "device-util.h"                                                                                                                                                                                                                                                                                                                                                               
                             18:#include "env-util.h"                                                                                                                                                                                                                                                                                                                                                                  
                             19:#include "escape.h"                                                                                                                                                                                                                                                                                                                                                                    
                             20:#include "ethtool-util.h"                                                                                                                                                                                                                                                                                                                                                              
                             21:#include "fd-util.h"                                                                                                                                                                                                                                                                                                                                                                   
                             22:#include "fileio.h"                                                                                                                                                                                                                                                                                                                                                                    
                             23:#include "link-config.h"                                                                                                                                                                                                                                                                                                                                                               
                             24:#include "log-link.h"                                                                                                                                                                                                                                                                                                                                                                  
                             25:#include "memory-util.h"                                                                                                                                                                                                                                                                                                                                                               
                             26:#include "net-condition.h"                                                                                                                                                                                                                                                                                                                                                             
                             27:#include "netif-sriov.h"                                                                                                                                                                                                                                                                                                                                                               
                             28:#include "netif-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             29:#include "netlink-util.h"                                                                                                                                                                                                                                                                                                                                                              
                             30:#include "network-util.h"                                                                                                                                                                                                                                                                                                                                                              
                             31:#include "parse-util.h"                                                                                                                                                                                                                                                                                                                                                                
                             32:#include "path-lookup.h"                                                                                                                                                                                                                                                                                                                                                               
                             33:#include "path-util.h"                                                                                                                                                                                                                                                                                                                                                                 
                             34:#include "proc-cmdline.h"                                                                                                                                                                                                                                                                                                                                                              
                             35:#include "random-util.h"                                                                                                                                                                                                                                                                                                                                                               
                             36:#include "specifier.h"                                                                                                                                                                                                                                                                                                                                                                 
                             37:#include "stat-util.h"                                                                                                                                                                                                                                                                                                                                                                 
                             38:#include "string-table.h"                                                                                                                                                                                                                                                                                                                                                              
                             39:#include "string-util.h"                                                                                                                                                                                                                                                                                                                                                               
                             40:#include "strv.h"                                                                                                                                                                                                                                                                                                                                                                      
                             41:#include "udev-builtin.h"                                                                                                                                                                                                                                                                                                                                                              
                             42:#include "utf8.h"                                                                                                                                                                                                                                                                                                                                                                      
                             43:                                                                                                                                                                                                                                                                                                                                                                                       
                             44:static const Specifier link_specifier_table[] = {                                                                                                                                                                                                                                                                                                                                      
                             45:        COMMON_SYSTEM_SPECIFIERS,                                                                                                                                                                                                                                                                                                                                                      
                             46:        COMMON_TMP_SPECIFIERS,                                                                                                                                                                                                                                                                                                                                                         
                             47:        {}                                                                                                                                                                                                                                                                                                                                                                             
                             48:};                                                                                                                                                                                                                                                                                                                                                                                     
                             49:                                                                                                                                                                                                                                                                                                                                                                                       
                             50:struct LinkConfigContext {                                                                                                                                                                                                                                                                                                                                                             
                             51:        LIST_HEAD(LinkConfig, configs);                                                                                                                                                                                                                                                                                                                                                
                             52:        int ethtool_fd;                                                                                                                                                                                                                                                                                                                                                                
                             53:        Hashmap *stats_by_path;                                                                                                                                                                                                                                                                                                                                                        
                             54:};                                                                                                                                                                                                                                                                                                                                                                                     
                             55:                                                                                                                                                                                                                                                                                                                                                                                       
                             56:static LinkConfig* link_config_free(LinkConfig *config) {                                                                                                                                                                                                                                                                                                                              
                             57:        if (!config)                                                                                                                                                                                                                                                                                                                                                                   
                             58:                return NULL;                                                                                                                                                                                                                                                                                                                                                           
                             59:                                                                                                                                                                                                                                                                                                                                                                                       
                             60:        free(config->filename);                                                                                                                                                                                                                                                                                                                                                        
                             61:        strv_free(config->dropins);                                                                                                                                                                                                                                                                                                                                                    
                             62:                                                                                                                                                                                                                                                                                                                                                                                       
                             63:        net_match_clear(&config->match);                                                                                                                                                                                                                                                                                                                                               
                             64:        condition_free_list(config->conditions);                                                                                                                                                                                                                                                                                                                                       
                             65:                                                                                                                                                                                                                                                                                                                                                                                       
                             66:        free(config->description);                                                                                                                                                                                                                                                                                                                                                     
                             67:        strv_free(config->properties);                                                                                                                                                                                                                                                                                                                                                 
                             68:        strv_free(config->import_properties);                                                                                                                                                                                                                                                                                                                                          
                             69:        strv_free(config->unset_properties);                                                                                                                                                                                                                                                                                                                                           
                             70:        free(config->name_policy);                                                                                                                                                                                                                                                                                                                                                     
                             71:        free(config->name);                                                                                                                                                                                                                                                                                                                                                            
                             72:        strv_free(config->alternative_names);                                                                                                                                                                                                                                                                                                                                          
                             73:        free(config->alternative_names_policy);                                                                                                                                                                                                                                                                                                                                        
                             74:        free(config->alias);                                                                                                                                                                                                                                                                                                                                                           
                             75:        free(config->wol_password_file);                                                                                                                                                                                                                                                                                                                                               
                             76:        erase_and_free(config->wol_password);                                                                                                                                                                                                                                                                                                                                          
                             77:        cpu_set_free(config->rps_cpu_mask);                                                                                                                                                                                                                                                                                                                                            
                             78:                                                                                                                                                                                                                                                                                                                                                                                       
                             79:        ordered_hashmap_free_with_destructor(config->sr_iov_by_section, sr_iov_free);                                                                                                                                                                                                                                                                                                  
                             80:                                                                                                                                                                                                                                                                                                                                                                                       
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/udev/net/link-config.c:260-330                                                                                                                                                                                                                                                                                                                                                        
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             260:                .tx_flow_control = -1,                                                                                                                                                                                                                                                                                                                                                
                             261:                .autoneg_flow_control = -1,                                                                                                                                                                                                                                                                                                                                           
                             262:                .txqueuelen = UINT32_MAX,                                                                                                                                                                                                                                                                                                                                             
                             263:                .coalesce.use_adaptive_rx_coalesce = -1,                                                                                                                                                                                                                                                                                                                              
                             264:                .coalesce.use_adaptive_tx_coalesce = -1,                                                                                                                                                                                                                                                                                                                              
                             265:                .mdi = ETH_TP_MDI_INVALID,                                                                                                                                                                                                                                                                                                                                            
                             266:                .sr_iov_num_vfs = UINT32_MAX,                                                                                                                                                                                                                                                                                                                                         
                             267:        };                                                                                                                                                                                                                                                                                                                                                                            
                             268:                                                                                                                                                                                                                                                                                                                                                                                      
                             269:        FOREACH_ELEMENT(feature, config->features)                                                                                                                                                                                                                                                                                                                                    
                             270:                *feature = -1;                                                                                                                                                                                                                                                                                                                                                        
                             271:                                                                                                                                                                                                                                                                                                                                                                                      
                             272:        dropin_dirname = strjoina(basename(filename), ".d");                                                                                                                                                                                                                                                                                                                          
                             273:        r = config_parse_many(                                                                                                                                                                                                                                                                                                                                                        
                             274:                        STRV_MAKE_CONST(filename),                                                                                                                                                                                                                                                                                                                                    
                             275:                        NETWORK_DIRS,                                                                                                                                                                                                                                                                                                                                                 
                             276:                        dropin_dirname,                                                                                                                                                                                                                                                                                                                                               
                             277:                        /* root = */ NULL,                                                                                                                                                                                                                                                                                                                                            
                             278:                        "Match\0"                                                                                                                                                                                                                                                                                                                                                     
                             279:                        "Link\0"                                                                                                                                                                                                                                                                                                                                                      
                             280:                        "SR-IOV\0",                                                                                                                                                                                                                                                                                                                                                   
                             281:                        config_item_perf_lookup, link_config_gperf_lookup,                                                                                                                                                                                                                                                                                                            
                             282:                        CONFIG_PARSE_WARN, config, &stats_by_path,                                                                                                                                                                                                                                                                                                                    
                             283:                        &config->dropins);                                                                                                                                                                                                                                                                                                                                            
                             284:        if (r < 0)                                                                                                                                                                                                                                                                                                                                                                    
                             285:                return r; /* config_parse_many() logs internally. */                                                                                                                                                                                                                                                                                                                  
                             286:                                                                                                                                                                                                                                                                                                                                                                                      
                             287:        if (ctx->stats_by_path) {                                                                                                                                                                                                                                                                                                                                                     
                             288:                r = hashmap_move(ctx->stats_by_path, stats_by_path);                                                                                                                                                                                                                                                                                                                  
                             289:                if (r < 0)                                                                                                                                                                                                                                                                                                                                                            
                             290:                        log_warning_errno(r, "Failed to save stats of '%s' and its drop-in configs, ignoring: %m", filename);                                                                                                                                                                                                                                                         
                             291:        } else                                                                                                                                                                                                                                                                                                                                                                        
                             292:                ctx->stats_by_path = TAKE_PTR(stats_by_path);                                                                                                                                                                                                                                                                                                                         
                             293:                                                                                                                                                                                                                                                                                                                                                                                      
                             294:        if (net_match_is_empty(&config->match) && !config->conditions) {                                                                                                                                                                                                                                                                                                              
                             295:                log_warning("%s: No valid settings found in the [Match] section, ignoring file. "                                                                                                                                                                                                                                                                                     
                             296:                            "To match all interfaces, add OriginalName=* in the [Match] section.",                                                                                                                                                                                                                                                                                    
                             297:                            filename);                                                                                                                                                                                                                                                                                                                                                
                             298:                return 0;                                                                                                                                                                                                                                                                                                                                                             
                             299:        }                                                                                                                                                                                                                                                                                                                                                                             
                             300:                                                                                                                                                                                                                                                                                                                                                                                      
                             301:        if (!condition_test_list(config->conditions, environ, NULL, NULL, NULL)) {                                                                                                                                                                                                                                                                                                    
                             302:                log_debug("%s: Conditions do not match the system environment, skipping.", filename);                                                                                                                                                                                                                                                                                 
                             303:                return 0;                                                                                                                                                                                                                                                                                                                                                             
                             304:        }                                                                                                                                                                                                                                                                                                                                                                             
                             305:                                                                                                                                                                                                                                                                                                                                                                                      
                             306:        if (IN_SET(config->mac_address_policy, MAC_ADDRESS_POLICY_PERSISTENT, MAC_ADDRESS_POLICY_RANDOM) &&                                                                                                                                                                                                                                                                           
                             307:            config->hw_addr.length > 0)                                                                                                                                                                                                                                                                                                                                               
                             308:                log_warning("%s: MACAddress= in [Link] section will be ignored when MACAddressPolicy= "                                                                                                                                                                                                                                                                               
                             309:                            "is set to \"persistent\" or \"random\".",                                                                                                                                                                                                                                                                                                                
                             310:                            filename);                                                                                                                                                                                                                                                                                                                                                
                             311:                                                                                                                                                                                                                                                                                                                                                                                      
                             312:        r = link_adjust_wol_options(config);                                                                                                                                                                                                                                                                                                                                          
                             313:        if (r < 0)                                                                                                                                                                                                                                                                                                                                                                    
                             314:                return r; /* link_adjust_wol_options() logs internally. */                                                                                                                                                                                                                                                                                                            
                             315:                                                                                                                                                                                                                                                                                                                                                                                      
                             316:        r = sr_iov_drop_invalid_sections(config->sr_iov_num_vfs, config->sr_iov_by_section);                                                                                                                                                                                                                                                                                          
                             317:        if (r < 0)                                                                                                                                                                                                                                                                                                                                                                    
                             318:                return r; /* sr_iov_drop_invalid_sections() logs internally. */                                                                                                                                                                                                                                                                                                       
                             319:                                                                                                                                                                                                                                                                                                                                                                                      
                             320:        log_debug("Parsed configuration file \"%s\"", filename);                                                                                                                                                                                                                                                                                                                      
                             321:                                                                                                                                                                                                                                                                                                                                                                                      
                             322:        LIST_PREPEND(configs, ctx->configs, TAKE_PTR(config));                                                                                                                                                                                                                                                                                                                        
                             323:        return 0;                                                                                                                                                                                                                                                                                                                                                                     
                             324:}                                                                                                                                                                                                                                                                                                                                                                                     
                             325:                                                                                                                                                                                                                                                                                                                                                                                      
                             326:static int device_unsigned_attribute(sd_device *device, const char *attr, unsigned *type) {                                                                                                                                                                                                                                                                                           
                             327:        const char *s;                                                                                                                                                                                                                                                                                                                                                                
                             328:        int r;                                                                                                                                                                                                                                                                                                                                                                        
                             329:                                                                                                                                                                                                                                                                                                                                                                                      
                             330:        r = sd_device_get_sysattr_value(device, attr, &s);                                                                                                                                                                                                                                                                                                                            
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.c:99-107                                                                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             99:Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                             
                             100:        LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                             
                             101:                if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                    
                             102:                        condition_free(c);                                                                                                                                                                                                                                                                                                                                            
                             103:                }                                                                                                                                                                                                                                                                                                                                                                     
                             104:                                                                                                                                                                                                                                                                                                                                                                                      
                             105:        assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                                   
                             106:        return head;                                                                                                                                                                                                                                                                                                                                                                  
                             107:}                                                                                                                                                                                                                                                                                                                                                                                     
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.h:73-78                                                                                                                                                                                                                                                                                                                                                              
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             73:        LIST_FIELDS(struct Condition, conditions);                                                                                                                                                                                                                                                                                                                                     
                             74:} Condition;                                                                                                                                                                                                                                                                                                                                                                           
                             75:                                                                                                                                                                                                                                                                                                                                                                                       
                             76:Condition* condition_new(ConditionType type, const char *parameter, bool trigger, bool negate);                                                                                                                                                                                                                                                                                        
                             77:Condition* condition_free(Condition *c);                                                                                                                                                                                                                                                                                                                                               
                             78:Condition* condition_free_list_type(Condition *first, ConditionType type);                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/basic/list.h:48-63                                                                                                                                                                                                                                                                                                                                                                    
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             48:#define LIST_REMOVE(name,head,item)                                     \                                                                                                                                                                                                                                                                                                              
                             49:        ({                                                              \                                                                                                                                                                                                                                                                                                              
                             50:                typeof(*(head)) **_head = &(head), *_item = (item);     \                                                                                                                                                                                                                                                                                                              
                             51:                assert(_item);                                          \                                                                                                                                                                                                                                                                                                              
                             52:                if (_item->name##_next)                                 \                                                                                                                                                                                                                                                                                                              
                             53:                        _item->name##_next->name##_prev = _item->name##_prev; \                                                                                                                                                                                                                                                                                                        
                             54:                if (_item->name##_prev)                                 \                                                                                                                                                                                                                                                                                                              
                             55:                        _item->name##_prev->name##_next = _item->name##_next; \                                                                                                                                                                                                                                                                                                        
                             56:                else {                                                  \                                                                                                                                                                                                                                                                                                              
                             57:                        assert(*_head == _item);                        \                                                                                                                                                                                                                                                                                                              
                             58:                        *_head = _item->name##_next;                    \                                                                                                                                                                                                                                                                                                              
                             59:                }                                                       \                                                                                                                                                                                                                                                                                                              
                             60:                _item->name##_next = _item->name##_prev = NULL;         \                                                                                                                                                                                                                                                                                                              
                             61:                _item;                                                  \                                                                                                                                                                                                                                                                                                              
                             62:        })                                                                                                                                                                                                                                                                                                                                                                             
                             63:                                                                                                                                                                                                                                                                                                                                                                                       
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.c:99-107                                                                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             99:Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                             
                             100:        LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                             
                             101:                if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                    
                             102:                        condition_free(c);                                                                                                                                                                                                                                                                                                                                            
                             103:                }                                                                                                                                                                                                                                                                                                                                                                     
                             104:                                                                                                                                                                                                                                                                                                                                                                                      
                             105:        assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                                   
                             106:        return head;                                                                                                                                                                                                                                                                                                                                                                  
                             107:}                                                                                                                                                                                                                                                                                                                                                                                     
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             <code>                                                                                                                                                                                                                                                                                                                                                                                    
                             src/shared/condition.c:99-107                                                                                                                                                                                                                                                                                                                                                             
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             99:Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                             
                             100:        LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                             
                             101:                if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                    
                             102:                        condition_free(c);                                                                                                                                                                                                                                                                                                                                            
                             103:                }                                                                                                                                                                                                                                                                                                                                                                     
                             104:                                                                                                                                                                                                                                                                                                                                                                                      
                             105:        assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                                   
                             106:        return head;                                                                                                                                                                                                                                                                                                                                                                  
                             107:}                                                                                                                                                                                                                                                                                                                                                                                     
                             ```                                                                                                                                                                                                                                                                                                                                                                                       
                             </code>                                                                                                                                                                                                                                                                                                                                                                                   
                             </code_snippets>                                                                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             ## Fix Strategy                                                                                                                                                                                                                                                                                                                                                                           
                             <fix_strategy>                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             1. Issue Analysis and Root Cause                                                                                                                                                                                                                                                                                                                                                          
                                - The heap-use-after-free is triggered in condition_free_list_type(): it uses LIST_FOREACH to iterate over the list of Condition objects, calling condition_free(c) on matching nodes without unlinking them first. After free(c), the LIST_FOREACH macro still follows the freed nodes next pointer (`c->conditions_next`), causing a use-after-free when trying to                  
                             read that pointer.                                                                                                                                                                                                                                                                                                                                                                        
                                - Later, during full cleanup via condition_free_list (which calls condition_free_list_type(head, _CONDITION_TYPE_INVALID)), the same UAF occurs again because the list still contains pointers to already freed nodes.                                                                                                                                                                 
                                - The core logic that must be preserved is:                                                                                                                                                                                                                                                                                                                                            
                                   Free only those nodes whose type matches (or free all if type < 0).                                                                                                                                                                                                                                                                                                                
                                   Maintain list integrity so that subsequent iterations or cleanups do not traverse freed memory.                                                                                                                                                                                                                                                                                    
                                   Return the updated head pointer reflecting removed nodes.                                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             2. Strategy for Patching condition_free_list_type                                                                                                                                                                                                                                                                                                                                         
                                - Modify src/shared/condition.c, function condition_free_list_type, to:                                                                                                                                                                                                                                                                                                                
                                  a. Iterate manually through the list using a `for` loop rather than LIST_FOREACH.                                                                                                                                                                                                                                                                                                    
                                  b. Before freeing a node, store its next pointer in a temporary variable.                                                                                                                                                                                                                                                                                                            
                                  c. Unlink the node from the list using the LIST_REMOVE macro.                                                                                                                                                                                                                                                                                                                        
                                  d. Call condition_free() on the unlinked node.                                                                                                                                                                                                                                                                                                                                       
                                  e. Continue iteration from the saved next pointer to avoid touching freed memory.                                                                                                                                                                                                                                                                                                    
                                - Preserve the final assertion (`assert(type >= 0 || !head)`) and return the possibly updated head pointer.                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             3. Detailed Steps to Implement the Patch                                                                                                                                                                                                                                                                                                                                                  
                                1. Open file `src/shared/condition.c`.                                                                                                                                                                                                                                                                                                                                                 
                                2. Locate the current implementation of `condition_free_list_type()` around lines 99107.                                                                                                                                                                                                                                                                                              
                                3. Replace the existing LIST_FOREACH-based block:                                                                                                                                                                                                                                                                                                                                      
                                     ```c                                                                                                                                                                                                                                                                                                                                                                              
                                     Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                        
                                             LIST_FOREACH(conditions, c, head)                                                                                                                                                                                                                                                                                                                                         
                                                     if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                
                                                             condition_free(c);                                                                                                                                                                                                                                                                                                                                        
                                                     }                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                       
                                             assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                               
                                             return head;                                                                                                                                                                                                                                                                                                                                                              
                                     }                                                                                                                                                                                                                                                                                                                                                                                 
                                     ```                                                                                                                                                                                                                                                                                                                                                                               
                                   with the following implementation:                                                                                                                                                                                                                                                                                                                                                  
                                     ```c                                                                                                                                                                                                                                                                                                                                                                              
                                     Condition* condition_free_list_type(Condition *head, ConditionType type) {                                                                                                                                                                                                                                                                                                        
                                             Condition *c, *n;                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                       
                                             /* Iterate through the list, unlink and free matching nodes */                                                                                                                                                                                                                                                                                                            
                                             for (c = head; c; c = n) {                                                                                                                                                                                                                                                                                                                                                
                                                     n = c->conditions_next;       /* Save next pointer */                                                                                                                                                                                                                                                                                                             
                                                     if (type < 0 || c->type == type) {                                                                                                                                                                                                                                                                                                                                
                                                             LIST_REMOVE(conditions, head, c);                                                                                                                                                                                                                                                                                                                         
                                                             condition_free(c);                                                                                                                                                                                                                                                                                                                                        
                                                     }                                                                                                                                                                                                                                                                                                                                                                 
                                             }                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                       
                                             /* If type < 0 (full free), head must be NULL */                                                                                                                                                                                                                                                                                                                          
                                             assert(type >= 0 || !head);                                                                                                                                                                                                                                                                                                                                               
                                             return head;                                                                                                                                                                                                                                                                                                                                                              
                                     }                                                                                                                                                                                                                                                                                                                                                                                 
                                     ```                                                                                                                                                                                                                                                                                                                                                                               
                                4. Ensure that `#include "list.h"` remains present so LIST_REMOVE is available.                                                                                                                                                                                                                                                                                                        
                                5. Rebuild the project and rerun the fuzzing target to confirm the heap-use-after-free is resolved.                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             4. Justification and Preservation of Existing Logic                                                                                                                                                                                                                                                                                                                                       
                                - By unlinking nodes prior to free, the list pointers are updated correctly, and freed nodes are no longer reachable in subsequent iterations.                                                                                                                                                                                                                                         
                                - The new loop captures `c->conditions_next` before any deallocation, preventing any reads from freed memory.                                                                                                                                                                                                                                                                          
                                - The behavior is identical in terms of which nodes get freed: those matching `type`, or all nodes if `type < 0`.                                                                                                                                                                                                                                                                      
                                - The head pointer is updated when removing the first element, so callers (e.g., net-condition and link-config cleanup) see the updated list.                                                                                                                                                                                                                                          
                                - The final `assert(type >= 0 || !head)` still ensures that full-list frees clear the head pointer.                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             5. Risk Analysis and Side Effects                                                                                                                                                                                                                                                                                                                                                         
                                - This change only affects the node-freeing routine for Condition lists. It has no impact on the parsing logic, on condition_test, or on the harness/fuzzer code.                                                                                                                                                                                                                      
                                - Tests or other parts of systemd that rely on condition_free_list or condition_free_list_type will see the same freed set of nodes and an updated head pointer, preserving functional behavior.                                                                                                                                                                                       
                                - No broad exception-catching or utility-function modifications are introduced.                                                                                                                                                                                                                                                                                                        
                                - The fix is localized, low-risk, and addresses the precise UAF root cause.                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             6. Validation                                                                                                                                                                                                                                                                                                                                                                             
                                - After patching, run AddressSanitizer on fuzz-link-parser to confirm no heap-use-after-free in condition_free_list_type.                                                                                                                                                                                                                                                              
                                - Run the full systemd test suite to ensure no regressions.                                                                                                                                                                                                                                                                                                                            
                                - Optionally, add a small unit test for condition_free_list_type, creating a mixed-type list, freeing a subset, and verifying list integrity and absence of memory errors.                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                       
                             </fix_strategy>                                                                                                                                                                                                                                                                                                                                                                           
                             ===Tests Result===                                                                                                                                                                                                                                                                                                                                                                        
                             No tests found                                                                                                                                                                                                                                                                                                                                                                            
                             ===Evaluation End===                                                                                                                                                                                                                                                                                                                                                                      
[11/04/25 11:20:31] INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                                                                                                                                                                                                                                                                                                            __init__.py:160
                             (n evals: 2, patch status: PatchStatus.SOUND)                                                                                                                                                                                                                                                                                                                                             
                    INFO     Building environment                                                                                                                                                                                                                                                                                                                                                       __init__.py:132
                             - Cache directory: /tmp/tmpu1vdk9kn                                                                                                                                                                                                                                                                                                                                                       
                             - Max timeout: 1800                                                                                                                                                                                                                                                                                                                                                                       
                             - Output directory: reports/prism.prism_o4_mini/systemd_systemd-full-001_systemd-004/agent-output-1762255231.0946863                                                                                                                                                                                                                                                                      
                             - Detection toml file: /tasks_new/systemd_systemd-full-001/detection/systemd_systemd-full-001_systemd-004.toml                                                                                                                                                                                                                                                                            
                             - Challenge project directory: /tasks_new/systemd_systemd-full-001/official-afc-systemd                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                       
