{
  "project_name": "libxml2",
  "vulnerability_identifier": "libxml2_lx-delta-03_vuln_004",
  "source_directory": "/home/qqor/crete/.cache/official-afc-libxml2",
  "llm_usage": {
    "total_cost": 0.18684160000000002,
    "prompt_tokens": 90096,
    "completion_tokens": 19940
  },
  "variant": "sound",
  "diff": "--- a/encoding.c\n+++ b/encoding.c\n@@ -2865,15 +2865,33 @@\n         c = b0 | b1 | b2 | b3;\n \n         if (c < 0x80) {\n+            size_t written = out - outstart;\n+            if (written + 1 > (size_t)*outlen) {\n+                *outlen = written;\n+                *inlen  = in - instart;\n+                return XML_ENC_ERR_SPACE;\n+            }\n             out[0] = c;\n             in += 4;\n             out += 1;\n         } else if (c < 0x800) {\n+            size_t written = out - outstart;\n+            if (written + 2 > (size_t)*outlen) {\n+                *outlen = written;\n+                *inlen  = in - instart;\n+                return XML_ENC_ERR_SPACE;\n+            }\n             out[0] = (c >> 6)   | 0xC0;\n             out[1] = (c & 0x3F) | 0x80;\n             in += 4;\n             out += 2;\n         } else if ((c & 0xF800) != 0xD800) {\n+            size_t written = out - outstart;\n+            if (written + 3 > (size_t)*outlen) {\n+                *outlen = written;\n+                *inlen  = in - instart;\n+                return XML_ENC_ERR_SPACE;\n+            }\n             out[0] =  (c >> 12)         | 0xE0;\n             out[1] = ((c >>  6) & 0x3F) | 0x80;\n             out[2] =  (c        & 0x3F) | 0x80;\n@@ -2901,6 +2919,14 @@\n                 out[2] = ((c >>  6) & 0x3F) | 0x80;\n                 out[3] =  (c        & 0x3F) | 0x80;\n             */\n+            {\n+                size_t written = out - outstart;\n+                if (written + 4 > (size_t)*outlen) {\n+                    *outlen = written;\n+                    *inlen  = in - instart;\n+                    return XML_ENC_ERR_SPACE;\n+                }\n+            }\n             out[0] = c & 0xff;\n             out[1] = (c >> 8) & 0xff;\n             out[2] = (c >> 0x10) & 0xff;\n",
  "stdout": "",
  "stderr": ""
}