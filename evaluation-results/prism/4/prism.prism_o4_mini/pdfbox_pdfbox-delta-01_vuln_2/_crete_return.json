{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-delta-01_vuln_2",
  "source_directory": "/home/qqor/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.09812,
    "prompt_tokens": 32660,
    "completion_tokens": 14135
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n@@ -55,8 +55,19 @@\n         this.timeoutMillisPerPage = millisPerPage;\n     }\n \n-    public void setTesseractPath(String tesseractPath) {\n-        this.tesseractPath = tesseractPath;\n+    public void setTesseractPath(String tesseractPath) throws IOException {\n+        String raw = tesseractPath;\n+        if (raw == null || raw.isEmpty()) {\n+            throw new IOException(\"Tesseract path must not be null or empty\");\n+        }\n+        if (!raw.matches(\"^[\\\\w/\\\\\\\\.-]+$\")) {\n+            throw new IOException(\"Invalid characters in Tesseract path: \" + raw);\n+        }\n+        Path exe = Paths.get(raw);\n+        if (!java.nio.file.Files.exists(exe) || !java.nio.file.Files.isRegularFile(exe) || !java.nio.file.Files.isExecutable(exe)) {\n+            throw new IOException(\"Tesseract executable not found or not executable: \" + raw);\n+        }\n+        this.tesseractPath = exe.toAbsolutePath().toString();\n     }\n     /**\n      * This will return the text of a document. See writeText. <br>\n@@ -155,11 +166,19 @@\n     }\n \n     private String runTesseract(Path image) throws IOException {\n-        String actualTessPath = pdDocument.getDocumentInformation()\n+        String raw = pdDocument.getDocumentInformation()\n                 .getCustomMetadataValue(TESSERACT_PATH_KEY);\n-        if (actualTessPath == null || actualTessPath.isEmpty()) {\n-            actualTessPath = tesseractPath;\n-        }\n+        if (raw == null || raw.isEmpty()) {\n+            raw = tesseractPath;\n+        }\n+        if (!raw.matches(\"^[\\\\w/\\\\\\\\.-]+$\")) {\n+            throw new IOException(\"Invalid characters in Tesseract path: \" + raw);\n+        }\n+        Path exe = Paths.get(raw);\n+        if (!java.nio.file.Files.exists(exe) || !java.nio.file.Files.isRegularFile(exe) || !java.nio.file.Files.isExecutable(exe)) {\n+            throw new IOException(\"Tesseract executable not found or not executable: \" + raw);\n+        }\n+        String actualTessPath = exe.toAbsolutePath().toString();\n \n         Path txt = Paths.get(image.toAbsolutePath().toString());\n         doOCR(actualTessPath, image, txt);\n",
  "stdout": "",
  "stderr": ""
}