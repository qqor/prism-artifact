{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-04_vuln_007",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.16197280000000003,
    "prompt_tokens": 107156,
    "completion_tokens": 10023
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-json.c\n+++ b/epan/dissectors/packet-json.c\n@@ -356,16 +356,28 @@\n \t\n \t\t\t\t\t\t\tread_index++;\n \t\n-\t\t\t\t\t\t\tfor (int i = 0; i < 8; i++)\n-\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\tcurrent_character = string[read_index];\n-\t\t\t\t\t\t\t\tread_index++;\n-\t\n-\t\t\t\t\t\t\t\tint nibble = ws_xton(current_character);\n-\t\n-\t\t\t\t\t\t\t\ttrail_surrogate <<= 4;\n-\t\t\t\t\t\t\t\ttrail_surrogate |= nibble;\n-\t\t\t\t\t\t\t}\n+                            for (int i = 0; i < 8; i++)\n+                            {\n+                                /* Prevent out-of-bounds read on malformed surrogate */\n+                                if (!(read_index < string_length))\n+                                {\n+                                    is_valid_unicode_character = false;\n+                                    break;\n+                                }\n+\n+                                current_character = string[read_index];\n+                                read_index++;\n+\n+                                int nibble = ws_xton(current_character);\n+                                if (nibble < 0)\n+                                {\n+                                    is_valid_unicode_character = false;\n+                                    break;\n+                                }\n+\n+                                trail_surrogate <<= 4;\n+                                trail_surrogate |= nibble;\n+                            }\n \t\n \t\t\t\t\t\t\tif ((IS_TRAIL_SURROGATE(trail_surrogate)))\n \t\t\t\t\t\t\t{\t\n",
  "stdout": "",
  "stderr": ""
}