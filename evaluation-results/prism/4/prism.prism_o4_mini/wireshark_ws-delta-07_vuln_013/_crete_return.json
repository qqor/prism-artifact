{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-07_vuln_013",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.2691546,
    "prompt_tokens": 175670,
    "completion_tokens": 17254
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-gvcp.c\n+++ b/epan/dissectors/packet-gvcp.c\n@@ -947,8 +947,12 @@\n void process_register_writes(proto_tree *tree, tvbuff_t *tvb, int offset)\n {\n     uint64_t total = 0;\n-\n-    for (uint32_t i = 0; i < gvcp_register_count; i++) {\n+    uint32_t display_count = gvcp_register_count;\n+    if (display_count > GVCP_MAX_REGISTER_COUNT) {\n+        display_count = GVCP_MAX_REGISTER_COUNT;\n+    }\n+\n+    for (uint32_t i = 0; i < display_count; i++) {\n         uint32_t addr = gvcp_register_number[i];\n         uint32_t val = gvcp_register_value[i];\n         total += val;\n@@ -959,17 +963,19 @@\n \n         if (is_protected(addr)) {\n             proto_tree_add_expert_format(tree, NULL, &ei_gvcp_privileged_register,\n-\t\t\t\ttvb, offset + (int)(i * 8), 8,\n-\t\t\t\t\"Write to protected register 0x%08X\", addr);\n-\t\t}\n-\t\t\t\n+                tvb, offset + (int)(i * 8), 8,\n+                \"Write to protected register 0x%08X\", addr);\n+        }\n     }\n \n-    proto_item *summary = proto_tree_add_item(tree, -1, tvb, offset, gvcp_register_count * 8, ENC_NA);\n+    proto_item *summary = proto_tree_add_item(tree, -1, tvb, offset, display_count * 8, ENC_NA);\n     proto_item_set_text(summary, \"Summary: %d writes, total written value: 0x%016lX\",\n-\t\tgvcp_register_count, total);\n-\n-\treturn;\n+        display_count, total);\n+\n+    /* clear register count after processing */\n+    gvcp_register_count = 0;\n+\n+    return;\n }\n \n /*\n@@ -978,11 +984,14 @@\n \n static int dissect_register(uint32_t addr, proto_tree *branch, tvbuff_t *tvb, int offset, int length)\n {\n-\tuint32_t value = 0;\n-\t\n-\tvalue = tvb_get_letohl(tvb, offset);\n-\tgvcp_register_number[gvcp_register_count] = addr;\n-\tgvcp_register_value[gvcp_register_count++] = value;\n+    if (gvcp_register_count >= GVCP_MAX_REGISTER_COUNT) {\n+        return 0;\n+    }\n+    uint32_t value = 0;\n+    \n+    value = tvb_get_letohl(tvb, offset);\n+    gvcp_register_number[gvcp_register_count] = addr;\n+    gvcp_register_value[gvcp_register_count++] = value;\n \n \tswitch (addr)\n \t{\n@@ -1773,15 +1782,19 @@\n \n static void dissect_writereg_cmd(proto_tree *gvcp_telegram_tree, tvbuff_t *tvb, packet_info *pinfo, int startoffset, int length, gvcp_conv_info_t *gvcp_info, gvcp_transaction_t* gvcp_trans)\n {\n-\tint offset = startoffset;\n-\tint i;\n-\tproto_item *item = NULL;\n-\tuint32_t addr = 0;\n-\tuint32_t value = 0;\n-\tconst char *address_string = NULL;\n-\tbool is_custom_register = false;\n-\tint num_registers = length / 8; /* divide by 8 because we are counting register-value pairs */\n-\tproto_tree *subtree = NULL;\n+    gvcp_register_count = 0;\n+    int offset = startoffset;\n+    int num_registers = length / 8; /* divide by 8 because we are counting register-value pairs */\n+    if (num_registers > GVCP_MAX_REGISTER_COUNT) {\n+        num_registers = GVCP_MAX_REGISTER_COUNT;\n+    }\n+    int i;\n+    proto_item *item = NULL;\n+    uint32_t addr = 0;\n+    uint32_t value = 0;\n+    const char *address_string = NULL;\n+    bool is_custom_register = false;\n+    proto_tree *subtree = NULL;\n \n \tif (gvcp_trans)\n \t{\n",
  "stdout": "",
  "stderr": ""
}