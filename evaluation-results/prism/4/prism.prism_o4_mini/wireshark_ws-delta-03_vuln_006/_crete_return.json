{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-03_vuln_006",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.2173919,
    "prompt_tokens": 142093,
    "completion_tokens": 13884
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-irc.c\n+++ b/epan/dissectors/packet-irc.c\n@@ -534,37 +534,47 @@\n      if (tvb_get_uint8(tvb, offset) != '#')\n          return;\n      \n-     channel_name = malloc(CHANNELLEN+1);\n- \n-     if (channel_name == NULL ) {\n-         return;\n-     }\n- \n-     start_offset = offset;\n- \n-     tree = proto_item_add_subtree(item, ett_irc_request_command_names);\n- \n-     while(tvb_offset_exists(tvb, start_offset) ) {\n-         length = tvb_captured_length_remaining(tvb, start_offset);\n-         end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n- \n-         if ( end_offset == -1 ) {\n-             proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, length, ENC_ASCII);\n-             \n-             memset(channel_name, 0, CHANNELLEN+1);\n-             tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-             proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-             free(channel_name);\n-             return;\n-         }\n- \n-         memset(channel_name, 0, CHANNELLEN+1);\n-         tvb_memcpy(tvb, channel_name, start_offset, length);\n-         proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-         proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, end_offset-start_offset, ENC_ASCII);\n-         start_offset = end_offset + 1;\n+    channel_name = malloc(CHANNELLEN+1);\n+\n+    if (channel_name == NULL ) {\n+        return;\n+    }\n+\n+    start_offset = offset;\n+\n+    tree = proto_item_add_subtree(item, ett_irc_request_command_names);\n+\n+    /* Compute segment lengths for safe copy */\n+    gint raw_len, seg_len;\n+\n+    while(tvb_offset_exists(tvb, start_offset) ) {\n+        length = tvb_captured_length_remaining(tvb, start_offset);\n+        end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n+\n+        /* Determine actual segment length and clamp to CHANNELLEN */\n+        if (end_offset != -1)\n+            raw_len = end_offset - start_offset;\n+        else\n+            raw_len = length;\n+        seg_len = (raw_len < CHANNELLEN) ? raw_len : CHANNELLEN;\n+\n+        if ( end_offset == -1 ) {\n+            proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, length, ENC_ASCII);\n+\n+            memset(channel_name, 0, CHANNELLEN+1);\n+            tvb_memcpy(tvb, channel_name, start_offset, seg_len);\n+            proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+            free(channel_name);\n+            return;\n+        }\n+\n+        memset(channel_name, 0, CHANNELLEN+1);\n+        tvb_memcpy(tvb, channel_name, start_offset, seg_len);\n+        proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+        proto_tree_add_item(tree, hf_irc_request_command_names_channel, tvb, start_offset, end_offset-start_offset, ENC_ASCII);\n+        start_offset = end_offset + 1;\n      }\n  \n      free(channel_name);\n",
  "stdout": "",
  "stderr": ""
}