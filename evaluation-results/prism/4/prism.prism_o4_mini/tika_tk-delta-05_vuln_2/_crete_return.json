{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.22281050000000002,
    "prompt_tokens": 103603,
    "completion_tokens": 24738
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1125,7 +1125,10 @@\n             }\n         }\n \n-        private File getOutputFile(String name, Metadata metadata, MediaType contentType) {\n+        private File getOutputFile(String name,\n+                                   Metadata metadata,\n+                                   MediaType contentType)\n+                throws IOException {\n             String ext = getExtension(contentType);\n             if (name.indexOf('.') == -1 && contentType != null) {\n                 name += ext;\n@@ -1158,6 +1161,12 @@\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n             File outputFile = new File(extractDir, normalizedName);\n+            // Prevent directory traversal by validating canonical paths\n+            String canonicalExtractDir = extractDir.getCanonicalPath();\n+            String canonicalOutputPath = outputFile.getCanonicalPath();\n+            if (!canonicalOutputPath.startsWith(canonicalExtractDir + File.separator)) {\n+                throw new IOException(\"Invalid file name (path traversal): \" + normalizedName);\n+            }\n             //if file already exists, prepend uuid\n             if (outputFile.exists()) {\n                 String fileName = FilenameUtils.getName(normalizedName);\n",
  "stdout": "",
  "stderr": ""
}