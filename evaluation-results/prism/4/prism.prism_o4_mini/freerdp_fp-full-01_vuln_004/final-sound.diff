--- a/winpr/include/winpr/stream.h
+++ b/winpr/include/winpr/stream.h
@@ -699,7 +699,7 @@
 	{
 		WINPR_ASSERT(_s);
 		WINPR_ASSERT(_b || (_n == 0));
-		WINPR_ASSERT(Stream_GetRemainingCapacity(_s) >= _n);
+		WINPR_ASSERT(Stream_GetRemainingLength(_s) >= _n);
 		memcpy(_b, (_s->pointer), (_n));
 		Stream_Seek(_s, _n);
 	}

--- a/libfreerdp/core/gcc.c
+++ b/libfreerdp/core/gcc.c
@@ -1859,8 +1859,13 @@
 	if (blockLength < 4 + (UINT8)mcs->channelCount * 12)
 		return FALSE;
 
-	if (mcs->channelCount > CHANNEL_MAX_COUNT)
-		return FALSE;
+	{
+		size_t requiredBytes = (size_t)mcs->channelCount * sizeof(rdpMcsChannel);
+		size_t allocatedBytes = (size_t)CHANNEL_MAX_COUNT * sizeof(rdpMcsChannel);
+
+		if (mcs->channelCount > CHANNEL_MAX_COUNT || requiredBytes > allocatedBytes)
+			return FALSE;
+	}
 
 	/* channelDefArray */
 	for (UINT32 i = 0; i < mcs->channelCount; i++)
