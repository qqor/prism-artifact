{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/tasks_new/apache-poi_poi-full-01/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.1382458,
    "prompt_tokens": 67014,
    "completion_tokens": 14666
  },
  "variant": "sound",
  "diff": "--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n@@ -168,14 +168,13 @@\n                   if (mplen < 0) {\n                      throw new IOException(\"Did not expect negative value: \" + mplen);\n                   }\n-                  byte[] mpdata = new byte[mplen];\n+                  byte[] mpdata = IOUtils.safelyAllocate(mplen, MAX_RECORD_LENGTH);\n                   if (IOUtils.readFully(inp, mpdata) < 0) {\n                      throw new IOException(\"Not enough data to read \" + mplen + \" bytes for attribute name\");\n                   }\n                   name = StringUtil.getFromUnicodeLE(mpdata, 0, (mplen/2)-1);\n                   skipToBoundary(mplen, inp);\n                }\n-\n                // Now create\n                prop = MAPIProperty.createCustom(id, type, name);\n             }\n\n--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFStringAttribute.java\n+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFStringAttribute.java\n@@ -44,6 +44,9 @@\n       String tmpData = null;\n       byte[] data = getData();\n       if(getType() == TNEFProperty.TYPE_TEXT) {\n+         if (data.length > 1_048_576) {\n+             throw new IllegalArgumentException(\"TNEF text attribute exceeds allowed size: \" + data.length + \" bytes\");\n+         }\n          tmpData = StringUtil.getFromUnicodeLE(data);\n       } else {\n          tmpData = StringUtil.getFromCompressedUnicode(\n",
  "stdout": "",
  "stderr": ""
}