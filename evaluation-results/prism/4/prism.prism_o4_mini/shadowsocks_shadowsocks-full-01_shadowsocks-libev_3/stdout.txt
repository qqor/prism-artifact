[11/04/25 10:36:35] INFO     Building environment                                                                                __init__.py:132
                             - Cache directory: /tmp/tmpz1f6n235                                                                                
                             - Max timeout: 1800                                                                                                
                             - Output directory:                                                                                                
                             reports/prism.prism_o4_mini/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3/agent-output-176225                
                             2595.4270403                                                                                                       
                             - Detection toml file:                                                                                             
                             /tasks_new/shadowsocks_shadowsocks-full-01/detection/shadowsocks_shadowsocks-full-01_shadowsocks-li                
                             bev_3.toml                                                                                                         
                             - Challenge project directory:                                                                                     
                             /tasks_new/shadowsocks_shadowsocks-full-01/official-afc-shadowsocks-libev                                          
                                                                                                                                                
                    INFO     Setting timeouts                                                                                      default.py:83
                               - build: 600 (original: 86)                                                                                      
                               - run tests: 600 (original: 0)                                                                                   
                    INFO     Successfully created Cached for CLEAN environment                                                   oss_fuzz.py:256
                    INFO     Current environments: ['CLEAN -> Cached']                                                           oss_fuzz.py:265
                    INFO     Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                                   __init__.py:160
                             (n evals: 0, patch status: PatchStatus.INITIALIZED)                                                                
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:36:36] INFO     [logging_performance](shadowsocks Setting owner) Took 0.86 seconds; exception=False          context_managers.py:23
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:36:37] INFO     [logging_performance](shadowsocks Setting owner) Took 0.87 seconds; exception=False          context_managers.py:23
[11/04/25 10:36:39] INFO     ===Evaluator Result===                                                                             evaluator.py:204
                             PatchStatus.VULNERABLE                                                                                             
                             ===Evaluator Diff===                                                                                               
                                                                                                                                                
                             ===Patch Result===                                                                                                 
                             + FUZZER=json_fuzz                                                                                                 
                             + shift                                                                                                            
                             + '[' '!' -v TESTCASE ']'                                                                                          
                             + TESTCASE=/testcase                                                                                               
                             + '[' '!' -f /testcase ']'                                                                                         
                             + export RUN_FUZZER_MODE=interactive                                                                               
                             + RUN_FUZZER_MODE=interactive                                                                                      
                             + export FUZZING_ENGINE=libfuzzer                                                                                  
                             + FUZZING_ENGINE=libfuzzer                                                                                         
                             + export SKIP_SEED_CORPUS=1                                                                                        
                             + SKIP_SEED_CORPUS=1                                                                                               
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                         
                             vm.mmap_rnd_bits = 28                                                                                              
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                            
                             INFO: Seed: 1747797146                                                                                             
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x556be26b54b0, 0x556be26b6179),                      
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x556be26b6180,0x556be26c2e10),                                         
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                 
                             Running: /testcase                                                                                                 
                             =================================================================                                                  
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x556be25385b0                 
                             bp 0x7ffe930663b0 sp 0x7ffe930663a8                                                                                
                             READ of size 1 at 0x5020000000b8 thread T0                                                                         
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                   
                                 #0 0x556be25385af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                          
                                 #1 0x556be25397ac in json_parse /src/shadowsocks/src/json.c:958:11                                             
                                 #2 0x556be2532c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                              
                                 #3 0x556be23e9a80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)                      
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                     
                                 #4 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #5 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #6 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #7 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                 #8 0x556be23ccedd in _start (/out/json_fuzz+0x5cedd)                                                           
                                                                                                                                                
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                     
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                              
                             allocated by thread T0 here:                                                                                       
                                 #0 0x556be24f584f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                  
                                 #1 0x556be260b223 in operator new(unsigned long) cxa_noexception.cpp                                           
                                 #2 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #3 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #4 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #5 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                                                                                                                                
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned                                                           
                             long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                             
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in                              
                             json_parse_ex                                                                                                      
                             Shadow bytes around the buggy address:                                                                             
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                  
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                  
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                               
                               Addressable:           00                                                                                        
                               Partially addressable: 01 02 03 04 05 06 07                                                                      
                               Heap left redzone:       fa                                                                                      
                               Freed heap region:       fd                                                                                      
                               Stack left redzone:      f1                                                                                      
                               Stack mid redzone:       f2                                                                                      
                               Stack right redzone:     f3                                                                                      
                               Stack after return:      f5                                                                                      
                               Stack use after scope:   f8                                                                                      
                               Global redzone:          f9                                                                                      
                               Global init order:       f6                                                                                      
                               Poisoned by user:        f7                                                                                      
                               Container overflow:      fc                                                                                      
                               Array cookie:            ac                                                                                      
                               Intra object redzone:    bb                                                                                      
                               ASan internal:           fe                                                                                      
                               Left alloca redzone:     ca                                                                                      
                               Right alloca redzone:    cb                                                                                      
                             ==18==ABORTING                                                                                                     
                             subprocess command returned a non-zero exit status: 1                                                              
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e                     
                             HELPER=True -e ARCHITECTURE=x86_64 -v                                                                              
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v                              
                             /tmp/tmp2bu2euk8:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce json_fuzz                          
                             -runs=100.                                                                                                         
                                                                                                                                                
                             ===Issue===                                                                                                        
                             + FUZZER=json_fuzz                                                                                                 
                             + shift                                                                                                            
                             + '[' '!' -v TESTCASE ']'                                                                                          
                             + TESTCASE=/testcase                                                                                               
                             + '[' '!' -f /testcase ']'                                                                                         
                             + export RUN_FUZZER_MODE=interactive                                                                               
                             + RUN_FUZZER_MODE=interactive                                                                                      
                             + export FUZZING_ENGINE=libfuzzer                                                                                  
                             + FUZZING_ENGINE=libfuzzer                                                                                         
                             + export SKIP_SEED_CORPUS=1                                                                                        
                             + SKIP_SEED_CORPUS=1                                                                                               
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                         
                             vm.mmap_rnd_bits = 28                                                                                              
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                            
                             INFO: Seed: 1747797146                                                                                             
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x556be26b54b0, 0x556be26b6179),                      
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x556be26b6180,0x556be26c2e10),                                         
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                 
                             Running: /testcase                                                                                                 
                             =================================================================                                                  
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x556be25385b0                 
                             bp 0x7ffe930663b0 sp 0x7ffe930663a8                                                                                
                             READ of size 1 at 0x5020000000b8 thread T0                                                                         
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                   
                                 #0 0x556be25385af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                          
                                 #1 0x556be25397ac in json_parse /src/shadowsocks/src/json.c:958:11                                             
                                 #2 0x556be2532c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                              
                                 #3 0x556be23e9a80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)                      
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                     
                                 #4 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #5 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #6 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #7 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                 #8 0x556be23ccedd in _start (/out/json_fuzz+0x5cedd)                                                           
                                                                                                                                                
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                     
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                              
                             allocated by thread T0 here:                                                                                       
                                 #0 0x556be24f584f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                  
                                 #1 0x556be260b223 in operator new(unsigned long) cxa_noexception.cpp                                           
                                 #2 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #3 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #4 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #5 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                                                                                                                                
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned                                                           
                             long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                             
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in                              
                             json_parse_ex                                                                                                      
                             Shadow bytes around the buggy address:                                                                             
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                  
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                  
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                               
                               Addressable:           00                                                                                        
                               Partially addressable: 01 02 03 04 05 06 07                                                                      
                               Heap left redzone:       fa                                                                                      
                               Freed heap region:       fd                                                                                      
                               Stack left redzone:      f1                                                                                      
                               Stack mid redzone:       f2                                                                                      
                               Stack right redzone:     f3                                                                                      
                               Stack after return:      f5                                                                                      
                               Stack use after scope:   f8                                                                                      
                               Global redzone:          f9                                                                                      
                               Global init order:       f6                                                                                      
                               Poisoned by user:        f7                                                                                      
                               Container overflow:      fc                                                                                      
                               Array cookie:            ac                                                                                      
                               Intra object redzone:    bb                                                                                      
                               ASan internal:           fe                                                                                      
                               Left alloca redzone:     ca                                                                                      
                               Right alloca redzone:    cb                                                                                      
                             ==18==ABORTING                                                                                                     
                             subprocess command returned a non-zero exit status: 1                                                              
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e                     
                             HELPER=True -e ARCHITECTURE=x86_64 -v                                                                              
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v                              
                             /tmp/tmp2bu2euk8:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce json_fuzz                          
                             -runs=100.                                                                                                         
                                                                                                                                                
                             ===Evaluation Report===                                                                                            
                                                                                                                                                
                             ===Analysis Report===                                                                                              
                                                                                                                                                
                             ===Evaluation End===                                                                                               
[11/04/25 10:36:49] INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                                 __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                 
[11/04/25 10:38:42] INFO     Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.PATCH                                    __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                 
[11/04/25 10:39:38] INFO     Prism Supervisor Routing: TeamStatus.PATCH -> TeamStatus.EVALUATE                                   __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                 
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:39:39] INFO     [logging_performance](shadowsocks Setting owner) Took 0.83 seconds; exception=False          context_managers.py:23
                    INFO     [logging_performance](shadowsocks Patching) Started...                                        context_managers.py:9
                    INFO     Checking valid diff: /tmp/tmpo86dad4f                                                                default.py:171
[11/04/25 10:40:42] INFO     [logging_performance](shadowsocks Patching) Took 62.73 seconds; exception=False              context_managers.py:23
                    INFO     [logging_performance](shadowsocks Checking build) Started...                                  context_managers.py:9
[11/04/25 10:40:46] INFO     [logging_performance](shadowsocks Checking build) Took 4.21 seconds; exception=False         context_managers.py:23
                    INFO     [logging_performance](shadowsocks Running PoV) Started...                                     context_managers.py:9
[11/04/25 10:40:48] INFO     [logging_performance](shadowsocks Running PoV) Took 1.97 seconds; exception=False            context_managers.py:23
                    INFO     [logging_performance](shadowsocks Testing) Started...                                         context_managers.py:9
                    INFO     [logging_performance](shadowsocks Testing) Took 0.00 seconds; exception=False                context_managers.py:23
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:40:49] INFO     [logging_performance](shadowsocks Setting owner) Took 0.82 seconds; exception=False          context_managers.py:23
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:40:50] INFO     [logging_performance](shadowsocks Setting owner) Took 0.84 seconds; exception=False          context_managers.py:23
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                   context_managers.py:9
[11/04/25 10:40:51] INFO     [logging_performance](shadowsocks Setting owner) Took 0.81 seconds; exception=False          context_managers.py:23
                    INFO     ===Evaluator Result===                                                                             evaluator.py:204
                             PatchStatus.SOUND                                                                                                  
                             ===Evaluator Diff===                                                                                               
                             --- a/src/json.c                                                                                                   
                             +++ b/src/json.c                                                                                                   
                             @@ -599,7 +599,7 @@                                                                                                
                                                                                                                                                
                                                   case 't':                                                                                    
                                                                                                                                                
                             -                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                    
                             +                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'r' ||                                    
                                                          *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                     
                                                      {                                                                                         
                                                         goto e_unknown_value;                                                                  
                             @@ -615,7 +615,7 @@                                                                                                
                                                                                                                                                
                                                   case 'f':                                                                                    
                                                                                                                                                
                             -                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                    
                             +                        if ((end - state.ptr) < 5 || *(++ state.ptr) != 'a' ||                                    
                                                          *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                   
                                                          *(++ state.ptr) != 'e')                                                               
                                                      {                                                                                         
                             @@ -630,7 +630,7 @@                                                                                                
                                                                                                                                                
                                                   case 'n':                                                                                    
                                                                                                                                                
                             -                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                    
                             +                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'u' ||                                    
                                                          *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                     
                                                      {                                                                                         
                                                         goto e_unknown_value;                                                                  
                                                                                                                                                
                             ===Patch Result===                                                                                                 
                                                                                                                                                
                             ===Issue===                                                                                                        
                             + FUZZER=json_fuzz                                                                                                 
                             + shift                                                                                                            
                             + '[' '!' -v TESTCASE ']'                                                                                          
                             + TESTCASE=/testcase                                                                                               
                             + '[' '!' -f /testcase ']'                                                                                         
                             + export RUN_FUZZER_MODE=interactive                                                                               
                             + RUN_FUZZER_MODE=interactive                                                                                      
                             + export FUZZING_ENGINE=libfuzzer                                                                                  
                             + FUZZING_ENGINE=libfuzzer                                                                                         
                             + export SKIP_SEED_CORPUS=1                                                                                        
                             + SKIP_SEED_CORPUS=1                                                                                               
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                         
                             vm.mmap_rnd_bits = 28                                                                                              
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                            
                             INFO: Seed: 1747797146                                                                                             
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x556be26b54b0, 0x556be26b6179),                      
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x556be26b6180,0x556be26c2e10),                                         
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                 
                             Running: /testcase                                                                                                 
                             =================================================================                                                  
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x556be25385b0                 
                             bp 0x7ffe930663b0 sp 0x7ffe930663a8                                                                                
                             READ of size 1 at 0x5020000000b8 thread T0                                                                         
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                   
                                 #0 0x556be25385af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                          
                                 #1 0x556be25397ac in json_parse /src/shadowsocks/src/json.c:958:11                                             
                                 #2 0x556be2532c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                              
                                 #3 0x556be23e9a80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)                      
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                     
                                 #4 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #5 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #6 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #7 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                 #8 0x556be23ccedd in _start (/out/json_fuzz+0x5cedd)                                                           
                                                                                                                                                
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                     
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                              
                             allocated by thread T0 here:                                                                                       
                                 #0 0x556be24f584f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                  
                                 #1 0x556be260b223 in operator new(unsigned long) cxa_noexception.cpp                                           
                                 #2 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #3 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #4 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #5 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                                                                                                                                
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned                                                           
                             long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                             
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in                              
                             json_parse_ex                                                                                                      
                             Shadow bytes around the buggy address:                                                                             
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                  
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                  
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                               
                               Addressable:           00                                                                                        
                               Partially addressable: 01 02 03 04 05 06 07                                                                      
                               Heap left redzone:       fa                                                                                      
                               Freed heap region:       fd                                                                                      
                               Stack left redzone:      f1                                                                                      
                               Stack mid redzone:       f2                                                                                      
                               Stack right redzone:     f3                                                                                      
                               Stack after return:      f5                                                                                      
                               Stack use after scope:   f8                                                                                      
                               Global redzone:          f9                                                                                      
                               Global init order:       f6                                                                                      
                               Poisoned by user:        f7                                                                                      
                               Container overflow:      fc                                                                                      
                               Array cookie:            ac                                                                                      
                               Intra object redzone:    bb                                                                                      
                               ASan internal:           fe                                                                                      
                               Left alloca redzone:     ca                                                                                      
                               Right alloca redzone:    cb                                                                                      
                             ==18==ABORTING                                                                                                     
                             subprocess command returned a non-zero exit status: 1                                                              
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e                     
                             HELPER=True -e ARCHITECTURE=x86_64 -v                                                                              
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v                              
                             /tmp/tmp2bu2euk8:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce json_fuzz                          
                             -runs=100.                                                                                                         
                                                                                                                                                
                             ===Evaluation Report===                                                                                            
                             # Evaluation Report                                                                                                
                                                                                                                                                
                             ## Summary                                                                                                         
                                                                                                                                                
                             A libFuzzer campaign exercising the JSON parsing component of the Shadowsocks codebase triggered a                 
                             heapbufferoverflow in the function `json_parse_ex` (src/shadowsocks/src/json.c), as reported by                  
                             AddressSanitizer. The overflow occurs on a onebyte read just past an eightbyte heap allocation.                  
                                                                                                                                                
                             ## Description                                                                                                     
                                                                                                                                                
                             - Issue:                                                                                                           
                               During fuzzing with `json_fuzz` (built against LLVMs libFuzzer and run in interactive mode for                  
                             100 iterations), AddressSanitizer detected a heapbufferoverflow in `json_parse_ex` when                          
                             processing a malformed or unexpected input. The invalid read of size 1 at address `0x5020000000b8`                 
                             is immediately past an eightbyte allocated region, indicating an outofbounds access.                            
                                                                                                                                                
                             - Vulnerability type:                                                                                              
                               Memory safety violationspecifically, a heapbufferoverflow.                                                    
                                                                                                                                                
                             - Key observations:                                                                                                
                                The overflow is reported at `/src/shadowsocks/src/json.c:634:55` inside `json_parse_ex`.                       
                                The call stack shows the crash propagating through `json_parse`, the fuzz entry point                          
                             `LLVMFuzzerTestOneInput` (in json_fuzz.c), and into libFuzzers driver code.                                       
                                AddressSanitizers shadowmemory dump confirms that the offending address lies in the right                    
                             redzone of a small heap block.                                                                                     
                                The harness (`json_fuzz.c`) simply feeds arbitrary input to `json_parse_ex` and is not                         
                             responsible for memory management issuesit only exposes the underlying parser bug.                                
                                                                                                                                                
                             - Relevant code areas for investigation:                                                                           
                               1. `json_parse_ex` in `src/shadowsocks/src/json.c` around line 634, where buffer bounds may be                   
                             miscalculated or input length checks are insufficient.                                                             
                               2. The caller `json_parse` (same file, around line 958), to understand how parsed buffers are                    
                             allocated and passed to `json_parse_ex`.                                                                           
                               3. The fuzz target `json_fuzz.c` (around line 12), which invokes `json_parse` on arbitrary byte                  
                             arrays, to review any assumptions about input length or null termination.                                          
                               4. Memory allocation sites in the JSON module, ensuring that all buffers used during parsing                     
                             have adequate size and that all pointer arithmetic is guarded by proper length checks.                             
                                                                                                                                                
                             ## Initial Issue Log                                                                                               
                             Here is the initial issue log of the codebase:                                                                     
                             <issue>                                                                                                            
                             + FUZZER=json_fuzz                                                                                                 
                             + shift                                                                                                            
                             + '[' '!' -v TESTCASE ']'                                                                                          
                             + TESTCASE=/testcase                                                                                               
                             + '[' '!' -f /testcase ']'                                                                                         
                             + export RUN_FUZZER_MODE=interactive                                                                               
                             + RUN_FUZZER_MODE=interactive                                                                                      
                             + export FUZZING_ENGINE=libfuzzer                                                                                  
                             + FUZZING_ENGINE=libfuzzer                                                                                         
                             + export SKIP_SEED_CORPUS=1                                                                                        
                             + SKIP_SEED_CORPUS=1                                                                                               
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                         
                             vm.mmap_rnd_bits = 28                                                                                              
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                  
                             INFO: Running with entropic power schedule (0xFF, 100).                                                            
                             INFO: Seed: 1747797146                                                                                             
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x556be26b54b0, 0x556be26b6179),                      
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x556be26b6180,0x556be26c2e10),                                         
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                 
                             Running: /testcase                                                                                                 
                             =================================================================                                                  
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x556be25385b0                 
                             bp 0x7ffe930663b0 sp 0x7ffe930663a8                                                                                
                             READ of size 1 at 0x5020000000b8 thread T0                                                                         
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                   
                                 #0 0x556be25385af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                          
                                 #1 0x556be25397ac in json_parse /src/shadowsocks/src/json.c:958:11                                             
                                 #2 0x556be2532c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                              
                                 #3 0x556be23e9a80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long)                      
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                                                     
                                 #4 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #5 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #6 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #7 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                 #8 0x556be23ccedd in _start (/out/json_fuzz+0x5cedd)                                                           
                                                                                                                                                
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                     
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                              
                             allocated by thread T0 here:                                                                                       
                                 #0 0x556be24f584f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                  
                                 #1 0x556be260b223 in operator new(unsigned long) cxa_noexception.cpp                                           
                                 #2 0x556be23d4cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                           
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                                                    
                                 #3 0x556be23da78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*,                         
                             unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                    
                                 #4 0x556be2405a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                        
                                 #5 0x7efc7df70082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId:                     
                             5792732f783158c66fb4f3756458ca24e46e827d)                                                                          
                                                                                                                                                
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned                                                           
                             long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                             
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in                              
                             json_parse_ex                                                                                                      
                             Shadow bytes around the buggy address:                                                                             
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                  
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                  
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                  
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                  
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                               
                               Addressable:           00                                                                                        
                               Partially addressable: 01 02 03 04 05 06 07                                                                      
                               Heap left redzone:       fa                                                                                      
                               Freed heap region:       fd                                                                                      
                               Stack left redzone:      f1                                                                                      
                               Stack mid redzone:       f2                                                                                      
                               Stack right redzone:     f3                                                                                      
                               Stack after return:      f5                                                                                      
                               Stack use after scope:   f8                                                                                      
                               Global redzone:          f9                                                                                      
                               Global init order:       f6                                                                                      
                               Poisoned by user:        f7                                                                                      
                               Container overflow:      fc                                                                                      
                               Array cookie:            ac                                                                                      
                               Intra object redzone:    bb                                                                                      
                               ASan internal:           fe                                                                                      
                               Left alloca redzone:     ca                                                                                      
                               Right alloca redzone:    cb                                                                                      
                             ==18==ABORTING                                                                                                     
                             subprocess command returned a non-zero exit status: 1                                                              
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e                     
                             HELPER=True -e ARCHITECTURE=x86_64 -v                                                                              
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v                              
                             /tmp/tmp2bu2euk8:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce json_fuzz                          
                             -runs=100.                                                                                                         
                                                                                                                                                
                             </issue>                                                                                                           
                             ===Analysis Report===                                                                                              
                             # Analysis Report                                                                                                  
                                                                                                                                                
                             ## Relevant Code Snippets                                                                                          
                             <code_snippets>                                                                                                    
                             <code>                                                                                                             
                             src/json.c:580-700                                                                                                 
                             ```                                                                                                                
                             580:                     case '[':                                                                                 
                             581:                                                                                                               
                             582:                        if (!new_value (&state, &top, &root, &alloc, json_array))                              
                             583:                           goto e_alloc_failure;                                                               
                             584:                                                                                                               
                             585:                        flags |= flag_seek_value;                                                              
                             586:                        continue;                                                                              
                             587:                                                                                                               
                             588:                     case '"':                                                                                 
                             589:                                                                                                               
                             590:                        if (!new_value (&state, &top, &root, &alloc, json_string))                             
                             591:                           goto e_alloc_failure;                                                               
                             592:                                                                                                               
                             593:                        flags |= flag_string;                                                                  
                             594:                                                                                                               
                             595:                        string = top->u.string.ptr;                                                            
                             596:                        string_length = 0;                                                                     
                             597:                                                                                                               
                             598:                        continue;                                                                              
                             599:                                                                                                               
                             600:                     case 't':                                                                                 
                             601:                                                                                                               
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                 
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                  
                             604:                        {                                                                                      
                             605:                           goto e_unknown_value;                                                               
                             606:                        }                                                                                      
                             607:                                                                                                               
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                            
                             609:                           goto e_alloc_failure;                                                               
                             610:                                                                                                               
                             611:                        top->u.boolean = 1;                                                                    
                             612:                                                                                                               
                             613:                        flags |= flag_next;                                                                    
                             614:                        break;                                                                                 
                             615:                                                                                                               
                             616:                     case 'f':                                                                                 
                             617:                                                                                                               
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                 
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                
                             620:                            *(++ state.ptr) != 'e')                                                            
                             621:                        {                                                                                      
                             622:                           goto e_unknown_value;                                                               
                             623:                        }                                                                                      
                             624:                                                                                                               
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                            
                             626:                           goto e_alloc_failure;                                                               
                             627:                                                                                                               
                             628:                        flags |= flag_next;                                                                    
                             629:                        break;                                                                                 
                             630:                                                                                                               
                             631:                     case 'n':                                                                                 
                             632:                                                                                                               
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                 
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                  
                             635:                        {                                                                                      
                             636:                           goto e_unknown_value;                                                               
                             637:                        }                                                                                      
                             638:                                                                                                               
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                               
                             640:                           goto e_alloc_failure;                                                               
                             641:                                                                                                               
                             642:                        flags |= flag_next;                                                                    
                             643:                        break;                                                                                 
                             644:                                                                                                               
                             645:                     default:                                                                                  
                             646:                                                                                                               
                             647:                        if (isdigit (b) || b == '-')                                                           
                             648:                        {                                                                                      
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                         
                             650:                              goto e_alloc_failure;                                                            
                             651:                                                                                                               
                             652:                           if (!state.first_pass)                                                              
                             653:                           {                                                                                   
                             654:                              while (isdigit (b) || b == '+' || b == '-'                                       
                             655:                                        || b == 'e' || b == 'E' || b == '.')                                   
                             656:                              {                                                                                
                             657:                                 if ( (++ state.ptr) == end)                                                   
                             658:                                 {                                                                             
                             659:                                    b = 0;                                                                     
                             660:                                    break;                                                                     
                             661:                                 }                                                                             
                             662:                                                                                                               
                             663:                                 b = *state.ptr;                                                               
                             664:                              }                                                                                
                             665:                                                                                                               
                             666:                              flags |= flag_next | flag_reproc;                                                
                             667:                              break;                                                                           
                             668:                           }                                                                                   
                             669:                                                                                                               
                             670:                           flags &= ~ (flag_num_negative | flag_num_e |                                        
                             671:                                        flag_num_e_got_sign | flag_num_e_negative |                            
                             672:                                           flag_num_zero);                                                     
                             673:                                                                                                               
                             674:                           num_digits = 0;                                                                     
                             675:                           num_fraction = 0;                                                                   
                             676:                           num_e = 0;                                                                          
                             677:                                                                                                               
                             678:                           if (b != '-')                                                                       
                             679:                           {                                                                                   
                             680:                              flags |= flag_reproc;                                                            
                             681:                              break;                                                                           
                             682:                           }                                                                                   
                             683:                                                                                                               
                             684:                           flags |= flag_num_negative;                                                         
                             685:                           continue;                                                                           
                             686:                        }                                                                                      
                             687:                        else                                                                                   
                             688:                        {  sprintf (error, "%d:%d: Unexpected %c when seeking value",                          
                             line_and_col, b);                                                                                                  
                             689:                           goto e_failed;                                                                      
                             690:                        }                                                                                      
                             691:                  };                                                                                           
                             692:            };                                                                                                 
                             693:         }                                                                                                     
                             694:         else                                                                                                  
                             695:         {                                                                                                     
                             696:            switch (top->type)                                                                                 
                             697:            {                                                                                                  
                             698:            case json_object:                                                                                  
                             699:                                                                                                               
                             700:               switch (b)                                                                                      
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:930-1000                                                                                                
                             ```                                                                                                                
                             930:                                                                                                               
                             931:   if (error_buf)                                                                                              
                             932:   {                                                                                                           
                             933:      if (*error)                                                                                              
                             934:         strcpy (error_buf, error);                                                                            
                             935:      else                                                                                                     
                             936:         strcpy (error_buf, "Unknown error");                                                                  
                             937:   }                                                                                                           
                             938:                                                                                                               
                             939:   if (state.first_pass)                                                                                       
                             940:      alloc = root;                                                                                            
                             941:                                                                                                               
                             942:   while (alloc)                                                                                               
                             943:   {                                                                                                           
                             944:      top = alloc->_reserved.next_alloc;                                                                       
                             945:      state.settings.mem_free (alloc, state.settings.user_data);                                               
                             946:      alloc = top;                                                                                             
                             947:   }                                                                                                           
                             948:                                                                                                               
                             949:   if (!state.first_pass)                                                                                      
                             950:      json_value_free_ex (&state.settings, root);                                                              
                             951:                                                                                                               
                             952:   return 0;                                                                                                   
                             953:}                                                                                                              
                             954:                                                                                                               
                             955:json_value * json_parse (const json_char * json, size_t length)                                                
                             956:{                                                                                                              
                             957:   json_settings settings = { 0 };                                                                             
                             958:   return json_parse_ex (&settings, json, length, 0);                                                          
                             959:}                                                                                                              
                             960:                                                                                                               
                             961:void json_value_free_ex (json_settings * settings, json_value * value)                                         
                             962:{                                                                                                              
                             963:   json_value * cur_value;                                                                                     
                             964:                                                                                                               
                             965:   if (!value)                                                                                                 
                             966:      return;                                                                                                  
                             967:                                                                                                               
                             968:   value->parent = 0;                                                                                          
                             969:                                                                                                               
                             970:   while (value)                                                                                               
                             971:   {                                                                                                           
                             972:      switch (value->type)                                                                                     
                             973:      {                                                                                                        
                             974:         case json_array:                                                                                      
                             975:                                                                                                               
                             976:            if (!value->u.array.length)                                                                        
                             977:            {                                                                                                  
                             978:               settings->mem_free (value->u.array.values, settings->user_data);                                
                             979:               break;                                                                                          
                             980:            }                                                                                                  
                             981:                                                                                                               
                             982:            value = value->u.array.values [-- value->u.array.length];                                          
                             983:            continue;                                                                                          
                             984:                                                                                                               
                             985:         case json_object:                                                                                     
                             986:                                                                                                               
                             987:            if (!value->u.object.length)                                                                       
                             988:            {                                                                                                  
                             989:               settings->mem_free (value->u.object.values, settings->user_data);                               
                             990:               break;                                                                                          
                             991:            }                                                                                                  
                             992:                                                                                                               
                             993:            value = value->u.object.values [-- value->u.object.length].value;                                  
                             994:            continue;                                                                                          
                             995:                                                                                                               
                             996:         case json_string:                                                                                     
                             997:                                                                                                               
                             998:            settings->mem_free (value->u.string.ptr, settings->user_data);                                     
                             999:            break;                                                                                             
                             1000:                                                                                                              
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:1-200                                                                                                   
                             ```                                                                                                                
                             1:/* vim: set et ts=3 sw=3 sts=3 ft=c:                                                                             
                             2: *                                                                                                               
                             3: * Copyright (C) 2012, 2013, 2014 James McLaughlin et al.  All rights reserved.                                  
                             4: * https://github.com/udp/json-parser                                                                            
                             5: *                                                                                                               
                             6: * Redistribution and use in source and binary forms, with or without                                            
                             7: * modification, are permitted provided that the following conditions                                            
                             8: * are met:                                                                                                      
                             9: *                                                                                                               
                             10: * 1. Redistributions of source code must retain the above copyright                                            
                             11: *   notice, this list of conditions and the following disclaimer.                                              
                             12: *                                                                                                              
                             13: * 2. Redistributions in binary form must reproduce the above copyright                                         
                             14: *   notice, this list of conditions and the following disclaimer in the                                        
                             15: *   documentation and/or other materials provided with the distribution.                                       
                             16: *                                                                                                              
                             17: * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND                                       
                             18: * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE                                        
                             19: * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE                                   
                             20: * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE                                      
                             21: * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL                                   
                             22: * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS                                      
                             23: * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)                                        
                             24: * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT                                   
                             25: * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY                                    
                             26: * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF                                       
                             27: * SUCH DAMAGE.                                                                                                 
                             28: */                                                                                                             
                             29:                                                                                                                
                             30:#include "json.h"                                                                                               
                             31:                                                                                                                
                             32:#ifdef _MSC_VER                                                                                                 
                             33:   #ifndef _CRT_SECURE_NO_WARNINGS                                                                              
                             34:      #define _CRT_SECURE_NO_WARNINGS                                                                           
                             35:   #endif                                                                                                       
                             36:#endif                                                                                                          
                             37:                                                                                                                
                             38:#ifdef __MINGW32__                                                                                              
                             39:#define CONV_PTR (uintptr_t)                                                                                    
                             40:#else                                                                                                           
                             41:#define CONV_PTR (unsigned long)                                                                                
                             42:#endif                                                                                                          
                             43:                                                                                                                
                             44:const struct _json_value json_value_none;                                                                       
                             45:                                                                                                                
                             46:#include <stdio.h>                                                                                              
                             47:#include <string.h>                                                                                             
                             48:#include <ctype.h>                                                                                              
                             49:#include <math.h>                                                                                               
                             50:                                                                                                                
                             51:typedef unsigned int json_uchar;                                                                                
                             52:                                                                                                                
                             53:static unsigned char hex_value (json_char c)                                                                    
                             54:{                                                                                                               
                             55:   if (isdigit(c))                                                                                              
                             56:      return c - '0';                                                                                           
                             57:                                                                                                                
                             58:   switch (c) {                                                                                                 
                             59:      case 'a': case 'A': return 0x0A;                                                                          
                             60:      case 'b': case 'B': return 0x0B;                                                                          
                             61:      case 'c': case 'C': return 0x0C;                                                                          
                             62:      case 'd': case 'D': return 0x0D;                                                                          
                             63:      case 'e': case 'E': return 0x0E;                                                                          
                             64:      case 'f': case 'F': return 0x0F;                                                                          
                             65:      default: return 0xFF;                                                                                     
                             66:   }                                                                                                            
                             67:}                                                                                                               
                             68:                                                                                                                
                             69:typedef struct                                                                                                  
                             70:{                                                                                                               
                             71:   unsigned long used_memory;                                                                                   
                             72:                                                                                                                
                             73:   unsigned int uint_max;                                                                                       
                             74:   unsigned long ulong_max;                                                                                     
                             75:                                                                                                                
                             76:   json_settings settings;                                                                                      
                             77:   int first_pass;                                                                                              
                             78:                                                                                                                
                             79:   const json_char * ptr;                                                                                       
                             80:   unsigned int cur_line, cur_col;                                                                              
                             81:                                                                                                                
                             82:} json_state;                                                                                                   
                             83:                                                                                                                
                             84:static void * default_alloc (size_t size, int zero, void * user_data)                                           
                             85:{                                                                                                               
                             86:   return zero ? calloc (1, size) : malloc (size);                                                              
                             87:}                                                                                                               
                             88:                                                                                                                
                             89:static void default_free (void * ptr, void * user_data)                                                         
                             90:{                                                                                                               
                             91:   free (ptr);                                                                                                  
                             92:}                                                                                                               
                             93:                                                                                                                
                             94:static void * json_alloc (json_state * state, unsigned long size, int zero)                                     
                             95:{                                                                                                               
                             96:   if ((state->ulong_max - state->used_memory) < size)                                                          
                             97:      return 0;                                                                                                 
                             98:                                                                                                                
                             99:   if (state->settings.max_memory                                                                               
                             100:         && (state->used_memory += size) > state->settings.max_memory)                                         
                             101:   {                                                                                                           
                             102:      return 0;                                                                                                
                             103:   }                                                                                                           
                             104:                                                                                                               
                             105:   return state->settings.mem_alloc (size, zero, state->settings.user_data);                                   
                             106:}                                                                                                              
                             107:                                                                                                               
                             108:static int new_value (json_state * state,                                                                      
                             109:                      json_value ** top, json_value ** root, json_value ** alloc,                              
                             110:                      json_type type)                                                                          
                             111:{                                                                                                              
                             112:   json_value * value;                                                                                         
                             113:   int values_size;                                                                                            
                             114:                                                                                                               
                             115:   if (!state->first_pass)                                                                                     
                             116:   {                                                                                                           
                             117:      value = *top = *alloc;                                                                                   
                             118:      *alloc = (*alloc)->_reserved.next_alloc;                                                                 
                             119:                                                                                                               
                             120:      if (!*root)                                                                                              
                             121:         *root = value;                                                                                        
                             122:                                                                                                               
                             123:      switch (value->type)                                                                                     
                             124:      {                                                                                                        
                             125:         case json_array:                                                                                      
                             126:                                                                                                               
                             127:            if (value->u.array.length == 0)                                                                    
                             128:               break;                                                                                          
                             129:                                                                                                               
                             130:            if (! (value->u.array.values = (json_value **) json_alloc                                          
                             131:               (state, value->u.array.length * sizeof (json_value *), 0)) )                                    
                             132:            {                                                                                                  
                             133:               return 0;                                                                                       
                             134:            }                                                                                                  
                             135:                                                                                                               
                             136:            value->u.array.length = 0;                                                                         
                             137:            break;                                                                                             
                             138:                                                                                                               
                             139:         case json_object:                                                                                     
                             140:                                                                                                               
                             141:            if (value->u.object.length == 0)                                                                   
                             142:               break;                                                                                          
                             143:                                                                                                               
                             144:            values_size = sizeof (*value->u.object.values) * value->u.object.length;                           
                             145:                                                                                                               
                             146:            if (! (value->u.object.values = (json_object_entry *) json_alloc                                   
                             147:                  (state, values_size + (CONV_PTR value->u.object.values), 0)) )                               
                             148:            {                                                                                                  
                             149:               return 0;                                                                                       
                             150:            }                                                                                                  
                             151:                                                                                                               
                             152:            value->_reserved.object_mem = (*(char **) &value->u.object.values) + values_size;                  
                             153:                                                                                                               
                             154:            value->u.object.length = 0;                                                                        
                             155:            break;                                                                                             
                             156:                                                                                                               
                             157:         case json_string:                                                                                     
                             158:                                                                                                               
                             159:            if (! (value->u.string.ptr = (json_char *) json_alloc                                              
                             160:               (state, (value->u.string.length + 1) * sizeof (json_char), 0)) )                                
                             161:            {                                                                                                  
                             162:               return 0;                                                                                       
                             163:            }                                                                                                  
                             164:                                                                                                               
                             165:            value->u.string.length = 0;                                                                        
                             166:            break;                                                                                             
                             167:                                                                                                               
                             168:         default:                                                                                              
                             169:            break;                                                                                             
                             170:      };                                                                                                       
                             171:                                                                                                               
                             172:      return 1;                                                                                                
                             173:   }                                                                                                           
                             174:                                                                                                               
                             175:   if (! (value = (json_value *) json_alloc                                                                    
                             176:         (state, sizeof (json_value) + state->settings.value_extra, 1)))                                       
                             177:   {                                                                                                           
                             178:      return 0;                                                                                                
                             179:   }                                                                                                           
                             180:                                                                                                               
                             181:   if (!*root)                                                                                                 
                             182:      *root = value;                                                                                           
                             183:                                                                                                               
                             184:   value->type = type;                                                                                         
                             185:   value->parent = *top;                                                                                       
                             186:                                                                                                               
                             187:   #ifdef JSON_TRACK_SOURCE                                                                                    
                             188:      value->line = state->cur_line;                                                                           
                             189:      value->col = state->cur_col;                                                                             
                             190:   #endif                                                                                                      
                             191:                                                                                                               
                             192:   if (*alloc)                                                                                                 
                             193:      (*alloc)->_reserved.next_alloc = value;                                                                  
                             194:                                                                                                               
                             195:   *alloc = *top = value;                                                                                      
                             196:                                                                                                               
                             197:   return 1;                                                                                                   
                             198:}                                                                                                              
                             199:                                                                                                               
                             200:#define whitespace \                                                                                           
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:700-830                                                                                                 
                             ```                                                                                                                
                             700:               switch (b)                                                                                      
                             701:               {                                                                                               
                             702:                  whitespace:                                                                                  
                             703:                     continue;                                                                                 
                             704:                                                                                                               
                             705:                  case '"':                                                                                    
                             706:                                                                                                               
                             707:                     if (flags & flag_need_comma)                                                              
                             708:                     {  sprintf (error, "%d:%d: Expected , before \"", line_and_col);                          
                             709:                        goto e_failed;                                                                         
                             710:                     }                                                                                         
                             711:                                                                                                               
                             712:                     flags |= flag_string;                                                                     
                             713:                                                                                                               
                             714:                     string = (json_char *) top->_reserved.object_mem;                                         
                             715:                     string_length = 0;                                                                        
                             716:                                                                                                               
                             717:                     break;                                                                                    
                             718:                                                                                                               
                             719:                  case '}':                                                                                    
                             720:                                                                                                               
                             721:                     flags = (flags & ~ flag_need_comma) | flag_next;                                          
                             722:                     break;                                                                                    
                             723:                                                                                                               
                             724:                  case ',':                                                                                    
                             725:                                                                                                               
                             726:                     if (flags & flag_need_comma)                                                              
                             727:                     {                                                                                         
                             728:                        flags &= ~ flag_need_comma;                                                            
                             729:                        break;                                                                                 
                             730:                     }                                                                                         
                             731:                                                                                                               
                             732:                  default:                                                                                     
                             733:                     sprintf (error, "%d:%d: Unexpected `%c` in object", line_and_col, b);                     
                             734:                     goto e_failed;                                                                            
                             735:               };                                                                                              
                             736:                                                                                                               
                             737:               break;                                                                                          
                             738:                                                                                                               
                             739:            case json_integer:                                                                                 
                             740:            case json_double:                                                                                  
                             741:                                                                                                               
                             742:               if (isdigit (b))                                                                                
                             743:               {                                                                                               
                             744:                  ++ num_digits;                                                                               
                             745:                                                                                                               
                             746:                  if (top->type == json_integer || flags & flag_num_e)                                         
                             747:                  {                                                                                            
                             748:                     if (! (flags & flag_num_e))                                                               
                             749:                     {                                                                                         
                             750:                        if (flags & flag_num_zero)                                                             
                             751:                        {  sprintf (error, "%d:%d: Unexpected `0` before `%c`", line_and_col,                  
                             b);                                                                                                                
                             752:                           goto e_failed;                                                                      
                             753:                        }                                                                                      
                             754:                                                                                                               
                             755:                        if (num_digits == 1 && b == '0')                                                       
                             756:                           flags |= flag_num_zero;                                                             
                             757:                     }                                                                                         
                             758:                     else                                                                                      
                             759:                     {                                                                                         
                             760:                        flags |= flag_num_e_got_sign;                                                          
                             761:                        num_e = (num_e * 10) + (b - '0');                                                      
                             762:                        continue;                                                                              
                             763:                     }                                                                                         
                             764:                                                                                                               
                             765:                     top->u.integer = (top->u.integer * 10) + (b - '0');                                       
                             766:                     continue;                                                                                 
                             767:                  }                                                                                            
                             768:                                                                                                               
                             769:                  num_fraction = (num_fraction * 10) + (b - '0');                                              
                             770:                  continue;                                                                                    
                             771:               }                                                                                               
                             772:                                                                                                               
                             773:               if (b == '+' || b == '-')                                                                       
                             774:               {                                                                                               
                             775:                  if ( (flags & flag_num_e) && !(flags & flag_num_e_got_sign))                                 
                             776:                  {                                                                                            
                             777:                     flags |= flag_num_e_got_sign;                                                             
                             778:                                                                                                               
                             779:                     if (b == '-')                                                                             
                             780:                        flags |= flag_num_e_negative;                                                          
                             781:                                                                                                               
                             782:                     continue;                                                                                 
                             783:                  }                                                                                            
                             784:               }                                                                                               
                             785:               else if (b == '.' && top->type == json_integer)                                                 
                             786:               {                                                                                               
                             787:                  if (!num_digits)                                                                             
                             788:                  {  sprintf (error, "%d:%d: Expected digit before `.`", line_and_col);                        
                             789:                     goto e_failed;                                                                            
                             790:                  }                                                                                            
                             791:                                                                                                               
                             792:                  top->type = json_double;                                                                     
                             793:                  top->u.dbl = (double) top->u.integer;                                                        
                             794:                                                                                                               
                             795:                  num_digits = 0;                                                                              
                             796:                  continue;                                                                                    
                             797:               }                                                                                               
                             798:                                                                                                               
                             799:               if (! (flags & flag_num_e))                                                                     
                             800:               {                                                                                               
                             801:                  if (top->type == json_double)                                                                
                             802:                  {                                                                                            
                             803:                     if (!num_digits)                                                                          
                             804:                     {  sprintf (error, "%d:%d: Expected digit after `.`", line_and_col);                      
                             805:                        goto e_failed;                                                                         
                             806:                     }                                                                                         
                             807:                                                                                                               
                             808:                     top->u.dbl += ((double) num_fraction) / (pow (10.0, (double)                              
                             num_digits));                                                                                                      
                             809:                  }                                                                                            
                             810:                                                                                                               
                             811:                  if (b == 'e' || b == 'E')                                                                    
                             812:                  {                                                                                            
                             813:                     flags |= flag_num_e;                                                                      
                             814:                                                                                                               
                             815:                     if (top->type == json_integer)                                                            
                             816:                     {                                                                                         
                             817:                        top->type = json_double;                                                               
                             818:                        top->u.dbl = (double) top->u.integer;                                                  
                             819:                     }                                                                                         
                             820:                                                                                                               
                             821:                     num_digits = 0;                                                                           
                             822:                     flags &= ~ flag_num_zero;                                                                 
                             823:                                                                                                               
                             824:                     continue;                                                                                 
                             825:                  }                                                                                            
                             826:               }                                                                                               
                             827:               else                                                                                            
                             828:               {                                                                                               
                             829:                  if (!num_digits)                                                                             
                             830:                  {  sprintf (error, "%d:%d: Expected digit after `e`", line_and_col);                         
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.h:1-200                                                                                                   
                             ```                                                                                                                
                             1:                                                                                                                 
                             2:/* vim: set et ts=3 sw=3 sts=3 ft=c:                                                                             
                             3: *                                                                                                               
                             4: * Copyright (C) 2012, 2013, 2014 James McLaughlin et al.  All rights reserved.                                  
                             5: * https://github.com/udp/json-parser                                                                            
                             6: *                                                                                                               
                             7: * Redistribution and use in source and binary forms, with or without                                            
                             8: * modification, are permitted provided that the following conditions                                            
                             9: * are met:                                                                                                      
                             10: *                                                                                                              
                             11: * 1. Redistributions of source code must retain the above copyright                                            
                             12: *   notice, this list of conditions and the following disclaimer.                                              
                             13: *                                                                                                              
                             14: * 2. Redistributions in binary form must reproduce the above copyright                                         
                             15: *   notice, this list of conditions and the following disclaimer in the                                        
                             16: *   documentation and/or other materials provided with the distribution.                                       
                             17: *                                                                                                              
                             18: * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND                                       
                             19: * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE                                        
                             20: * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE                                   
                             21: * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE                                      
                             22: * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL                                   
                             23: * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS                                      
                             24: * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)                                        
                             25: * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT                                   
                             26: * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY                                    
                             27: * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF                                       
                             28: * SUCH DAMAGE.                                                                                                 
                             29: */                                                                                                             
                             30:                                                                                                                
                             31:#ifndef _JSON_H                                                                                                 
                             32:#define _JSON_H                                                                                                 
                             33:                                                                                                                
                             34:#ifndef json_char                                                                                               
                             35:   #define json_char char                                                                                       
                             36:#endif                                                                                                          
                             37:                                                                                                                
                             38:#ifndef json_int_t                                                                                              
                             39:   #ifndef _MSC_VER                                                                                             
                             40:      #include <inttypes.h>                                                                                     
                             41:      #define json_int_t int64_t                                                                                
                             42:   #else                                                                                                        
                             43:      #define json_int_t __int64                                                                                
                             44:   #endif                                                                                                       
                             45:#endif                                                                                                          
                             46:                                                                                                                
                             47:#include <stdlib.h>                                                                                             
                             48:                                                                                                                
                             49:#ifdef __cplusplus                                                                                              
                             50:                                                                                                                
                             51:   #include <string.h>                                                                                          
                             52:                                                                                                                
                             53:   extern "C"                                                                                                   
                             54:   {                                                                                                            
                             55:                                                                                                                
                             56:#endif                                                                                                          
                             57:                                                                                                                
                             58:typedef struct                                                                                                  
                             59:{                                                                                                               
                             60:   unsigned long max_memory;                                                                                    
                             61:   int settings;                                                                                                
                             62:                                                                                                                
                             63:   /* Custom allocator support (leave null to use malloc/free)                                                  
                             64:    */                                                                                                          
                             65:                                                                                                                
                             66:   void * (* mem_alloc) (size_t, int zero, void * user_data);                                                   
                             67:   void (* mem_free) (void *, void * user_data);                                                                
                             68:                                                                                                                
                             69:   void * user_data;  /* will be passed to mem_alloc and mem_free */                                            
                             70:                                                                                                                
                             71:   size_t value_extra;  /* how much extra space to allocate for values? */                                      
                             72:                                                                                                                
                             73:} json_settings;                                                                                                
                             74:                                                                                                                
                             75:#define json_enable_comments  0x01                                                                              
                             76:                                                                                                                
                             77:typedef enum                                                                                                    
                             78:{                                                                                                               
                             79:   json_none,                                                                                                   
                             80:   json_object,                                                                                                 
                             81:   json_array,                                                                                                  
                             82:   json_integer,                                                                                                
                             83:   json_double,                                                                                                 
                             84:   json_string,                                                                                                 
                             85:   json_boolean,                                                                                                
                             86:   json_null                                                                                                    
                             87:                                                                                                                
                             88:} json_type;                                                                                                    
                             89:                                                                                                                
                             90:extern const struct _json_value json_value_none;                                                                
                             91:                                                                                                                
                             92:typedef struct _json_object_entry                                                                               
                             93:{                                                                                                               
                             94:    json_char * name;                                                                                           
                             95:    unsigned int name_length;                                                                                   
                             96:                                                                                                                
                             97:    struct _json_value * value;                                                                                 
                             98:                                                                                                                
                             99:} json_object_entry;                                                                                            
                             100:                                                                                                               
                             101:typedef struct _json_value                                                                                     
                             102:{                                                                                                              
                             103:   struct _json_value * parent;                                                                                
                             104:                                                                                                               
                             105:   json_type type;                                                                                             
                             106:                                                                                                               
                             107:   union                                                                                                       
                             108:   {                                                                                                           
                             109:      int boolean;                                                                                             
                             110:      json_int_t integer;                                                                                      
                             111:      double dbl;                                                                                              
                             112:                                                                                                               
                             113:      struct                                                                                                   
                             114:      {                                                                                                        
                             115:         unsigned int length;                                                                                  
                             116:         json_char * ptr; /* null terminated */                                                                
                             117:                                                                                                               
                             118:      } string;                                                                                                
                             119:                                                                                                               
                             120:      struct                                                                                                   
                             121:      {                                                                                                        
                             122:         unsigned int length;                                                                                  
                             123:                                                                                                               
                             124:         json_object_entry * values;                                                                           
                             125:                                                                                                               
                             126:         #if defined(__cplusplus) && __cplusplus >= 201103L                                                    
                             127:         decltype(values) begin () const                                                                       
                             128:         {  return values;                                                                                     
                             129:         }                                                                                                     
                             130:         decltype(values) end () const                                                                         
                             131:         {  return values + length;                                                                            
                             132:         }                                                                                                     
                             133:         #endif                                                                                                
                             134:                                                                                                               
                             135:      } object;                                                                                                
                             136:                                                                                                               
                             137:      struct                                                                                                   
                             138:      {                                                                                                        
                             139:         unsigned int length;                                                                                  
                             140:         struct _json_value ** values;                                                                         
                             141:                                                                                                               
                             142:         #if defined(__cplusplus) && __cplusplus >= 201103L                                                    
                             143:         decltype(values) begin () const                                                                       
                             144:         {  return values;                                                                                     
                             145:         }                                                                                                     
                             146:         decltype(values) end () const                                                                         
                             147:         {  return values + length;                                                                            
                             148:         }                                                                                                     
                             149:         #endif                                                                                                
                             150:                                                                                                               
                             151:      } array;                                                                                                 
                             152:                                                                                                               
                             153:   } u;                                                                                                        
                             154:                                                                                                               
                             155:   union                                                                                                       
                             156:   {                                                                                                           
                             157:      struct _json_value * next_alloc;                                                                         
                             158:      void * object_mem;                                                                                       
                             159:                                                                                                               
                             160:   } _reserved;                                                                                                
                             161:                                                                                                               
                             162:   #ifdef JSON_TRACK_SOURCE                                                                                    
                             163:                                                                                                               
                             164:      /* Location of the value in the source JSON                                                              
                             165:       */                                                                                                      
                             166:      unsigned int line, col;                                                                                  
                             167:                                                                                                               
                             168:   #endif                                                                                                      
                             169:                                                                                                               
                             170:                                                                                                               
                             171:   /* Some C++ operator sugar */                                                                               
                             172:                                                                                                               
                             173:   #ifdef __cplusplus                                                                                          
                             174:                                                                                                               
                             175:      public:                                                                                                  
                             176:                                                                                                               
                             177:         inline _json_value ()                                                                                 
                             178:         {  memset (this, 0, sizeof (_json_value));                                                            
                             179:         }                                                                                                     
                             180:                                                                                                               
                             181:         inline const struct _json_value &operator [] (int index) const                                        
                             182:         {                                                                                                     
                             183:            if (type != json_array || index < 0                                                                
                             184:                     || ((unsigned int) index) >= u.array.length)                                              
                             185:            {                                                                                                  
                             186:               return json_value_none;                                                                         
                             187:            }                                                                                                  
                             188:                                                                                                               
                             189:            return *u.array.values [index];                                                                    
                             190:         }                                                                                                     
                             191:                                                                                                               
                             192:         inline const struct _json_value &operator [] (const char * index) const                               
                             193:         {                                                                                                     
                             194:            if (type != json_object)                                                                           
                             195:               return json_value_none;                                                                         
                             196:                                                                                                               
                             197:            for (unsigned int i = 0; i < u.object.length; ++ i)                                                
                             198:               if (!strcmp (u.object.values [i].name, index))                                                  
                             199:                  return *u.object.values [i].value;                                                           
                             200:                                                                                                               
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:610-670                                                                                                 
                             ```                                                                                                                
                             610:                                                                                                               
                             611:                        top->u.boolean = 1;                                                                    
                             612:                                                                                                               
                             613:                        flags |= flag_next;                                                                    
                             614:                        break;                                                                                 
                             615:                                                                                                               
                             616:                     case 'f':                                                                                 
                             617:                                                                                                               
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                 
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                
                             620:                            *(++ state.ptr) != 'e')                                                            
                             621:                        {                                                                                      
                             622:                           goto e_unknown_value;                                                               
                             623:                        }                                                                                      
                             624:                                                                                                               
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                            
                             626:                           goto e_alloc_failure;                                                               
                             627:                                                                                                               
                             628:                        flags |= flag_next;                                                                    
                             629:                        break;                                                                                 
                             630:                                                                                                               
                             631:                     case 'n':                                                                                 
                             632:                                                                                                               
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                 
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                  
                             635:                        {                                                                                      
                             636:                           goto e_unknown_value;                                                               
                             637:                        }                                                                                      
                             638:                                                                                                               
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                               
                             640:                           goto e_alloc_failure;                                                               
                             641:                                                                                                               
                             642:                        flags |= flag_next;                                                                    
                             643:                        break;                                                                                 
                             644:                                                                                                               
                             645:                     default:                                                                                  
                             646:                                                                                                               
                             647:                        if (isdigit (b) || b == '-')                                                           
                             648:                        {                                                                                      
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                         
                             650:                              goto e_alloc_failure;                                                            
                             651:                                                                                                               
                             652:                           if (!state.first_pass)                                                              
                             653:                           {                                                                                   
                             654:                              while (isdigit (b) || b == '+' || b == '-'                                       
                             655:                                        || b == 'e' || b == 'E' || b == '.')                                   
                             656:                              {                                                                                
                             657:                                 if ( (++ state.ptr) == end)                                                   
                             658:                                 {                                                                             
                             659:                                    b = 0;                                                                     
                             660:                                    break;                                                                     
                             661:                                 }                                                                             
                             662:                                                                                                               
                             663:                                 b = *state.ptr;                                                               
                             664:                              }                                                                                
                             665:                                                                                                               
                             666:                              flags |= flag_next | flag_reproc;                                                
                             667:                              break;                                                                           
                             668:                           }                                                                                   
                             669:                                                                                                               
                             670:                           flags &= ~ (flag_num_negative | flag_num_e |                                        
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:200-279                                                                                                 
                             ```                                                                                                                
                             200:#define whitespace \                                                                                           
                             201:   case '\n': ++ state.cur_line;  state.cur_col = 0; \                                                         
                             202:   case ' ': case '\t': case '\r'                                                                              
                             203:                                                                                                               
                             204:#define string_add(b)  \                                                                                       
                             205:   do { if (!state.first_pass) string [string_length] = b;  ++ string_length; } while (0);                     
                             206:                                                                                                               
                             207:#define line_and_col \                                                                                         
                             208:   state.cur_line, state.cur_col                                                                               
                             209:                                                                                                               
                             210:static const long                                                                                              
                             211:   flag_next             = 1 << 0,                                                                             
                             212:   flag_reproc           = 1 << 1,                                                                             
                             213:   flag_need_comma       = 1 << 2,                                                                             
                             214:   flag_seek_value       = 1 << 3,                                                                             
                             215:   flag_escaped          = 1 << 4,                                                                             
                             216:   flag_string           = 1 << 5,                                                                             
                             217:   flag_need_colon       = 1 << 6,                                                                             
                             218:   flag_done             = 1 << 7,                                                                             
                             219:   flag_num_negative     = 1 << 8,                                                                             
                             220:   flag_num_zero         = 1 << 9,                                                                             
                             221:   flag_num_e            = 1 << 10,                                                                            
                             222:   flag_num_e_got_sign   = 1 << 11,                                                                            
                             223:   flag_num_e_negative   = 1 << 12,                                                                            
                             224:   flag_line_comment     = 1 << 13,                                                                            
                             225:   flag_block_comment    = 1 << 14;                                                                            
                             226:                                                                                                               
                             227:json_value * json_parse_ex (json_settings * settings,                                                          
                             228:                            const json_char * json,                                                            
                             229:                            size_t length,                                                                     
                             230:                            char * error_buf)                                                                  
                             231:{                                                                                                              
                             232:   json_char error [json_error_max];                                                                           
                             233:   const json_char * end;                                                                                      
                             234:   json_value * top, * root, * alloc = 0;                                                                      
                             235:   json_state state = { 0 };                                                                                   
                             236:   long flags;                                                                                                 
                             237:   long num_digits = 0, num_e = 0;                                                                             
                             238:   json_int_t num_fraction = 0;                                                                                
                             239:                                                                                                               
                             240:   /* Skip UTF-8 BOM                                                                                           
                             241:    */                                                                                                         
                             242:   if (length >= 3 && ((unsigned char) json [0]) == 0xEF                                                       
                             243:                   && ((unsigned char) json [1]) == 0xBB                                                       
                             244:                   && ((unsigned char) json [2]) == 0xBF)                                                      
                             245:   {                                                                                                           
                             246:      json += 3;                                                                                               
                             247:      length -= 3;                                                                                             
                             248:   }                                                                                                           
                             249:                                                                                                               
                             250:   error[0] = '\0';                                                                                            
                             251:   end = (json + length);                                                                                      
                             252:                                                                                                               
                             253:   memcpy (&state.settings, settings, sizeof (json_settings));                                                 
                             254:                                                                                                               
                             255:   if (!state.settings.mem_alloc)                                                                              
                             256:      state.settings.mem_alloc = default_alloc;                                                                
                             257:                                                                                                               
                             258:   if (!state.settings.mem_free)                                                                               
                             259:      state.settings.mem_free = default_free;                                                                  
                             260:                                                                                                               
                             261:   memset (&state.uint_max, 0xFF, sizeof (state.uint_max));                                                    
                             262:   memset (&state.ulong_max, 0xFF, sizeof (state.ulong_max));                                                  
                             263:                                                                                                               
                             264:   state.uint_max -= 8; /* limit of how much can be added before next check */                                 
                             265:   state.ulong_max -= 8;                                                                                       
                             266:                                                                                                               
                             267:   for (state.first_pass = 1; state.first_pass >= 0; -- state.first_pass)                                      
                             268:   {                                                                                                           
                             269:      json_uchar uchar;                                                                                        
                             270:      unsigned char uc_b1, uc_b2, uc_b3, uc_b4;                                                                
                             271:      json_char * string = 0;                                                                                  
                             272:      unsigned int string_length = 0;                                                                          
                             273:                                                                                                               
                             274:      top = root = 0;                                                                                          
                             275:      flags = flag_seek_value;                                                                                 
                             276:                                                                                                               
                             277:      state.cur_line = 1;                                                                                      
                             278:                                                                                                               
                             279:      for (state.ptr = json ;; ++ state.ptr)                                                                   
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:631-637                                                                                                 
                             ```                                                                                                                
                             631:                     case 'n':                                                                                 
                             632:                                                                                                               
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                 
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                  
                             635:                        {                                                                                      
                             636:                           goto e_unknown_value;                                                               
                             637:                        }                                                                                      
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:600-620                                                                                                 
                             ```                                                                                                                
                             600:                     case 't':                                                                                 
                             601:                                                                                                               
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                 
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                  
                             604:                        {                                                                                      
                             605:                           goto e_unknown_value;                                                               
                             606:                        }                                                                                      
                             607:                                                                                                               
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                            
                             609:                           goto e_alloc_failure;                                                               
                             610:                                                                                                               
                             611:                        top->u.boolean = 1;                                                                    
                             612:                                                                                                               
                             613:                        flags |= flag_next;                                                                    
                             614:                        break;                                                                                 
                             615:                                                                                                               
                             616:                     case 'f':                                                                                 
                             617:                                                                                                               
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                 
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                
                             620:                            *(++ state.ptr) != 'e')                                                            
                             ```                                                                                                                
                             </code>                                                                                                            
                             <code>                                                                                                             
                             src/json.c:618-626                                                                                                 
                             ```                                                                                                                
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                 
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                
                             620:                            *(++ state.ptr) != 'e')                                                            
                             621:                        {                                                                                      
                             622:                           goto e_unknown_value;                                                               
                             623:                        }                                                                                      
                             624:                                                                                                               
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                            
                             626:                           goto e_alloc_failure;                                                               
                             ```                                                                                                                
                             </code>                                                                                                            
                             </code_snippets>                                                                                                   
                                                                                                                                                
                             ## Fix Strategy                                                                                                    
                             <fix_strategy>                                                                                                     
                                                                                                                                                
                             1. Identify and correct offbyone bounds checks in literal parsing branches within json_parse_ex                  
                             (src/json.c). Specifically:                                                                                        
                                a. In the `case 't'` branch (parsing "true"): change the check from                                             
                                     if ((end - state.ptr) < 3 || )                                                                            
                                   to                                                                                                           
                                     if ((end - state.ptr) < 4 || )                                                                            
                                b. In the `case 'f'` branch (parsing "false"): change the check from                                            
                                     if ((end - state.ptr) < 4 || )                                                                            
                                   to                                                                                                           
                                     if ((end - state.ptr) < 5 || )                                                                            
                                c. In the `case 'n'` branch (parsing "null"): change the check from                                             
                                     if ((end - state.ptr) < 3 || )                                                                            
                                   to                                                                                                           
                                     if ((end - state.ptr) < 4 || )                                                                            
                                                                                                                                                
                             2. Rationale:                                                                                                      
                                - `state.ptr` initially points at the first character of the literal ('t','f','n'). Parsing                     
                             "true" requires reading three more characters ('r','u','e') via three `++state.ptr` increments. To                 
                             avoid reading at `end` (onepastbuffer), ensure `(end - state.ptr) >= 4`. Likewise for "null"                     
                             (4byte literal) and "false" (5byte literal).                                                                     
                                - By tightening the required minimum remaining bytes by one in each check, we prevent any read                  
                             when only exactly the literallength remains (which would otherwise lead to an outofbounds read)                 
                             or fewer, correctly dispatching to `e_unknown_value`.                                                              
                                                                                                                                                
                             3. Implementation Steps:                                                                                           
                                - Open src/shadowsocks/src/json.c.                                                                              
                                - Locate the `switch (b)` under `for (state.ptr = json )` where cases 't','f','n' appear.                      
                                - Modify the three bounds checks as outlined.                                                                   
                                - Rebuild the codebase and rerun the JSON fuzz target to confirm the heapbufferoverflow no                    
                             longer reproduces.                                                                                                 
                                                                                                                                                
                             4. Preservation of existing logic:                                                                                 
                                - Only the guard conditions are tightened; the parsing flow (pointer increments, new_value                      
                             calls, flag settings) remains unchanged.                                                                           
                                - All other literal parsing semantics and error paths (`e_unknown_value`) are preserved.                        
                                - No harness or external dependencies are modified, ensuring existing tests and fuzzing logic                   
                             remain valid.                                                                                                      
                                                                                                                                                
                             5. Side Effects and Mitigations:                                                                                   
                                - Short inputs (e.g., "t", "tru", "nul") will now reliably trigger `e_unknown_value` rather                     
                             than causing undefined readsthis is correct JSON behavior.                                                        
                                - No change to allocated buffer sizes or string parsing logic, so no unintended effects on                      
                             valid inputs.                                                                                                      
                                - Regression testing should confirm that valid JSON literals "true", "false", and "null" still                  
                             parse successfully.                                                                                                
                                                                                                                                                
                             6. References:                                                                                                     
                                - Similar offbyone guard adjustments exist in robust parsers (e.g., checking `i +                             
                             needed_length <= length` before substring comparisons).                                                            
                                - This fix aligns with how numeric parsing loops already guard against `state.ptr == end`                       
                             before dereferencing.                                                                                              
                                                                                                                                                
                             </fix_strategy>                                                                                                    
                             ===Tests Result===                                                                                                 
                             No tests found                                                                                                     
                             ===Evaluation End===                                                                                               
                    INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                                     __init__.py:160
                             (n evals: 2, patch status: PatchStatus.SOUND)                                                                      
                    INFO     Building environment                                                                                __init__.py:132
                             - Cache directory: /tmp/tmpz1f6n235                                                                                
                             - Max timeout: 1800                                                                                                
                             - Output directory:                                                                                                
                             reports/prism.prism_o4_mini/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3/agent-output-176225                
                             2851.8545654                                                                                                       
                             - Detection toml file:                                                                                             
                             /tasks_new/shadowsocks_shadowsocks-full-01/detection/shadowsocks_shadowsocks-full-01_shadowsocks-li                
                             bev_3.toml                                                                                                         
                             - Challenge project directory:                                                                                     
                             /tasks_new/shadowsocks_shadowsocks-full-01/official-afc-shadowsocks-libev                                          
                                                                                                                                                
