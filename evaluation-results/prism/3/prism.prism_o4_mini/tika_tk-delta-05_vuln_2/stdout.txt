[2;36m[12/29/25 21:53:15][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=654807;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=176440;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp0ui9k07p[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_o4_mini/tika_tk-delta-05_vuln_2/[0m[95magent-output-17[0m [2m               [0m
[2;36m                    [0m         [95m67045195.8234942[0m                                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-no-delta/tika_tk-delta-05_vuln_2.toml   [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=626410;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=885595;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:54:50][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m95.06[0m  ]8;id=506256;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=414688;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=408046;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=20954;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=730575;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=428413;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=818548;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=336619;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m95[0m[1m)[0m                                                          [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=41147;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=263678;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:54:51][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.07[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=915922;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=14730;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/29/25 21:54:53][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=638490;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=488225;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=913239;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=361784;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=943101;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=503196;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=18909;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=499935;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:54:55][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.47[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=976984;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=34378;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=746853;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=980856;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:54:56][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.04[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=21256;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=127703;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/29/25 21:55:09][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=144476;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=133938;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp9468614207585213504/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp9468614207585213504/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[12/29/25 21:55:19][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=45993;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=141025;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/29/25 21:56:53][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=536547;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=181150;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[12/29/25 21:57:35][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=695643;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=783953;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=774023;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=481943;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:57:36][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.99[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=454361;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=863066;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=604039;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=378135;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpqatppu44[0m                                                 ]8;id=953847;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=836970;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[12/29/25 21:58:49][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m72.47[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=224278;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=360224;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=461660;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=980057;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:59:22][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m33.08[0m seconds;                ]8;id=456330;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=61411;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=553715;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=914292;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:59:34][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.77[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=531950;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=984196;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=111789;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=586253;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=930544;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=731266;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=695166;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=570397;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:59:35][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=775915;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=499842;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/29/25 21:59:36][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=345202;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=593786;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:59:37][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=850817;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=59163;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=243773;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=470401;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[12/29/25 21:59:38][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.98[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=510058;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=295043;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[12/29/25 21:59:39][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=526649;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=55594;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java                       [2m                [0m
[2;36m                    [0m         +++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java                       [2m                [0m
[2;36m                    [0m         @@ [1;36m-1093[0m,[1;36m11[0m +[1;36m1093[0m,[1;36m16[0m @@                                                             [2m                [0m
[2;36m                    [0m                      MediaType contentType = [1;35mdetector.detect[0m[1m([0mtis, metadata[1m)[0m;                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                      String name = [1;35mmetadata.get[0m[1m([0mTikaCoreProperties.RESOURCE_NAME_KEY[1m)[0m;      [2m                [0m
[2;36m                    [0m         -            File outputFile = null;                                                [2m                [0m
[2;36m                    [0m         +            File outputFile;                                                       [2m                [0m
[2;36m                    [0m                      if [1m([0mname == null[1m)[0m [1m{[0m                                                    [2m                [0m
[2;36m                    [0m                          name = [32m"file"[0m + count++;                                           [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            outputFile = [1;35mgetOutputFile[0m[1m([0mname, metadata, contentType[1m)[0m;               [2m                [0m
[2;36m                    [0m         +            try [1m{[0m                                                                  [2m                [0m
[2;36m                    [0m         +                outputFile = [1;35mgetOutputFile[0m[1m([0mname, metadata, contentType[1m)[0m;           [2m                [0m
[2;36m                    [0m         +            [1m}[0m catch [1m([0mIOException e[1m)[0m [1m{[0m                                              [2m                [0m
[2;36m                    [0m         +                [1;35mLOG.warn[0m[1m([0m[32m"Skipping embedded file [0m[32m{[0m[32m}[0m[32m due to invalid file path: [0m[32m{[0m[32m}[0m[32m"[0m, [2m                [0m
[2;36m                    [0m         name, [1;35me.getMessage[0m[1m([0m[1m)[0m[1m)[0m;                                                              [2m                [0m
[2;36m                    [0m         +                return;                                                            [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                      File parent = [1;35moutputFile.getParentFile[0m[1m([0m[1m)[0m;                              [2m                [0m
[2;36m                    [0m         @@ [1;36m-1125[0m,[1;36m7[0m +[1;36m1130[0m,[1;36m7[0m @@                                                               [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -        private File [1;35mgetOutputFile[0m[1m([0mString name, Metadata metadata, MediaType       [2m                [0m
[2;36m                    [0m         contentType[1m)[0m [1m{[0m                                                                      [2m                [0m
[2;36m                    [0m         +        private File [1;35mgetOutputFile[0m[1m([0mString name, Metadata metadata, MediaType       [2m                [0m
[2;36m                    [0m         contentType[1m)[0m throws IOException [1m{[0m                                                   [2m                [0m
[2;36m                    [0m                      String ext = [1;35mgetExtension[0m[1m([0mcontentType[1m)[0m;                                [2m                [0m
[2;36m                    [0m                      if [1m([0m[1;35mname.indexOf[0m[1m([0m[32m'.'[0m[1m)[0m == [1;36m-1[0m && contentType != null[1m)[0m [1m{[0m                  [2m                [0m
[2;36m                    [0m                          name += ext;                                                       [2m                [0m
[2;36m                    [0m         @@ [1;36m-1135[0m,[1;36m8[0m +[1;36m1140[0m,[1;36m8[0m @@                                                               [2m                [0m
[2;36m                    [0m                      if [1m([0mrelID != null && ![1;35mname.startsWith[0m[1m([0mrelID[1m)[0m[1m)[0m [1m{[0m                        [2m                [0m
[2;36m                    [0m                          name = relID + [32m"_"[0m + name;                                         [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            [35m/[0m[35m/[0m[95mdefensively[0m do this so that we don't get an exception                [2m                [0m
[2;36m                    [0m         -            [35m/[0m[35m/[0m[95mfrom[0m FilenameUtils.normalize                                         [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m defensively do this so that we don't get an exception               [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m from FilenameUtils.normalize                                        [2m                [0m
[2;36m                    [0m                      name = [1;35mname.replaceAll[0m[1m([0m[32m"\u0000"[0m, [32m" "[0m[1m)[0m;                                 [2m                [0m
[2;36m                    [0m                      String normalizedName = [1;35mFilenameUtils.normalize[0m[1m([0mname[1m)[0m;                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         @@ [1;36m-1147[0m,[1;36m7[0m +[1;36m1152[0m,[1;36m7[0m @@                                                               [2m                [0m
[2;36m                    [0m                      if [1m([0mnormalizedName == null[1m)[0m [1m{[0m                                          [2m                [0m
[2;36m                    [0m                          normalizedName = [32m"file"[0m + count++ + ext;                           [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            [35m/[0m[35m/[0m[95mstrip[0m off initial C:[35m/[0m or ~[35m/[0m or [35m/[0m                                     [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m strip off initial C:[35m/[0m or ~[35m/[0m or [35m/[0m                                    [2m                [0m
[2;36m                    [0m                      int prefixLength = [1;35mFilenameUtils.getPrefixLength[0m[1m([0mnormalizedName[1m)[0m;      [2m                [0m
[2;36m                    [0m                      if [1m([0mprefixLength > [1;36m-1[0m[1m)[0m [1m{[0m                                               [2m                [0m
[2;36m                    [0m                          normalizedName = [1;35mnormalizedName.substring[0m[1m([0mprefixLength[1m)[0m;           [2m                [0m
[2;36m                    [0m         @@ [1;36m-1157[0m,[1;36m15[0m +[1;36m1162[0m,[1;36m20[0m @@                                                             [2m                [0m
[2;36m                    [0m                      [1m}[0m catch [1m([0mIllegalArgumentException e[1m)[0m [1m{[0m                                 [2m                [0m
[2;36m                    [0m                          [1;35mLOG.warn[0m[1m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m, normalizedName[1m)[0m;           [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            File outputFile = new [1;35mFile[0m[1m([0mextractDir, normalizedName[1m)[0m;                [2m                [0m
[2;36m                    [0m         -            [35m/[0m[35m/[0m[95mif[0m file already exists, prepend uuid                                 [2m                [0m
[2;36m                    [0m         -            if [1m([0m[1;35moutputFile.exists[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m                                             [2m                [0m
[2;36m                    [0m         -                String fileName = [1;35mFilenameUtils.getName[0m[1m([0mnormalizedName[1m)[0m;           [2m                [0m
[2;36m                    [0m         -                outputFile = new [1;35mFile[0m[1m([0mextractDir, UUID                             [2m                [0m
[2;36m                    [0m         -                        [1;35m.randomUUID[0m[1m([0m[1m)[0m                                              [2m                [0m
[2;36m                    [0m         -                        [1;35m.toString[0m[1m([0m[1m)[0m + [32m"-"[0m + fileName[1m)[0m;                             [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            return outputFile;                                                     [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m resolve and normalize against extraction directory to prevent       [2m                [0m
[2;36m                    [0m         traversal                                                                           [2m                [0m
[2;36m                    [0m         +            java.nio.file.Path root = [1;35mextractDir.toPath[0m[1m([0m[1m)[0m;                         [2m                [0m
[2;36m                    [0m         +            java.nio.file.Path target = [1;35mroot.resolve[0m[1m([0mnormalizedName[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;  [2m                [0m
[2;36m                    [0m         +            if [1m([0m![1;35mtarget.startsWith[0m[1m([0mroot[1m)[0m[1m)[0m [1m{[0m                                        [2m                [0m
[2;36m                    [0m         +                throw new [1;35mIOException[0m[1m([0m[32m"Invalid embedded file name, potential path [0m [2m                [0m
[2;36m                    [0m         [32mtraversal: "[0m + normalizedName[1m)[0m;                                                     [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m if file already exists, prepend uuid                                [2m                [0m
[2;36m                    [0m         +            if [1m([0m[1;35mjava.nio.file.Files.exists[0m[1m([0mtarget[1m)[0m[1m)[0m [1m{[0m                              [2m                [0m
[2;36m                    [0m         +                String baseName = [1;35mFilenameUtils.getName[0m[1m([0mnormalizedName[1m)[0m;           [2m                [0m
[2;36m                    [0m         +                String unique = [1;35mUUID.randomUUID[0m[1m([0m[1m)[0m[1;35m.toString[0m[1m([0m[1m)[0m + [32m"-"[0m + baseName;     [2m                [0m
[2;36m                    [0m         +                java.nio.file.Path alt = [1;35mroot.resolve[0m[1m([0munique[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;         [2m                [0m
[2;36m                    [0m         +                target = alt;                                                      [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +            return [1;35mtarget.toFile[0m[1m([0m[1m)[0m;                                                [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                  private String [1;35mgetExtension[0m[1m([0mMediaType contentType[1m)[0m [1m{[0m                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp9468614207585213504/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A critical file path traversal vulnerability was detected during fuzz testing of    [2m                [0m
[2;36m                    [0m         the Apache Tika CLI’s embedded document extraction feature. Jazzer’s                [2m                [0m
[2;36m                    [0m         `FilePathTraversal` sanitizer raised a `FuzzerSecurityIssueCritical` exception when [2m                [0m
[2;36m                    [0m         a crafted input led to an output path containing `..[35m/[0m[95m..[0m` segments, indicating that  [2m                [0m
[2;36m                    [0m         the extractor could write files outside the intended directory.                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - Issue overview                                                                    [2m                [0m
[2;36m                    [0m           During fuzzing with Jazzer, a                                                     [2m                [0m
[2;36m                    [0m         `com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: File path traversal` [2m                [0m
[2;36m                    [0m         exception was thrown. The offending                                                 [2m                [0m
[2;36m                    [0m         path—`[35m/tmp/expander-tmp9468614207585213504/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m`—i [2m                [0m
[2;36m                    [0m         ncludes upward directory references that escape the sandboxed output folder.        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - Vulnerability type                                                                [2m                [0m
[2;36m                    [0m           This is a file path traversal vulnerability: untrusted input is used to construct [2m                [0m
[2;36m                    [0m         filesystem paths, permitting directory escape.                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - Key observations                                                                  [2m                [0m
[2;36m                    [0m           • The exception is raised by `FilePathTraversal.check` at                         [2m                [0m
[2;36m                    [0m         `FilePathTraversal.jav[1;92ma:346[0m`.                                                       [2m                [0m
[2;36m                    [0m           • The check occurs inside `processFileOutputStartHook`, indicating the sanitizer  [2m                [0m
[2;36m                    [0m         inspects file outputs as they are created.                                          [2m                [0m
[2;36m                    [0m           • The stack trace flows through Tika’s internal parsers:                          [2m                [0m
[2;36m                    [0m             – `TikaCLI$FileEmbeddedDocumentExtractor.parseEmbedded`                         [2m                [0m
[2;36m                    [0m             – `PackageParser.parseEntry`, `parseEntries`, `_parse`                          [2m                [0m
[2;36m                    [0m             – `CompositeParser.parse` → `AutoDetectParser.parse`                            [2m                [0m
[2;36m                    [0m             – `TikaCLI.process` → `TikaCLI.main`                                            [2m                [0m
[2;36m                    [0m           • The fuzz harness [1m([0m`TikaAppUnpackerFuzzer.fuzzerTestOneInput`[1m)[0m simply invokes    [2m                [0m
[2;36m                    [0m         the Tika CLI routines and is not the root cause.                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - Code areas for investigation                                                      [2m                [0m
[2;36m                    [0m           [1;36m1[0m. **FilePathTraversal sanitizer** [1m([0mmethods `check`, `checkFile`,                 [2m                [0m
[2;36m                    [0m         `processFileOutputStartHook`[1m)[0m to verify how paths are normalized and validated.     [2m                [0m
[2;36m                    [0m           [1;36m2[0m. **TikaCLI FileEmbeddedDocumentExtractor** [1m([0mparticularly `parseEmbedded`[1m)[0m to    [2m                [0m
[2;36m                    [0m         see how embedded file names are handled and passed to the sanitizer.                [2m                [0m
[2;36m                    [0m           [1;36m3[0m. **PackageParser** and **CompositeParser** logic where entries are unpacked, to [2m                [0m
[2;36m                    [0m         understand how file names propagate into output paths.                              [2m                [0m
[2;36m                    [0m           [1;36m4[0m. Any utility functions or canonicalization routines used before writing files   [2m                [0m
[2;36m                    [0m         to disk.                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A review of these components will give a holistic view of how user-supplied names   [2m                [0m
[2;36m                    [0m         may lead to directory traversal in the file extraction workflow.                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: [0m   [2m                [0m
[2;36m                    [0m         [39mFile path traversal: [0m                                                               [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp9468614207585213504/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1;39m([0m[39mFilePathTraversal.j[0m [2m                [0m
[2;36m                    [0m         [39mav[0m[1;92ma:346[0m[1;39m)[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1;39m([0m[39mFilePathTravers[0m [2m                [0m
[2;36m                    [0m         [39mal.jav[0m[1;92ma:304[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1;39m([0m[39mFilePathTraversa[0m [2m                [0m
[2;36m                    [0m         [39ml.jav[0m[1;92ma:288[0m[1;39m)[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1;39m([0m[39mFilePathTraversal.jav[0m[1;92ma:256[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.tika.cli.TikaCLI$[0m[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1;39m([0m[39mTikaCLI.jav[0m [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.tika.cli.TikaCLI$[0m[1;35mOutputType.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:1057[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:486[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:238[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:54[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: ea76e639355e804b[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1050[0m[39m-[0m[1;36m1150[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1050[0m[39m:        public void [0m[1;35mprocess[0m[1;39m([0m[39mInputStream input, OutputStream output, Metadata [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m1051[0m[39m:            Parser p = parser;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1052[0m[39m:            if [0m[1;39m([0m[39mfork[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m1053[0m[39m:                p = new [0m[1;35mForkParser[0m[1;39m([0m[1;35mTikaCLI.class.getClassLoader[0m[1;39m([0m[1;39m)[0m[39m, p[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m1054[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1055[0m[39m:            ContentHandler handler = [0m[1;35mgetContentHandler[0m[1;39m([0m[39moutput, metadata[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m1056[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1057[0m[39m:                [0m[1;35mp.parse[0m[1;39m([0m[39minput, handler, metadata, context[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1058[0m[39m:                [0m[35m/[0m[35m/[0m[39m fix for TIKA-[0m[1;36m596[0m[39m: if a parser doesn't generate[0m              [2m                [0m
[2;36m                    [0m         [1;36m1059[0m[39m:                [0m[35m/[0m[35m/[0m[39m XHTML output, the lack of an output document prevents[0m       [2m                [0m
[2;36m                    [0m         [1;36m1060[0m[39m:                [0m[35m/[0m[35m/[0m[39m metadata from being output: this fixes that[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1061[0m[39m:                if [0m[1;39m([0m[39mhandler instanceof NoDocumentMetHandler[0m[1;39m)[0m[39m [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1062[0m[39m:                    NoDocumentMetHandler metHandler = [0m[1;39m([0m[39mNoDocumentMetHandler[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mhandler;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m1063[0m[39m:                    if [0m[1;39m([0m[39m![0m[1;35mmetHandler.metOutput[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1064[0m[39m:                        [0m[1;35mmetHandler.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m1065[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1066[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1067[0m[39m:            [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m1068[0m[39m:                if [0m[1;39m([0m[39mfork[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m1069[0m[39m:                    [0m[1;39m([0m[1;39m([0m[39mForkParser[0m[1;39m)[0m[39m p[0m[1;39m)[0m[1;35m.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m1070[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1071[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1072[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1073[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1074[0m[39m:        protected ContentHandler [0m[1;35mgetContentHandler[0m[1;39m([0m[39mOutputStream output, [0m       [2m                [0m
[2;36m                    [0m         [39mMetadata metadata[0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m1075[0m[39m:            throw new [0m[1;35mUnsupportedOperationException[0m[1;39m([0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1076[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1077[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1078[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1079[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:    private class FileEmbeddedDocumentExtractor implements [0m                    [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentExtractor [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:            File outputFile = null;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            File parent = [0m[1;35moutputFile.getParentFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mparent.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mparent.mkdirs[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"unable to create directory \""[0m[39m + [0m   [2m                [0m
[2;36m                    [0m         [39mparent + [0m[32m"\""[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:            [0m[1;35mSystem.out.println[0m[1;39m([0m[32m"Extracting '"[0m[39m + name + [0m[32m"' [0m[32m([0m[32m"[0m[39m + contentType + [0m  [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m to "[0m[39m + outputFile[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:            try [0m[1;39m([0m[39mFileOutputStream os = new [0m[1;35mFileOutputStream[0m[1;39m([0m[39moutputFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m     [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                if [0m[1;39m([0m[1;35membeddedStreamTranslator.shouldTranslate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                    try [0m[1;39m([0m[39mInputStream translated = [0m                             [2m                [0m
[2;36m                    [0m         [1;35membeddedStreamTranslator.translate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:                        [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtranslated, os[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:                    [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtis, os[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                [0m[35m/[0m[35m/[0m[39m being a CLI program messages should go to the stderr too[0m    [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                String msg = [0m[1;35mString.format[0m[1;39m([0m[39mLocale.ROOT, [0m[32m"Ignoring unexpected [0m  [2m                [0m
[2;36m                    [0m         [32mexception trying to save embedded file %s [0m[32m([0m[32m%s[0m[32m)[0m[32m"[0m[39m, name, [0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[39mmsg, e[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:450[0m[39m-[0m[1;36m550[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m491[0m[39m:                if [0m[1;39m([0m[39musesEncryption[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m492[0m[39m:                    [0m[1;35mEmbeddedDocumentUtil.recordEmbeddedStreamException[0m[1;39m([0m         [2m                [0m
[2;36m                    [0m         [1;36m493[0m[39m:                            new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[32m"stream [0m[32m([0m[32m"[0m[39m + name + [0m [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m is encrypted"[0m[1;39m)[0m[39m,[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m494[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m495[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m496[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m497[0m[39m:                [0m[35m/[0m[35m/[0m[39m do not write to the handler if[0m                               [2m                [0m
[2;36m                    [0m         [1;36m498[0m[39m:                [0m[35m/[0m[35m/[0m[39m UnsupportedZipFeatureException.Feature.DATA_DESCRIPTOR[0m       [2m                [0m
[2;36m                    [0m         [1;36m499[0m[39m:                [0m[35m/[0m[35m/[0m[39m is met, we will catch this exception and read the zip [0m       [2m                [0m
[2;36m                    [0m         [39marchive once again[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m500[0m[39m:                boolean usesDataDescriptor =[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m501[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesDataDescriptor[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m502[0m[39m:                if [0m[1;39m([0m[39musesDataDescriptor && [0m[1;35mzipArchiveEntry.getMethod[0m[1;39m([0m[1;39m)[0m[39m == [0m       [2m                [0m
[2;36m                    [0m         [39mZipEntry.STORED[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m503[0m[39m:                    throw new [0m[1;35mUnsupportedZipFeatureException[0m[1;39m([0m                   [2m                [0m
[2;36m                    [0m         [1;36m504[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [39mUnsupportedZipFeatureException.Feature.DATA_DESCRIPTOR,[0m                             [2m                [0m
[2;36m                    [0m         [1;36m505[0m[39m:                            zipArchiveEntry[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m506[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m507[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m508[0m[39m:                [0m[1;35mEmbeddedDocumentUtil.recordEmbeddedStreamException[0m[1;39m([0m             [2m                [0m
[2;36m                    [0m         [1;36m509[0m[39m:                        new [0m[1;35mTikaException[0m[1;39m([0m[32m"Can't read archive stream [0m[32m([0m[32m"[0m[39m + name [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m,[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m510[0m[39m:                        parentMetadata[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m511[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m512[0m[39m:            if [0m[1;39m([0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m513[0m[39m:                [0m[1;35mxhtml.element[0m[1;39m([0m[32m"p"[0m[39m, name[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m514[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m515[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m516[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m517[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m518[0m[39m:    [0m[35m/[0m[35m/[0m[39m Pending a fix for COMPRESS-[0m[1;36m269[0m[39m, we have to wrap ourselves[0m                [2m                [0m
[2;36m                    [0m         [1;36m519[0m[39m:    private static class SevenZWrapper extends ArchiveInputStream [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m520[0m[39m:        private SevenZFile file;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m521[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m522[0m[39m:        private [0m[1;35mSevenZWrapper[0m[1;39m([0m[39mSevenZFile file[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m523[0m[39m:            this.file = file;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m524[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m525[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m526[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m527[0m[39m:        public int [0m[1;35mread[0m[1;39m([0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m528[0m[39m:            return [0m[1;35mfile.read[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m529[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m530[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m531[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m532[0m[39m:        public int [0m[1;35mread[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m b[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m533[0m[39m:            return [0m[1;35mfile.read[0m[1;39m([0m[39mb[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m534[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m535[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m536[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m537[0m[39m:        public int [0m[1;35mread[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m b, int off, int len[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m538[0m[39m:            return [0m[1;35mfile.read[0m[1;39m([0m[39mb, off, len[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m539[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m540[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m541[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m542[0m[39m:        public ArchiveEntry [0m[1;35mgetNextEntry[0m[1;39m([0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m543[0m[39m:            return [0m[1;35mfile.getNextEntry[0m[1;39m([0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m544[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m545[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m546[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m547[0m[39m:        public void [0m[1;35mclose[0m[1;39m([0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m548[0m[39m:            [0m[1;35mfile.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m549[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m550[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:350[0m[39m-[0m[1;36m450[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:            [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m351[0m[39m:            [0m[1;35mxhtml.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m352[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m353[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m354[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m355[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m356[0m[39m:     * Parse the entries of the zip archive[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m357[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m358[0m[39m:     * @param ais                     archive input stream[0m                      [2m                [0m
[2;36m                    [0m         [1;36m359[0m[39m:     * @param metadata                document metadata [0m[1;39m([0m[39minput and output[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [1;36m360[0m[39m:     * @param extractor               the delegate parser[0m                       [2m                [0m
[2;36m                    [0m         [1;36m361[0m[39m:     * @param xhtml                   the xhtml handler[0m                         [2m                [0m
[2;36m                    [0m         [1;36m362[0m[39m:     * @param shouldUseDataDescriptor indicates if a data descriptor is [0m        [2m                [0m
[2;36m                    [0m         [39mrequired or not[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m363[0m[39m:     * @param entryCnt                index of the entry[0m                        [2m                [0m
[2;36m                    [0m         [1;36m364[0m[39m:     * @throws TikaException if the document could not be parsed[0m                [2m                [0m
[2;36m                    [0m         [1;36m365[0m[39m:     * @throws IOException   if a UnsupportedZipFeatureException is met[0m         [2m                [0m
[2;36m                    [0m         [1;36m366[0m[39m:     * @throws SAXException  if the SAX events could not be processed[0m           [2m                [0m
[2;36m                    [0m         [1;36m367[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m368[0m[39m:    private void [0m[1;35mparseEntries[0m[1;39m([0m[39mArchiveInputStream ais, Metadata metadata,[0m        [2m                [0m
[2;36m                    [0m         [1;36m369[0m[39m:                              EmbeddedDocumentExtractor extractor, [0m             [2m                [0m
[2;36m                    [0m         [39mXHTMLContentHandler xhtml,[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m370[0m[39m:                              boolean shouldUseDataDescriptor, AtomicInteger [0m   [2m                [0m
[2;36m                    [0m         [39mentryCnt[0m[1;39m)[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m371[0m[39m:            throws TikaException, IOException, SAXException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m372[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m373[0m[39m:            ArchiveEntry entry = [0m[1;35mais.getNextEntry[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m374[0m[39m:            while [0m[1;39m([0m[39mentry != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m375[0m[39m:                if [0m[1;39m([0m[39mshouldUseDataDescriptor && [0m[1;35mentryCnt.get[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m376[0m[39m:                    [0m[35m/[0m[35m/[0m[39m With shouldUseDataDescriptor being true, we are reading[0m  [2m                [0m
[2;36m                    [0m         [1;36m377[0m[39m:                    [0m[35m/[0m[35m/[0m[39m the zip once again. The number of entryCnt entries have[0m  [2m                [0m
[2;36m                    [0m         [1;36m378[0m[39m:                    [0m[35m/[0m[35m/[0m[39m already been parsed in the last time, so we can just[0m     [2m                [0m
[2;36m                    [0m         [1;36m379[0m[39m:                    [0m[35m/[0m[35m/[0m[39m skip these entries.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m380[0m[39m:                    [0m[1;35mentryCnt.decrementAndGet[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m381[0m[39m:                    entry = [0m[1;35mais.getNextEntry[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m382[0m[39m:                    continue;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m383[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m384[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m385[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mentry.isDirectory[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m386[0m[39m:                    [0m[1;35mparseEntry[0m[1;39m([0m[39mais, entry, extractor, metadata, xhtml[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m387[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m388[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m389[0m[39m:                if [0m[1;39m([0m[39m!shouldUseDataDescriptor[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m390[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Record the number of entries we have read, this is used[0m  [2m                [0m
[2;36m                    [0m         [1;36m391[0m[39m:                    [0m[35m/[0m[35m/[0m[39m for zip archives using Data Descriptor. It's used for[0m    [2m                [0m
[2;36m                    [0m         [1;36m392[0m[39m:                    [0m[35m/[0m[35m/[0m[39m skipping the entries we have already read[0m                [2m                [0m
[2;36m                    [0m         [1;36m393[0m[39m:                    [0m[1;35mentryCnt.incrementAndGet[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m394[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m395[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m396[0m[39m:                entry = [0m[1;35mais.getNextEntry[0m[1;39m([0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m397[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m398[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mUnsupportedZipFeatureException zfe[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m399[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m400[0m[39m:            [0m[35m/[0m[35m/[0m[39m If it's an encrypted document of unknown password, report as [0m    [2m                [0m
[2;36m                    [0m         [39msuch[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m401[0m[39m:            if [0m[1;39m([0m[1;35mzfe.getFeature[0m[1;39m([0m[1;39m)[0m[39m == Feature.ENCRYPTION[0m[1;39m)[0m[39m [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [1;36m402[0m[39m:                throw new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[39mzfe[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m403[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m404[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m405[0m[39m:            if [0m[1;39m([0m[1;35mzfe.getFeature[0m[1;39m([0m[1;39m)[0m[39m == Feature.DATA_DESCRIPTOR[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m406[0m[39m:                throw zfe;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m407[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m408[0m[39m:            [0m[35m/[0m[35m/[0m[39m Otherwise throw the exception[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m409[0m[39m:            throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"UnsupportedZipFeature"[0m[39m, zfe[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m410[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mPasswordRequiredException pre[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m411[0m[39m:            throw new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[39mpre[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m412[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m413[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m414[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m415[0m[39m:    private void [0m[1;35mupdateMediaType[0m[1;39m([0m[39mArchiveInputStream ais, Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m416[0m[39m:        MediaType type = [0m[1;35mgetMediaType[0m[1;39m([0m[39mais[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m417[0m[39m:        if [0m[1;39m([0m[1;35mtype.equals[0m[1;39m([0m[39mMediaType.OCTET_STREAM[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                              [2m                [0m
[2;36m                    [0m         [1;36m418[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m419[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m420[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m421[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m see if the user or an earlier step has passed in a content type[0m   [2m                [0m
[2;36m                    [0m         [1;36m422[0m[39m:        String incomingContentTypeString = [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m423[0m[39m:        if [0m[1;39m([0m[39mincomingContentTypeString == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m424[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m425[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m426[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m427[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m428[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m429[0m[39m:        MediaType incomingMediaType = [0m                                          [2m                [0m
[2;36m                    [0m         [1;35mMediaType.parse[0m[1;39m([0m[39mincomingContentTypeString[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m430[0m[39m:        if [0m[1;39m([0m[39mincomingMediaType == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m431[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m432[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m433[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m434[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m435[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mPACKAGE_SPECIALIZATIONS.contains[0m[1;39m([0m[39mincomingMediaType[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m436[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m437[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m438[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m439[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m440[0m[39m:    private void [0m[1;35mparseEntry[0m[1;39m([0m[39mArchiveInputStream archive, ArchiveEntry entry,[0m     [2m                [0m
[2;36m                    [0m         [1;36m441[0m[39m:                            EmbeddedDocumentExtractor extractor, Metadata [0m      [2m                [0m
[2;36m                    [0m         [39mparentMetadata,[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m442[0m[39m:                            XHTMLContentHandler xhtml[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [1;36m443[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m444[0m[39m:        String name = [0m[1;35mentry.getName[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m445[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m446[0m[39m:        [0m[35m/[0m[35m/[0m[95mTry[0m[39m to detect charset of archive entry in case of non-unicode [0m        [2m                [0m
[2;36m                    [0m         [39mfilename is used[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m447[0m[39m:        if [0m[1;39m([0m[39mdetectCharsetsInEntryNames && entry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m448[0m[39m:            [0m[35m/[0m[35m/[0m[39m Extend short entry name to improve accuracy of charset detection[0m [2m                [0m
[2;36m                    [0m         [1;36m449[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m entryName = [0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1200[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1170[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1171[0m[39m:        private String [0m[1;35mgetExtension[0m[1;39m([0m[39mMediaType contentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1172[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1173[0m[39m:                String ext = config[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1174[0m[39m:                        [0m[1;35m.getMimeRepository[0m[1;39m([0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m1175[0m[39m:                        [0m[1;35m.forName[0m[1;39m([0m[1;35mcontentType.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1176[0m[39m:                        [0m[1;35m.getExtension[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1177[0m[39m:                if [0m[1;39m([0m[39mext == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1178[0m[39m:                    return [0m[32m".bin"[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1179[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1180[0m[39m:                    return ext;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1181[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1182[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mMimeTypeException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m1183[0m[39m:                [0m[1;35me.printStackTrace[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1184[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1185[0m[39m:            return [0m[32m".bin"[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m1186[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1187[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1188[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1189[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1190[0m[39m:    private class NoDocumentJSONMetHandler extends DefaultHandler [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m1191[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1192[0m[39m:        protected final Metadata metadata;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1193[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1194[0m[39m:        protected PrintWriter writer;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1195[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1196[0m[39m:        public [0m[1;35mNoDocumentJSONMetHandler[0m[1;39m([0m[39mMetadata metadata, PrintWriter writer[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m1197[0m[39m:            this.metadata = metadata;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1198[0m[39m:            this.writer = writer;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1199[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1200[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:420[0m[39m-[0m[1;36m480[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m420[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m421[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m see if the user or an earlier step has passed in a content type[0m   [2m                [0m
[2;36m                    [0m         [1;36m422[0m[39m:        String incomingContentTypeString = [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m423[0m[39m:        if [0m[1;39m([0m[39mincomingContentTypeString == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m424[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m425[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m426[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m427[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m428[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m429[0m[39m:        MediaType incomingMediaType = [0m                                          [2m                [0m
[2;36m                    [0m         [1;35mMediaType.parse[0m[1;39m([0m[39mincomingContentTypeString[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m430[0m[39m:        if [0m[1;39m([0m[39mincomingMediaType == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m431[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m432[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m433[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m434[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m435[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mPACKAGE_SPECIALIZATIONS.contains[0m[1;39m([0m[39mincomingMediaType[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m436[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mMetadata.CONTENT_TYPE, [0m[1;35mtype.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m437[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m438[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m439[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m440[0m[39m:    private void [0m[1;35mparseEntry[0m[1;39m([0m[39mArchiveInputStream archive, ArchiveEntry entry,[0m     [2m                [0m
[2;36m                    [0m         [1;36m441[0m[39m:                            EmbeddedDocumentExtractor extractor, Metadata [0m      [2m                [0m
[2;36m                    [0m         [39mparentMetadata,[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m442[0m[39m:                            XHTMLContentHandler xhtml[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [1;36m443[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m444[0m[39m:        String name = [0m[1;35mentry.getName[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m445[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m446[0m[39m:        [0m[35m/[0m[35m/[0m[95mTry[0m[39m to detect charset of archive entry in case of non-unicode [0m        [2m                [0m
[2;36m                    [0m         [39mfilename is used[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m447[0m[39m:        if [0m[1;39m([0m[39mdetectCharsetsInEntryNames && entry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m448[0m[39m:            [0m[35m/[0m[35m/[0m[39m Extend short entry name to improve accuracy of charset detection[0m [2m                [0m
[2;36m                    [0m         [1;36m449[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m entryName = [0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1020[0m[39m-[0m[1;36m1050[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1020[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1021[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1022[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1023[0m[39m:        public void [0m[1;35mendDocument[0m[1;39m([0m[1;39m)[0m[39m throws SAXException [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m1024[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1025[0m[39m:                XMPMetadata xmp = new [0m[1;35mXMPMetadata[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1026[0m[39m:                String result;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1027[0m[39m:                result = [0m[1;35mxmp.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1028[0m[39m:                [0m[1;35mwriter.write[0m[1;39m([0m[39mresult[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1029[0m[39m:                [0m[1;35mwriter.flush[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1030[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mTikaException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1031[0m[39m:                throw new [0m[1;35mSAXException[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1032[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1033[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1034[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1035[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1036[0m[39m:    private static class SimplePasswordProvider implements PasswordProvider, [0m  [2m                [0m
[2;36m                    [0m         [39mSerializable [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1037[0m[39m:        private final String password;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1038[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1039[0m[39m:        public [0m[1;35mSimplePasswordProvider[0m[1;39m([0m[39mString password[0m[1;39m)[0m[39m [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1040[0m[39m:            this.password = password;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1041[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1042[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1043[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1044[0m[39m:        public String [0m[1;35mgetPassword[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1045[0m[39m:            return password;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1046[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1047[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1048[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1049[0m[39m:    private class OutputType [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1050[0m[39m:        public void [0m[1;35mprocess[0m[1;39m([0m[39mInputStream input, OutputStream output, Metadata [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-batch/src/main/java/org/apache/tika/batch/fs/FSUtil.jav[0m[1;92ma:90[0m[39m-[0m[1;36m140[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * @throws java.io.IOException[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:     * @see #[0m[1;35mgetOutputPath[0m[1;39m([0m[39mPath, String, HANDLE_EXISTING, String[0m[1;39m)[0m                [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:    @Deprecated[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:    public static File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mFile outputRoot, String [0m                    [2m                [0m
[2;36m                    [0m         [39minitialRelativePath, HANDLE_EXISTING handleExisting, String suffix[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        return [0m[1;35mgetOutputPath[0m[1;39m([0m[1;35mPaths.get[0m[1;39m([0m[1;35moutputRoot.toURI[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m, initialRelativePath,[0m [2m                [0m
[2;36m                    [0m         [39mhandleExisting, suffix[0m[1;39m)[0m[1;35m.toFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:     * Given an output root and an initial relative path,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:     * return the output file according to the HANDLE_EXISTING strategy[0m         [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:     * <p/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:     * In the most basic use case, given a root directory [0m[32m"input"[0m[39m,[0m              [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:     * a file's relative path [0m[32m"dir1/dir2/fileA.docx"[0m[39m, and an output directory[0m   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:     * [0m[32m"output"[0m[39m, the output file would be [0m[32m"output/dir1/dir2/fileA.docx."[0m        [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:     * <p/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:     * If HANDLE_EXISTING is set to OVERWRITE, this will not check to see if [0m   [2m                [0m
[2;36m                    [0m         [39mthe output already exists,[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:     * and the returned file could overwrite an existing file!!![0m                [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:     * <p/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:     * If HANDLE_EXISTING is set to RENAME, this will try to increment a [0m       [2m                [0m
[2;36m                    [0m         [39mcounter at the end of[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:     * the file name [0m[1;39m([0m[1;35mfileA[0m[1;39m([0m[1;36m2[0m[1;39m)[0m[39m.docx[0m[1;39m)[0m[39m until there is a file name that doesn't [0m   [2m                [0m
[2;36m                    [0m         [39mexist.[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:     * <p/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:     * This will return null if handleExisting == HANDLE_EXISTING.SKIP and[0m      [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:     * the candidate file already exists.[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:     * <p/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * This will throw an IOException if HANDLE_EXISTING is set to[0m              [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     * RENAME, and a candidate cannot output file cannot be found[0m               [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:     * after trying to increment the file count [0m[1;39m([0m[39me.g. [0m[1;35mfileA[0m[1;39m([0m[1;36m2[0m[1;39m)[0m[39m.docx[0m[1;39m)[0m[39m [0m[1;36m10000[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mtimes[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:     * and then after trying [0m[1;36m20[0m[39m,[0m[1;36m000[0m[39m UUIDs.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:     * @param outputRoot          root directory into which to put the path[0m     [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:     * @param initialRelativePath relative path including file [0m                 [2m                [0m
[2;36m                    [0m         [1;39m([0m[32m"somedir/subdir1/file.doc"[0m[1;39m)[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:     * @param handleExisting      policy for what to do if the output path [0m     [2m                [0m
[2;36m                    [0m         [39malready exists[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:     * @param suffix              suffix to add to the output path[0m              [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:     * @return can return null[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:     * @throws IOException[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:    public static Path [0m[1;35mgetOutputPath[0m[1;39m([0m[39mPath outputRoot, String [0m                   [2m                [0m
[2;36m                    [0m         [39minitialRelativePath, HANDLE_EXISTING handleExisting, String suffix[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:        String localSuffix = [0m[1;39m([0m[39msuffix == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : suffix;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        Path cand = [0m[1;35mFSUtil.resolveRelative[0m[1;39m([0m[39moutputRoot, initialRelativePath + [0m   [2m                [0m
[2;36m                    [0m         [32m"."[0m[39m + localSuffix[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:        if [0m[1;39m([0m[1;35mFiles.exists[0m[1;39m([0m[39mcand[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            if [0m[1;39m([0m[1;35mhandleExisting.equals[0m[1;39m([0m[39mHANDLE_EXISTING.OVERWRITE[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:                return cand;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35mhandleExisting.equals[0m[1;39m([0m[39mHANDLE_EXISTING.SKIP[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:                return null;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:        [0m[35m/[0m[35m/[0m[95mif[0m[39m we're here, the output file exists, and[0m                            [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m must find a new name for it.[0m                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-batch/src/main/java/org/apache/tika/batch/fs/FSUtil.jav[0m[1;92ma:1[0m[39m-[0m[1;36m90[0m                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.batch.fs;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.File;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.regex.Matcher;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m: * Utility class to handle some common issues when[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: * reading from and writing to a file system [0m[1;39m([0m[39mFS[0m[1;39m)[0m[39m.[0m                               [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:public class FSUtil [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    private final static Pattern FILE_NAME_PATTERN = [0m                            [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\A[0m[32m([0m[32m.*?[0m[32m)[0m[32m([0m[32m?:\\[0m[32m([0m[32m([0m[32m\\d+[0m[32m)[0m[32m\\[0m[32m)[0m[32m)[0m[32m?\\.[0m[32m([0m[32m[[0m[32m^\\.[0m[32m][0m[32m+[0m[32m)[0m[32m\\Z"[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    @Deprecated[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    public static boolean [0m[1;35mcheckThisIsAncestorOfThat[0m[1;39m([0m[39mFile ancestor, File child[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:        int ancLen = ancestor[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:                [0m[1;35m.getAbsolutePath[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:                [0m[1;35m.length[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:        int childLen = child[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:                [0m[1;35m.getAbsolutePath[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:                [0m[1;35m.length[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        if [0m[1;39m([0m[39mchildLen <= ancLen[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:            return false;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:        String childBase = child[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:                [0m[1;35m.getAbsolutePath[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:                [0m[1;35m.substring[0m[1;39m([0m[1;36m0[0m[39m, ancLen[0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        return [0m[1;35mchildBase.equals[0m[1;39m([0m[1;35mancestor.getAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    @Deprecated[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    public static boolean [0m[1;35mcheckThisIsAncestorOfOrSameAsThat[0m[1;39m([0m[39mFile ancestor, File [0m [2m                [0m
[2;36m                    [0m         [39mchild[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[1;35mancestor.equals[0m[1;39m([0m[39mchild[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            return true;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        return [0m[1;35mcheckThisIsAncestorOfThat[0m[1;39m([0m[39mancestor, child[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:     * Given an output root and an initial relative path,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:     * return the output file according to the HANDLE_EXISTING strategy[0m          [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:     * <p/>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:     * In the most basic use case, given a root directory [0m[32m"input"[0m[39m,[0m               [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:     * a file's relative path [0m[32m"dir1/dir2/fileA.docx"[0m[39m, and an output directory[0m    [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:     * [0m[32m"output"[0m[39m, the output file would be [0m[32m"output/dir1/dir2/fileA.docx."[0m         [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:     * <p/>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:     * If HANDLE_EXISTING is set to OVERWRITE, this will not check to see if the[0m [2m                [0m
[2;36m                    [0m         [39moutput already exists,[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:     * and the returned file could overwrite an existing file!!![0m                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:     * <p/>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:     * If HANDLE_EXISTING is set to RENAME, this will try to increment a counter[0m [2m                [0m
[2;36m                    [0m         [39mat the end of[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * the file name [0m[1;39m([0m[1;35mfileA[0m[1;39m([0m[1;36m2[0m[1;39m)[0m[39m.docx[0m[1;39m)[0m[39m until there is a file name that doesn't [0m    [2m                [0m
[2;36m                    [0m         [39mexist.[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     * <p/>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     * This will return null if handleExisting == HANDLE_EXISTING.SKIP and[0m       [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * the candidate file already exists.[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * <p/>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * This will throw an IOException if HANDLE_EXISTING is set to[0m               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * RENAME, and a candidate cannot output file cannot be found[0m                [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * after trying to increment the file count [0m[1;39m([0m[39me.g. [0m[1;35mfileA[0m[1;39m([0m[1;36m2[0m[1;39m)[0m[39m.docx[0m[1;39m)[0m[39m [0m[1;36m10000[0m[39m times[0m [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * and then after trying [0m[1;36m20[0m[39m,[0m[1;36m000[0m[39m UUIDs.[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * @param outputRoot          directory root for output[0m                      [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * @param initialRelativePath initial relative path [0m[1;39m([0m[39mincluding file name, [0m   [2m                [0m
[2;36m                    [0m         [39mwhich may be renamed[0m[1;39m)[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * @param handleExisting      what to do if the output file exists[0m           [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * @param suffix              suffix to add to files, can be null[0m            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     * @return output file or null if no output file should be created[0m           [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * @throws java.io.IOException[0m                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-batch/src/main/java/org/apache/tika/batch/fs/FSUtil.jav[0m[1;92ma:197[0m[39m-[0m[1;36m203[0m               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:    public static Path [0m[1;35mresolveRelative[0m[1;39m([0m[39mPath p, String other[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:        Path op = [0m[1;35mPaths.get[0m[1;39m([0m[39mother[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:        if [0m[1;39m([0m[1;35mop.isAbsolute[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[39mother + [0m[32m" cannot be an absolute [0m [2m                [0m
[2;36m                    [0m         [32mpath!"[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:        return [0m[1;35mp.resolve[0m[1;39m([0m[39mop[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1097[0m[39m-[0m[1;36m1101[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Root Cause and Symptom  [0m                                                         [2m                [0m
[2;36m                    [0m         [39m   - The embedded-extraction code in TikaCLI’s [0m                                     [2m                [0m
[2;36m                    [0m         [39m`FileEmbeddedDocumentExtractor.getOutputFile` uses `[0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m` [0m [2m                [0m
[2;36m                    [0m         [39mand a simple `new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m` to construct output paths. This[0m [2m                [0m
[2;36m                    [0m         [39mapproach can still allow carefully crafted “..” segments or encoded path fragments [0m [2m                [0m
[2;36m                    [0m         [39mto bypass the normalization and escape `extractDir`, triggering Jazzer’s [0m           [2m                [0m
[2;36m                    [0m         [39m`FilePathTraversal` sanitizer.  [0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Core Insight and Desired Invariant  [0m                                             [2m                [0m
[2;36m                    [0m         [39m   - We must ensure that any user-supplied or archive-supplied filename—after [0m      [2m                [0m
[2;36m                    [0m         [39mstripping nulls, applying any metadata-based prefixes, extensions, or [0m              [2m                [0m
[2;36m                    [0m         [39mURL-decoding—can never result in a filesystem path outside the designated [0m          [2m                [0m
[2;36m                    [0m         [39mextraction root [0m[1;39m([0m[39m`extractDir`[0m[1;39m)[0m[39m.  [0m                                                   [2m                [0m
[2;36m                    [0m         [39m   - A robust way to enforce this is to switch to Java NIO’s `Path` API: resolve [0m   [2m                [0m
[2;36m                    [0m         [39mthe [0m[1;39m([0m[39mcleaned[0m[1;39m)[0m[39m relative path against the canonical extraction directory path, [0m       [2m                [0m
[2;36m                    [0m         [39mnormalize it [0m[1;39m([0m[39mcollapsing “..[0m[35m/[0m[39m” segments[0m[1;39m)[0m[39m, and then verify the resolved path still [0m  [2m                [0m
[2;36m                    [0m         [39mstarts with the extraction root.  [0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Detailed Patch Steps  [0m                                                           [2m                [0m
[2;36m                    [0m         [39m   A. Modify `getOutputFile` to use `Path.resolve` + `Path.normalize` + prefix [0m     [2m                [0m
[2;36m                    [0m         [39mcheck:  [0m                                                                            [2m                [0m
[2;36m                    [0m         [39m   - After computing `normalizedName` [0m[1;39m([0m[39mretaining the existing steps up through [0m     [2m                [0m
[2;36m                    [0m         [39mURL-decoding[0m[1;39m)[0m[39m, replace the `new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m` logic with:[0m       [2m                [0m
[2;36m                    [0m         [39m     ```java[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m     [0m[35m/[0m[35m/[0m[39m Convert extractDir to Path once[0m                                             [2m                [0m
[2;36m                    [0m         [39m     Path root = [0m[1;35mextractDir.toPath[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [39m     [0m[35m/[0m[35m/[0m[39m Resolve then normalize to collapse any ..[0m[35m/[0m[39m segments[0m                         [2m                [0m
[2;36m                    [0m         [39m     Path target = [0m[1;35mroot.resolve[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [39m     [0m[35m/[0m[35m/[0m[39m Enforce that the resulting path is still under extractDir[0m                   [2m                [0m
[2;36m                    [0m         [39m     if [0m[1;39m([0m[39m![0m[1;35mtarget.startsWith[0m[1;39m([0m[39mroot[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [39m         throw new [0m[1;35mIOException[0m[1;39m([0m                                                     [2m                [0m
[2;36m                    [0m         [39m             [0m[32m"Invalid embedded file name, potential path traversal: "[0m[39m + [0m            [2m                [0m
[2;36m                    [0m         [39mnormalizedName[0m[1;39m)[0m[39m;[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m     [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m     [0m[35m/[0m[35m/[0m[39m Duplicate-file handling remains, but also via Path[0m                          [2m                [0m
[2;36m                    [0m         [39m     if [0m[1;39m([0m[1;35mFiles.exists[0m[1;39m([0m[39mtarget[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [39m         String baseName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [39m         String unique = [0m[1;35mUUID.randomUUID[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + baseName;[0m             [2m                [0m
[2;36m                    [0m         [39m         Path alt = [0m[1;35mroot.resolve[0m[1;39m([0m[39munique[0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [39m         [0m[35m/[0m[35m/[0m[39m alt must still start with root by construction[0m                          [2m                [0m
[2;36m                    [0m         [39m         target = alt;[0m                                                              [2m                [0m
[2;36m                    [0m         [39m     [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m     return [0m[1;35mtarget.toFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [39m     ```[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m   - This ensures no path can escape `extractDir` because any “..[0m[35m/[0m[39m” above will be [0m  [2m                [0m
[2;36m                    [0m         [39mcollapsed in `[0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m`, and the subsequent `[0m[1;35mstartsWith[0m[1;39m([0m[39mroot[0m[1;39m)[0m[39m` check will fail [0m  [2m                [0m
[2;36m                    [0m         [39mfor traversal attempts.  [0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   B. Guard the caller [0m[1;39m([0m[39m`parseEmbedded`[0m[1;39m)[0m[39m against unhandled `IOException` from [0m      [2m                [0m
[2;36m                    [0m         [39m`getOutputFile`:  [0m                                                                  [2m                [0m
[2;36m                    [0m         [39m   - Surround the call to `[0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, [0m[33m...[0m[1;39m)[0m[39m` with a narrow [0m                 [2m                [0m
[2;36m                    [0m         [39m`try`[0m[35m/[0m[39m`[0m[1;35mcatch[0m[1;39m([0m[39mIOException[0m[1;39m)[0m[39m` that logs a warning and skips extraction of that [0m        [2m                [0m
[2;36m                    [0m         [39membedded file rather than propagating and aborting the entire parse. Example:[0m       [2m                [0m
[2;36m                    [0m         [39m     ```java[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m     File outputFile;[0m                                                               [2m                [0m
[2;36m                    [0m         [39m     try [0m[1;39m{[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m         outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [39m     [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIOException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [39m         [0m[1;35mLOG.warn[0m[1;39m([0m[32m"Skipping embedded file [0m[32m{[0m[32m}[0m[32m due to invalid file path: [0m[32m{[0m[32m}[0m[32m"[0m[39m, name, [0m  [2m                [0m
[2;36m                    [0m         [1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m         return;  [0m[35m/[0m[35m/[0m[39m skip this embedded entry, continue parsing others[0m              [2m                [0m
[2;36m                    [0m         [39m     [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m     ```[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m   - Preserve the existing parent-directory creation and file-writing logic [0m        [2m                [0m
[2;36m                    [0m         [39munchanged.  [0m                                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Preservation of Existing Logic  [0m                                                 [2m                [0m
[2;36m                    [0m         [39m   - We retain the full sequence of extension handling, relationship-ID prefixing, [0m [2m                [0m
[2;36m                    [0m         [39mnull-character stripping, filename normalization fallback, prefix stripping, and [0m   [2m                [0m
[2;36m                    [0m         [39mURL-decoding.  [0m                                                                     [2m                [0m
[2;36m                    [0m         [39m   - We keep the existing duplicate-file UUID prefix strategy, simply migrating it [0m [2m                [0m
[2;36m                    [0m         [39mto the `Path` world.  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m   - All SAX exception and I/O warning behavior in `parseEmbedded` remains intact; [0m [2m                [0m
[2;36m                    [0m         [39monly an invalid path scenario is now caught earlier and logged as a skip.  [0m         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Why This Is Optimal  [0m                                                            [2m                [0m
[2;36m                    [0m         [39m   - Using NIO’s `[0m[1;35mPath.normalize[0m[1;39m([0m[1;39m)[0m[39m` plus an absolute-prefix check is the standard, [0m [2m                [0m
[2;36m                    [0m         [39mbattle-tested defense against directory traversal.  [0m                                [2m                [0m
[2;36m                    [0m         [39m   - It mirrors the logic in `FSUtil.resolveRelative` [0m[1;39m([0m[39mused elsewhere in TikaBatch[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mand ensures consistency across the codebase.  [0m                                      [2m                [0m
[2;36m                    [0m         [39m   - No external libraries or harness code is modified; fuzzing logic remains [0m      [2m                [0m
[2;36m                    [0m         [39munchanged and can continue to verify that traversals are blocked.  [0m                 [2m                [0m
[2;36m                    [0m         [39m   - The fix is localized to two methods in TikaCLI, minimizing risk of breaking [0m   [2m                [0m
[2;36m                    [0m         [39munrelated functionality.  [0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. Potential Side Effects and Mitigations  [0m                                         [2m                [0m
[2;36m                    [0m         [39m   - If an embedded file’s name contains illegal path segments or percent-encodings[0m [2m                [0m
[2;36m                    [0m         [39mthat we now detect as “outside” the root, those files will simply be skipped rather[0m [2m                [0m
[2;36m                    [0m         [39mthan extracted. Users will see a WARN in the CLI logs but parsing will continue.  [0m  [2m                [0m
[2;36m                    [0m         [39m   - Testing: Add unit tests in TikaCLI to pass names like “..[0m[35m/../[0m[95mevil[0m[39m” or [0m         [2m                [0m
[2;36m                    [0m         [39m“%2E%2E/secret” and assert they are skipped [0m[1;39m([0m[39mand no file is written[0m[1;39m)[0m[39m but parsing [0m   [2m                [0m
[2;36m                    [0m         [39mcontinues. This will catch regressions.  [0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. References for Similar Patterns  [0m                                                [2m                [0m
[2;36m                    [0m         [39m   - `tika-batch/src/main/java/org/apache/tika/batch/fs/FSUtil.resolveRelative`  [0m   [2m                [0m
[2;36m                    [0m         [39m   - Tika’s own use of `Path` in other secure output routines.  [0m                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mCode Ranges Patched:  [0m                                                              [2m                [0m
[2;36m                    [0m         [39m<code_range>tika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m[39m<[0m[35m/[0m[95mcode[0m [2m                [0m
[2;36m                    [0m         [95m_range[0m[39m>  [0m                                                                           [2m                [0m
[2;36m                    [0m         [39m<code_range>tika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1097[0m[39m-[0m[1;36m1101[0m[39m<[0m[35m/[0m[95mcode[0m [2m                [0m
[2;36m                    [0m         [95m_range[0m[39m>  [0m[1;39m([0m[39mfor parseEmbedded guard[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=359616;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=581259;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=7289;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=316569;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp0ui9k07p[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_o4_mini/tika_tk-delta-05_vuln_2/[0m[95magent-output-17[0m [2m               [0m
[2;36m                    [0m         [95m67045579.6640055[0m                                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-no-delta/tika_tk-delta-05_vuln_2.toml   [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[12/29/25 21:59:40][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/qqor/crete/.cache/environments/[0m[95mtika[0m           ]8;id=174708;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=38441;file:///home/qqor/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=363551;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=738452;file:///home/qqor/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=96235;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=384175;file:///home/qqor/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
