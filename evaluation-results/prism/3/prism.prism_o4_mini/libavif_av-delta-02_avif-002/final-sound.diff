--- a/src/reformat.c
+++ b/src/reformat.c
@@ -795,27 +795,42 @@
                     total_spill += fabs(spill_Cb);
                     total_spill += fabs(spill_Cr);
                     // if spill too high, dampen
-                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)){
+                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)) {
                         int a, b;
-                        if (i % 2 == 0){
+                        if (i % 2 == 0) {
                             a = 1;
-                        }else{
+                        } else {
                             a = -1;
                         }
-                        if (j % 2 == 0){
+                        if (j % 2 == 0) {
                             b = 1;
-                        }else{
+                        } else {
                             b = -1;
+                        }
+                        // clamp indices to valid range
+                        int ii = (int)i;
+                        int jj = (int)j;
+                        int ai = ii + a;
+                        if (ai < 0) {
+                            ai = 0;
+                        } else if (ai >= (int)image->width) {
+                            ai = (int)image->width - 1;
+                        }
+                        int bj = jj + b;
+                        if (bj < 0) {
+                            bj = 0;
+                        } else if (bj >= (int)image->height) {
+                            bj = (int)image->height - 1;
                         }
                         uspill_image[i][j] -= pSpillCb;
                         vspill_image[i][j] -= pSpillCb;
-                        uspill_image[i+a][j] -= pSpillCb;
-                        vspill_image[i+a][j] -= pSpillCr;
-                        uspill_image[i][j+b] -= pSpillCb;
-                        vspill_image[i][j+b] -= pSpillCr;
-                        uspill_image[i+a][j+b] -= pSpillCb;
-                        vspill_image[i+a][j+b] -= pSpillCr;
-                    }   
+                        uspill_image[ai][j] -= pSpillCb;
+                        vspill_image[ai][j] -= pSpillCr;
+                        uspill_image[i][bj] -= pSpillCb;
+                        vspill_image[i][bj] -= pSpillCr;
+                        uspill_image[ai][bj] -= pSpillCb;
+                        vspill_image[ai][bj] -= pSpillCr;
+                    }
                 }
             }
             // break out of iteration if improvement is small compared to the size of the image
