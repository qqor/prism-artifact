{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-02_vuln_004",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.29524220000000007,
    "prompt_tokens": 168750,
    "completion_tokens": 24913
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-icmp.c\n+++ b/epan/dissectors/packet-icmp.c\n@@ -924,13 +924,29 @@\n \tswitch(c_type) {\n \t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n \t\t\t/* Identification Name must be printable*/\n-\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n-\n-\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n-\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n-\t\t\t\t\tbreak;\n-\n-\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n+\t\t\t{\n+\t\t\t\t/* Compute lengths as signed integers to match proto_tree API */\n+\t\t\t\tgint raw_len = (obj_length > 4) ? (obj_length - 4) : 0;\n+\t\t\t\tgint rem_len = tvb_reported_length_remaining(tvb, offset);\n+\t\t\t\tif (rem_len < 0)\n+\t\t\t\t\trem_len = 0;\n+\t\t\t\t/* Clamp to available data */\n+\t\t\t\tgint name_len = (raw_len < rem_len) ? raw_len : rem_len;\n+\t\t\t\t/* Clamp to local buffer capacity */\n+\t\t\t\tif (name_len > ICMP_MAX_IDENT_NAME_LENGTH)\n+\t\t\t\t\tname_len = ICMP_MAX_IDENT_NAME_LENGTH;\n+\t\t\t\t/* Safely copy only up to name_len bytes */\n+\t\t\t\ttvb_memcpy(tvb, ident_name, offset, name_len);\n+\t\t\t\t/* Truncate at first non-printable character */\n+\t\t\t\tgint i;\n+\t\t\t\tfor (i = 0; i < name_len; i++)\n+\t\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n+\t\t\t\t\t\tbreak;\n+\t\t\t\tname_len = i;\n+\t\t\t\tproto_tree_add_item(ext_object_tree,\n+\t\t\t\t    hf_icmp_int_ident_name_string,\n+\t\t\t\t    tvb, offset, name_len, ENC_ASCII);\n+\t\t\t}\n \t\t\tbreak;\n \t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n \t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n",
  "stdout": "",
  "stderr": ""
}