{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_7",
  "source_directory": "/tasks_new/tika_tk-full-01/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.1779613,
    "prompt_tokens": 102519,
    "completion_tokens": 14816
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n@@ -268,6 +268,11 @@\n     private void processURL(String urlString, String name, XHTMLContentHandler xhtml,\n                             Metadata parentMetadata,\n                             ParseContext context) throws IOException, SAXException {\n+        // Disable external resource fetching by default to prevent SSRF\n+        TextAndCSVConfig config = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);\n+        if (!config.isFetchEmbeddedResources()) {\n+            return;\n+        }\n         EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n         Metadata metadata = new Metadata();\n         metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);\n\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n@@ -55,4 +55,15 @@\n         nameToDelimiterMap.entrySet()\n                           .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));\n     }\n+\n+    // Flag to control external resource fetching in CSV parser (prevents SSRF)\n+    private boolean fetchEmbeddedResources = false;\n+\n+    public boolean isFetchEmbeddedResources() {\n+        return fetchEmbeddedResources;\n+    }\n+\n+    public void setFetchEmbeddedResources(boolean fetchEmbeddedResources) {\n+        this.fetchEmbeddedResources = fetchEmbeddedResources;\n+    }\n }\n",
  "stdout": "",
  "stderr": ""
}