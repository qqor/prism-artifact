[10/28/25 00:12:28] INFO     Building environment                                                                                                                                                 __init__.py:132
                             - Cache directory: /tmp/tmp0zrdftgv                                                                                                                                                 
                             - Max timeout: 1800                                                                                                                                                                 
                             - Output directory: reports/prism.prism_o4_mini/tika_tk-full-01_vuln_7/agent-output-1761610348.3982575                                                                              
                             - Detection toml file: /tasks_new/tika_tk-full-01/detection/tika_tk-full-01_vuln_7.toml                                                                                             
                             - Challenge project directory: /tasks_new/tika_tk-full-01/official-afc-tika                                                                                                         
                                                                                                                                                                                                                 
                    INFO     [logging_performance](tika Building Cached for CLEAN environment) Started...                                                                                   context_managers.py:9
[10/28/25 00:14:16] INFO     [logging_performance](tika Building Cached for CLEAN environment) Took 108.57 seconds; exception=False                                                        context_managers.py:23
                    INFO     [logging_performance](tika Running tests for Cached for CLEAN environment) Started...                                                                          context_managers.py:9
                    INFO     [logging_performance](tika Running tests for Cached for CLEAN environment) Took 0.00 seconds; exception=False                                                 context_managers.py:23
                    INFO     Setting timeouts                                                                                                                                                       default.py:85
                               - build: 600 (original: 108)                                                                                                                                                      
                               - run tests: 600 (original: 0)                                                                                                                                                    
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:14:18] INFO     [logging_performance](tika Setting owner) Took 1.04 seconds; exception=False                                                                                  context_managers.py:23
[10/28/25 00:14:19] INFO     Successfully created Cached for CLEAN environment                                                                                                                    oss_fuzz.py:256
                    INFO     Current environments: ['CLEAN -> Cached']                                                                                                                            oss_fuzz.py:265
                    INFO     Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                                                                                                    __init__.py:160
                             (n evals: 0, patch status: PatchStatus.INITIALIZED)                                                                                                                                 
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:14:21] INFO     [logging_performance](tika Setting owner) Took 1.30 seconds; exception=False                                                                                  context_managers.py:23
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:14:22] INFO     [logging_performance](tika Setting owner) Took 0.91 seconds; exception=False                                                                                  context_managers.py:23
[10/28/25 00:14:32] INFO     ===Evaluator Result===                                                                                                                                              evaluator.py:204
                             PatchStatus.VULNERABLE                                                                                                                                                              
                             ===Evaluator Diff===                                                                                                                                                                
                                                                                                                                                                                                                 
                             ===Patch Result===                                                                                                                                                                  
                             == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: Server Side Request Forgery (SSRF)                                                                   
                             Attempted connection to: jazzer.com:443                                                                                                                                             
                             Requests to destinations based on untrusted data could lead to exfiltration of sensitive data or exposure of internal services.                                                     
                                                                                                                                                                                                                 
                                                                                                                                                                                                                 
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf(ServerSideRequestForgery.java:127)                                                            
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket(ServerSideRequestForgery.java:71)                                                       
                                     at java.base/java.net.Socket.connect(Socket.java:633)                                                                                                                       
                                     at java.base/sun.security.ssl.SSLSocketImpl.connect(SSLSocketImpl.java:299)                                                                                                 
                                     at java.base/sun.net.NetworkClient.doConnect(NetworkClient.java:178)                                                                                                        
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:498)                                                                                                    
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:603)                                                                                                    
                                     at java.base/sun.net.www.protocol.https.HttpsClient.<init>(HttpsClient.java:266)                                                                                            
                                     at java.base/sun.net.www.protocol.https.HttpsClient.New(HttpsClient.java:380)                                                                                               
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpClient(AbstractDelegateHttpsURLConnection.java:189)                                    
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1242)                                                                         
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1128)                                                                          
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:175)                                             
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1665)                                                                       
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)                                                                        
                                     at java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)                                                              
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processURL(TextAndCSVParser.java:278)                                                                                        
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processCell(TextAndCSVParser.java:261)                                                                                       
                                     at org.apache.tika.parser.csv.TextAndCSVParser.parse(TextAndCSVParser.java:211)                                                                                             
                                     at com.example.TextAndCSVParserFuzzer.parseOne(TextAndCSVParserFuzzer.java:57)                                                                                              
                                     at com.example.TextAndCSVParserFuzzer.fuzzerTestOneInput(TextAndCSVParserFuzzer.java:41)                                                                                    
                             DEDUP_TOKEN: 092377579d0e2656                                                                                                                                                       
                             == libFuzzer crashing input ==                                                                                                                                                      
                             ===Issue===                                                                                                                                                                         
                             == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: Server Side Request Forgery (SSRF)                                                                   
                             Attempted connection to: jazzer.com:443                                                                                                                                             
                             Requests to destinations based on untrusted data could lead to exfiltration of sensitive data or exposure of internal services.                                                     
                                                                                                                                                                                                                 
                                                                                                                                                                                                                 
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf(ServerSideRequestForgery.java:127)                                                            
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket(ServerSideRequestForgery.java:71)                                                       
                                     at java.base/java.net.Socket.connect(Socket.java:633)                                                                                                                       
                                     at java.base/sun.security.ssl.SSLSocketImpl.connect(SSLSocketImpl.java:299)                                                                                                 
                                     at java.base/sun.net.NetworkClient.doConnect(NetworkClient.java:178)                                                                                                        
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:498)                                                                                                    
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:603)                                                                                                    
                                     at java.base/sun.net.www.protocol.https.HttpsClient.<init>(HttpsClient.java:266)                                                                                            
                                     at java.base/sun.net.www.protocol.https.HttpsClient.New(HttpsClient.java:380)                                                                                               
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpClient(AbstractDelegateHttpsURLConnection.java:189)                                    
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1242)                                                                         
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1128)                                                                          
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:175)                                             
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1665)                                                                       
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)                                                                        
                                     at java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)                                                              
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processURL(TextAndCSVParser.java:278)                                                                                        
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processCell(TextAndCSVParser.java:261)                                                                                       
                                     at org.apache.tika.parser.csv.TextAndCSVParser.parse(TextAndCSVParser.java:211)                                                                                             
                                     at com.example.TextAndCSVParserFuzzer.parseOne(TextAndCSVParserFuzzer.java:57)                                                                                              
                                     at com.example.TextAndCSVParserFuzzer.fuzzerTestOneInput(TextAndCSVParserFuzzer.java:41)                                                                                    
                             DEDUP_TOKEN: 092377579d0e2656                                                                                                                                                       
                             == libFuzzer crashing input ==                                                                                                                                                      
                             ===Evaluation Report===                                                                                                                                                             
                                                                                                                                                                                                                 
                             ===Analysis Report===                                                                                                                                                               
                                                                                                                                                                                                                 
                             ===Evaluation End===                                                                                                                                                                
[10/28/25 00:14:45] INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                                                                                                  __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
[10/28/25 00:16:37] INFO     Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.PATCH                                                                                                     __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
[10/28/25 00:17:27] INFO     Prism Supervisor Routing: TeamStatus.PATCH -> TeamStatus.EVALUATE                                                                                                    __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:17:28] INFO     [logging_performance](tika Setting owner) Took 0.91 seconds; exception=False                                                                                  context_managers.py:23
[10/28/25 00:17:29] INFO     [logging_performance](tika Patching) Started...                                                                                                                context_managers.py:9
                    INFO     Checking valid diff: /tmp/tmpegceuoeq                                                                                                                                 default.py:173
[10/28/25 00:18:49] INFO     [logging_performance](tika Patching) Took 80.58 seconds; exception=False                                                                                      context_managers.py:23
                    INFO     [logging_performance](tika Checking build) Started...                                                                                                          context_managers.py:9
[10/28/25 00:19:21] INFO     [logging_performance](tika Checking build) Took 31.76 seconds; exception=False                                                                                context_managers.py:23
                    INFO     [logging_performance](tika Running PoV) Started...                                                                                                             context_managers.py:9
[10/28/25 00:19:30] INFO     [logging_performance](tika Running PoV) Took 8.92 seconds; exception=False                                                                                    context_managers.py:23
                    INFO     [logging_performance](tika Testing) Started...                                                                                                                 context_managers.py:9
                    INFO     [logging_performance](tika Testing) Took 0.00 seconds; exception=False                                                                                        context_managers.py:23
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:19:31] INFO     [logging_performance](tika Setting owner) Took 0.88 seconds; exception=False                                                                                  context_managers.py:23
[10/28/25 00:19:32] INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:19:33] INFO     [logging_performance](tika Setting owner) Took 0.92 seconds; exception=False                                                                                  context_managers.py:23
                    INFO     [logging_performance](tika Setting owner) Started...                                                                                                           context_managers.py:9
[10/28/25 00:19:34] INFO     [logging_performance](tika Setting owner) Took 0.92 seconds; exception=False                                                                                  context_managers.py:23
[10/28/25 00:19:35] INFO     ===Evaluator Result===                                                                                                                                              evaluator.py:204
                             PatchStatus.SOUND                                                                                                                                                                   
                             ===Evaluator Diff===                                                                                                                                                                
                             --- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java                       
                             +++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java                       
                             @@ -268,6 +268,11 @@                                                                                                                                                                
                                  private void processURL(String urlString, String name, XHTMLContentHandler xhtml,                                                                                              
                                                          Metadata parentMetadata,                                                                                                                               
                                                          ParseContext context) throws IOException, SAXException {                                                                                               
                             +        // Disable external resource fetching by default to prevent SSRF                                                                                                           
                             +        TextAndCSVConfig config = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);                                                                                    
                             +        if (!config.isFetchEmbeddedResources()) {                                                                                                                                  
                             +            return;                                                                                                                                                                
                             +        }                                                                                                                                                                          
                                      EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);                                                                                 
                                      Metadata metadata = new Metadata();                                                                                                                                        
                                      metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);                                                                                                                  
                                                                                                                                                                                                                 
                             --- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java                       
                             +++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java                       
                             @@ -55,4 +55,15 @@                                                                                                                                                                  
                                      nameToDelimiterMap.entrySet()                                                                                                                                              
                                                        .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));                                                                                         
                                  }                                                                                                                                                                              
                             +                                                                                                                                                                                   
                             +    // Flag to control external resource fetching in CSV parser (prevents SSRF)                                                                                                    
                             +    private boolean fetchEmbeddedResources = false;                                                                                                                                
                             +                                                                                                                                                                                   
                             +    public boolean isFetchEmbeddedResources() {                                                                                                                                    
                             +        return fetchEmbeddedResources;                                                                                                                                             
                             +    }                                                                                                                                                                              
                             +                                                                                                                                                                                   
                             +    public void setFetchEmbeddedResources(boolean fetchEmbeddedResources) {                                                                                                        
                             +        this.fetchEmbeddedResources = fetchEmbeddedResources;                                                                                                                      
                             +    }                                                                                                                                                                              
                              }                                                                                                                                                                                  
                                                                                                                                                                                                                 
                             ===Patch Result===                                                                                                                                                                  
                                                                                                                                                                                                                 
                             ===Issue===                                                                                                                                                                         
                             == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: Server Side Request Forgery (SSRF)                                                                   
                             Attempted connection to: jazzer.com:443                                                                                                                                             
                             Requests to destinations based on untrusted data could lead to exfiltration of sensitive data or exposure of internal services.                                                     
                                                                                                                                                                                                                 
                                                                                                                                                                                                                 
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf(ServerSideRequestForgery.java:127)                                                            
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket(ServerSideRequestForgery.java:71)                                                       
                                     at java.base/java.net.Socket.connect(Socket.java:633)                                                                                                                       
                                     at java.base/sun.security.ssl.SSLSocketImpl.connect(SSLSocketImpl.java:299)                                                                                                 
                                     at java.base/sun.net.NetworkClient.doConnect(NetworkClient.java:178)                                                                                                        
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:498)                                                                                                    
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:603)                                                                                                    
                                     at java.base/sun.net.www.protocol.https.HttpsClient.<init>(HttpsClient.java:266)                                                                                            
                                     at java.base/sun.net.www.protocol.https.HttpsClient.New(HttpsClient.java:380)                                                                                               
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpClient(AbstractDelegateHttpsURLConnection.java:189)                                    
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1242)                                                                         
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1128)                                                                          
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:175)                                             
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1665)                                                                       
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)                                                                        
                                     at java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)                                                              
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processURL(TextAndCSVParser.java:278)                                                                                        
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processCell(TextAndCSVParser.java:261)                                                                                       
                                     at org.apache.tika.parser.csv.TextAndCSVParser.parse(TextAndCSVParser.java:211)                                                                                             
                                     at com.example.TextAndCSVParserFuzzer.parseOne(TextAndCSVParserFuzzer.java:57)                                                                                              
                                     at com.example.TextAndCSVParserFuzzer.fuzzerTestOneInput(TextAndCSVParserFuzzer.java:41)                                                                                    
                             DEDUP_TOKEN: 092377579d0e2656                                                                                                                                                       
                             == libFuzzer crashing input ==                                                                                                                                                      
                             ===Evaluation Report===                                                                                                                                                             
                             # Evaluation Report                                                                                                                                                                 
                                                                                                                                                                                                                 
                             ## Summary                                                                                                                                                                          
                                                                                                                                                                                                                 
                             During fuzz testing of the Apache Tika CSV parser (TextAndCSVParser) via a Jazzer-based harness, a server-side request forgery (SSRF) issue was detected. The                       
                             fuzzer input caused the parser to interpret cell content as a URL and attempt an outbound HTTPS connection to “jazzer.com:443.” This behavior was intercepted by                    
                             Jazzer’s ServerSideRequestForgery sanitizer, resulting in a `FuzzerSecurityIssueMedium` exception.                                                                                  
                                                                                                                                                                                                                 
                             ## Description                                                                                                                                                                      
                                                                                                                                                                                                                 
                             - Issue type                                                                                                                                                                        
                               The fuzzer run triggered a Server-Side Request Forgery (SSRF) condition. Untrusted CSV cell data was used to build a network request.                                             
                                                                                                                                                                                                                 
                             - Exception details                                                                                                                                                                 
                               com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: Server Side Request Forgery (SSRF)                                                                                    
                               Attempted connection to: jazzer.com:443                                                                                                                                           
                               Stack trace highlights:                                                                                                                                                           
                                 • ServerSideRequestForgery.checkSsrf                                                                                                                                            
                                 • Socket.connect → SSLSocketImpl.connect                                                                                                                                        
                                 • HttpURLConnection.openServer → HttpsURLConnectionImpl.getInputStream                                                                                                          
                                 • TextAndCSVParser.processURL → processCell → parse                                                                                                                             
                                 • TextAndCSVParserFuzzer.parseOne → fuzzerTestOneInput                                                                                                                          
                                                                                                                                                                                                                 
                             - Key observations                                                                                                                                                                  
                               • The CSV parser’s processURL method will open a network stream to a URL derived directly from cell content.                                                                      
                               • Jazzer’s SSRF sanitizer flagged this as a medium-severity security issue.                                                                                                       
                               • The network request originates from standard Java URL/HttpURLConnection code.                                                                                                   
                                                                                                                                                                                                                 
                             - Areas for investigation                                                                                                                                                           
                               1. org.apache.tika.parser.csv.TextAndCSVParser.processURL (and related processCell/parse methods) to see how URLs are extracted and fetched.                                      
                               2. Any utility or helper methods in the CSV parser that translate cell text into URL objects.                                                                                     
                               3. The fuzzer harness class com.example.TextAndCSVParserFuzzer to understand how inputs are handed to the parser (though it is not the root cause).                               
                               4. Interaction with Java’s URLConnection APIs to determine where untrusted data leads to outbound connections.                                                                    
                                                                                                                                                                                                                 
                             This information should help in reviewing the code paths that allow unvalidated or unfiltered URLs from CSV input to trigger real network requests.                                 
                                                                                                                                                                                                                 
                             ## Initial Issue Log                                                                                                                                                                
                             Here is the initial issue log of the codebase:                                                                                                                                      
                             <issue>                                                                                                                                                                             
                             == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueMedium: Server Side Request Forgery (SSRF)                                                                   
                             Attempted connection to: jazzer.com:443                                                                                                                                             
                             Requests to destinations based on untrusted data could lead to exfiltration of sensitive data or exposure of internal services.                                                     
                                                                                                                                                                                                                 
                                                                                                                                                                                                                 
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrf(ServerSideRequestForgery.java:127)                                                            
                                     at com.code_intelligence.jazzer.sanitizers.ServerSideRequestForgery.checkSsrfSocket(ServerSideRequestForgery.java:71)                                                       
                                     at java.base/java.net.Socket.connect(Socket.java:633)                                                                                                                       
                                     at java.base/sun.security.ssl.SSLSocketImpl.connect(SSLSocketImpl.java:299)                                                                                                 
                                     at java.base/sun.net.NetworkClient.doConnect(NetworkClient.java:178)                                                                                                        
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:498)                                                                                                    
                                     at java.base/sun.net.www.http.HttpClient.openServer(HttpClient.java:603)                                                                                                    
                                     at java.base/sun.net.www.protocol.https.HttpsClient.<init>(HttpsClient.java:266)                                                                                            
                                     at java.base/sun.net.www.protocol.https.HttpsClient.New(HttpsClient.java:380)                                                                                               
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.getNewHttpClient(AbstractDelegateHttpsURLConnection.java:189)                                    
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect0(HttpURLConnection.java:1242)                                                                         
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.plainConnect(HttpURLConnection.java:1128)                                                                          
                                     at java.base/sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:175)                                             
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1665)                                                                       
                                     at java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)                                                                        
                                     at java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)                                                              
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processURL(TextAndCSVParser.java:278)                                                                                        
                                     at org.apache.tika.parser.csv.TextAndCSVParser.processCell(TextAndCSVParser.java:261)                                                                                       
                                     at org.apache.tika.parser.csv.TextAndCSVParser.parse(TextAndCSVParser.java:211)                                                                                             
                                     at com.example.TextAndCSVParserFuzzer.parseOne(TextAndCSVParserFuzzer.java:57)                                                                                              
                                     at com.example.TextAndCSVParserFuzzer.fuzzerTestOneInput(TextAndCSVParserFuzzer.java:41)                                                                                    
                             DEDUP_TOKEN: 092377579d0e2656                                                                                                                                                       
                             == libFuzzer crashing input ==                                                                                                                                                      
                             </issue>                                                                                                                                                                            
                             ===Analysis Report===                                                                                                                                                               
                             # Analysis Report                                                                                                                                                                   
                                                                                                                                                                                                                 
                             ## Relevant Code Snippets                                                                                                                                                           
                             <code_snippets>                                                                                                                                                                     
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:1-50                        
                             ```                                                                                                                                                                                 
                             1:/*                                                                                                                                                                                
                             2: * Licensed to the Apache Software Foundation (ASF) under one or more                                                                                                             
                             3: * contributor license agreements.  See the NOTICE file distributed with                                                                                                          
                             4: * this work for additional information regarding copyright ownership.                                                                                                            
                             5: * The ASF licenses this file to You under the Apache License, Version 2.0                                                                                                        
                             6: * (the "License"); you may not use this file except in compliance with                                                                                                           
                             7: * the License.  You may obtain a copy of the License at                                                                                                                          
                             8: *                                                                                                                                                                                
                             9: *      http://www.apache.org/licenses/LICENSE-2.0                                                                                                                                
                             10: *                                                                                                                                                                               
                             11: * Unless required by applicable law or agreed to in writing, software                                                                                                           
                             12: * distributed under the License is distributed on an "AS IS" BASIS,                                                                                                             
                             13: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                                                                                      
                             14: * See the License for the specific language governing permissions and                                                                                                           
                             15: * limitations under the License.                                                                                                                                                
                             16: */                                                                                                                                                                              
                             17:package org.apache.tika.parser.csv;                                                                                                                                              
                             18:                                                                                                                                                                                 
                             19:import java.io.BufferedReader;                                                                                                                                                   
                             20:import java.io.IOException;                                                                                                                                                      
                             21:import java.io.InputStream;                                                                                                                                                      
                             22:import java.io.InputStreamReader;                                                                                                                                                
                             23:import java.io.Reader;                                                                                                                                                           
                             24:import java.io.UncheckedIOException;                                                                                                                                             
                             25:import java.net.URL;                                                                                                                                                             
                             26:import java.net.URLConnection;                                                                                                                                                   
                             27:import java.nio.charset.Charset;                                                                                                                                                 
                             28:import java.nio.charset.UnsupportedCharsetException;                                                                                                                             
                             29:import java.util.Arrays;                                                                                                                                                         
                             30:import java.util.Collections;                                                                                                                                                    
                             31:import java.util.HashMap;                                                                                                                                                        
                             32:import java.util.HashSet;                                                                                                                                                        
                             33:import java.util.Map;                                                                                                                                                            
                             34:import java.util.Set;                                                                                                                                                            
                             35:import java.util.regex.Matcher;                                                                                                                                                  
                             36:import java.util.regex.Pattern;                                                                                                                                                  
                             37:                                                                                                                                                                                 
                             38:import org.apache.commons.csv.CSVFormat;                                                                                                                                         
                             39:import org.apache.commons.csv.CSVParser;                                                                                                                                         
                             40:import org.apache.commons.csv.CSVRecord;                                                                                                                                         
                             41:import org.apache.commons.io.input.CloseShieldInputStream;                                                                                                                       
                             42:import org.xml.sax.ContentHandler;                                                                                                                                               
                             43:import org.xml.sax.SAXException;                                                                                                                                                 
                             44:                                                                                                                                                                                 
                             45:import org.apache.tika.config.Field;                                                                                                                                             
                             46:import org.apache.tika.detect.AutoDetectReader;                                                                                                                                  
                             47:import org.apache.tika.detect.EncodingDetector;                                                                                                                                  
                             48:import org.apache.tika.exception.TikaConfigException;                                                                                                                            
                             49:import org.apache.tika.exception.TikaException;                                                                                                                                  
                             50:import org.apache.tika.extractor.EmbeddedDocumentExtractor;                                                                                                                      
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:200-260                     
                             ```                                                                                                                                                                                 
                             200:        try (CSVParser commonsParser = CSVParser.builder().setReader(reader).setFormat(csvFormat).get()) {                                                                      
                             201:            xhtmlContentHandler.startDocument();                                                                                                                                
                             202:            xhtmlContentHandler.startElement(TABLE);                                                                                                                            
                             203:            int firstRowColCount = 0;                                                                                                                                           
                             204:            try {                                                                                                                                                               
                             205:                for (CSVRecord row : commonsParser) {                                                                                                                           
                             206:                    xhtmlContentHandler.startElement(TR);                                                                                                                       
                             207:                    for (String cell : row) {                                                                                                                                   
                             208:                        if (totalRows == 0) {                                                                                                                                   
                             209:                            firstRowColCount++;                                                                                                                                 
                             210:                        }                                                                                                                                                       
                             211:                        processCell(cell, xhtmlContentHandler, metadata, context);                    }                                                                         
                             212:                    xhtmlContentHandler.endElement(TR);                                                                                                                         
                             213:                    if (totalRows == 0) {                                                                                                                                       
                             214:                        metadata.set(NUM_COLUMNS, firstRowColCount);                                                                                                            
                             215:                    }                                                                                                                                                           
                             216:                    totalRows++;                                                                                                                                                
                             217:                }                                                                                                                                                               
                             218:                metadata.set(NUM_ROWS, totalRows);                                                                                                                              
                             219:            } catch (UncheckedIOException e) {                                                                                                                                  
                             220:                if (e.getCause() != null && e.getCause().getMessage() != null &&                                                                                                
                             221:                        e.getCause().getMessage().contains("encapsulated")) {                                                                                                   
                             222:                    //if there's a parse exception                                                                                                                              
                             223:                    //try to get the rest of the content...treat it as text for now                                                                                             
                             224:                    //There will be some content lost because of buffering.                                                                                                     
                             225:                    //TODO -- figure out how to improve this                                                                                                                    
                             226:                    xhtmlContentHandler.endElement(TABLE);                                                                                                                      
                             227:                    xhtmlContentHandler.startElement("div", "name", "after exception");                                                                                         
                             228:                    handleText(reader, xhtmlContentHandler);                                                                                                                    
                             229:                    xhtmlContentHandler.endElement("div");                                                                                                                      
                             230:                    xhtmlContentHandler.endDocument();                                                                                                                          
                             231:                    //TODO -- consider dumping what's left in the reader as text                                                                                                
                             232:                    throw new TikaException("exception parsing the csv", e);                                                                                                    
                             233:                } else {                                                                                                                                                        
                             234:                    if (e.getCause() != null) {                                                                                                                                 
                             235:                        throw new TikaException("exception parsing the csv", e.getCause());                                                                                     
                             236:                    } else {                                                                                                                                                    
                             237:                        throw new TikaException("exception parsing the csv", e);                                                                                                
                             238:                    }                                                                                                                                                           
                             239:                }                                                                                                                                                               
                             240:            }                                                                                                                                                                   
                             241:                                                                                                                                                                                
                             242:            xhtmlContentHandler.endElement(TABLE);                                                                                                                              
                             243:            xhtmlContentHandler.endDocument();                                                                                                                                  
                             244:        }                                                                                                                                                                       
                             245:    }                                                                                                                                                                           
                             246:                                                                                                                                                                                
                             247:    private void processCell(String cellContent, XHTMLContentHandler xhtml,                                                                                                     
                             248:                             Metadata metadata,                                                                                                                                 
                             249:                             ParseContext context) throws IOException, SAXException {                                                                                           
                             250:        xhtml.startElement(TD);                                                                                                                                                 
                             251:        Matcher m = HYPERLINK_PATTERN.matcher(cellContent);                                                                                                                     
                             252:        if (m.find()) {                                                                                                                                                         
                             253:            String url = m.group(1);                                                                                                                                            
                             254:            String name = m.group(2);                                                                                                                                           
                             255:            if (StringUtils.isBlank(name)) {                                                                                                                                    
                             256:                name = url;                                                                                                                                                     
                             257:            }                                                                                                                                                                   
                             258:            xhtml.startElement("a", "href", url);                                                                                                                               
                             259:            xhtml.characters(name);                                                                                                                                             
                             260:            xhtml.endElement("a");                                                                                                                                              
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:260-310                     
                             ```                                                                                                                                                                                 
                             260:            xhtml.endElement("a");                                                                                                                                              
                             261:            processURL(url, name, xhtml, metadata, context);                                                                                                                    
                             262:        } else {                                                                                                                                                                
                             263:            xhtml.characters(cellContent);                                                                                                                                      
                             264:        }                                                                                                                                                                       
                             265:        xhtml.endElement(TD);                                                                                                                                                   
                             266:    }                                                                                                                                                                           
                             267:                                                                                                                                                                                
                             268:    private void processURL(String urlString, String name, XHTMLContentHandler xhtml,                                                                                           
                             269:                            Metadata parentMetadata,                                                                                                                            
                             270:                            ParseContext context) throws IOException, SAXException {                                                                                            
                             271:        EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);                                                                              
                             272:        Metadata metadata = new Metadata();                                                                                                                                     
                             273:        metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);                                                                                                               
                             274:        try {                                                                                                                                                                   
                             275:            URL url = new URL(urlString);                                                                                                                                       
                             276:            URLConnection connection = url.openConnection();                                                                                                                    
                             277:            connection.setConnectTimeout(5000);                                                                                                                                 
                             278:            try (TikaInputStream tis = TikaInputStream.get(connection.getInputStream())) {                                                                                      
                             279:                ex.parseEmbedded(tis, xhtml, metadata, false);                                                                                                                  
                             280:            }                                                                                                                                                                   
                             281:        } catch (Exception e) {                                                                                                                                                 
                             282:            parentMetadata.set(TikaCoreProperties.EMBEDDED_EXCEPTION,                                                                                                           
                             283:                    ExceptionUtils.getStackTrace(e));                                                                                                                           
                             284:        }                                                                                                                                                                       
                             285:    }                                                                                                                                                                           
                             286:                                                                                                                                                                                
                             287:                                                                                                                                                                                
                             288:    private void handleText(Reader reader, Charset charset, ContentHandler handler,                                                                                             
                             289:                            Metadata metadata) throws SAXException, IOException, TikaException {                                                                                
                             290:        // Automatically detect the character encoding                                                                                                                          
                             291:        //try to get detected content type; could be a subclass of text/plain                                                                                                   
                             292:        //such as vcal, etc.                                                                                                                                                    
                             293:        String incomingMime = metadata.get(Metadata.CONTENT_TYPE);                                                                                                              
                             294:        MediaType mediaType = MediaType.TEXT_PLAIN;                                                                                                                             
                             295:        if (incomingMime != null) {                                                                                                                                             
                             296:            MediaType tmpMediaType = MediaType.parse(incomingMime);                                                                                                             
                             297:            if (tmpMediaType != null) {                                                                                                                                         
                             298:                mediaType = tmpMediaType;                                                                                                                                       
                             299:            }                                                                                                                                                                   
                             300:        }                                                                                                                                                                       
                             301:        MediaType type = new MediaType(mediaType, charset);                                                                                                                     
                             302:        metadata.set(Metadata.CONTENT_TYPE, type.toString());                                                                                                                   
                             303:        // deprecated, see TIKA-431                                                                                                                                             
                             304:        metadata.set(Metadata.CONTENT_ENCODING, charset.name());                                                                                                                
                             305:                                                                                                                                                                                
                             306:        XHTMLContentHandler xhtml = new XHTMLContentHandler(handler, metadata);                                                                                                 
                             307:        xhtml.startDocument();                                                                                                                                                  
                             308:        handleText(reader, xhtml);                                                                                                                                              
                             309:        xhtml.endDocument();                                                                                                                                                    
                             310:    }                                                                                                                                                                           
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:310-370                     
                             ```                                                                                                                                                                                 
                             310:    }                                                                                                                                                                           
                             311:                                                                                                                                                                                
                             312:    private Reader detect(CSVParams params, TextAndCSVConfig textAndCSVConfig, InputStream stream, Metadata metadata,                                                           
                             313:                          ParseContext context) throws IOException, TikaException {                                                                                             
                             314:        //if the file was already identified as not .txt, .csv or .tsv                                                                                                          
                             315:        //don't even try to csv or not                                                                                                                                          
                             316:        String mediaString = metadata.get(Metadata.CONTENT_TYPE);                                                                                                               
                             317:        if (mediaString != null) {                                                                                                                                              
                             318:            MediaType mediaType = MediaType.parse(mediaString);                                                                                                                 
                             319:            if (!SUPPORTED_TYPES.contains(mediaType.getBaseType())) {                                                                                                           
                             320:                params.setMediaType(mediaType);                                                                                                                                 
                             321:                return new AutoDetectReader(CloseShieldInputStream.wrap(stream), metadata,                                                                                      
                             322:                        getEncodingDetector(context));                                                                                                                          
                             323:            }                                                                                                                                                                   
                             324:        }                                                                                                                                                                       
                             325:        Reader reader;                                                                                                                                                          
                             326:        if (params.getCharset() == null) {                                                                                                                                      
                             327:            reader = new AutoDetectReader(CloseShieldInputStream.wrap(stream), metadata,                                                                                        
                             328:                    getEncodingDetector(context));                                                                                                                              
                             329:            params.setCharset(((AutoDetectReader) reader).getCharset());                                                                                                        
                             330:            if (params.isComplete()) {                                                                                                                                          
                             331:                return reader;                                                                                                                                                  
                             332:            }                                                                                                                                                                   
                             333:        } else {                                                                                                                                                                
                             334:            reader = new BufferedReader(                                                                                                                                        
                             335:                    new InputStreamReader(CloseShieldInputStream.wrap(stream), params.getCharset()));                                                                           
                             336:        }                                                                                                                                                                       
                             337:                                                                                                                                                                                
                             338:        if (params.getDelimiter() == null &&                                                                                                                                    
                             339:                (params.getMediaType() == null || isCSVOrTSV(params.getMediaType()))) {                                                                                         
                             340:                                                                                                                                                                                
                             341:            CSVSniffer sniffer = new CSVSniffer(markLimit, textAndCSVConfig.getDelimiterToNameMap().keySet(), minConfidence);                                                   
                             342:            CSVResult result = sniffer.getBest(reader, metadata);                                                                                                               
                             343:            params.setMediaType(result.getMediaType());                                                                                                                         
                             344:            params.setDelimiter(result.getDelimiter());                                                                                                                         
                             345:        }                                                                                                                                                                       
                             346:        return reader;                                                                                                                                                          
                             347:    }                                                                                                                                                                           
                             348:                                                                                                                                                                                
                             349:    private CSVParams getOverride(Metadata metadata, TextAndCSVConfig textAndCSVConfig) {                                                                                       
                             350:        String override = metadata.get(TikaCoreProperties.CONTENT_TYPE_USER_OVERRIDE);                                                                                          
                             351:        if (override == null) {                                                                                                                                                 
                             352:            return new CSVParams();                                                                                                                                             
                             353:        }                                                                                                                                                                       
                             354:        MediaType mediaType = MediaType.parse(override);                                                                                                                        
                             355:        if (mediaType == null) {                                                                                                                                                
                             356:            return new CSVParams();                                                                                                                                             
                             357:        }                                                                                                                                                                       
                             358:        String charsetString = mediaType.getParameters().get(CHARSET);                                                                                                          
                             359:        Charset charset = null;                                                                                                                                                 
                             360:        if (charsetString != null) {                                                                                                                                            
                             361:            try {                                                                                                                                                               
                             362:                charset = Charset.forName(charsetString);                                                                                                                       
                             363:            } catch (UnsupportedCharsetException e) {                                                                                                                           
                             364:                //swallow                                                                                                                                                       
                             365:            }                                                                                                                                                                   
                             366:        }                                                                                                                                                                       
                             367:        if (!isCSVOrTSV(mediaType)) {                                                                                                                                           
                             368:            return new CSVParams(mediaType, charset);                                                                                                                           
                             369:        }                                                                                                                                                                       
                             370:                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:100-120                     
                             ```                                                                                                                                                                                 
                             100:     */                                                                                                                                                                         
                             101:    public static final Property NUM_ROWS = Property.externalInteger(                                                                                                           
                             102:            CSV_PREFIX + TikaCoreProperties.NAMESPACE_PREFIX_DELIMITER + "num_rows");                                                                                           
                             103:                                                                                                                                                                                
                             104:    private static final Pattern HYPERLINK_PATTERN =                                                                                                                            
                             105:            Pattern.compile("(?i)[\"]*=HYPERLINK\\([\"]+([^\"]+)(?:[\" ]+,[ \"]+([^\"]+))?");                                                                                   
                             106:                                                                                                                                                                                
                             107:    private static final String TD = "td";                                                                                                                                      
                             108:    private static final String TR = "tr";                                                                                                                                      
                             109:    private static final String TABLE = "table";                                                                                                                                
                             110:    private static final int DEFAULT_MARK_LIMIT = 20000;                                                                                                                        
                             111:                                                                                                                                                                                
                             112:    private static final Set<MediaType> SUPPORTED_TYPES = Collections                                                                                                           
                             113:            .unmodifiableSet(new HashSet<>(Arrays.asList(CSV, TSV, MediaType.TEXT_PLAIN)));                                                                                     
                             114:                                                                                                                                                                                
                             115:    /**                                                                                                                                                                         
                             116:     * This is the mark limit in characters (not bytes) to                                                                                                                      
                             117:     * read from the stream when classifying the stream as                                                                                                                      
                             118:     * csv, tsv or txt.                                                                                                                                                         
                             119:     */                                                                                                                                                                         
                             120:    @Field                                                                                                                                                                      
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:121-160                     
                             ```                                                                                                                                                                                 
                             121:    private int markLimit = DEFAULT_MARK_LIMIT;                                                                                                                                 
                             122:                                                                                                                                                                                
                             123:                                                                                                                                                                                
                             124:    /**                                                                                                                                                                         
                             125:     * minimum confidence score that there's enough                                                                                                                             
                             126:     * evidence to determine csv/tsv vs. txt                                                                                                                                    
                             127:     */                                                                                                                                                                         
                             128:    @Field                                                                                                                                                                      
                             129:    private double minConfidence = 0.50;                                                                                                                                        
                             130:                                                                                                                                                                                
                             131:    public TextAndCSVParser() {                                                                                                                                                 
                             132:    }                                                                                                                                                                           
                             133:                                                                                                                                                                                
                             134:    public TextAndCSVParser(EncodingDetector encodingDetector) {                                                                                                                
                             135:        super(encodingDetector);                                                                                                                                                
                             136:    }                                                                                                                                                                           
                             137:                                                                                                                                                                                
                             138:    private static void handleText(Reader reader, XHTMLContentHandler xhtml)                                                                                                    
                             139:            throws SAXException, IOException {                                                                                                                                  
                             140:        xhtml.startElement("p");                                                                                                                                                
                             141:        char[] buffer = new char[4096];                                                                                                                                         
                             142:        int n = reader.read(buffer);                                                                                                                                            
                             143:        while (n != -1) {                                                                                                                                                       
                             144:            xhtml.characters(buffer, 0, n);                                                                                                                                     
                             145:            n = reader.read(buffer);                                                                                                                                            
                             146:        }                                                                                                                                                                       
                             147:        xhtml.endElement("p");                                                                                                                                                  
                             148:                                                                                                                                                                                
                             149:    }                                                                                                                                                                           
                             150:                                                                                                                                                                                
                             151:    static boolean isCSVOrTSV(MediaType mediaType) {                                                                                                                            
                             152:        if (mediaType == null) {                                                                                                                                                
                             153:            return false;                                                                                                                                                       
                             154:        }                                                                                                                                                                       
                             155:        return mediaType.getBaseType().equals(TSV) || mediaType.getBaseType().equals(CSV);                                                                                      
                             156:    }                                                                                                                                                                           
                             157:                                                                                                                                                                                
                             158:    private final TextAndCSVConfig defaultTextAndCSVConfig = new TextAndCSVConfig();                                                                                            
                             159:    @Override                                                                                                                                                                   
                             160:    public Set<MediaType> getSupportedTypes(ParseContext context) {                                                                                                             
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:160-246                     
                             ```                                                                                                                                                                                 
                             160:    public Set<MediaType> getSupportedTypes(ParseContext context) {                                                                                                             
                             161:        return SUPPORTED_TYPES;                                                                                                                                                 
                             162:    }                                                                                                                                                                           
                             163:                                                                                                                                                                                
                             164:    @Override                                                                                                                                                                   
                             165:    public void parse(InputStream stream, ContentHandler handler, Metadata metadata,                                                                                            
                             166:                      ParseContext context) throws IOException, SAXException, TikaException {                                                                                   
                             167:        TextAndCSVConfig textAndCSVConfig = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);                                                                       
                             168:                                                                                                                                                                                
                             169:        CSVParams params = getOverride(metadata, textAndCSVConfig);                                                                                                             
                             170:        Reader reader;                                                                                                                                                          
                             171:        Charset charset;                                                                                                                                                        
                             172:        if (!params.isComplete()) {                                                                                                                                             
                             173:            reader = detect(params, textAndCSVConfig, stream, metadata, context);                                                                                               
                             174:            if (params.getCharset() != null) {                                                                                                                                  
                             175:                charset = params.getCharset();                                                                                                                                  
                             176:            } else {                                                                                                                                                            
                             177:                charset = ((AutoDetectReader) reader).getCharset();                                                                                                             
                             178:            }                                                                                                                                                                   
                             179:        } else {                                                                                                                                                                
                             180:            reader = new BufferedReader(new InputStreamReader(stream, params.getCharset()));                                                                                    
                             181:            charset = params.getCharset();                                                                                                                                      
                             182:        }                                                                                                                                                                       
                             183:                                                                                                                                                                                
                             184:        updateMetadata(params, metadata, textAndCSVConfig);                                                                                                                     
                             185:                                                                                                                                                                                
                             186:        //if text or a non-csv/tsv category of text                                                                                                                             
                             187:        //treat this as text and be done                                                                                                                                        
                             188:        //TODO -- if it was detected as a non-csv subtype of text                                                                                                               
                             189:        if (!params.getMediaType().getBaseType().equals(CSV) &&                                                                                                                 
                             190:                !params.getMediaType().getBaseType().equals(TSV)) {                                                                                                             
                             191:            handleText(reader, charset, handler, metadata);                                                                                                                     
                             192:            return;                                                                                                                                                             
                             193:        }                                                                                                                                                                       
                             194:                                                                                                                                                                                
                             195:        CSVFormat csvFormat = CSVFormat.EXCEL.builder().setDelimiter(params.getDelimiter()).get();                                                                              
                             196:        metadata.set(DELIMITER_PROPERTY, textAndCSVConfig.getDelimiterToNameMap().get(csvFormat.getDelimiterString().charAt(0)));                                               
                             197:                                                                                                                                                                                
                             198:        XHTMLContentHandler xhtmlContentHandler = new XHTMLContentHandler(handler, metadata);                                                                                   
                             199:        int totalRows = 0;                                                                                                                                                      
                             200:        try (CSVParser commonsParser = CSVParser.builder().setReader(reader).setFormat(csvFormat).get()) {                                                                      
                             201:            xhtmlContentHandler.startDocument();                                                                                                                                
                             202:            xhtmlContentHandler.startElement(TABLE);                                                                                                                            
                             203:            int firstRowColCount = 0;                                                                                                                                           
                             204:            try {                                                                                                                                                               
                             205:                for (CSVRecord row : commonsParser) {                                                                                                                           
                             206:                    xhtmlContentHandler.startElement(TR);                                                                                                                       
                             207:                    for (String cell : row) {                                                                                                                                   
                             208:                        if (totalRows == 0) {                                                                                                                                   
                             209:                            firstRowColCount++;                                                                                                                                 
                             210:                        }                                                                                                                                                       
                             211:                        processCell(cell, xhtmlContentHandler, metadata, context);                    }                                                                         
                             212:                    xhtmlContentHandler.endElement(TR);                                                                                                                         
                             213:                    if (totalRows == 0) {                                                                                                                                       
                             214:                        metadata.set(NUM_COLUMNS, firstRowColCount);                                                                                                            
                             215:                    }                                                                                                                                                           
                             216:                    totalRows++;                                                                                                                                                
                             217:                }                                                                                                                                                               
                             218:                metadata.set(NUM_ROWS, totalRows);                                                                                                                              
                             219:            } catch (UncheckedIOException e) {                                                                                                                                  
                             220:                if (e.getCause() != null && e.getCause().getMessage() != null &&                                                                                                
                             221:                        e.getCause().getMessage().contains("encapsulated")) {                                                                                                   
                             222:                    //if there's a parse exception                                                                                                                              
                             223:                    //try to get the rest of the content...treat it as text for now                                                                                             
                             224:                    //There will be some content lost because of buffering.                                                                                                     
                             225:                    //TODO -- figure out how to improve this                                                                                                                    
                             226:                    xhtmlContentHandler.endElement(TABLE);                                                                                                                      
                             227:                    xhtmlContentHandler.startElement("div", "name", "after exception");                                                                                         
                             228:                    handleText(reader, xhtmlContentHandler);                                                                                                                    
                             229:                    xhtmlContentHandler.endElement("div");                                                                                                                      
                             230:                    xhtmlContentHandler.endDocument();                                                                                                                          
                             231:                    //TODO -- consider dumping what's left in the reader as text                                                                                                
                             232:                    throw new TikaException("exception parsing the csv", e);                                                                                                    
                             233:                } else {                                                                                                                                                        
                             234:                    if (e.getCause() != null) {                                                                                                                                 
                             235:                        throw new TikaException("exception parsing the csv", e.getCause());                                                                                     
                             236:                    } else {                                                                                                                                                    
                             237:                        throw new TikaException("exception parsing the csv", e);                                                                                                
                             238:                    }                                                                                                                                                           
                             239:                }                                                                                                                                                               
                             240:            }                                                                                                                                                                   
                             241:                                                                                                                                                                                
                             242:            xhtmlContentHandler.endElement(TABLE);                                                                                                                              
                             243:            xhtmlContentHandler.endDocument();                                                                                                                                  
                             244:        }                                                                                                                                                                       
                             245:    }                                                                                                                                                                           
                             246:                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:158-162                     
                             ```                                                                                                                                                                                 
                             158:    private final TextAndCSVConfig defaultTextAndCSVConfig = new TextAndCSVConfig();                                                                                            
                             159:    @Override                                                                                                                                                                   
                             160:    public Set<MediaType> getSupportedTypes(ParseContext context) {                                                                                                             
                             161:        return SUPPORTED_TYPES;                                                                                                                                                 
                             162:    }                                                                                                                                                                           
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java:1-58                        
                             ```                                                                                                                                                                                 
                             1:/*                                                                                                                                                                                
                             2: * Licensed to the Apache Software Foundation (ASF) under one or more                                                                                                             
                             3: * contributor license agreements.  See the NOTICE file distributed with                                                                                                          
                             4: * this work for additional information regarding copyright ownership.                                                                                                            
                             5: * The ASF licenses this file to You under the Apache License, Version 2.0                                                                                                        
                             6: * (the "License"); you may not use this file except in compliance with                                                                                                           
                             7: * the License.  You may obtain a copy of the License at                                                                                                                          
                             8: *                                                                                                                                                                                
                             9: *      http://www.apache.org/licenses/LICENSE-2.0                                                                                                                                
                             10: *                                                                                                                                                                               
                             11: * Unless required by applicable law or agreed to in writing, software                                                                                                           
                             12: * distributed under the License is distributed on an "AS IS" BASIS,                                                                                                             
                             13: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                                                                                      
                             14: * See the License for the specific language governing permissions and                                                                                                           
                             15: * limitations under the License.                                                                                                                                                
                             16: */                                                                                                                                                                              
                             17:package org.apache.tika.parser.csv;                                                                                                                                              
                             18:                                                                                                                                                                                 
                             19:import java.io.Serializable;                                                                                                                                                     
                             20:import java.util.HashMap;                                                                                                                                                        
                             21:import java.util.Map;                                                                                                                                                            
                             22:                                                                                                                                                                                 
                             23:public class TextAndCSVConfig implements Serializable {                                                                                                                          
                             24:                                                                                                                                                                                 
                             25:    private static final Map<Character, String> DELIMITER_TO_NAME_MAP = new HashMap<>();                                                                                         
                             26:    private static final Map<String, Character> NAME_TO_DELIMITER_MAP = new HashMap<>();                                                                                         
                             27:                                                                                                                                                                                 
                             28:    static {                                                                                                                                                                     
                             29:        DELIMITER_TO_NAME_MAP.put(',', "comma");                                                                                                                                 
                             30:        DELIMITER_TO_NAME_MAP.put('\t', "tab");                                                                                                                                  
                             31:        DELIMITER_TO_NAME_MAP.put('|', "pipe");                                                                                                                                  
                             32:        DELIMITER_TO_NAME_MAP.put(';', "semicolon");                                                                                                                             
                             33:    }                                                                                                                                                                            
                             34:                                                                                                                                                                                 
                             35:    static {                                                                                                                                                                     
                             36:        for (Map.Entry<Character, String> e : DELIMITER_TO_NAME_MAP.entrySet()) {                                                                                                
                             37:            NAME_TO_DELIMITER_MAP.put(e.getValue(), e.getKey());                                                                                                                 
                             38:        }                                                                                                                                                                        
                             39:    }                                                                                                                                                                            
                             40:                                                                                                                                                                                 
                             41:    private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;                                                                                                   
                             42:    private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;                                                                                                   
                             43:                                                                                                                                                                                 
                             44:    public Map<String, Character> getNameToDelimiterMap() {                                                                                                                      
                             45:        return nameToDelimiterMap;                                                                                                                                               
                             46:    }                                                                                                                                                                            
                             47:                                                                                                                                                                                 
                             48:    public Map<Character, String> getDelimiterToNameMap() {                                                                                                                      
                             49:        return delimiterToNameMap;                                                                                                                                               
                             50:    }                                                                                                                                                                            
                             51:                                                                                                                                                                                 
                             52:    public void setNameToDelimiterMap(Map<String, Character> nameToDelimiterMap) {                                                                                               
                             53:        this.nameToDelimiterMap = new HashMap<>(nameToDelimiterMap);                                                                                                             
                             54:        this.delimiterToNameMap = new HashMap<>();                                                                                                                               
                             55:        nameToDelimiterMap.entrySet()                                                                                                                                            
                             56:                          .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));                                                                                       
                             57:    }                                                                                                                                                                            
                             58:}                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java:1-58                        
                             ```                                                                                                                                                                                 
                             1:/*                                                                                                                                                                                
                             2: * Licensed to the Apache Software Foundation (ASF) under one or more                                                                                                             
                             3: * contributor license agreements.  See the NOTICE file distributed with                                                                                                          
                             4: * this work for additional information regarding copyright ownership.                                                                                                            
                             5: * The ASF licenses this file to You under the Apache License, Version 2.0                                                                                                        
                             6: * (the "License"); you may not use this file except in compliance with                                                                                                           
                             7: * the License.  You may obtain a copy of the License at                                                                                                                          
                             8: *                                                                                                                                                                                
                             9: *      http://www.apache.org/licenses/LICENSE-2.0                                                                                                                                
                             10: *                                                                                                                                                                               
                             11: * Unless required by applicable law or agreed to in writing, software                                                                                                           
                             12: * distributed under the License is distributed on an "AS IS" BASIS,                                                                                                             
                             13: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                                                                                      
                             14: * See the License for the specific language governing permissions and                                                                                                           
                             15: * limitations under the License.                                                                                                                                                
                             16: */                                                                                                                                                                              
                             17:package org.apache.tika.parser.csv;                                                                                                                                              
                             18:                                                                                                                                                                                 
                             19:import java.io.Serializable;                                                                                                                                                     
                             20:import java.util.HashMap;                                                                                                                                                        
                             21:import java.util.Map;                                                                                                                                                            
                             22:                                                                                                                                                                                 
                             23:public class TextAndCSVConfig implements Serializable {                                                                                                                          
                             24:                                                                                                                                                                                 
                             25:    private static final Map<Character, String> DELIMITER_TO_NAME_MAP = new HashMap<>();                                                                                         
                             26:    private static final Map<String, Character> NAME_TO_DELIMITER_MAP = new HashMap<>();                                                                                         
                             27:                                                                                                                                                                                 
                             28:    static {                                                                                                                                                                     
                             29:        DELIMITER_TO_NAME_MAP.put(',', "comma");                                                                                                                                 
                             30:        DELIMITER_TO_NAME_MAP.put('\t', "tab");                                                                                                                                  
                             31:        DELIMITER_TO_NAME_MAP.put('|', "pipe");                                                                                                                                  
                             32:        DELIMITER_TO_NAME_MAP.put(';', "semicolon");                                                                                                                             
                             33:    }                                                                                                                                                                            
                             34:                                                                                                                                                                                 
                             35:    static {                                                                                                                                                                     
                             36:        for (Map.Entry<Character, String> e : DELIMITER_TO_NAME_MAP.entrySet()) {                                                                                                
                             37:            NAME_TO_DELIMITER_MAP.put(e.getValue(), e.getKey());                                                                                                                 
                             38:        }                                                                                                                                                                        
                             39:    }                                                                                                                                                                            
                             40:                                                                                                                                                                                 
                             41:    private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;                                                                                                   
                             42:    private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;                                                                                                   
                             43:                                                                                                                                                                                 
                             44:    public Map<String, Character> getNameToDelimiterMap() {                                                                                                                      
                             45:        return nameToDelimiterMap;                                                                                                                                               
                             46:    }                                                                                                                                                                            
                             47:                                                                                                                                                                                 
                             48:    public Map<Character, String> getDelimiterToNameMap() {                                                                                                                      
                             49:        return delimiterToNameMap;                                                                                                                                               
                             50:    }                                                                                                                                                                            
                             51:                                                                                                                                                                                 
                             52:    public void setNameToDelimiterMap(Map<String, Character> nameToDelimiterMap) {                                                                                               
                             53:        this.nameToDelimiterMap = new HashMap<>(nameToDelimiterMap);                                                                                                             
                             54:        this.delimiterToNameMap = new HashMap<>();                                                                                                                               
                             55:        nameToDelimiterMap.entrySet()                                                                                                                                            
                             56:                          .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));                                                                                       
                             57:    }                                                                                                                                                                            
                             58:}                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:104-106                     
                             ```                                                                                                                                                                                 
                             104:    private static final Pattern HYPERLINK_PATTERN =                                                                                                                            
                             105:            Pattern.compile("(?i)[\"]*=HYPERLINK\\([\"]+([^\"]+)(?:[\" ]+,[ \"]+([^\"]+))?");                                                                                   
                             106:                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:165-175                     
                             ```                                                                                                                                                                                 
                             165:    public void parse(InputStream stream, ContentHandler handler, Metadata metadata,                                                                                            
                             166:                      ParseContext context) throws IOException, SAXException, TikaException {                                                                                   
                             167:        TextAndCSVConfig textAndCSVConfig = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);                                                                       
                             168:                                                                                                                                                                                
                             169:        CSVParams params = getOverride(metadata, textAndCSVConfig);                                                                                                             
                             170:        Reader reader;                                                                                                                                                          
                             171:        Charset charset;                                                                                                                                                        
                             172:        if (!params.isComplete()) {                                                                                                                                             
                             173:            reader = detect(params, textAndCSVConfig, stream, metadata, context);                                                                                               
                             174:            if (params.getCharset() != null) {                                                                                                                                  
                             175:                charset = params.getCharset();                                                                                                                                  
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:247-266                     
                             ```                                                                                                                                                                                 
                             247:    private void processCell(String cellContent, XHTMLContentHandler xhtml,                                                                                                     
                             248:                             Metadata metadata,                                                                                                                                 
                             249:                             ParseContext context) throws IOException, SAXException {                                                                                           
                             250:        xhtml.startElement(TD);                                                                                                                                                 
                             251:        Matcher m = HYPERLINK_PATTERN.matcher(cellContent);                                                                                                                     
                             252:        if (m.find()) {                                                                                                                                                         
                             253:            String url = m.group(1);                                                                                                                                            
                             254:            String name = m.group(2);                                                                                                                                           
                             255:            if (StringUtils.isBlank(name)) {                                                                                                                                    
                             256:                name = url;                                                                                                                                                     
                             257:            }                                                                                                                                                                   
                             258:            xhtml.startElement("a", "href", url);                                                                                                                               
                             259:            xhtml.characters(name);                                                                                                                                             
                             260:            xhtml.endElement("a");                                                                                                                                              
                             261:            processURL(url, name, xhtml, metadata, context);                                                                                                                    
                             262:        } else {                                                                                                                                                                
                             263:            xhtml.characters(cellContent);                                                                                                                                      
                             264:        }                                                                                                                                                                       
                             265:        xhtml.endElement(TD);                                                                                                                                                   
                             266:    }                                                                                                                                                                           
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java:268-285                     
                             ```                                                                                                                                                                                 
                             268:    private void processURL(String urlString, String name, XHTMLContentHandler xhtml,                                                                                           
                             269:                            Metadata parentMetadata,                                                                                                                            
                             270:                            ParseContext context) throws IOException, SAXException {                                                                                            
                             271:        EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);                                                                              
                             272:        Metadata metadata = new Metadata();                                                                                                                                     
                             273:        metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);                                                                                                               
                             274:        try {                                                                                                                                                                   
                             275:            URL url = new URL(urlString);                                                                                                                                       
                             276:            URLConnection connection = url.openConnection();                                                                                                                    
                             277:            connection.setConnectTimeout(5000);                                                                                                                                 
                             278:            try (TikaInputStream tis = TikaInputStream.get(connection.getInputStream())) {                                                                                      
                             279:                ex.parseEmbedded(tis, xhtml, metadata, false);                                                                                                                  
                             280:            }                                                                                                                                                                   
                             281:        } catch (Exception e) {                                                                                                                                                 
                             282:            parentMetadata.set(TikaCoreProperties.EMBEDDED_EXCEPTION,                                                                                                           
                             283:                    ExceptionUtils.getStackTrace(e));                                                                                                                           
                             284:        }                                                                                                                                                                       
                             285:    }                                                                                                                                                                           
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java:1-58                        
                             ```                                                                                                                                                                                 
                             1:/*                                                                                                                                                                                
                             2: * Licensed to the Apache Software Foundation (ASF) under one or more                                                                                                             
                             3: * contributor license agreements.  See the NOTICE file distributed with                                                                                                          
                             4: * this work for additional information regarding copyright ownership.                                                                                                            
                             5: * The ASF licenses this file to You under the Apache License, Version 2.0                                                                                                        
                             6: * (the "License"); you may not use this file except in compliance with                                                                                                           
                             7: * the License.  You may obtain a copy of the License at                                                                                                                          
                             8: *                                                                                                                                                                                
                             9: *      http://www.apache.org/licenses/LICENSE-2.0                                                                                                                                
                             10: *                                                                                                                                                                               
                             11: * Unless required by applicable law or agreed to in writing, software                                                                                                           
                             12: * distributed under the License is distributed on an "AS IS" BASIS,                                                                                                             
                             13: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.                                                                                                      
                             14: * See the License for the specific language governing permissions and                                                                                                           
                             15: * limitations under the License.                                                                                                                                                
                             16: */                                                                                                                                                                              
                             17:package org.apache.tika.parser.csv;                                                                                                                                              
                             18:                                                                                                                                                                                 
                             19:import java.io.Serializable;                                                                                                                                                     
                             20:import java.util.HashMap;                                                                                                                                                        
                             21:import java.util.Map;                                                                                                                                                            
                             22:                                                                                                                                                                                 
                             23:public class TextAndCSVConfig implements Serializable {                                                                                                                          
                             24:                                                                                                                                                                                 
                             25:    private static final Map<Character, String> DELIMITER_TO_NAME_MAP = new HashMap<>();                                                                                         
                             26:    private static final Map<String, Character> NAME_TO_DELIMITER_MAP = new HashMap<>();                                                                                         
                             27:                                                                                                                                                                                 
                             28:    static {                                                                                                                                                                     
                             29:        DELIMITER_TO_NAME_MAP.put(',', "comma");                                                                                                                                 
                             30:        DELIMITER_TO_NAME_MAP.put('\t', "tab");                                                                                                                                  
                             31:        DELIMITER_TO_NAME_MAP.put('|', "pipe");                                                                                                                                  
                             32:        DELIMITER_TO_NAME_MAP.put(';', "semicolon");                                                                                                                             
                             33:    }                                                                                                                                                                            
                             34:                                                                                                                                                                                 
                             35:    static {                                                                                                                                                                     
                             36:        for (Map.Entry<Character, String> e : DELIMITER_TO_NAME_MAP.entrySet()) {                                                                                                
                             37:            NAME_TO_DELIMITER_MAP.put(e.getValue(), e.getKey());                                                                                                                 
                             38:        }                                                                                                                                                                        
                             39:    }                                                                                                                                                                            
                             40:                                                                                                                                                                                 
                             41:    private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;                                                                                                   
                             42:    private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;                                                                                                   
                             43:                                                                                                                                                                                 
                             44:    public Map<String, Character> getNameToDelimiterMap() {                                                                                                                      
                             45:        return nameToDelimiterMap;                                                                                                                                               
                             46:    }                                                                                                                                                                            
                             47:                                                                                                                                                                                 
                             48:    public Map<Character, String> getDelimiterToNameMap() {                                                                                                                      
                             49:        return delimiterToNameMap;                                                                                                                                               
                             50:    }                                                                                                                                                                            
                             51:                                                                                                                                                                                 
                             52:    public void setNameToDelimiterMap(Map<String, Character> nameToDelimiterMap) {                                                                                               
                             53:        this.nameToDelimiterMap = new HashMap<>(nameToDelimiterMap);                                                                                                             
                             54:        this.delimiterToNameMap = new HashMap<>();                                                                                                                               
                             55:        nameToDelimiterMap.entrySet()                                                                                                                                            
                             56:                          .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));                                                                                       
                             57:    }                                                                                                                                                                            
                             58:}                                                                                                                                                                                
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             </code_snippets>                                                                                                                                                                    
                                                                                                                                                                                                                 
                             ## Fix Strategy                                                                                                                                                                     
                             <fix_strategy>                                                                                                                                                                      
                                                                                                                                                                                                                 
                             </fix_strategy>                                                                                                                                                                     
                             ===Tests Result===                                                                                                                                                                  
                             No tests found                                                                                                                                                                      
                             ===Evaluation End===                                                                                                                                                                
                    INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                                                                                                      __init__.py:160
                             (n evals: 2, patch status: PatchStatus.SOUND)                                                                                                                                       
                    INFO     Building environment                                                                                                                                                 __init__.py:132
                             - Cache directory: /tmp/tmp0zrdftgv                                                                                                                                                 
                             - Max timeout: 1800                                                                                                                                                                 
                             - Output directory: reports/prism.prism_o4_mini/tika_tk-full-01_vuln_7/agent-output-1761610775.3988972                                                                              
                             - Detection toml file: /tasks_new/tika_tk-full-01/detection/tika_tk-full-01_vuln_7.toml                                                                                             
                             - Challenge project directory: /tasks_new/tika_tk-full-01/official-afc-tika                                                                                                         
                                                                                                                                                                                                                 
