[10/27/25 22:08:03] INFO     Building environment                                                                                                                                                 __init__.py:132
                             - Cache directory: /tmp/tmpi51864z8                                                                                                                                                 
                             - Max timeout: 1800                                                                                                                                                                 
                             - Output directory: reports/prism.prism_o4_mini/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3/agent-output-1761602883.2279048                                                 
                             - Detection toml file: /tasks_new/shadowsocks_shadowsocks-full-01/detection/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3.toml                                                
                             - Challenge project directory: /tasks_new/shadowsocks_shadowsocks-full-01/official-afc-shadowsocks-libev                                                                            
                                                                                                                                                                                                                 
                    INFO     [logging_performance](shadowsocks Building Cached for CLEAN environment) Started...                                                                            context_managers.py:9
[10/27/25 22:09:29] INFO     [logging_performance](shadowsocks Building Cached for CLEAN environment) Took 86.65 seconds; exception=False                                                  context_managers.py:23
                    INFO     [logging_performance](shadowsocks Running tests for Cached for CLEAN environment) Started...                                                                   context_managers.py:9
                    INFO     [logging_performance](shadowsocks Running tests for Cached for CLEAN environment) Took 0.00 seconds; exception=False                                          context_managers.py:23
                    INFO     Setting timeouts                                                                                                                                                       default.py:85
                               - build: 600 (original: 86)                                                                                                                                                       
                               - run tests: 600 (original: 0)                                                                                                                                                    
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
[10/27/25 22:09:30] INFO     [logging_performance](shadowsocks Setting owner) Took 0.80 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:09:31] INFO     Successfully created Cached for CLEAN environment                                                                                                                    oss_fuzz.py:256
                    INFO     Current environments: ['CLEAN -> Cached']                                                                                                                            oss_fuzz.py:265
                    INFO     Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                                                                                                    __init__.py:160
                             (n evals: 0, patch status: PatchStatus.INITIALIZED)                                                                                                                                 
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
                    INFO     [logging_performance](shadowsocks Setting owner) Took 0.88 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:09:32] INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
                    INFO     [logging_performance](shadowsocks Setting owner) Took 0.84 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:09:35] INFO     ===Evaluator Result===                                                                                                                                              evaluator.py:204
                             PatchStatus.VULNERABLE                                                                                                                                                              
                             ===Evaluator Diff===                                                                                                                                                                
                                                                                                                                                                                                                 
                             ===Patch Result===                                                                                                                                                                  
                             + FUZZER=json_fuzz                                                                                                                                                                  
                             + shift                                                                                                                                                                             
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                           
                             + TESTCASE=/testcase                                                                                                                                                                
                             + '[' '!' -f /testcase ']'                                                                                                                                                          
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                       
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                   
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                          
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                         
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                                                                                          
                             vm.mmap_rnd_bits = 28                                                                                                                                                               
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                   
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                             
                             INFO: Seed: 663520775                                                                                                                                                               
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x55fb7b9464b0, 0x55fb7b947179),                                                                                       
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x55fb7b947180,0x55fb7b953e10),                                                                                                          
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                                                                                  
                             Running: /testcase                                                                                                                                                                  
                             =================================================================                                                                                                                   
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x55fb7b7c95b0 bp 0x7ffc48bc8dd0 sp 0x7ffc48bc8dc8                                              
                             READ of size 1 at 0x5020000000b8 thread T0                                                                                                                                          
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                                                                                    
                                 #0 0x55fb7b7c95af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                                                                                           
                                 #1 0x55fb7b7ca7ac in json_parse /src/shadowsocks/src/json.c:958:11                                                                                                              
                                 #2 0x55fb7b7c3c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                                                                                               
                                 #3 0x55fb7b67aa80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                        
                                 #4 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #5 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #6 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #7 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                 #8 0x55fb7b65dedd in _start (/out/json_fuzz+0x5cedd)                                                                                                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                                                                                      
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                                                                                               
                             allocated by thread T0 here:                                                                                                                                                        
                                 #0 0x55fb7b78684f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                   
                                 #1 0x55fb7b89c223 in operator new(unsigned long) cxa_noexception.cpp                                                                                                            
                                 #2 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #3 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #4 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #5 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                                     
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in json_parse_ex                                                                                 
                             Shadow bytes around the buggy address:                                                                                                                                              
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                                                                                   
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                
                               Addressable:           00                                                                                                                                                         
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                       
                               Heap left redzone:       fa                                                                                                                                                       
                               Freed heap region:       fd                                                                                                                                                       
                               Stack left redzone:      f1                                                                                                                                                       
                               Stack mid redzone:       f2                                                                                                                                                       
                               Stack right redzone:     f3                                                                                                                                                       
                               Stack after return:      f5                                                                                                                                                       
                               Stack use after scope:   f8                                                                                                                                                       
                               Global redzone:          f9                                                                                                                                                       
                               Global init order:       f6                                                                                                                                                       
                               Poisoned by user:        f7                                                                                                                                                       
                               Container overflow:      fc                                                                                                                                                       
                               Array cookie:            ac                                                                                                                                                       
                               Intra object redzone:    bb                                                                                                                                                       
                               ASan internal:           fe                                                                                                                                                       
                               Left alloca redzone:     ca                                                                                                                                                       
                               Right alloca redzone:    cb                                                                                                                                                       
                             ==18==ABORTING                                                                                                                                                                      
                             subprocess command returned a non-zero exit status: 1                                                                                                                               
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v                                                
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v /tmp/tmpateze75u:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0                         
                             reproduce json_fuzz -runs=100.                                                                                                                                                      
                                                                                                                                                                                                                 
                             ===Issue===                                                                                                                                                                         
                             + FUZZER=json_fuzz                                                                                                                                                                  
                             + shift                                                                                                                                                                             
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                           
                             + TESTCASE=/testcase                                                                                                                                                                
                             + '[' '!' -f /testcase ']'                                                                                                                                                          
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                       
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                   
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                          
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                         
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                                                                                          
                             vm.mmap_rnd_bits = 28                                                                                                                                                               
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                   
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                             
                             INFO: Seed: 663520775                                                                                                                                                               
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x55fb7b9464b0, 0x55fb7b947179),                                                                                       
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x55fb7b947180,0x55fb7b953e10),                                                                                                          
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                                                                                  
                             Running: /testcase                                                                                                                                                                  
                             =================================================================                                                                                                                   
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x55fb7b7c95b0 bp 0x7ffc48bc8dd0 sp 0x7ffc48bc8dc8                                              
                             READ of size 1 at 0x5020000000b8 thread T0                                                                                                                                          
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                                                                                    
                                 #0 0x55fb7b7c95af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                                                                                           
                                 #1 0x55fb7b7ca7ac in json_parse /src/shadowsocks/src/json.c:958:11                                                                                                              
                                 #2 0x55fb7b7c3c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                                                                                               
                                 #3 0x55fb7b67aa80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                        
                                 #4 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #5 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #6 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #7 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                 #8 0x55fb7b65dedd in _start (/out/json_fuzz+0x5cedd)                                                                                                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                                                                                      
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                                                                                               
                             allocated by thread T0 here:                                                                                                                                                        
                                 #0 0x55fb7b78684f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                   
                                 #1 0x55fb7b89c223 in operator new(unsigned long) cxa_noexception.cpp                                                                                                            
                                 #2 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #3 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #4 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #5 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                                     
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in json_parse_ex                                                                                 
                             Shadow bytes around the buggy address:                                                                                                                                              
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                                                                                   
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                
                               Addressable:           00                                                                                                                                                         
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                       
                               Heap left redzone:       fa                                                                                                                                                       
                               Freed heap region:       fd                                                                                                                                                       
                               Stack left redzone:      f1                                                                                                                                                       
                               Stack mid redzone:       f2                                                                                                                                                       
                               Stack right redzone:     f3                                                                                                                                                       
                               Stack after return:      f5                                                                                                                                                       
                               Stack use after scope:   f8                                                                                                                                                       
                               Global redzone:          f9                                                                                                                                                       
                               Global init order:       f6                                                                                                                                                       
                               Poisoned by user:        f7                                                                                                                                                       
                               Container overflow:      fc                                                                                                                                                       
                               Array cookie:            ac                                                                                                                                                       
                               Intra object redzone:    bb                                                                                                                                                       
                               ASan internal:           fe                                                                                                                                                       
                               Left alloca redzone:     ca                                                                                                                                                       
                               Right alloca redzone:    cb                                                                                                                                                       
                             ==18==ABORTING                                                                                                                                                                      
                             subprocess command returned a non-zero exit status: 1                                                                                                                               
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v                                                
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v /tmp/tmpateze75u:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0                         
                             reproduce json_fuzz -runs=100.                                                                                                                                                      
                                                                                                                                                                                                                 
                             ===Evaluation Report===                                                                                                                                                             
                                                                                                                                                                                                                 
                             ===Analysis Report===                                                                                                                                                               
                                                                                                                                                                                                                 
                             ===Evaluation End===                                                                                                                                                                
[10/27/25 22:09:45] INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                                                                                                  __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
[10/27/25 22:11:58] INFO     Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.PATCH                                                                                                     __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
[10/27/25 22:12:33] INFO     Prism Supervisor Routing: TeamStatus.PATCH -> TeamStatus.EVALUATE                                                                                                    __init__.py:160
                             (n evals: 1, patch status: PatchStatus.VULNERABLE)                                                                                                                                  
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
[10/27/25 22:12:34] INFO     [logging_performance](shadowsocks Setting owner) Took 0.83 seconds; exception=False                                                                           context_managers.py:23
                    INFO     [logging_performance](shadowsocks Patching) Started...                                                                                                         context_managers.py:9
                    INFO     Checking valid diff: /tmp/tmpu8qgah77                                                                                                                                 default.py:173
[10/27/25 22:13:37] INFO     [logging_performance](shadowsocks Patching) Took 62.91 seconds; exception=False                                                                               context_managers.py:23
                    INFO     [logging_performance](shadowsocks Checking build) Started...                                                                                                   context_managers.py:9
[10/27/25 22:13:42] INFO     [logging_performance](shadowsocks Checking build) Took 4.37 seconds; exception=False                                                                          context_managers.py:23
                    INFO     [logging_performance](shadowsocks Running PoV) Started...                                                                                                      context_managers.py:9
[10/27/25 22:13:43] INFO     [logging_performance](shadowsocks Running PoV) Took 1.93 seconds; exception=False                                                                             context_managers.py:23
                    INFO     [logging_performance](shadowsocks Testing) Started...                                                                                                          context_managers.py:9
                    INFO     [logging_performance](shadowsocks Testing) Took 0.00 seconds; exception=False                                                                                 context_managers.py:23
                    INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
[10/27/25 22:13:44] INFO     [logging_performance](shadowsocks Setting owner) Took 0.76 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:13:45] INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
                    INFO     [logging_performance](shadowsocks Setting owner) Took 0.78 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:13:46] INFO     [logging_performance](shadowsocks Setting owner) Started...                                                                                                    context_managers.py:9
                    INFO     [logging_performance](shadowsocks Setting owner) Took 0.79 seconds; exception=False                                                                           context_managers.py:23
[10/27/25 22:13:47] INFO     ===Evaluator Result===                                                                                                                                              evaluator.py:204
                             PatchStatus.SOUND                                                                                                                                                                   
                             ===Evaluator Diff===                                                                                                                                                                
                             --- a/src/json.c                                                                                                                                                                    
                             +++ b/src/json.c                                                                                                                                                                    
                             @@ -599,7 +599,7 @@                                                                                                                                                                 
                                                                                                                                                                                                                 
                                                   case 't':                                                                                                                                                     
                                                                                                                                                                                                                 
                             -                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                                                                                     
                             +                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'r' ||                                                                                                     
                                                          *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                                                                                      
                                                      {                                                                                                                                                          
                                                         goto e_unknown_value;                                                                                                                                   
                             @@ -615,7 +615,7 @@                                                                                                                                                                 
                                                                                                                                                                                                                 
                                                   case 'f':                                                                                                                                                     
                                                                                                                                                                                                                 
                             -                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                                                                                     
                             +                        if ((end - state.ptr) < 5 || *(++ state.ptr) != 'a' ||                                                                                                     
                                                          *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                                                                                    
                                                          *(++ state.ptr) != 'e')                                                                                                                                
                                                      {                                                                                                                                                          
                             @@ -630,7 +630,7 @@                                                                                                                                                                 
                                                                                                                                                                                                                 
                                                   case 'n':                                                                                                                                                     
                                                                                                                                                                                                                 
                             -                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                                                                                     
                             +                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'u' ||                                                                                                     
                                                          *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                                                                                      
                                                      {                                                                                                                                                          
                                                         goto e_unknown_value;                                                                                                                                   
                                                                                                                                                                                                                 
                             ===Patch Result===                                                                                                                                                                  
                                                                                                                                                                                                                 
                             ===Issue===                                                                                                                                                                         
                             + FUZZER=json_fuzz                                                                                                                                                                  
                             + shift                                                                                                                                                                             
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                           
                             + TESTCASE=/testcase                                                                                                                                                                
                             + '[' '!' -f /testcase ']'                                                                                                                                                          
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                       
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                   
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                          
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                         
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                                                                                          
                             vm.mmap_rnd_bits = 28                                                                                                                                                               
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                   
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                             
                             INFO: Seed: 663520775                                                                                                                                                               
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x55fb7b9464b0, 0x55fb7b947179),                                                                                       
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x55fb7b947180,0x55fb7b953e10),                                                                                                          
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                                                                                  
                             Running: /testcase                                                                                                                                                                  
                             =================================================================                                                                                                                   
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x55fb7b7c95b0 bp 0x7ffc48bc8dd0 sp 0x7ffc48bc8dc8                                              
                             READ of size 1 at 0x5020000000b8 thread T0                                                                                                                                          
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                                                                                    
                                 #0 0x55fb7b7c95af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                                                                                           
                                 #1 0x55fb7b7ca7ac in json_parse /src/shadowsocks/src/json.c:958:11                                                                                                              
                                 #2 0x55fb7b7c3c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                                                                                               
                                 #3 0x55fb7b67aa80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                        
                                 #4 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #5 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #6 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #7 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                 #8 0x55fb7b65dedd in _start (/out/json_fuzz+0x5cedd)                                                                                                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                                                                                      
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                                                                                               
                             allocated by thread T0 here:                                                                                                                                                        
                                 #0 0x55fb7b78684f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                   
                                 #1 0x55fb7b89c223 in operator new(unsigned long) cxa_noexception.cpp                                                                                                            
                                 #2 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #3 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #4 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #5 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                                     
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in json_parse_ex                                                                                 
                             Shadow bytes around the buggy address:                                                                                                                                              
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                                                                                   
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                
                               Addressable:           00                                                                                                                                                         
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                       
                               Heap left redzone:       fa                                                                                                                                                       
                               Freed heap region:       fd                                                                                                                                                       
                               Stack left redzone:      f1                                                                                                                                                       
                               Stack mid redzone:       f2                                                                                                                                                       
                               Stack right redzone:     f3                                                                                                                                                       
                               Stack after return:      f5                                                                                                                                                       
                               Stack use after scope:   f8                                                                                                                                                       
                               Global redzone:          f9                                                                                                                                                       
                               Global init order:       f6                                                                                                                                                       
                               Poisoned by user:        f7                                                                                                                                                       
                               Container overflow:      fc                                                                                                                                                       
                               Array cookie:            ac                                                                                                                                                       
                               Intra object redzone:    bb                                                                                                                                                       
                               ASan internal:           fe                                                                                                                                                       
                               Left alloca redzone:     ca                                                                                                                                                       
                               Right alloca redzone:    cb                                                                                                                                                       
                             ==18==ABORTING                                                                                                                                                                      
                             subprocess command returned a non-zero exit status: 1                                                                                                                               
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v                                                
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v /tmp/tmpateze75u:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0                         
                             reproduce json_fuzz -runs=100.                                                                                                                                                      
                                                                                                                                                                                                                 
                             ===Evaluation Report===                                                                                                                                                             
                             # Evaluation Report                                                                                                                                                                 
                                                                                                                                                                                                                 
                             ## Summary                                                                                                                                                                          
                                                                                                                                                                                                                 
                             A libFuzzer run on the Shadowsocks JSON parser triggered an AddressSanitizer (ASan) heap-buffer-overflow in the function `json_parse_ex`                                            
                             (src/shadowsocks/src/json.c:634). The fuzzer invoked the parser via `LLVMFuzzerTestOneInput` in `json_fuzz.c`, feeding a single input 100 times, and ASan detected                  
                             a one-byte out-of-bounds read immediately past an 8-byte heap allocation.                                                                                                           
                                                                                                                                                                                                                 
                             ## Description                                                                                                                                                                      
                                                                                                                                                                                                                 
                             - Issue type                                                                                                                                                                        
                               The crash is classified as a heap-based buffer overflow (out-of-bounds read). ASan reports reading one byte at address `0x5020000000b8`, which lies exactly one                   
                             byte beyond an 8-byte region allocated on the heap.                                                                                                                                 
                                                                                                                                                                                                                 
                             - Stack trace highlights                                                                                                                                                            
                               1. `json_parse_ex` at json.c:634:55                                                                                                                                               
                               2. `json_parse` at json.c:958:11                                                                                                                                                  
                               3. `LLVMFuzzerTestOneInput` in json_fuzz.c:12:9                                                                                                                                   
                               4. libFuzzer driver routines                                                                                                                                                      
                                                                                                                                                                                                                 
                             - Key observations                                                                                                                                                                  
                                The overflow occurs during parsing logic in `json_parse_ex`.                                                                                                                    
                                ASans shadow bytes indicate a redzone violation immediately after the allocated buffer.                                                                                        
                                The fuzzer harness simply passes the test case to the parser; it is not responsible for allocation or parsing logic.                                                            
                                The input that triggers the crash is a minimal testcase supplied via `/testcase`.                                                                                               
                                                                                                                                                                                                                 
                             - Code areas for investigation                                                                                                                                                      
                                The implementation of `json_parse_ex` around line 630 in `src/shadowsocks/src/json.c`, especially any loops or pointer arithmetic that read beyond buffer                       
                             bounds.                                                                                                                                                                             
                                The wrapper function `json_parse` in the same file, which invokes `json_parse_ex`.                                                                                              
                                The fuzz target entry point in `json_fuzz.c` (around line 12) to understand how the input is handed off to the parser.                                                          
                                Any buffer allocation strategies or assumptions made before and during parsing (memory sizes, null-terminators, indexing).                                                      
                                                                                                                                                                                                                 
                             Reviewing these locations in tandem will give a comprehensive view of how the parser handles allocated buffers and where bounds checks may be insufficient.                         
                                                                                                                                                                                                                 
                             ## Initial Issue Log                                                                                                                                                                
                             Here is the initial issue log of the codebase:                                                                                                                                      
                             <issue>                                                                                                                                                                             
                             + FUZZER=json_fuzz                                                                                                                                                                  
                             + shift                                                                                                                                                                             
                             + '[' '!' -v TESTCASE ']'                                                                                                                                                           
                             + TESTCASE=/testcase                                                                                                                                                                
                             + '[' '!' -f /testcase ']'                                                                                                                                                          
                             + export RUN_FUZZER_MODE=interactive                                                                                                                                                
                             + RUN_FUZZER_MODE=interactive                                                                                                                                                       
                             + export FUZZING_ENGINE=libfuzzer                                                                                                                                                   
                             + FUZZING_ENGINE=libfuzzer                                                                                                                                                          
                             + export SKIP_SEED_CORPUS=1                                                                                                                                                         
                             + SKIP_SEED_CORPUS=1                                                                                                                                                                
                             + run_fuzzer json_fuzz -runs=100 /testcase                                                                                                                                          
                             vm.mmap_rnd_bits = 28                                                                                                                                                               
                             /out/json_fuzz -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null                                                                                   
                             INFO: Running with entropic power schedule (0xFF, 100).                                                                                                                             
                             INFO: Seed: 663520775                                                                                                                                                               
                             INFO: Loaded 1 modules   (3273 inline 8-bit counters): 3273 [0x55fb7b9464b0, 0x55fb7b947179),                                                                                       
                             INFO: Loaded 1 PC tables (3273 PCs): 3273 [0x55fb7b947180,0x55fb7b953e10),                                                                                                          
                             /out/json_fuzz: Running 1 inputs 100 time(s) each.                                                                                                                                  
                             Running: /testcase                                                                                                                                                                  
                             =================================================================                                                                                                                   
                             ==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5020000000b8 at pc 0x55fb7b7c95b0 bp 0x7ffc48bc8dd0 sp 0x7ffc48bc8dc8                                              
                             READ of size 1 at 0x5020000000b8 thread T0                                                                                                                                          
                             SCARINESS: 12 (1-byte-read-heap-buffer-overflow)                                                                                                                                    
                                 #0 0x55fb7b7c95af in json_parse_ex /src/shadowsocks/src/json.c:634:55                                                                                                           
                                 #1 0x55fb7b7ca7ac in json_parse /src/shadowsocks/src/json.c:958:11                                                                                                              
                                 #2 0x55fb7b7c3c04 in LLVMFuzzerTestOneInput /src/json_fuzz.c:12:9                                                                                                               
                                 #3 0x55fb7b67aa80 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13                        
                                 #4 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #5 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #6 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #7 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                 #8 0x55fb7b65dedd in _start (/out/json_fuzz+0x5cedd)                                                                                                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: json_parse_ex--json_parse--LLVMFuzzerTestOneInput                                                                                                                      
                             0x5020000000b8 is located 0 bytes after 8-byte region [0x5020000000b0,0x5020000000b8)                                                                                               
                             allocated by thread T0 here:                                                                                                                                                        
                                 #0 0x55fb7b78684f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3                                                                                   
                                 #1 0x55fb7b89c223 in operator new(unsigned long) cxa_noexception.cpp                                                                                                            
                                 #2 0x55fb7b665cf5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6                            
                                 #3 0x55fb7b66b78f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long))                                                                          
                             /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9                                                                                                                     
                                 #4 0x55fb7b696a32 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10                                                                                         
                                 #5 0x7ff6caf09082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)                                            
                                                                                                                                                                                                                 
                             DEDUP_TOKEN: __interceptor_malloc--operator new(unsigned long)--fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long)                                                     
                             SUMMARY: AddressSanitizer: heap-buffer-overflow /src/shadowsocks/src/json.c:634:55 in json_parse_ex                                                                                 
                             Shadow bytes around the buggy address:                                                                                                                                              
                               0x501ffffffe00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501ffffffe80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x501fffffff80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                                                                                                   
                               0x502000000000: fa fa 00 00 fa fa 00 fa fa fa 00 fa fa fa 00 fa                                                                                                                   
                             =>0x502000000080: fa fa 00 fa fa fa 00[fa]fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000100: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000180: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000200: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000280: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                               0x502000000300: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa                                                                                                                   
                             Shadow byte legend (one shadow byte represents 8 application bytes):                                                                                                                
                               Addressable:           00                                                                                                                                                         
                               Partially addressable: 01 02 03 04 05 06 07                                                                                                                                       
                               Heap left redzone:       fa                                                                                                                                                       
                               Freed heap region:       fd                                                                                                                                                       
                               Stack left redzone:      f1                                                                                                                                                       
                               Stack mid redzone:       f2                                                                                                                                                       
                               Stack right redzone:     f3                                                                                                                                                       
                               Stack after return:      f5                                                                                                                                                       
                               Stack use after scope:   f8                                                                                                                                                       
                               Global redzone:          f9                                                                                                                                                       
                               Global init order:       f6                                                                                                                                                       
                               Poisoned by user:        f7                                                                                                                                                       
                               Container overflow:      fc                                                                                                                                                       
                               Array cookie:            ac                                                                                                                                                       
                               Intra object redzone:    bb                                                                                                                                                       
                               ASan internal:           fe                                                                                                                                                       
                               Left alloca redzone:     ca                                                                                                                                                       
                               Right alloca redzone:    cb                                                                                                                                                       
                             ==18==ABORTING                                                                                                                                                                      
                             subprocess command returned a non-zero exit status: 1                                                                                                                               
                             INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v                                                
                             /tasks_new/shadowsocks_shadowsocks-full-01/fuzz-tooling/build/out/shadowsocks:/out -v /tmp/tmpateze75u:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0                         
                             reproduce json_fuzz -runs=100.                                                                                                                                                      
                                                                                                                                                                                                                 
                             </issue>                                                                                                                                                                            
                             ===Analysis Report===                                                                                                                                                               
                             # Analysis Report                                                                                                                                                                   
                                                                                                                                                                                                                 
                             ## Relevant Code Snippets                                                                                                                                                           
                             <code_snippets>                                                                                                                                                                     
                             <code>                                                                                                                                                                              
                             src/json.c:1-200                                                                                                                                                                    
                             ```                                                                                                                                                                                 
                             1:/* vim: set et ts=3 sw=3 sts=3 ft=c:                                                                                                                                              
                             2: *                                                                                                                                                                                
                             3: * Copyright (C) 2012, 2013, 2014 James McLaughlin et al.  All rights reserved.                                                                                                   
                             4: * https://github.com/udp/json-parser                                                                                                                                             
                             5: *                                                                                                                                                                                
                             6: * Redistribution and use in source and binary forms, with or without                                                                                                             
                             7: * modification, are permitted provided that the following conditions                                                                                                             
                             8: * are met:                                                                                                                                                                       
                             9: *                                                                                                                                                                                
                             10: * 1. Redistributions of source code must retain the above copyright                                                                                                             
                             11: *   notice, this list of conditions and the following disclaimer.                                                                                                               
                             12: *                                                                                                                                                                               
                             13: * 2. Redistributions in binary form must reproduce the above copyright                                                                                                          
                             14: *   notice, this list of conditions and the following disclaimer in the                                                                                                         
                             15: *   documentation and/or other materials provided with the distribution.                                                                                                        
                             16: *                                                                                                                                                                               
                             17: * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND                                                                                                        
                             18: * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE                                                                                                         
                             19: * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE                                                                                                    
                             20: * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE                                                                                                       
                             21: * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL                                                                                                    
                             22: * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS                                                                                                       
                             23: * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)                                                                                                         
                             24: * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT                                                                                                    
                             25: * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY                                                                                                     
                             26: * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF                                                                                                        
                             27: * SUCH DAMAGE.                                                                                                                                                                  
                             28: */                                                                                                                                                                              
                             29:                                                                                                                                                                                 
                             30:#include "json.h"                                                                                                                                                                
                             31:                                                                                                                                                                                 
                             32:#ifdef _MSC_VER                                                                                                                                                                  
                             33:   #ifndef _CRT_SECURE_NO_WARNINGS                                                                                                                                               
                             34:      #define _CRT_SECURE_NO_WARNINGS                                                                                                                                            
                             35:   #endif                                                                                                                                                                        
                             36:#endif                                                                                                                                                                           
                             37:                                                                                                                                                                                 
                             38:#ifdef __MINGW32__                                                                                                                                                               
                             39:#define CONV_PTR (uintptr_t)                                                                                                                                                     
                             40:#else                                                                                                                                                                            
                             41:#define CONV_PTR (unsigned long)                                                                                                                                                 
                             42:#endif                                                                                                                                                                           
                             43:                                                                                                                                                                                 
                             44:const struct _json_value json_value_none;                                                                                                                                        
                             45:                                                                                                                                                                                 
                             46:#include <stdio.h>                                                                                                                                                               
                             47:#include <string.h>                                                                                                                                                              
                             48:#include <ctype.h>                                                                                                                                                               
                             49:#include <math.h>                                                                                                                                                                
                             50:                                                                                                                                                                                 
                             51:typedef unsigned int json_uchar;                                                                                                                                                 
                             52:                                                                                                                                                                                 
                             53:static unsigned char hex_value (json_char c)                                                                                                                                     
                             54:{                                                                                                                                                                                
                             55:   if (isdigit(c))                                                                                                                                                               
                             56:      return c - '0';                                                                                                                                                            
                             57:                                                                                                                                                                                 
                             58:   switch (c) {                                                                                                                                                                  
                             59:      case 'a': case 'A': return 0x0A;                                                                                                                                           
                             60:      case 'b': case 'B': return 0x0B;                                                                                                                                           
                             61:      case 'c': case 'C': return 0x0C;                                                                                                                                           
                             62:      case 'd': case 'D': return 0x0D;                                                                                                                                           
                             63:      case 'e': case 'E': return 0x0E;                                                                                                                                           
                             64:      case 'f': case 'F': return 0x0F;                                                                                                                                           
                             65:      default: return 0xFF;                                                                                                                                                      
                             66:   }                                                                                                                                                                             
                             67:}                                                                                                                                                                                
                             68:                                                                                                                                                                                 
                             69:typedef struct                                                                                                                                                                   
                             70:{                                                                                                                                                                                
                             71:   unsigned long used_memory;                                                                                                                                                    
                             72:                                                                                                                                                                                 
                             73:   unsigned int uint_max;                                                                                                                                                        
                             74:   unsigned long ulong_max;                                                                                                                                                      
                             75:                                                                                                                                                                                 
                             76:   json_settings settings;                                                                                                                                                       
                             77:   int first_pass;                                                                                                                                                               
                             78:                                                                                                                                                                                 
                             79:   const json_char * ptr;                                                                                                                                                        
                             80:   unsigned int cur_line, cur_col;                                                                                                                                               
                             81:                                                                                                                                                                                 
                             82:} json_state;                                                                                                                                                                    
                             83:                                                                                                                                                                                 
                             84:static void * default_alloc (size_t size, int zero, void * user_data)                                                                                                            
                             85:{                                                                                                                                                                                
                             86:   return zero ? calloc (1, size) : malloc (size);                                                                                                                               
                             87:}                                                                                                                                                                                
                             88:                                                                                                                                                                                 
                             89:static void default_free (void * ptr, void * user_data)                                                                                                                          
                             90:{                                                                                                                                                                                
                             91:   free (ptr);                                                                                                                                                                   
                             92:}                                                                                                                                                                                
                             93:                                                                                                                                                                                 
                             94:static void * json_alloc (json_state * state, unsigned long size, int zero)                                                                                                      
                             95:{                                                                                                                                                                                
                             96:   if ((state->ulong_max - state->used_memory) < size)                                                                                                                           
                             97:      return 0;                                                                                                                                                                  
                             98:                                                                                                                                                                                 
                             99:   if (state->settings.max_memory                                                                                                                                                
                             100:         && (state->used_memory += size) > state->settings.max_memory)                                                                                                          
                             101:   {                                                                                                                                                                            
                             102:      return 0;                                                                                                                                                                 
                             103:   }                                                                                                                                                                            
                             104:                                                                                                                                                                                
                             105:   return state->settings.mem_alloc (size, zero, state->settings.user_data);                                                                                                    
                             106:}                                                                                                                                                                               
                             107:                                                                                                                                                                                
                             108:static int new_value (json_state * state,                                                                                                                                       
                             109:                      json_value ** top, json_value ** root, json_value ** alloc,                                                                                               
                             110:                      json_type type)                                                                                                                                           
                             111:{                                                                                                                                                                               
                             112:   json_value * value;                                                                                                                                                          
                             113:   int values_size;                                                                                                                                                             
                             114:                                                                                                                                                                                
                             115:   if (!state->first_pass)                                                                                                                                                      
                             116:   {                                                                                                                                                                            
                             117:      value = *top = *alloc;                                                                                                                                                    
                             118:      *alloc = (*alloc)->_reserved.next_alloc;                                                                                                                                  
                             119:                                                                                                                                                                                
                             120:      if (!*root)                                                                                                                                                               
                             121:         *root = value;                                                                                                                                                         
                             122:                                                                                                                                                                                
                             123:      switch (value->type)                                                                                                                                                      
                             124:      {                                                                                                                                                                         
                             125:         case json_array:                                                                                                                                                       
                             126:                                                                                                                                                                                
                             127:            if (value->u.array.length == 0)                                                                                                                                     
                             128:               break;                                                                                                                                                           
                             129:                                                                                                                                                                                
                             130:            if (! (value->u.array.values = (json_value **) json_alloc                                                                                                           
                             131:               (state, value->u.array.length * sizeof (json_value *), 0)) )                                                                                                     
                             132:            {                                                                                                                                                                   
                             133:               return 0;                                                                                                                                                        
                             134:            }                                                                                                                                                                   
                             135:                                                                                                                                                                                
                             136:            value->u.array.length = 0;                                                                                                                                          
                             137:            break;                                                                                                                                                              
                             138:                                                                                                                                                                                
                             139:         case json_object:                                                                                                                                                      
                             140:                                                                                                                                                                                
                             141:            if (value->u.object.length == 0)                                                                                                                                    
                             142:               break;                                                                                                                                                           
                             143:                                                                                                                                                                                
                             144:            values_size = sizeof (*value->u.object.values) * value->u.object.length;                                                                                            
                             145:                                                                                                                                                                                
                             146:            if (! (value->u.object.values = (json_object_entry *) json_alloc                                                                                                    
                             147:                  (state, values_size + (CONV_PTR value->u.object.values), 0)) )                                                                                                
                             148:            {                                                                                                                                                                   
                             149:               return 0;                                                                                                                                                        
                             150:            }                                                                                                                                                                   
                             151:                                                                                                                                                                                
                             152:            value->_reserved.object_mem = (*(char **) &value->u.object.values) + values_size;                                                                                   
                             153:                                                                                                                                                                                
                             154:            value->u.object.length = 0;                                                                                                                                         
                             155:            break;                                                                                                                                                              
                             156:                                                                                                                                                                                
                             157:         case json_string:                                                                                                                                                      
                             158:                                                                                                                                                                                
                             159:            if (! (value->u.string.ptr = (json_char *) json_alloc                                                                                                               
                             160:               (state, (value->u.string.length + 1) * sizeof (json_char), 0)) )                                                                                                 
                             161:            {                                                                                                                                                                   
                             162:               return 0;                                                                                                                                                        
                             163:            }                                                                                                                                                                   
                             164:                                                                                                                                                                                
                             165:            value->u.string.length = 0;                                                                                                                                         
                             166:            break;                                                                                                                                                              
                             167:                                                                                                                                                                                
                             168:         default:                                                                                                                                                               
                             169:            break;                                                                                                                                                              
                             170:      };                                                                                                                                                                        
                             171:                                                                                                                                                                                
                             172:      return 1;                                                                                                                                                                 
                             173:   }                                                                                                                                                                            
                             174:                                                                                                                                                                                
                             175:   if (! (value = (json_value *) json_alloc                                                                                                                                     
                             176:         (state, sizeof (json_value) + state->settings.value_extra, 1)))                                                                                                        
                             177:   {                                                                                                                                                                            
                             178:      return 0;                                                                                                                                                                 
                             179:   }                                                                                                                                                                            
                             180:                                                                                                                                                                                
                             181:   if (!*root)                                                                                                                                                                  
                             182:      *root = value;                                                                                                                                                            
                             183:                                                                                                                                                                                
                             184:   value->type = type;                                                                                                                                                          
                             185:   value->parent = *top;                                                                                                                                                        
                             186:                                                                                                                                                                                
                             187:   #ifdef JSON_TRACK_SOURCE                                                                                                                                                     
                             188:      value->line = state->cur_line;                                                                                                                                            
                             189:      value->col = state->cur_col;                                                                                                                                              
                             190:   #endif                                                                                                                                                                       
                             191:                                                                                                                                                                                
                             192:   if (*alloc)                                                                                                                                                                  
                             193:      (*alloc)->_reserved.next_alloc = value;                                                                                                                                   
                             194:                                                                                                                                                                                
                             195:   *alloc = *top = value;                                                                                                                                                       
                             196:                                                                                                                                                                                
                             197:   return 1;                                                                                                                                                                    
                             198:}                                                                                                                                                                               
                             199:                                                                                                                                                                                
                             200:#define whitespace \                                                                                                                                                            
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:600-650                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             600:                     case 't':                                                                                                                                                  
                             601:                                                                                                                                                                                
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                                                                                  
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                                                                                   
                             604:                        {                                                                                                                                                       
                             605:                           goto e_unknown_value;                                                                                                                                
                             606:                        }                                                                                                                                                       
                             607:                                                                                                                                                                                
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             609:                           goto e_alloc_failure;                                                                                                                                
                             610:                                                                                                                                                                                
                             611:                        top->u.boolean = 1;                                                                                                                                     
                             612:                                                                                                                                                                                
                             613:                        flags |= flag_next;                                                                                                                                     
                             614:                        break;                                                                                                                                                  
                             615:                                                                                                                                                                                
                             616:                     case 'f':                                                                                                                                                  
                             617:                                                                                                                                                                                
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                                                                                  
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                                                                                 
                             620:                            *(++ state.ptr) != 'e')                                                                                                                             
                             621:                        {                                                                                                                                                       
                             622:                           goto e_unknown_value;                                                                                                                                
                             623:                        }                                                                                                                                                       
                             624:                                                                                                                                                                                
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             626:                           goto e_alloc_failure;                                                                                                                                
                             627:                                                                                                                                                                                
                             628:                        flags |= flag_next;                                                                                                                                     
                             629:                        break;                                                                                                                                                  
                             630:                                                                                                                                                                                
                             631:                     case 'n':                                                                                                                                                  
                             632:                                                                                                                                                                                
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                                                                                  
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                                                                                   
                             635:                        {                                                                                                                                                       
                             636:                           goto e_unknown_value;                                                                                                                                
                             637:                        }                                                                                                                                                       
                             638:                                                                                                                                                                                
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                                                                                                
                             640:                           goto e_alloc_failure;                                                                                                                                
                             641:                                                                                                                                                                                
                             642:                        flags |= flag_next;                                                                                                                                     
                             643:                        break;                                                                                                                                                  
                             644:                                                                                                                                                                                
                             645:                     default:                                                                                                                                                   
                             646:                                                                                                                                                                                
                             647:                        if (isdigit (b) || b == '-')                                                                                                                            
                             648:                        {                                                                                                                                                       
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                                                                                          
                             650:                              goto e_alloc_failure;                                                                                                                             
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:1-200                                                                                                                                                                    
                             ```                                                                                                                                                                                 
                             1:/* vim: set et ts=3 sw=3 sts=3 ft=c:                                                                                                                                              
                             2: *                                                                                                                                                                                
                             3: * Copyright (C) 2012, 2013, 2014 James McLaughlin et al.  All rights reserved.                                                                                                   
                             4: * https://github.com/udp/json-parser                                                                                                                                             
                             5: *                                                                                                                                                                                
                             6: * Redistribution and use in source and binary forms, with or without                                                                                                             
                             7: * modification, are permitted provided that the following conditions                                                                                                             
                             8: * are met:                                                                                                                                                                       
                             9: *                                                                                                                                                                                
                             10: * 1. Redistributions of source code must retain the above copyright                                                                                                             
                             11: *   notice, this list of conditions and the following disclaimer.                                                                                                               
                             12: *                                                                                                                                                                               
                             13: * 2. Redistributions in binary form must reproduce the above copyright                                                                                                          
                             14: *   notice, this list of conditions and the following disclaimer in the                                                                                                         
                             15: *   documentation and/or other materials provided with the distribution.                                                                                                        
                             16: *                                                                                                                                                                               
                             17: * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND                                                                                                        
                             18: * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE                                                                                                         
                             19: * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE                                                                                                    
                             20: * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE                                                                                                       
                             21: * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL                                                                                                    
                             22: * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS                                                                                                       
                             23: * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)                                                                                                         
                             24: * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT                                                                                                    
                             25: * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY                                                                                                     
                             26: * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF                                                                                                        
                             27: * SUCH DAMAGE.                                                                                                                                                                  
                             28: */                                                                                                                                                                              
                             29:                                                                                                                                                                                 
                             30:#include "json.h"                                                                                                                                                                
                             31:                                                                                                                                                                                 
                             32:#ifdef _MSC_VER                                                                                                                                                                  
                             33:   #ifndef _CRT_SECURE_NO_WARNINGS                                                                                                                                               
                             34:      #define _CRT_SECURE_NO_WARNINGS                                                                                                                                            
                             35:   #endif                                                                                                                                                                        
                             36:#endif                                                                                                                                                                           
                             37:                                                                                                                                                                                 
                             38:#ifdef __MINGW32__                                                                                                                                                               
                             39:#define CONV_PTR (uintptr_t)                                                                                                                                                     
                             40:#else                                                                                                                                                                            
                             41:#define CONV_PTR (unsigned long)                                                                                                                                                 
                             42:#endif                                                                                                                                                                           
                             43:                                                                                                                                                                                 
                             44:const struct _json_value json_value_none;                                                                                                                                        
                             45:                                                                                                                                                                                 
                             46:#include <stdio.h>                                                                                                                                                               
                             47:#include <string.h>                                                                                                                                                              
                             48:#include <ctype.h>                                                                                                                                                               
                             49:#include <math.h>                                                                                                                                                                
                             50:                                                                                                                                                                                 
                             51:typedef unsigned int json_uchar;                                                                                                                                                 
                             52:                                                                                                                                                                                 
                             53:static unsigned char hex_value (json_char c)                                                                                                                                     
                             54:{                                                                                                                                                                                
                             55:   if (isdigit(c))                                                                                                                                                               
                             56:      return c - '0';                                                                                                                                                            
                             57:                                                                                                                                                                                 
                             58:   switch (c) {                                                                                                                                                                  
                             59:      case 'a': case 'A': return 0x0A;                                                                                                                                           
                             60:      case 'b': case 'B': return 0x0B;                                                                                                                                           
                             61:      case 'c': case 'C': return 0x0C;                                                                                                                                           
                             62:      case 'd': case 'D': return 0x0D;                                                                                                                                           
                             63:      case 'e': case 'E': return 0x0E;                                                                                                                                           
                             64:      case 'f': case 'F': return 0x0F;                                                                                                                                           
                             65:      default: return 0xFF;                                                                                                                                                      
                             66:   }                                                                                                                                                                             
                             67:}                                                                                                                                                                                
                             68:                                                                                                                                                                                 
                             69:typedef struct                                                                                                                                                                   
                             70:{                                                                                                                                                                                
                             71:   unsigned long used_memory;                                                                                                                                                    
                             72:                                                                                                                                                                                 
                             73:   unsigned int uint_max;                                                                                                                                                        
                             74:   unsigned long ulong_max;                                                                                                                                                      
                             75:                                                                                                                                                                                 
                             76:   json_settings settings;                                                                                                                                                       
                             77:   int first_pass;                                                                                                                                                               
                             78:                                                                                                                                                                                 
                             79:   const json_char * ptr;                                                                                                                                                        
                             80:   unsigned int cur_line, cur_col;                                                                                                                                               
                             81:                                                                                                                                                                                 
                             82:} json_state;                                                                                                                                                                    
                             83:                                                                                                                                                                                 
                             84:static void * default_alloc (size_t size, int zero, void * user_data)                                                                                                            
                             85:{                                                                                                                                                                                
                             86:   return zero ? calloc (1, size) : malloc (size);                                                                                                                               
                             87:}                                                                                                                                                                                
                             88:                                                                                                                                                                                 
                             89:static void default_free (void * ptr, void * user_data)                                                                                                                          
                             90:{                                                                                                                                                                                
                             91:   free (ptr);                                                                                                                                                                   
                             92:}                                                                                                                                                                                
                             93:                                                                                                                                                                                 
                             94:static void * json_alloc (json_state * state, unsigned long size, int zero)                                                                                                      
                             95:{                                                                                                                                                                                
                             96:   if ((state->ulong_max - state->used_memory) < size)                                                                                                                           
                             97:      return 0;                                                                                                                                                                  
                             98:                                                                                                                                                                                 
                             99:   if (state->settings.max_memory                                                                                                                                                
                             100:         && (state->used_memory += size) > state->settings.max_memory)                                                                                                          
                             101:   {                                                                                                                                                                            
                             102:      return 0;                                                                                                                                                                 
                             103:   }                                                                                                                                                                            
                             104:                                                                                                                                                                                
                             105:   return state->settings.mem_alloc (size, zero, state->settings.user_data);                                                                                                    
                             106:}                                                                                                                                                                               
                             107:                                                                                                                                                                                
                             108:static int new_value (json_state * state,                                                                                                                                       
                             109:                      json_value ** top, json_value ** root, json_value ** alloc,                                                                                               
                             110:                      json_type type)                                                                                                                                           
                             111:{                                                                                                                                                                               
                             112:   json_value * value;                                                                                                                                                          
                             113:   int values_size;                                                                                                                                                             
                             114:                                                                                                                                                                                
                             115:   if (!state->first_pass)                                                                                                                                                      
                             116:   {                                                                                                                                                                            
                             117:      value = *top = *alloc;                                                                                                                                                    
                             118:      *alloc = (*alloc)->_reserved.next_alloc;                                                                                                                                  
                             119:                                                                                                                                                                                
                             120:      if (!*root)                                                                                                                                                               
                             121:         *root = value;                                                                                                                                                         
                             122:                                                                                                                                                                                
                             123:      switch (value->type)                                                                                                                                                      
                             124:      {                                                                                                                                                                         
                             125:         case json_array:                                                                                                                                                       
                             126:                                                                                                                                                                                
                             127:            if (value->u.array.length == 0)                                                                                                                                     
                             128:               break;                                                                                                                                                           
                             129:                                                                                                                                                                                
                             130:            if (! (value->u.array.values = (json_value **) json_alloc                                                                                                           
                             131:               (state, value->u.array.length * sizeof (json_value *), 0)) )                                                                                                     
                             132:            {                                                                                                                                                                   
                             133:               return 0;                                                                                                                                                        
                             134:            }                                                                                                                                                                   
                             135:                                                                                                                                                                                
                             136:            value->u.array.length = 0;                                                                                                                                          
                             137:            break;                                                                                                                                                              
                             138:                                                                                                                                                                                
                             139:         case json_object:                                                                                                                                                      
                             140:                                                                                                                                                                                
                             141:            if (value->u.object.length == 0)                                                                                                                                    
                             142:               break;                                                                                                                                                           
                             143:                                                                                                                                                                                
                             144:            values_size = sizeof (*value->u.object.values) * value->u.object.length;                                                                                            
                             145:                                                                                                                                                                                
                             146:            if (! (value->u.object.values = (json_object_entry *) json_alloc                                                                                                    
                             147:                  (state, values_size + (CONV_PTR value->u.object.values), 0)) )                                                                                                
                             148:            {                                                                                                                                                                   
                             149:               return 0;                                                                                                                                                        
                             150:            }                                                                                                                                                                   
                             151:                                                                                                                                                                                
                             152:            value->_reserved.object_mem = (*(char **) &value->u.object.values) + values_size;                                                                                   
                             153:                                                                                                                                                                                
                             154:            value->u.object.length = 0;                                                                                                                                         
                             155:            break;                                                                                                                                                              
                             156:                                                                                                                                                                                
                             157:         case json_string:                                                                                                                                                      
                             158:                                                                                                                                                                                
                             159:            if (! (value->u.string.ptr = (json_char *) json_alloc                                                                                                               
                             160:               (state, (value->u.string.length + 1) * sizeof (json_char), 0)) )                                                                                                 
                             161:            {                                                                                                                                                                   
                             162:               return 0;                                                                                                                                                        
                             163:            }                                                                                                                                                                   
                             164:                                                                                                                                                                                
                             165:            value->u.string.length = 0;                                                                                                                                         
                             166:            break;                                                                                                                                                              
                             167:                                                                                                                                                                                
                             168:         default:                                                                                                                                                               
                             169:            break;                                                                                                                                                              
                             170:      };                                                                                                                                                                        
                             171:                                                                                                                                                                                
                             172:      return 1;                                                                                                                                                                 
                             173:   }                                                                                                                                                                            
                             174:                                                                                                                                                                                
                             175:   if (! (value = (json_value *) json_alloc                                                                                                                                     
                             176:         (state, sizeof (json_value) + state->settings.value_extra, 1)))                                                                                                        
                             177:   {                                                                                                                                                                            
                             178:      return 0;                                                                                                                                                                 
                             179:   }                                                                                                                                                                            
                             180:                                                                                                                                                                                
                             181:   if (!*root)                                                                                                                                                                  
                             182:      *root = value;                                                                                                                                                            
                             183:                                                                                                                                                                                
                             184:   value->type = type;                                                                                                                                                          
                             185:   value->parent = *top;                                                                                                                                                        
                             186:                                                                                                                                                                                
                             187:   #ifdef JSON_TRACK_SOURCE                                                                                                                                                     
                             188:      value->line = state->cur_line;                                                                                                                                            
                             189:      value->col = state->cur_col;                                                                                                                                              
                             190:   #endif                                                                                                                                                                       
                             191:                                                                                                                                                                                
                             192:   if (*alloc)                                                                                                                                                                  
                             193:      (*alloc)->_reserved.next_alloc = value;                                                                                                                                   
                             194:                                                                                                                                                                                
                             195:   *alloc = *top = value;                                                                                                                                                       
                             196:                                                                                                                                                                                
                             197:   return 1;                                                                                                                                                                    
                             198:}                                                                                                                                                                               
                             199:                                                                                                                                                                                
                             200:#define whitespace \                                                                                                                                                            
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:600-650                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             600:                     case 't':                                                                                                                                                  
                             601:                                                                                                                                                                                
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                                                                                  
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                                                                                   
                             604:                        {                                                                                                                                                       
                             605:                           goto e_unknown_value;                                                                                                                                
                             606:                        }                                                                                                                                                       
                             607:                                                                                                                                                                                
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             609:                           goto e_alloc_failure;                                                                                                                                
                             610:                                                                                                                                                                                
                             611:                        top->u.boolean = 1;                                                                                                                                     
                             612:                                                                                                                                                                                
                             613:                        flags |= flag_next;                                                                                                                                     
                             614:                        break;                                                                                                                                                  
                             615:                                                                                                                                                                                
                             616:                     case 'f':                                                                                                                                                  
                             617:                                                                                                                                                                                
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                                                                                  
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                                                                                 
                             620:                            *(++ state.ptr) != 'e')                                                                                                                             
                             621:                        {                                                                                                                                                       
                             622:                           goto e_unknown_value;                                                                                                                                
                             623:                        }                                                                                                                                                       
                             624:                                                                                                                                                                                
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             626:                           goto e_alloc_failure;                                                                                                                                
                             627:                                                                                                                                                                                
                             628:                        flags |= flag_next;                                                                                                                                     
                             629:                        break;                                                                                                                                                  
                             630:                                                                                                                                                                                
                             631:                     case 'n':                                                                                                                                                  
                             632:                                                                                                                                                                                
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                                                                                  
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                                                                                   
                             635:                        {                                                                                                                                                       
                             636:                           goto e_unknown_value;                                                                                                                                
                             637:                        }                                                                                                                                                       
                             638:                                                                                                                                                                                
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                                                                                                
                             640:                           goto e_alloc_failure;                                                                                                                                
                             641:                                                                                                                                                                                
                             642:                        flags |= flag_next;                                                                                                                                     
                             643:                        break;                                                                                                                                                  
                             644:                                                                                                                                                                                
                             645:                     default:                                                                                                                                                   
                             646:                                                                                                                                                                                
                             647:                        if (isdigit (b) || b == '-')                                                                                                                            
                             648:                        {                                                                                                                                                       
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                                                                                          
                             650:                              goto e_alloc_failure;                                                                                                                             
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:200-280                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             200:#define whitespace \                                                                                                                                                            
                             201:   case '\n': ++ state.cur_line;  state.cur_col = 0; \                                                                                                                          
                             202:   case ' ': case '\t': case '\r'                                                                                                                                               
                             203:                                                                                                                                                                                
                             204:#define string_add(b)  \                                                                                                                                                        
                             205:   do { if (!state.first_pass) string [string_length] = b;  ++ string_length; } while (0);                                                                                      
                             206:                                                                                                                                                                                
                             207:#define line_and_col \                                                                                                                                                          
                             208:   state.cur_line, state.cur_col                                                                                                                                                
                             209:                                                                                                                                                                                
                             210:static const long                                                                                                                                                               
                             211:   flag_next             = 1 << 0,                                                                                                                                              
                             212:   flag_reproc           = 1 << 1,                                                                                                                                              
                             213:   flag_need_comma       = 1 << 2,                                                                                                                                              
                             214:   flag_seek_value       = 1 << 3,                                                                                                                                              
                             215:   flag_escaped          = 1 << 4,                                                                                                                                              
                             216:   flag_string           = 1 << 5,                                                                                                                                              
                             217:   flag_need_colon       = 1 << 6,                                                                                                                                              
                             218:   flag_done             = 1 << 7,                                                                                                                                              
                             219:   flag_num_negative     = 1 << 8,                                                                                                                                              
                             220:   flag_num_zero         = 1 << 9,                                                                                                                                              
                             221:   flag_num_e            = 1 << 10,                                                                                                                                             
                             222:   flag_num_e_got_sign   = 1 << 11,                                                                                                                                             
                             223:   flag_num_e_negative   = 1 << 12,                                                                                                                                             
                             224:   flag_line_comment     = 1 << 13,                                                                                                                                             
                             225:   flag_block_comment    = 1 << 14;                                                                                                                                             
                             226:                                                                                                                                                                                
                             227:json_value * json_parse_ex (json_settings * settings,                                                                                                                           
                             228:                            const json_char * json,                                                                                                                             
                             229:                            size_t length,                                                                                                                                      
                             230:                            char * error_buf)                                                                                                                                   
                             231:{                                                                                                                                                                               
                             232:   json_char error [json_error_max];                                                                                                                                            
                             233:   const json_char * end;                                                                                                                                                       
                             234:   json_value * top, * root, * alloc = 0;                                                                                                                                       
                             235:   json_state state = { 0 };                                                                                                                                                    
                             236:   long flags;                                                                                                                                                                  
                             237:   long num_digits = 0, num_e = 0;                                                                                                                                              
                             238:   json_int_t num_fraction = 0;                                                                                                                                                 
                             239:                                                                                                                                                                                
                             240:   /* Skip UTF-8 BOM                                                                                                                                                            
                             241:    */                                                                                                                                                                          
                             242:   if (length >= 3 && ((unsigned char) json [0]) == 0xEF                                                                                                                        
                             243:                   && ((unsigned char) json [1]) == 0xBB                                                                                                                        
                             244:                   && ((unsigned char) json [2]) == 0xBF)                                                                                                                       
                             245:   {                                                                                                                                                                            
                             246:      json += 3;                                                                                                                                                                
                             247:      length -= 3;                                                                                                                                                              
                             248:   }                                                                                                                                                                            
                             249:                                                                                                                                                                                
                             250:   error[0] = '\0';                                                                                                                                                             
                             251:   end = (json + length);                                                                                                                                                       
                             252:                                                                                                                                                                                
                             253:   memcpy (&state.settings, settings, sizeof (json_settings));                                                                                                                  
                             254:                                                                                                                                                                                
                             255:   if (!state.settings.mem_alloc)                                                                                                                                               
                             256:      state.settings.mem_alloc = default_alloc;                                                                                                                                 
                             257:                                                                                                                                                                                
                             258:   if (!state.settings.mem_free)                                                                                                                                                
                             259:      state.settings.mem_free = default_free;                                                                                                                                   
                             260:                                                                                                                                                                                
                             261:   memset (&state.uint_max, 0xFF, sizeof (state.uint_max));                                                                                                                     
                             262:   memset (&state.ulong_max, 0xFF, sizeof (state.ulong_max));                                                                                                                   
                             263:                                                                                                                                                                                
                             264:   state.uint_max -= 8; /* limit of how much can be added before next check */                                                                                                  
                             265:   state.ulong_max -= 8;                                                                                                                                                        
                             266:                                                                                                                                                                                
                             267:   for (state.first_pass = 1; state.first_pass >= 0; -- state.first_pass)                                                                                                       
                             268:   {                                                                                                                                                                            
                             269:      json_uchar uchar;                                                                                                                                                         
                             270:      unsigned char uc_b1, uc_b2, uc_b3, uc_b4;                                                                                                                                 
                             271:      json_char * string = 0;                                                                                                                                                   
                             272:      unsigned int string_length = 0;                                                                                                                                           
                             273:                                                                                                                                                                                
                             274:      top = root = 0;                                                                                                                                                           
                             275:      flags = flag_seek_value;                                                                                                                                                  
                             276:                                                                                                                                                                                
                             277:      state.cur_line = 1;                                                                                                                                                       
                             278:                                                                                                                                                                                
                             279:      for (state.ptr = json ;; ++ state.ptr)                                                                                                                                    
                             280:      {                                                                                                                                                                         
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:350-450                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             350:                        else                                                                                                                                                    
                             351:                        {  string [string_length ++] = 0xC0 | (uchar >> 6);                                                                                                     
                             352:                           string [string_length ++] = 0x80 | (uchar & 0x3F);                                                                                                   
                             353:                        }                                                                                                                                                       
                             354:                                                                                                                                                                                
                             355:                        break;                                                                                                                                                  
                             356:                    }                                                                                                                                                           
                             357:                                                                                                                                                                                
                             358:                    if (uchar <= 0xFFFF) {                                                                                                                                      
                             359:                        if (state.first_pass)                                                                                                                                   
                             360:                           string_length += 3;                                                                                                                                  
                             361:                        else                                                                                                                                                    
                             362:                        {  string [string_length ++] = 0xE0 | (uchar >> 12);                                                                                                    
                             363:                           string [string_length ++] = 0x80 | ((uchar >> 6) & 0x3F);                                                                                            
                             364:                           string [string_length ++] = 0x80 | (uchar & 0x3F);                                                                                                   
                             365:                        }                                                                                                                                                       
                             366:                                                                                                                                                                                
                             367:                        break;                                                                                                                                                  
                             368:                    }                                                                                                                                                           
                             369:                                                                                                                                                                                
                             370:                    if (state.first_pass)                                                                                                                                       
                             371:                       string_length += 4;                                                                                                                                      
                             372:                    else                                                                                                                                                        
                             373:                    {  string [string_length ++] = 0xF0 | (uchar >> 18);                                                                                                        
                             374:                       string [string_length ++] = 0x80 | ((uchar >> 12) & 0x3F);                                                                                               
                             375:                       string [string_length ++] = 0x80 | ((uchar >> 6) & 0x3F);                                                                                                
                             376:                       string [string_length ++] = 0x80 | (uchar & 0x3F);                                                                                                       
                             377:                    }                                                                                                                                                           
                             378:                                                                                                                                                                                
                             379:                    break;                                                                                                                                                      
                             380:                                                                                                                                                                                
                             381:                  default:                                                                                                                                                      
                             382:                     string_add (b);                                                                                                                                            
                             383:               };                                                                                                                                                               
                             384:                                                                                                                                                                                
                             385:               continue;                                                                                                                                                        
                             386:            }                                                                                                                                                                   
                             387:                                                                                                                                                                                
                             388:            if (b == '\\')                                                                                                                                                      
                             389:            {                                                                                                                                                                   
                             390:               flags |= flag_escaped;                                                                                                                                           
                             391:               continue;                                                                                                                                                        
                             392:            }                                                                                                                                                                   
                             393:                                                                                                                                                                                
                             394:            if (b == '"')                                                                                                                                                       
                             395:            {                                                                                                                                                                   
                             396:               if (!state.first_pass)                                                                                                                                           
                             397:                  string [string_length] = 0;                                                                                                                                   
                             398:                                                                                                                                                                                
                             399:               flags &= ~ flag_string;                                                                                                                                          
                             400:               string = 0;                                                                                                                                                      
                             401:                                                                                                                                                                                
                             402:               switch (top->type)                                                                                                                                               
                             403:               {                                                                                                                                                                
                             404:                  case json_string:                                                                                                                                             
                             405:                                                                                                                                                                                
                             406:                     top->u.string.length = string_length;                                                                                                                      
                             407:                     flags |= flag_next;                                                                                                                                        
                             408:                                                                                                                                                                                
                             409:                     break;                                                                                                                                                     
                             410:                                                                                                                                                                                
                             411:                  case json_object:                                                                                                                                             
                             412:                                                                                                                                                                                
                             413:                     if (state.first_pass)                                                                                                                                      
                             414:                        (*(json_char **) &top->u.object.values) += string_length + 1;                                                                                           
                             415:                     else                                                                                                                                                       
                             416:                     {                                                                                                                                                          
                             417:                        top->u.object.values [top->u.object.length].name                                                                                                        
                             418:                           = (json_char *) top->_reserved.object_mem;                                                                                                           
                             419:                                                                                                                                                                                
                             420:                        top->u.object.values [top->u.object.length].name_length                                                                                                 
                             421:                           = string_length;                                                                                                                                     
                             422:                                                                                                                                                                                
                             423:                        (*(json_char **) &top->_reserved.object_mem) += string_length + 1;                                                                                      
                             424:                     }                                                                                                                                                          
                             425:                                                                                                                                                                                
                             426:                     flags |= flag_seek_value | flag_need_colon;                                                                                                                
                             427:                     continue;                                                                                                                                                  
                             428:                                                                                                                                                                                
                             429:                  default:                                                                                                                                                      
                             430:                     break;                                                                                                                                                     
                             431:               };                                                                                                                                                               
                             432:            }                                                                                                                                                                   
                             433:            else                                                                                                                                                                
                             434:            {                                                                                                                                                                   
                             435:               string_add (b);                                                                                                                                                  
                             436:               continue;                                                                                                                                                        
                             437:            }                                                                                                                                                                   
                             438:         }                                                                                                                                                                      
                             439:                                                                                                                                                                                
                             440:         if (state.settings.settings & json_enable_comments)                                                                                                                    
                             441:         {                                                                                                                                                                      
                             442:            if (flags & (flag_line_comment | flag_block_comment))                                                                                                               
                             443:            {                                                                                                                                                                   
                             444:               if (flags & flag_line_comment)                                                                                                                                   
                             445:               {                                                                                                                                                                
                             446:                  if (b == '\r' || b == '\n' || !b)                                                                                                                             
                             447:                  {                                                                                                                                                             
                             448:                     flags &= ~ flag_line_comment;                                                                                                                              
                             449:                     -- state.ptr;  /* so null can be reproc'd */                                                                                                               
                             450:                  }                                                                                                                                                             
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:600-650                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             600:                     case 't':                                                                                                                                                  
                             601:                                                                                                                                                                                
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                                                                                  
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                                                                                   
                             604:                        {                                                                                                                                                       
                             605:                           goto e_unknown_value;                                                                                                                                
                             606:                        }                                                                                                                                                       
                             607:                                                                                                                                                                                
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             609:                           goto e_alloc_failure;                                                                                                                                
                             610:                                                                                                                                                                                
                             611:                        top->u.boolean = 1;                                                                                                                                     
                             612:                                                                                                                                                                                
                             613:                        flags |= flag_next;                                                                                                                                     
                             614:                        break;                                                                                                                                                  
                             615:                                                                                                                                                                                
                             616:                     case 'f':                                                                                                                                                  
                             617:                                                                                                                                                                                
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                                                                                  
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                                                                                 
                             620:                            *(++ state.ptr) != 'e')                                                                                                                             
                             621:                        {                                                                                                                                                       
                             622:                           goto e_unknown_value;                                                                                                                                
                             623:                        }                                                                                                                                                       
                             624:                                                                                                                                                                                
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             626:                           goto e_alloc_failure;                                                                                                                                
                             627:                                                                                                                                                                                
                             628:                        flags |= flag_next;                                                                                                                                     
                             629:                        break;                                                                                                                                                  
                             630:                                                                                                                                                                                
                             631:                     case 'n':                                                                                                                                                  
                             632:                                                                                                                                                                                
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                                                                                  
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                                                                                   
                             635:                        {                                                                                                                                                       
                             636:                           goto e_unknown_value;                                                                                                                                
                             637:                        }                                                                                                                                                       
                             638:                                                                                                                                                                                
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                                                                                                
                             640:                           goto e_alloc_failure;                                                                                                                                
                             641:                                                                                                                                                                                
                             642:                        flags |= flag_next;                                                                                                                                     
                             643:                        break;                                                                                                                                                  
                             644:                                                                                                                                                                                
                             645:                     default:                                                                                                                                                   
                             646:                                                                                                                                                                                
                             647:                        if (isdigit (b) || b == '-')                                                                                                                            
                             648:                        {                                                                                                                                                       
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                                                                                          
                             650:                              goto e_alloc_failure;                                                                                                                             
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             <code>                                                                                                                                                                              
                             src/json.c:600-700                                                                                                                                                                  
                             ```                                                                                                                                                                                 
                             600:                     case 't':                                                                                                                                                  
                             601:                                                                                                                                                                                
                             602:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'r' ||                                                                                                  
                             603:                            *(++ state.ptr) != 'u' || *(++ state.ptr) != 'e')                                                                                                   
                             604:                        {                                                                                                                                                       
                             605:                           goto e_unknown_value;                                                                                                                                
                             606:                        }                                                                                                                                                       
                             607:                                                                                                                                                                                
                             608:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             609:                           goto e_alloc_failure;                                                                                                                                
                             610:                                                                                                                                                                                
                             611:                        top->u.boolean = 1;                                                                                                                                     
                             612:                                                                                                                                                                                
                             613:                        flags |= flag_next;                                                                                                                                     
                             614:                        break;                                                                                                                                                  
                             615:                                                                                                                                                                                
                             616:                     case 'f':                                                                                                                                                  
                             617:                                                                                                                                                                                
                             618:                        if ((end - state.ptr) < 4 || *(++ state.ptr) != 'a' ||                                                                                                  
                             619:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 's' ||                                                                                                 
                             620:                            *(++ state.ptr) != 'e')                                                                                                                             
                             621:                        {                                                                                                                                                       
                             622:                           goto e_unknown_value;                                                                                                                                
                             623:                        }                                                                                                                                                       
                             624:                                                                                                                                                                                
                             625:                        if (!new_value (&state, &top, &root, &alloc, json_boolean))                                                                                             
                             626:                           goto e_alloc_failure;                                                                                                                                
                             627:                                                                                                                                                                                
                             628:                        flags |= flag_next;                                                                                                                                     
                             629:                        break;                                                                                                                                                  
                             630:                                                                                                                                                                                
                             631:                     case 'n':                                                                                                                                                  
                             632:                                                                                                                                                                                
                             633:                        if ((end - state.ptr) < 3 || *(++ state.ptr) != 'u' ||                                                                                                  
                             634:                            *(++ state.ptr) != 'l' || *(++ state.ptr) != 'l')                                                                                                   
                             635:                        {                                                                                                                                                       
                             636:                           goto e_unknown_value;                                                                                                                                
                             637:                        }                                                                                                                                                       
                             638:                                                                                                                                                                                
                             639:                        if (!new_value (&state, &top, &root, &alloc, json_null))                                                                                                
                             640:                           goto e_alloc_failure;                                                                                                                                
                             641:                                                                                                                                                                                
                             642:                        flags |= flag_next;                                                                                                                                     
                             643:                        break;                                                                                                                                                  
                             644:                                                                                                                                                                                
                             645:                     default:                                                                                                                                                   
                             646:                                                                                                                                                                                
                             647:                        if (isdigit (b) || b == '-')                                                                                                                            
                             648:                        {                                                                                                                                                       
                             649:                           if (!new_value (&state, &top, &root, &alloc, json_integer))                                                                                          
                             650:                              goto e_alloc_failure;                                                                                                                             
                             651:                                                                                                                                                                                
                             652:                           if (!state.first_pass)                                                                                                                               
                             653:                           {                                                                                                                                                    
                             654:                              while (isdigit (b) || b == '+' || b == '-'                                                                                                        
                             655:                                        || b == 'e' || b == 'E' || b == '.')                                                                                                    
                             656:                              {                                                                                                                                                 
                             657:                                 if ( (++ state.ptr) == end)                                                                                                                    
                             658:                                 {                                                                                                                                              
                             659:                                    b = 0;                                                                                                                                      
                             660:                                    break;                                                                                                                                      
                             661:                                 }                                                                                                                                              
                             662:                                                                                                                                                                                
                             663:                                 b = *state.ptr;                                                                                                                                
                             664:                              }                                                                                                                                                 
                             665:                                                                                                                                                                                
                             666:                              flags |= flag_next | flag_reproc;                                                                                                                 
                             667:                              break;                                                                                                                                            
                             668:                           }                                                                                                                                                    
                             669:                                                                                                                                                                                
                             670:                           flags &= ~ (flag_num_negative | flag_num_e |                                                                                                         
                             671:                                        flag_num_e_got_sign | flag_num_e_negative |                                                                                             
                             672:                                           flag_num_zero);                                                                                                                      
                             673:                                                                                                                                                                                
                             674:                           num_digits = 0;                                                                                                                                      
                             675:                           num_fraction = 0;                                                                                                                                    
                             676:                           num_e = 0;                                                                                                                                           
                             677:                                                                                                                                                                                
                             678:                           if (b != '-')                                                                                                                                        
                             679:                           {                                                                                                                                                    
                             680:                              flags |= flag_reproc;                                                                                                                             
                             681:                              break;                                                                                                                                            
                             682:                           }                                                                                                                                                    
                             683:                                                                                                                                                                                
                             684:                           flags |= flag_num_negative;                                                                                                                          
                             685:                           continue;                                                                                                                                            
                             686:                        }                                                                                                                                                       
                             687:                        else                                                                                                                                                    
                             688:                        {  sprintf (error, "%d:%d: Unexpected %c when seeking value", line_and_col, b);                                                                         
                             689:                           goto e_failed;                                                                                                                                       
                             690:                        }                                                                                                                                                       
                             691:                  };                                                                                                                                                            
                             692:            };                                                                                                                                                                  
                             693:         }                                                                                                                                                                      
                             694:         else                                                                                                                                                                   
                             695:         {                                                                                                                                                                      
                             696:            switch (top->type)                                                                                                                                                  
                             697:            {                                                                                                                                                                   
                             698:            case json_object:                                                                                                                                                   
                             699:                                                                                                                                                                                
                             700:               switch (b)                                                                                                                                                       
                             ```                                                                                                                                                                                 
                             </code>                                                                                                                                                                             
                             </code_snippets>                                                                                                                                                                    
                                                                                                                                                                                                                 
                             ## Fix Strategy                                                                                                                                                                     
                             <fix_strategy>                                                                                                                                                                      
                                                                                                                                                                                                                 
                             1. Root Cause Analysis                                                                                                                                                              
                                - In json_parse_ex (src/json.c lines ~600650), the code parses the JSON literals "true", "false", and "null" by performing a single length check (`(end -                       
                             state.ptr) < N`) followed by N increments and dereferences (`*(++state.ptr)`), where N is the number of remaining characters.                                                       
                                - Because `(end - state.ptr)` returns the count of bytes from the current pointer to the buffer end, using `< N` allows exactly N bytes remaining to pass the                    
                             check, but N increments then move the pointer to `end` and the final dereference reads one past the allocation, triggering the ASan heap-buffer-overflow.                           
                                                                                                                                                                                                                 
                             2. Critical Logic to Preserve                                                                                                                                                       
                                - The existing branching logic for literals must remain, including the goto-based error handling (`e_unknown_value`) and the subsequent `new_value` call.                        
                                - No changes to harness code, test code, or other parsing flows (numbers, strings, objects, arrays).                                                                             
                                                                                                                                                                                                                 
                             3. Patch Strategy                                                                                                                                                                   
                                A. Adjust Boundary Checks                                                                                                                                                        
                                   - For each literal branch, increase the required minimum remaining bytes by one:                                                                                              
                                      true (initial 't' plus 'r','u','e'): originally checked `< 3`, should be `< 4`.                                                                                         
                                      false (initial 'f' plus 'a','l','s','e'): originally `< 4`, should be `< 5`.                                                                                            
                                      null (initial 'n' plus 'u','l','l'): originally `< 3`, should be `< 4`.                                                                                                 
                                   - This ensures that if only exactly enough bytes for the increments remain (pointer + N == end), the check fails and jumps to `e_unknown_value` instead of                    
                             overrunning.                                                                                                                                                                        
                                                                                                                                                                                                                 
                                B. (Optional Safety Hardening)                                                                                                                                                   
                                   - Refactor each literal parsing to perform per-character pointer bounds checks, emulating the string parsing style:                                                           
                                     For each expected character:                                                                                                                                                
                                       1. `state.ptr++;`                                                                                                                                                         
                                       2. `if (state.ptr == end || *state.ptr != expected_char) goto e_unknown_value;`                                                                                           
                                   - This pattern guarantees no dereference when `state.ptr == end` and centralizes the bound check.                                                                             
                                                                                                                                                                                                                 
                             4. Implementation Steps                                                                                                                                                             
                                1. Open src/shadowsocks/src/json.c and locate the three literal parsing blocks around line 600.                                                                                  
                                2. Update the `if ((end - state.ptr) < N)` conditions to `< 4`, `< 5`, and `< 4` for true, false, and null respectively.                                                   
                                3. Keep the `*(++state.ptr) != ` comparisons unchanged, relying on the tightened guard.                                                                                         
                                4. Alternatively (for each literal):                                                                                                                                             
                                     a. Replace the combined length check + chained `*(++state.ptr)` with a small loop or sequence of:                                                                           
                                        ```                                                                                                                                                                      
                                        for (i = 0; i < N; ++i) {                                                                                                                                                
                                          if (++state.ptr == end || *state.ptr != expected[i]) goto e_unknown_value;                                                                                             
                                        }                                                                                                                                                                        
                                        ```                                                                                                                                                                      
                                     b. Where `expected[]` is the array of the remaining characters (e.g. {'r','u','e'}).                                                                                        
                                5. Rebuild and rerun the libFuzzer target:                                                                                                                                       
                                   - Confirm the original ASan heap-buffer-overflow in json_parse_ex is resolved.                                                                                                
                                   - Run existing unit tests and fuzzing harness to ensure no regressions.                                                                                                       
                                                                                                                                                                                                                 
                             5. Justification                                                                                                                                                                    
                                - Tightening the length checks matches the true required buffer size and prevents any single-byte over-reads, directly addressing the ASan report.                               
                                - The minimal change strategy preserves all existing parsing and error-reporting logic.                                                                                          
                                - The optional per-character refactor aligns with the proven safe pattern already used in string parsing within the same function, enhancing code consistency                    
                             and future maintainability.                                                                                                                                                         
                                                                                                                                                                                                                 
                             6. Potential Side Effects and Mitigation                                                                                                                                            
                                - Legitimate short inputs ending just at a literal boundary will now report `e_unknown_value` (error) rather than causing OOB behavior. This aligns with correct                 
                             JSON parsing semantics.                                                                                                                                                             
                                - No impact on other JSON features; no external or harness code is modified.                                                                                                     
                                - Thorough regression testing with coverage on literals and partial inputs will confirm correctness.                                                                             
                                                                                                                                                                                                                 
                             7. References in Codebase                                                                                                                                                           
                                - The string parsing loop (around line 350) already uses per-increment bound checks (`if ((++state.ptr) == end) goto e_unterminated_string;`) before                             
                             dereferencing, serving as a template for safe literal parsing.                                                                                                                      
                                                                                                                                                                                                                 
                             </fix_strategy>                                                                                                                                                                     
                             ===Tests Result===                                                                                                                                                                  
                             No tests found                                                                                                                                                                      
                             ===Evaluation End===                                                                                                                                                                
                    INFO     Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                                                                                                      __init__.py:160
                             (n evals: 2, patch status: PatchStatus.SOUND)                                                                                                                                       
                    INFO     Building environment                                                                                                                                                 __init__.py:132
                             - Cache directory: /tmp/tmpi51864z8                                                                                                                                                 
                             - Max timeout: 1800                                                                                                                                                                 
                             - Output directory: reports/prism.prism_o4_mini/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3/agent-output-1761603227.2119832                                                 
                             - Detection toml file: /tasks_new/shadowsocks_shadowsocks-full-01/detection/shadowsocks_shadowsocks-full-01_shadowsocks-libev_3.toml                                                
                             - Challenge project directory: /tasks_new/shadowsocks_shadowsocks-full-01/official-afc-shadowsocks-libev                                                                            
                                                                                                                                                                                                                 
