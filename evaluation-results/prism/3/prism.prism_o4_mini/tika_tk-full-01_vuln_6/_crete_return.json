{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_6",
  "source_directory": "/tasks_new/tika_tk-full-01/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.2905881,
    "prompt_tokens": 149691,
    "completion_tokens": 28620
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n@@ -33,17 +33,26 @@\n     public static void main(String[] args) throws IOException {\n         Path inputFile = Paths.get(args[0]);\n         Path extractDir = Paths.get(args[1]);\n+        Files.createDirectories(extractDir);\n+        Path canonicalRoot = extractDir.toAbsolutePath().normalize();\n         try (InputStream is = Files.newInputStream(inputFile);\n-                TarArchiveInputStream tais = new TarArchiveInputStream(is)) {\n+             TarArchiveInputStream tais = new TarArchiveInputStream(is)) {\n \n             TarArchiveEntry tae = tais.getNextEntry();\n \n             while (tae != null) {\n                 if (tae.isFile()) {\n-                    Path target = extractDir.resolve(tae.getName()).normalize();\n-                    if (!Files.isDirectory(target.getParent())) {\n-                        Files.createDirectories(target.getParent());\n+                    // Sanitize the entry name: strip leading separators\n+                    String rawName = tae.getName().replaceFirst(\"^[/\\\\\\\\]+\", \"\");\n+                    Path entryPath = Paths.get(rawName).normalize();\n+                    Path target = canonicalRoot.resolve(entryPath).normalize();\n+                    // Validation: prevent path traversal\n+                    if (!target.startsWith(canonicalRoot)) {\n+                        System.err.println(\"Skipping tar entry outside extraction directory: \" + tae.getName());\n+                        tae = tais.getNextEntry();\n+                        continue;\n                     }\n+                    Files.createDirectories(target.getParent());\n                     Files.write(target, tais.readAllBytes());\n                 }\n                 tae = tais.getNextEntry();\n",
  "stdout": "",
  "stderr": ""
}