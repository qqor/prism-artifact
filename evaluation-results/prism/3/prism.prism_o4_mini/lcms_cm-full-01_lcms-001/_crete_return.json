{
  "project_name": "lcms",
  "vulnerability_identifier": "lcms_cm-full-01_lcms-001",
  "source_directory": "/tasks_new/lcms_cm-full-01/official-afc-little-cms",
  "llm_usage": {
    "total_cost": 0.26336420000000005,
    "prompt_tokens": 172802,
    "completion_tokens": 16655
  },
  "variant": "sound",
  "diff": "--- a/src/cmslut.c\n+++ b/src/cmslut.c\n@@ -1227,6 +1227,10 @@\n \n cmsStageSignature CMSEXPORT cmsStageType(const cmsStage* mpe)\n {\n+    // Defensive null check: treat a NULL stage as identity (no-op)\n+    if (mpe == NULL)\n+        return cmsSigIdentityElemType;\n+\n     return mpe -> Type;\n }\n \n\n--- a/src/cmsps2.c\n+++ b/src/cmsps2.c\n@@ -757,7 +757,11 @@\n     const char* PostMaj;\n     const char* PreMin, *PostMin;\n     cmsStage* mpe;\n-        \n+\n+    // Defensive guard: nothing to emit if pipeline or its first element is NULL\n+    if (Pipeline == NULL || Pipeline->Elements == NULL)\n+        return 0;\n+\n     mpe = Pipeline->Elements;\n \n     switch (cmsStageInputChannels(mpe)) {\n@@ -904,6 +908,11 @@\n             _cmsOptimizePipeline(m->ContextID, &DeviceLink, Intent, &InputFormat, &OutFrm, &dwFlags);\n \n             rc = EmitCIEBasedDEF(m, DeviceLink, Intent, &BlackPointAdaptedToD50);\n+            if (!rc) {\n+                cmsPipelineFree(DeviceLink);\n+                cmsDeleteTransform(xform);\n+                return FALSE;\n+            }\n             cmsPipelineFree(DeviceLink);            \n             if (!rc) {\n                 cmsDeleteTransform(xform);\n",
  "stdout": "",
  "stderr": ""
}