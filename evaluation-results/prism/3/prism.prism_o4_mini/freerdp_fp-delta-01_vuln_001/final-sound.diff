--- a/libfreerdp/crypto/certificate.c
+++ b/libfreerdp/crypto/certificate.c
@@ -1534,16 +1534,16 @@
 	WINPR_ASSERT(bio);
 	WINPR_ASSERT(ppem);
 
-	const uint16_t blocksize = 2048;
-	uint16_t offset = 0;
-	uint16_t length = blocksize;
+	const size_t blocksize = 2048;
+	size_t offset = 0;
+	size_t length = blocksize;
 	char* pem = NULL;
 
 	*ppem = NULL;
 	if (plength)
 		*plength = 0;
 
-	while (status != 0)
+	while (offset < length)
 	{
 		char* tmp = realloc(pem, length + 1);
 		if (!tmp)
@@ -1564,13 +1564,15 @@
 			break;
 
 		offset += (size_t)status;
-		length += blocksize;
-
-	}
+		if (offset == length)
+			length += blocksize;
+	}
+
 	pem[offset] = '\0';
 	*ppem = pem;
 	if (plength)
 		*plength = offset;
+	rc = TRUE;
 	rc = TRUE;
 fail:
 	if (!rc)
