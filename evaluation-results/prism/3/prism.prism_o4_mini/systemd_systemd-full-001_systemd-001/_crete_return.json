{
  "project_name": "systemd",
  "vulnerability_identifier": "systemd_systemd-full-001_systemd-001",
  "source_directory": "/tasks_new/systemd_systemd-full-001/official-afc-systemd",
  "llm_usage": {
    "total_cost": 0.1399948,
    "prompt_tokens": 48316,
    "completion_tokens": 19738
  },
  "variant": "sound",
  "diff": "--- a/src/udev/udev-rules.c\n+++ b/src/udev/udev-rules.c\n@@ -1184,13 +1184,20 @@\n                  * The return value must be terminated by two subsequent NULs\n                  * so it could be safely interpreted as nulstr.\n                  */\n-                if (is_prefix_match){\n+                {\n+                    size_t orig_len = strlen(str) + 1;\n+                    size_t offset = (size_t)(j - str);\n+                    size_t needed = is_prefix_match ? 3 : 2;\n+                    if (offset + needed > orig_len)\n+                        return -EINVAL;\n+                    if (is_prefix_match) {\n                         j[0] = '*';\n                         j[1] = '\\0';\n                         j[2] = '\\0';\n-                } else {\n+                    } else {\n                         j[0] = '\\0';\n                         j[1] = '\\0';\n+                    }\n                 }\n                 str = m;            \n         } else {\n@@ -1215,18 +1222,23 @@\n                 * The return value must be terminated by two subsequent NULs\n                 * so it could be safely interpreted as nulstr.\n                 */\n-                if (is_prefix_match){\n+                {\n+                    size_t orig_len = strlen(str) + 1;\n+                    size_t needed = is_prefix_match ? 3 : 2;\n+                    if ((pos - 1) + (l + needed) > orig_len)\n+                        return -EINVAL;\n+                    if (is_prefix_match) {\n                         /* need more room to make rule glob match */\n                         memcpy(str + pos - 1, unescaped, l + 1);\n                         str[pos + l - 1] = '*';\n-                        str[pos + l] = '\\0';\n+                        str[pos + l]     = '\\0';\n                         str[pos + l + 1] = '\\0';\n                         m = str + pos - 1;\n-\n-                } else {\n+                    } else {\n                         memcpy(m, unescaped, l + 1);\n-                        m[l] = '\\0';\n+                        m[l]     = '\\0';\n                         m[l + 1] = '\\0';\n+                    }\n                 }\n                 str = m;\n \n",
  "stdout": "",
  "stderr": ""
}