{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_002",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.7380658999999999,
    "prompt_tokens": 470109,
    "completion_tokens": 50215
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-telnet.c\n+++ b/epan/dissectors/packet-telnet.c\n@@ -636,9 +636,7 @@\n dissect_linemode_subopt(packet_info *pinfo, const char *optname _U_, tvbuff_t *tvb _U_, int offset _U_,\n                     int len _U_, proto_tree *tree _U_, proto_item *item _U_)\n {\n-  if ( hf_telnet_naws_subopt_set )\n-    wmem_free(pinfo->pool, hf_naws_data);\n-\n+  (void)pinfo;\n   return;\n }\n \n@@ -2095,8 +2093,12 @@\n         /* Data is escaped, we have to unescape it. */\n         unescaped_tvb = unescape_and_tvbuffify_telnet_option(pinfo, tvb, start_offset, subneg_len);\n         (*opt->dissect)(pinfo, opt->name, unescaped_tvb, 0, subneg_len - iac_data, option_tree, option_item);\n-      } else {\n-        (*opt->dissect)(pinfo, opt->name, tvb, start_offset, subneg_len, option_tree, option_item);\n+        if ( hf_telnet_naws_subopt_set ) {\n+          /* Reset NAWS state; buffer will be freed by pool teardown */\n+          hf_naws_data = NULL;\n+          hf_telnet_naws_subopt_set = 0;\n+          hf_telnet_line = 0;\n+        }\n       }\n     } else {\n       /* We don't have a dissector for them; just show them as data. */\n",
  "stdout": "",
  "stderr": ""
}