{
  "project_name": "libavif",
  "vulnerability_identifier": "libavif_av-delta-02_avif-002",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-libavif",
  "llm_usage": {
    "total_cost": 0.5373522000000002,
    "prompt_tokens": 278934,
    "completion_tokens": 52392
  },
  "variant": "sound",
  "diff": "--- a/src/reformat.c\n+++ b/src/reformat.c\n@@ -631,6 +631,7 @@\n                                               const avifReformatState * state,\n                                               avifAlphaMultiplyMode alphaMultiplyMode)\n {\n+    (void)alphaMultiplyMode;\n     // Aliases for some state\n     const float kr = state->yuv.kr;\n     const float kg = state->yuv.kg;\n@@ -770,14 +771,12 @@\n                     spill_Cr = AVIF_CLAMP(Cr - AVIF_CLAMP(Cr,minCr,maxCr),0.0f,1.0f);\n                     spill_Cb = AVIF_CLAMP(Cb - AVIF_CLAMP(Cb,minCb,maxCb),0.0f,1.0f);\n \n-                    // now we have generated the spill, get it's neigbors\n-                    int adjCol = (i%2) ? -1 : 1;\n-                    int adjRow = (j%2) ? -1 : 1;\n-                    // check the bounds\n-                    if (i + adjCol >= image->width){\n+                    int adjCol = (i % 2) ? -1 : 1;\n+                    if ((int)i + adjCol < 0 || (int)i + adjCol >= (int)image->width) {\n                         adjCol = 0;\n                     }\n-                    if (j + adjRow >= image->height){\n+                    int adjRow = (j % 2) ? -1 : 1;\n+                    if ((int)j + adjRow < 0 || (int)j + adjRow >= (int)image->height) {\n                         adjRow = 0;\n                     }\n                     float pSpillCb = spill_Cb/3;\n@@ -795,27 +794,25 @@\n                     total_spill += fabs(spill_Cb);\n                     total_spill += fabs(spill_Cr);\n                     // if spill too high, dampen\n-                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)){\n-                        int a, b;\n-                        if (i % 2 == 0){\n-                            a = 1;\n-                        }else{\n-                            a = -1;\n-                        }\n-                        if (j % 2 == 0){\n-                            b = 1;\n-                        }else{\n-                            b = -1;\n-                        }\n-                        uspill_image[i][j] -= pSpillCb;\n-                        vspill_image[i][j] -= pSpillCb;\n-                        uspill_image[i+a][j] -= pSpillCb;\n-                        vspill_image[i+a][j] -= pSpillCr;\n-                        uspill_image[i][j+b] -= pSpillCb;\n-                        vspill_image[i][j+b] -= pSpillCr;\n-                        uspill_image[i+a][j+b] -= pSpillCb;\n-                        vspill_image[i+a][j+b] -= pSpillCr;\n-                    }   \n+                    if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)) {\n+                        int a = (i % 2 == 0) ? 1 : -1;\n+                        int b = (j % 2 == 0) ? 1 : -1;\n+                        if ((int)i + a < 0 || (int)i + a >= (int)image->width) {\n+                            a = 0;\n+                        }\n+                        if ((int)j + b < 0 || (int)j + b >= (int)image->height) {\n+                            b = 0;\n+                        }\n+                        const int offsets[4][2] = {{0, 0}, {a, 0}, {0, b}, {a, b}};\n+                        for (int k = 0; k < 4; ++k) {\n+                            int xi = (int)i + offsets[k][0];\n+                            int yj = (int)j + offsets[k][1];\n+                            if (xi >= 0 && xi < (int)image->width && yj >= 0 && yj < (int)image->height) {\n+                                uspill_image[xi][yj] -= pSpillCb;\n+                                vspill_image[xi][yj] -= pSpillCr;\n+                            }\n+                        }\n+                    }\n                 }\n             }\n             // break out of iteration if improvement is small compared to the size of the image\n",
  "stdout": "",
  "stderr": ""
}