{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.08757430000000001,
    "prompt_tokens": 38541,
    "completion_tokens": 10268
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1157,13 +1157,19 @@\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n-            //if file already exists, prepend uuid\n+            // Enforce no path traversal: ensure output file stays within extractDir\n+            java.nio.file.Path root = extractDir.toPath().toAbsolutePath().normalize();\n+            java.nio.file.Path candidate = root.resolve(normalizedName).normalize();\n+            if (!candidate.startsWith(root)) {\n+                // sanitize traversal attempt by using only the base file name\n+                String baseName = FilenameUtils.getName(normalizedName);\n+                candidate = root.resolve(baseName).normalize();\n+            }\n+            File outputFile = candidate.toFile();\n             if (outputFile.exists()) {\n-                String fileName = FilenameUtils.getName(normalizedName);\n-                outputFile = new File(extractDir, UUID\n-                        .randomUUID()\n-                        .toString() + \"-\" + fileName);\n+                String fileName = outputFile.getName();\n+                java.nio.file.Path unique = root.resolve(UUID.randomUUID().toString() + \"-\" + fileName).normalize();\n+                outputFile = unique.toFile();\n             }\n             return outputFile;\n         }\n",
  "stdout": "",
  "stderr": ""
}