--- a/parser.c
+++ b/parser.c
@@ -4000,9 +4000,14 @@
                     return;
                 }
 
-                // Grow the buffer to handle the input
-                xmlSBufGrow(buf, str - chunk);
-                xmlSBufAddEntitySecure(buf, ent->name, ent->length);
+                // Ensure the upcoming content fits
+                if (xmlParserEntityCheck(ctxt, ent->length))
+                    return;
+                // Grow buffer to accommodate the entityâ€™s content
+                if (xmlSBufGrow(buf, ent->length) < 0)
+                    return;
+                // Copy the actual entity content, not its name
+                xmlSBufAddEntitySecure(buf, ent->content, ent->length);
 
                 chunk = str;
             } else {
