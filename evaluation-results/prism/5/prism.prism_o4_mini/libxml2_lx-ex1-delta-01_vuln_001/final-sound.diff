--- a/HTMLparser.c
+++ b/HTMLparser.c
@@ -3331,12 +3331,16 @@
     buffer_size = ctxt->spaceMax;
     buffer = (xmlChar *) ctxt->spaceTab;
     if (buffer == NULL) {
-        buffer_size = 500;
-        buffer = xmlMalloc(buffer_size + 1);
+        /* initialize with a sufficiently large buffer, respecting maxLength */
+        size_t initial = HTML_PARSER_BIG_BUFFER_SIZE;
+        if (maxLength > 0 && (size_t)maxLength < initial)
+            initial = (size_t)maxLength;
+        buffer = (xmlChar *)xmlMalloc(initial + 1);
         if (buffer == NULL) {
             htmlErrMemory(ctxt);
             return(NULL);
         }
+        buffer_size = initial;
     }
 
     line = input->line;
