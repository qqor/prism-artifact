{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-delta-03_vuln_003",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 0.6048053,
    "prompt_tokens": 463667,
    "completion_tokens": 21539
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/codec/rfx_types.h\n+++ b/libfreerdp/codec/rfx_types.h\n@@ -118,11 +118,12 @@\n \tRFX_TILE** tiles;\n \n \tUINT16 numQuant;\n-\tUINT32* quantVals;\n+    UINT32 * quantVals;\n \n-\tUINT32 tilesDataSize;\n-\n-\tBOOL freeArray;\n+    UINT32 tilesDataSize;\n+    UINT64 metadataBlock;\n+    UINT64 metadataData;\n+    BOOL freeArray;\n };\n \n struct S_RFX_MESSAGE_LIST\n\n--- a/libfreerdp/codec/rfx.c\n+++ b/libfreerdp/codec/rfx.c\n@@ -706,33 +706,53 @@\n \treturn TRUE;\n }\n \n-static INLINE BOOL rfx_process_message_metadata(RFX_CONTEXT* WINPR_RESTRICT context,\n-\t\t\t\t\t\t\t\t\t\t\t\tRFX_MESSAGE* WINPR_RESTRICT message,\n-\t\t\t\t\t\t\t\t\t\t\t\twStream* WINPR_RESTRICT s,\n-\t\t\t\t\t\t\t\t\t\t\t\tUINT16* WINPR_RESTRICT pExpectedBlockType)\n-{\n-\tUINT32 magic = 0;\n-\n-\tWINPR_ASSERT(context);\n-\tWINPR_ASSERT(context->priv);\n-\tWINPR_ASSERT(message);\n-\tWINPR_ASSERT(s);\n-\tWINPR_ASSERT(pExpectedBlockType);\n-\n-\tif (*pExpectedBlockType != WBT_FRAME_END)\n-\t{\n-\t\tWLog_Print(context->priv->log, WLOG_ERROR, \"message unexpected wants WBT_FRAME_END (0x%x)\", *pExpectedBlockType);\n-\t\treturn FALSE;\n-\t}\n-\n-\tStream_Read_UINT32(s, magic); /* magic (4 bytes), 0xCACCACCA */\n-\tif (magic != WF_MAGIC)\n-\t{\n-\t\tWLog_Print(context->priv->log, WLOG_ERROR, \"invalid magic number 0x%08\" PRIX32 \"\", magic);\n-\t\treturn FALSE;\n-\t}\n-\t*(UINT64*)metadataBlock = metadataData;\n-\treturn TRUE;\n+static INLINE BOOL rfx_process_message_metadata(RFX_CONTEXT* context,\n+                                                RFX_MESSAGE* message,\n+                                                wStream* s,\n+                                                UINT16* pExpectedBlockType)\n+{\n+    UINT32 magic = 0;\n+    UINT64 blockOffset = 0;\n+    UINT64 dataValue = 0;\n+\n+    WINPR_ASSERT(context);\n+    WINPR_ASSERT(context->priv);\n+    WINPR_ASSERT(message);\n+    WINPR_ASSERT(s);\n+    WINPR_ASSERT(pExpectedBlockType);\n+\n+    if (*pExpectedBlockType != WBT_FRAME_END)\n+    {\n+        WLog_Print(context->priv->log, WLOG_ERROR,\n+                   \"message unexpected wants WBT_FRAME_END (0x%\" PRIu16 \")\",\n+                   *pExpectedBlockType);\n+        return FALSE;\n+    }\n+\n+    *pExpectedBlockType = WBT_FRAME_BEGIN;\n+    WLog_Print(context->priv->log, WLOG_DEBUG,\n+               \"RFX_FRAME_BEGIN\");\n+\n+    /* verify and read magic */\n+    if (!Stream_CheckAndLogRequiredLengthWLog(context->priv->log, s, 4))\n+        return FALSE;\n+    Stream_Read_UINT32(s, magic);\n+    if (magic != WF_MAGIC)\n+    {\n+        WLog_Print(context->priv->log, WLOG_ERROR,\n+                   \"invalid magic number 0x%08\" PRIX32, magic);\n+        return FALSE;\n+    }\n+\n+    /* read metadata block offset and data */\n+    if (!Stream_CheckAndLogRequiredLengthWLog(context->priv->log, s, 16))\n+        return FALSE;\n+    Stream_Read_UINT64(s, blockOffset);\n+    Stream_Read_UINT64(s, dataValue);\n+    message->metadataBlock = blockOffset;\n+    message->metadataData = dataValue;\n+\n+    return TRUE;\n }\n \n static INLINE BOOL rfx_resize_rects(RFX_MESSAGE* WINPR_RESTRICT message)\n",
  "stdout": "",
  "stderr": ""
}