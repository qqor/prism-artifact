--- a/src/fmt.c
+++ b/src/fmt.c
@@ -314,17 +314,21 @@
         n += scpy(out, param, p, pr);
         for (j = 0; minus && pr < w && j + pr < w; j++)
           n += scpy(out, param, &pad, 1);
-      } else if (c == 'e' || c == 'E') {
-		  char tmp[8];
-          double d = va_arg(*ap, double);
-          int64_t exponent = (int64_t)log10(my_fabs(d));
-          double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
-          n += scpy(out, param, tmp, k);
+    } else if (c == 'e' || c == 'E') {
+        char tmp[64];
+        /* default precision if not specified */
+        if (pr == (size_t)~0U) pr = 6;
+        /* clamp precision to buffer capacity */
+        if (pr > sizeof(tmp) - 1) pr = sizeof(tmp) - 1;
+        double d = va_arg(*ap, double);
+        int64_t exponent = (int64_t)log10(my_fabs(d));
+        double mantissa = d / power(10, exponent);
+        k = mg_dtoa(tmp, sizeof(tmp), mantissa, (int)pr, c == 'e');
+        n += scpy(out, param, tmp, k);
+        out(c, param); n++;
+        k = mg_lld(tmp, exponent, 1, 0);
+        n += scpy(out, param, tmp, k);
+    }
 	  } else if (c == '%') {
         out('%', param);
         n++;

--- a/mongoose.c
+++ b/mongoose.c
@@ -816,17 +816,21 @@
         n += scpy(out, param, p, pr);
         for (j = 0; minus && pr < w && j + pr < w; j++)
           n += scpy(out, param, &pad, 1);
-      } else if (c == 'e' || c == 'E') {
-		  char tmp[8];
-          double d = va_arg(*ap, double);
-          int64_t exponent = (int64_t)log10(my_fabs(d));
-          double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
-          n += scpy(out, param, tmp, k);
+    } else if (c == 'e' || c == 'E') {
+        char tmp[64];
+        /* default precision if not specified */
+        if (pr == (size_t)~0U) pr = 6;
+        /* clamp precision to buffer capacity */
+        if (pr > sizeof(tmp) - 1) pr = sizeof(tmp) - 1;
+        double d = va_arg(*ap, double);
+        int64_t exponent = (int64_t)log10(my_fabs(d));
+        double mantissa = d / power(10, exponent);
+        k = mg_dtoa(tmp, sizeof(tmp), mantissa, (int)pr, c == 'e');
+        n += scpy(out, param, tmp, k);
+        out(c, param); n++;
+        k = mg_lld(tmp, exponent, 1, 0);
+        n += scpy(out, param, tmp, k);
+    }
 	  } else if (c == '%') {
         out('%', param);
         n++;
