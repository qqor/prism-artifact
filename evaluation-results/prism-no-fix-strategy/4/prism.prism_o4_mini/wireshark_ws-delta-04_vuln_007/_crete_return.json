{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-04_vuln_007",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.32053119999999996,
    "prompt_tokens": 190292,
    "completion_tokens": 25275
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-json.c\n+++ b/epan/dissectors/packet-json.c\n@@ -350,32 +350,32 @@\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n \t\t\t\t\t\t\n-\t\t\t\t\t\telse if (current_character == 'U') {\n-\t\t\t\t\t\t\tuint16_t lead_surrogate = code_point;\n-\t\t\t\t\t\t\tuint16_t trail_surrogate = 0;\n-\t\n-\t\t\t\t\t\t\tread_index++;\n-\t\n-\t\t\t\t\t\t\tfor (int i = 0; i < 8; i++)\n-\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\tcurrent_character = string[read_index];\n-\t\t\t\t\t\t\t\tread_index++;\n-\t\n-\t\t\t\t\t\t\t\tint nibble = ws_xton(current_character);\n-\t\n-\t\t\t\t\t\t\t\ttrail_surrogate <<= 4;\n-\t\t\t\t\t\t\t\ttrail_surrogate |= nibble;\n-\t\t\t\t\t\t\t}\n-\t\n-\t\t\t\t\t\t\tif ((IS_TRAIL_SURROGATE(trail_surrogate)))\n-\t\t\t\t\t\t\t{\t\n-\t\t\t\t\t\t\t\tcode_point = SURROGATE_VALUE(lead_surrogate, trail_surrogate);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\telse\n-\t\t\t\t\t\t\t{\n-\t\t\t\t\t\t\t\tis_valid_unicode_character = false;\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n+                        else if (current_character == 'U') {\n+                            uint16_t lead_surrogate = code_point;\n+                            uint16_t trail_surrogate = 0;\n+\n+                            read_index++;\n+                            /* parse 8 hex digits safely for full surrogate with bounds and validity checks */\n+                            for (int i = 0; i < 8; i++) {\n+                                if (read_index >= string_length) {\n+                                    is_valid_unicode_character = false;\n+                                    break;\n+                                }\n+                                current_character = string[read_index++];\n+                                int nibble = ws_xton(current_character);\n+                                if (nibble < 0) {\n+                                    is_valid_unicode_character = false;\n+                                    break;\n+                                }\n+                                trail_surrogate = (trail_surrogate << 4) | nibble;\n+                            }\n+\n+                            if (is_valid_unicode_character && IS_TRAIL_SURROGATE(trail_surrogate)) {\n+                                code_point = SURROGATE_VALUE(lead_surrogate, trail_surrogate);\n+                            } else {\n+                                is_valid_unicode_character = false;\n+                            }\n+                        }\n \t\t\t\t\t\telse\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\tread_index++;\n",
  "stdout": "",
  "stderr": ""
}