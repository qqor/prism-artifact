{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-delta-01_vuln_5",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.1291334,
    "prompt_tokens": 87882,
    "completion_tokens": 7378
  },
  "variant": "sound",
  "diff": "--- a/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n+++ b/poi-ooxml/src/main/java/org/apache/poi/xssf/extractor/XSSFEventBasedExcelExtractor.java\n@@ -59,9 +59,11 @@\n import org.apache.poi.xssf.usermodel.XSSFSimpleShape;\n import org.apache.xmlbeans.XmlException;\n import org.xml.sax.Attributes;\n-import org.xml.sax.ContentHandler;\n-import org.xml.sax.InputSource;\n-import org.xml.sax.SAXException;\n+ import org.xml.sax.ContentHandler;\n+ import org.xml.sax.InputSource;\n+ import org.xml.sax.XMLReader;\n+ import javax.xml.XMLConstants;\n+ import org.xml.sax.SAXException;\n import org.xml.sax.XMLReader;\n import org.xml.sax.helpers.DefaultHandler;\n \n@@ -312,8 +314,18 @@\n         }\n         PackagePart part = parts.get(0);\n         try (InputStream is = part.getInputStream()) {\n-            SAXParser parser = SAXParserFactory.newInstance().newSAXParser();\n-            parser.parse(is, new ExtendedPropertiesHandler(text));\n+ SAXParser parser = SAXParserFactory.newInstance().newSAXParser();\n+ // disable external entities and DTDs to prevent SSRF\n+ XMLReader reader = parser.getXMLReader();\n+ try {\n+     reader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false);\n+     reader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false);\n+     reader.setFeature(\"http://apache.org/xml/features/nonvalidating/load-external-dtd\", false);\n+     reader.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true);\n+ } catch (SAXException e) {\n+     // ignore unsupported features\n+ }\n+ parser.parse(is, new ExtendedPropertiesHandler(text));\n         } catch (ParserConfigurationException | SAXException | IOException e) {\n             //swallow\n         }\n",
  "stdout": "",
  "stderr": ""
}