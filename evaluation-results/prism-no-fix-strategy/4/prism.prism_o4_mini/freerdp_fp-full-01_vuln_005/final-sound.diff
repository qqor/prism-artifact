--- a/libfreerdp/core/freerdp.c
+++ b/libfreerdp/core/freerdp.c
@@ -1449,15 +1449,22 @@
 	wStream sbuffer = { 0 };
 	wStream* s = Stream_StaticConstInit(&sbuffer, data, size);
 
-	WINPR_ASSERT(data || (size == 0));
-	WINPR_ASSERT(s);
-
-	rdpMcs* mcs = test_mcs_new();
-	WINPR_ASSERT(mcs);
-
-	BOOL result = mcs_recv_connect_response(mcs, s);
-	test_mcs_free(mcs);
-	return result;
+    if (!data && (size != 0))
+        return FALSE;
+    if (!s)
+        return FALSE;
+
+    rdpMcs* mcs = test_mcs_new();
+    if (!mcs)
+        return FALSE;
+
+    BOOL result = FALSE;
+    if (mcs_recv_connect_initial(mcs, s))
+        result = mcs_recv_connect_response(mcs, s);
+
+    test_mcs_free(mcs);
+
+    return result;
 }
 
 BOOL freerdp_persist_credentials(rdpContext* context)
