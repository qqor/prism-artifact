--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java
+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java
@@ -87,11 +87,23 @@
         if ((offset < 0) || (offset >= string.length)) {
             throw new ArrayIndexOutOfBoundsException("Illegal offset " + offset + " (String data is of length " + string.length + ")");
         }
-        if ((len < 0) || (((string.length - offset) / 2) < len)) {
-            throw new IllegalArgumentException("Illegal length " + len);
-        }
-
-        return new String(string, offset, len * 2, UTF16LE);
+    if (len < 0) {
+        throw new IllegalArgumentException("Illegal len " + len);
+    }
+    if (len == 0) {
+        return "";
+    }
+    if ((offset < 0) || (offset > string.length) ||
+        ((string.length - offset) / 2 < len)) {
+        throw new ArrayIndexOutOfBoundsException(
+            "Illegal offset (" + offset + ") or len (" + len + ")");
+   }
+   // guard against untrusted data causing excessive memory use
+   if ((long) len * 2 > MAX_RECORD_LENGTH) {
+       throw new IllegalArgumentException("Unicode LE string too large: " + len
+           + " chars (" + (len * 2) + " bytes)");
+   }
+   return new String(string, offset, len * 2, UTF16LE);
     }
 
     /**
