{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.8205989,
    "prompt_tokens": 676187,
    "completion_tokens": 17453
  },
  "variant": "sound",
  "diff": "--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java\n+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java\n@@ -87,11 +87,23 @@\n         if ((offset < 0) || (offset >= string.length)) {\n             throw new ArrayIndexOutOfBoundsException(\"Illegal offset \" + offset + \" (String data is of length \" + string.length + \")\");\n         }\n-        if ((len < 0) || (((string.length - offset) / 2) < len)) {\n-            throw new IllegalArgumentException(\"Illegal length \" + len);\n-        }\n-\n-        return new String(string, offset, len * 2, UTF16LE);\n+    if (len < 0) {\n+        throw new IllegalArgumentException(\"Illegal len \" + len);\n+    }\n+    if (len == 0) {\n+        return \"\";\n+    }\n+    if ((offset < 0) || (offset > string.length) ||\n+        ((string.length - offset) / 2 < len)) {\n+        throw new ArrayIndexOutOfBoundsException(\n+            \"Illegal offset (\" + offset + \") or len (\" + len + \")\");\n+   }\n+   // guard against untrusted data causing excessive memory use\n+   if ((long) len * 2 > MAX_RECORD_LENGTH) {\n+       throw new IllegalArgumentException(\"Unicode LE string too large: \" + len\n+           + \" chars (\" + (len * 2) + \" bytes)\");\n+   }\n+   return new String(string, offset, len * 2, UTF16LE);\n     }\n \n     /**\n",
  "stdout": "",
  "stderr": ""
}