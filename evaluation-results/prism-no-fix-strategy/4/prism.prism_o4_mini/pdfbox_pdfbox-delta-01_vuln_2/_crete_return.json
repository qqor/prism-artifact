{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-delta-01_vuln_2",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.6016461,
    "prompt_tokens": 391075,
    "completion_tokens": 38969
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n@@ -13,6 +13,7 @@\n import java.nio.file.Files;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n+import java.nio.file.InvalidPathException;\n import java.nio.file.SimpleFileVisitor;\n import java.nio.file.attribute.BasicFileAttributes;\n import java.util.ArrayList;\n@@ -155,11 +156,24 @@\n     }\n \n     private String runTesseract(Path image) throws IOException {\n-        String actualTessPath = pdDocument.getDocumentInformation()\n+        String candidateTessPath = pdDocument.getDocumentInformation()\n                 .getCustomMetadataValue(TESSERACT_PATH_KEY);\n-        if (actualTessPath == null || actualTessPath.isEmpty()) {\n-            actualTessPath = tesseractPath;\n-        }\n+        Path tessExecutablePath;\n+        try {\n+            if (candidateTessPath != null && !candidateTessPath.isEmpty()) {\n+                tessExecutablePath = Paths.get(candidateTessPath);\n+                if (!Files.exists(tessExecutablePath)\n+                    || !Files.isRegularFile(tessExecutablePath)\n+                    || !Files.isExecutable(tessExecutablePath)) {\n+                    throw new IOException(\"Invalid tesseract executable path: \" + candidateTessPath);\n+                }\n+            } else {\n+                tessExecutablePath = Paths.get(tesseractPath);\n+            }\n+        } catch (InvalidPathException e) {\n+            throw new IOException(\"Invalid tesseract executable path: \" + candidateTessPath, e);\n+        }\n+        String actualTessPath = tessExecutablePath.toRealPath().toString();\n \n         Path txt = Paths.get(image.toAbsolutePath().toString());\n         doOCR(actualTessPath, image, txt);\n",
  "stdout": "",
  "stderr": ""
}