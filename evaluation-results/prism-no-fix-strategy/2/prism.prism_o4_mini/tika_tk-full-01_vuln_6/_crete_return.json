{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_6",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 3.1170711000000004,
    "prompt_tokens": 2635777,
    "completion_tokens": 49481
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n@@ -21,7 +21,7 @@\n import java.nio.file.Files;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n-\n+import java.nio.file.StandardCopyOption;\n import org.apache.commons.compress.archivers.tar.TarArchiveEntry;\n import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;\n \n@@ -36,18 +36,21 @@\n         try (InputStream is = Files.newInputStream(inputFile);\n                 TarArchiveInputStream tais = new TarArchiveInputStream(is)) {\n \n-            TarArchiveEntry tae = tais.getNextEntry();\n-\n-            while (tae != null) {\n-                if (tae.isFile()) {\n-                    Path target = extractDir.resolve(tae.getName()).normalize();\n-                    if (!Files.isDirectory(target.getParent())) {\n-                        Files.createDirectories(target.getParent());\n+                    TarArchiveEntry tae;\n+                    while ((tae = tais.getNextEntry()) != null) {\n+                        if (!tae.isFile()) {\n+                            continue;\n+                        }\n+                        Path target = extractDir.resolve(tae.getName()).normalize().toAbsolutePath();\n+                        Path destDir = extractDir.toAbsolutePath().normalize();\n+                        if (!target.startsWith(destDir)) {\n+                            continue;\n+                        }\n+                        if (!Files.isDirectory(target.getParent())) {\n+                            Files.createDirectories(target.getParent());\n+                        }\n+                        Files.copy(tais, target, StandardCopyOption.REPLACE_EXISTING);\n                     }\n-                    Files.write(target, tais.readAllBytes());\n-                }\n-                tae = tais.getNextEntry();\n-            }\n         }\n     }\n }\n",
  "stdout": "",
  "stderr": ""
}