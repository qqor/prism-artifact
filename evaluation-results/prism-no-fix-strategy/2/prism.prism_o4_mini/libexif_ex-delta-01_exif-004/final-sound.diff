--- a/libexif/apple/exif-mnote-data-apple.c
+++ b/libexif/apple/exif-mnote-data-apple.c
@@ -123,9 +123,20 @@
 		continue;
 	}
         ofs += 12;
+
+        if (dofs + dsize > buf_size) {
+            exif_log(md->log, EXIF_LOG_CODE_CORRUPT_DATA,
+                     "ExifMnoteDataApple",
+                     "Data size overflow detected (%u > %u)",
+                     dofs + dsize, buf_size);
+            continue;
+        }
+
         d->entries[i].data = exif_mem_alloc(md->mem, dsize);
         if (!d->entries[i].data) {
-            EXIF_LOG_NO_MEMORY(md->log, "ExifMnoteApple", dsize);
+            EXIF_LOG_NO_MEMORY(md->log,
+                               "ExifMnoteDataApple",
+                               dsize);
             continue;
         }
         memcpy(d->entries[i].data, buf + dofs, dsize);
