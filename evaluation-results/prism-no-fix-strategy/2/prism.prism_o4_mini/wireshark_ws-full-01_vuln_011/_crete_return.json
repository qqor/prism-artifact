{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_011",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 1.3710587000000003,
    "prompt_tokens": 971657,
    "completion_tokens": 68690
  },
  "variant": "sound",
  "diff": "--- a/epan/tvbuff.h\n+++ b/epan/tvbuff.h\n@@ -46,6 +46,8 @@\n \n struct tvbuff;\n typedef struct tvbuff tvbuff_t;\n+/* Ensure a buffer range is present in the tvb, or throw a BoundsError */\n+WS_DLL_PUBLIC void tvb_ensure_bytes_exist(const tvbuff_t *tvb, int offset, int length);\n \n /** @defgroup tvbuff Testy, Virtual(-izable) Buffers\n  *\n\n--- a/epan/dissectors/packet-aim.c\n+++ b/epan/dissectors/packet-aim.c\n@@ -15,14 +15,15 @@\n \n \n #include <epan/packet.h>\n+#include <epan/tvbuff.h>\n #include <epan/strutil.h>\n #include <epan/to_str.h>\n #include <epan/tfs.h>\n+#include <epan/prefs.h>\n+#include <epan/expert.h>\n \n #include \"packet-tcp.h\"\n #include \"packet-tls.h\"\n-#include <epan/prefs.h>\n-#include <epan/expert.h>\n \n void proto_register_aim(void);\n void proto_reg_handoff_aim(void);\n@@ -583,14 +584,21 @@\n {\n \tuint16_t buddyname_length;\n \n-\t*name = wmem_alloc(pool, 256);\n-\n-\tbuddyname_length = tvb_get_ntohs(tvb, offset);\n-\n-\tif (pool)\n-\t\tmemcpy(*name, tvb_get_ptr(tvb,offset,1), buddyname_length);\n-\n-\treturn buddyname_length;\n+    *name = wmem_alloc(pool, 256);\n+\n+    buddyname_length = tvb_get_ntohs(tvb, offset);\n+\n+    /* Clamp buddyname_length to the allocated buffer size and ensure enough data */\n+    if (buddyname_length > 256)\n+        buddyname_length = 256;\n+    tvb_ensure_bytes_exist(tvb, offset, buddyname_length);\n+\n+    if (pool)\n+        memcpy(*name,\n+               tvb_get_ptr(tvb, offset, buddyname_length),\n+               buddyname_length);\n+\n+    return buddyname_length;\n }\n \n \n",
  "stdout": "",
  "stderr": ""
}