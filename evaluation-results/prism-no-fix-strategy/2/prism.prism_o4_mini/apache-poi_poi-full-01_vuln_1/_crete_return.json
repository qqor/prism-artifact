{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 1.1776017,
    "prompt_tokens": 982423,
    "completion_tokens": 22031
  },
  "variant": "sound",
  "diff": "--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java\n+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java\n@@ -30,8 +30,8 @@\n  */\n @Internal\n public final class StringUtil {\n-    //arbitrarily selected; may need to increase\n-    private static final int DEFAULT_MAX_RECORD_LENGTH = 10000000;\n+    // maximum UnicodeLE string length to prevent OOM; adjust as needed\n+    private static final int DEFAULT_MAX_RECORD_LENGTH = 500_000;\n     private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;\n \n     public static final Charset UTF16LE = StandardCharsets.UTF_16LE;\n@@ -81,18 +81,23 @@\n             final int offset,\n             final int len)\n             throws ArrayIndexOutOfBoundsException, IllegalArgumentException {\n+        // Prevent excessive allocation from malformed or malicious data\n+        if (len > MAX_RECORD_LENGTH) {\n+            throw new IllegalArgumentException(\"UnicodeLE string length \" +\n+                    len + \" exceeds maximum of \" + MAX_RECORD_LENGTH);\n+        }\n         if (len == 0) {\n             return \"\";\n         }\n         if ((offset < 0) || (offset >= string.length)) {\n-            throw new ArrayIndexOutOfBoundsException(\"Illegal offset \" + offset + \" (String data is of length \" + string.length + \")\");\n+            throw new ArrayIndexOutOfBoundsException(\"Illegal offset \" + offset +\n+                    \" (String data is of length \" + string.length + \")\");\n         }\n         if ((len < 0) || (((string.length - offset) / 2) < len)) {\n             throw new IllegalArgumentException(\"Illegal length \" + len);\n         }\n-\n         return new String(string, offset, len * 2, UTF16LE);\n-    }\n+   }\n \n     /**\n      * Given a byte array of 16-bit unicode characters in little endian\n",
  "stdout": "",
  "stderr": ""
}