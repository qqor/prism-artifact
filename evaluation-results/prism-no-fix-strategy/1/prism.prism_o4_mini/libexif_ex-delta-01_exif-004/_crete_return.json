{
  "project_name": "libexif",
  "vulnerability_identifier": "libexif_ex-delta-01_exif-004",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-libexif",
  "llm_usage": {
    "total_cost": 0.1506483,
    "prompt_tokens": 98689,
    "completion_tokens": 9566
  },
  "variant": "sound",
  "diff": "--- a/libexif/apple/exif-mnote-data-apple.c\n+++ b/libexif/apple/exif-mnote-data-apple.c\n@@ -117,7 +117,7 @@\n         } else {\n             dofs = ofs + 8;\n         }\n-\tif (dofs > buf_size) {\n+    if (dofs >= buf_size) {\n \t\texif_log (md->log, EXIF_LOG_CODE_CORRUPT_DATA,\n                                   \"ExifMnoteApplet\", \"Tag size overflow detected (%u vs size %u)\", dofs, buf_size);\n \t\tcontinue;\n@@ -128,8 +128,18 @@\n             EXIF_LOG_NO_MEMORY(md->log, \"ExifMnoteApple\", dsize);\n             continue;\n         }\n-        memcpy(d->entries[i].data, buf + dofs, dsize);\n-        d->entries[i].size = dsize;\n+        {\n+            unsigned int copy_size = dsize;\n+            if (dofs + dsize > buf_size) {\n+                exif_log(md->log, EXIF_LOG_CODE_CORRUPT_DATA,\n+                         \"ExifMnoteDataApple\",\n+                         \"Tag size overflow detected (%u > available %u)\",\n+                         dsize, buf_size - dofs);\n+                copy_size = buf_size - dofs;\n+            }\n+            memcpy(d->entries[i].data, buf + dofs, copy_size);\n+            d->entries[i].size = copy_size;\n+        }\n     }\n     d->count = tcount;\n \n",
  "stdout": "",
  "stderr": ""
}