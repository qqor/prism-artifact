{
  "project_name": "shadowsocks",
  "vulnerability_identifier": "shadowsocks_shadowsocks-full-01_shadowsocks-libev_1",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-shadowsocks-libev",
  "llm_usage": {
    "total_cost": 1.1423225000000001,
    "prompt_tokens": 802795,
    "completion_tokens": 58920
  },
  "variant": "sound",
  "diff": "--- a/src/json.c\n+++ b/src/json.c\n@@ -301,59 +301,65 @@\n                   case 'n':  string_add ('\\n');  break;\n                   case 'r':  string_add ('\\r');  break;\n                   case 't':  string_add ('\\t');  break;\n-                  case 'u':\n-\n-                    if (end - state.ptr < 4 || \n-                        (uc_b1 = hex_value (*++ state.ptr)) == 0xFF ||\n-                        (uc_b2 = hex_value (*++ state.ptr)) == 0xFF ||\n-                        (uc_b3 = hex_value (*++ state.ptr)) == 0xFF ||\n-                        (uc_b4 = hex_value (*++ state.ptr)) == 0xFF)\n-                    {\n-                        sprintf (error, \"Invalid character value `%c` (at %d:%d)\", b, line_and_col);\n-                        goto e_failed;\n-                    }\n-\n-                    uc_b1 = (uc_b1 << 4) | uc_b2;\n-                    uc_b2 = (uc_b3 << 4) | uc_b4;\n-                    uchar = (uc_b1 << 8) | uc_b2;\n-\n-                    if ((uchar & 0xF800) == 0xD800) {\n-                        json_uchar uchar2;\n-                        \n-                        if (end - state.ptr < 6 || (*++ state.ptr) != '\\\\' || (*++ state.ptr) != 'u' ||\n-                            (uc_b1 = hex_value (*++ state.ptr)) == 0xFF ||\n-                            (uc_b2 = hex_value (*++ state.ptr)) == 0xFF ||\n-                            (uc_b3 = hex_value (*++ state.ptr)) == 0xFF ||\n-                            (uc_b4 = hex_value (*++ state.ptr)) == 0xFF)\n-                        {\n-                            sprintf (error, \"Invalid character value `%c` (at %d:%d)\", b, line_and_col);\n-                            goto e_failed;\n-                        }\n-\n-                        uc_b1 = (uc_b1 << 4) | uc_b2;\n-                        uc_b2 = (uc_b3 << 4) | uc_b4;\n-                        uchar2 = (uc_b1 << 8) | uc_b2;\n-                        \n-                        uchar = 0x010000 | ((uchar & 0x3FF) << 10) | (uchar2 & 0x3FF);\n-                    }\n-\n-                    if (sizeof (json_char) >= sizeof (json_uchar) || (uchar <= 0x7F))\n-                    {\n-                       string_add ((json_char) uchar);\n-                       break;\n-                    }\n-\n-                    if (uchar <= 0x7FF)\n-                    {\n-                        if (state.first_pass)\n-                           string_length += 2;\n-                        else\n-                        {  string [string_length ++] = 0xC0 | (uchar >> 6);\n-                           string [string_length ++] = 0x80 | (uchar & 0x3F);\n-                        }\n-\n-                        break;\n-                    }\n+                        case 'u':\n+                            /* Parse a \"\\\\uXXXX\" escape sequence */\n+                            if (end - state.ptr < 5)\n+                            {\n+                                sprintf(error, \"Unterminated \\\\u escape (at %d:%d)\", line_and_col);\n+                                goto e_failed;\n+                            }\n+                            /* Validate prefix and read four hex digits */\n+                            if (state.ptr[1] != 'u' ||\n+                                (uc_b1 = hex_value(state.ptr[2])) == 0xFF ||\n+                                (uc_b2 = hex_value(state.ptr[3])) == 0xFF ||\n+                                (uc_b3 = hex_value(state.ptr[4])) == 0xFF ||\n+                                (uc_b4 = hex_value(state.ptr[5])) == 0xFF)\n+                            {\n+                                sprintf(error, \"Invalid \\\\u escape sequence (at %d:%d)\", line_and_col);\n+                                goto e_failed;\n+                            }\n+                            /* Advance past \"\\\\uXXXX\" */\n+                            state.ptr += 5;\n+                            /* Compose the code unit */\n+                            uc_b1 = (uc_b1 << 4) | uc_b2;\n+                            uc_b2 = (uc_b3 << 4) | uc_b4;\n+                            uchar = (uc_b1 << 8) | uc_b2;\n+\n+            if ((uchar & 0xF800) == 0xD800)\n+            {\n+                json_uchar uchar2;\n+\n+                /* High surrogate, parse low surrogate of form \\\\uXXXX */\n+                if (end - state.ptr < 7)\n+                {\n+                    sprintf(error, \"Unpaired high surrogate or truncated low surrogate (at %d:%d)\", line_and_col);\n+                    goto e_failed;\n+                }\n+                /* Check prefix characters */\n+                if (state.ptr[1] != '\\\\' || state.ptr[2] != 'u')\n+                {\n+                    sprintf(error, \"Invalid low surrogate escape sequence (at %d:%d)\", line_and_col);\n+                    goto e_failed;\n+                }\n+                /* Read the four hex digits without advancing state.ptr */\n+                uc_b1 = hex_value(state.ptr[3]);\n+                uc_b2 = hex_value(state.ptr[4]);\n+                uc_b3 = hex_value(state.ptr[5]);\n+                uc_b4 = hex_value(state.ptr[6]);\n+                if (uc_b1 == 0xFF || uc_b2 == 0xFF || uc_b3 == 0xFF || uc_b4 == 0xFF)\n+                {\n+                    sprintf(error, \"Invalid hex in low surrogate (at %d:%d)\", line_and_col);\n+                    goto e_failed;\n+                }\n+                /* Consume the \"\\\\uXXXX\" sequence */\n+                state.ptr += 6;\n+                /* Compose the low surrogate code unit */\n+                uc_b1 = (uc_b1 << 4) | uc_b2;\n+                uc_b2 = (uc_b3 << 4) | uc_b4;\n+                uchar2 = (uc_b1 << 8) | uc_b2;\n+                /* Construct the full supplementary code point */\n+                uchar = 0x010000 | ((uchar & 0x3FF) << 10) | (uchar2 & 0x3FF);\n+            }\n \n                     if (uchar <= 0xFFFF) {\n                         if (state.first_pass)\n",
  "stdout": "",
  "stderr": ""
}