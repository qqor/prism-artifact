--- a/src/fmt.c
+++ b/src/fmt.c
@@ -319,12 +319,9 @@
           double d = va_arg(*ap, double);
           int64_t exponent = (int64_t)log10(my_fabs(d));
           double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
-          n += scpy(out, param, tmp, k);
+        k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
+        if ((size_t)k >= sizeof(tmp)) k = sizeof(tmp) - 1;
+        n += scpy(out, param, tmp, k);
 	  } else if (c == '%') {
         out('%', param);
         n++;
