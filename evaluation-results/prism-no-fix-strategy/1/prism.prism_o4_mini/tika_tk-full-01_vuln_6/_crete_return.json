{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_6",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 2.3004993,
    "prompt_tokens": 1850147,
    "completion_tokens": 60304
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n@@ -33,20 +33,32 @@\n     public static void main(String[] args) throws IOException {\n         Path inputFile = Paths.get(args[0]);\n         Path extractDir = Paths.get(args[1]);\n+        Path normalizedExtractDir = extractDir.toAbsolutePath().normalize();\n         try (InputStream is = Files.newInputStream(inputFile);\n                 TarArchiveInputStream tais = new TarArchiveInputStream(is)) {\n \n-            TarArchiveEntry tae = tais.getNextEntry();\n-\n-            while (tae != null) {\n-                if (tae.isFile()) {\n-                    Path target = extractDir.resolve(tae.getName()).normalize();\n-                    if (!Files.isDirectory(target.getParent())) {\n-                        Files.createDirectories(target.getParent());\n-                    }\n-                    Files.write(target, tais.readAllBytes());\n+            // iterate through archive entries and extract safely\n+            TarArchiveEntry tae;\n+            while ((tae = tais.getNextEntry()) != null) {\n+                // resolve and normalize target path\n+                Path target = normalizedExtractDir.resolve(tae.getName()).toAbsolutePath().normalize();\n+                if (!target.startsWith(normalizedExtractDir)) {\n+                    System.err.println(\"Skipping entry outside extraction directory: \" + tae.getName());\n+                    continue;\n                 }\n-                tae = tais.getNextEntry();\n+                if (tae.isDirectory()) {\n+                    Files.createDirectories(target);\n+                    continue;\n+                }\n+                if (tae.isSymbolicLink() || tae.isLink()) {\n+                    System.err.println(\"Skipping link entry in archive: \" + tae.getName());\n+                    continue;\n+                }\n+                // handle regular files: ensure parent directory exists then write\n+                if (!Files.isDirectory(target.getParent())) {\n+                    Files.createDirectories(target.getParent());\n+                }\n+                Files.write(target, tais.readAllBytes());\n             }\n         }\n     }\n",
  "stdout": "",
  "stderr": ""
}