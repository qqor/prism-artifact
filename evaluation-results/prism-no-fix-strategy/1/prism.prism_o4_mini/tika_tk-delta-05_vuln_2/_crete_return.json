{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 1.4267506000000003,
    "prompt_tokens": 1147206,
    "completion_tokens": 37460
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1106,9 +1106,21 @@\n                     throw new IOException(\"unable to create directory \\\"\" + parent + \"\\\"\");\n                 }\n             }\n-            System.out.println(\"Extracting '\" + name + \"' (\" + contentType + \") to \" + outputFile);\n-\n-            try (FileOutputStream os = new FileOutputStream(outputFile)) {\n+            Path outputDirPath = outputFile.toPath().getParent();\n+            String safeName = Paths.get(name).getFileName().toString();\n+            Path safePath = outputDirPath.resolve(safeName).normalize();\n+            if (!safePath.startsWith(outputDirPath)) {\n+                // Prevent path traversal: use only the base name\n+                safePath = outputDirPath.resolve(safeName);\n+            }\n+            if (Files.exists(safePath)) {\n+                safePath = outputDirPath.resolve(UUID.randomUUID().toString() + \"-\" + safeName);\n+            }\n+            Files.createDirectories(safePath.getParent());\n+            File finalOutput = safePath.toFile();\n+            System.out.println(\"Extracting '\" + safeName + \"' (\" + contentType + \") to \" + finalOutput);\n+            \n+            try (FileOutputStream os = new FileOutputStream(finalOutput)) {\n                 if (embeddedStreamTranslator.shouldTranslate(tis, metadata)) {\n                     try (InputStream translated = embeddedStreamTranslator.translate(tis, metadata)) {\n                         IOUtils.copy(translated, os);\n",
  "stdout": "",
  "stderr": ""
}