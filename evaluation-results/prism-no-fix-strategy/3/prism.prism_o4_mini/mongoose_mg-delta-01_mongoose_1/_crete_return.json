{
  "project_name": "mongoose",
  "vulnerability_identifier": "mongoose_mg-delta-01_mongoose_1",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-mongoose",
  "llm_usage": {
    "total_cost": 1.4794801999999998,
    "prompt_tokens": 1057570,
    "completion_tokens": 71853
  },
  "variant": "sound",
  "diff": "--- a/src/printf.c\n+++ b/src/printf.c\n@@ -26,11 +26,16 @@\n static void mg_pfn_iobuf_private(char ch, void *param, bool expand) {\n   struct mg_iobuf *io = (struct mg_iobuf *) param;\n   if (expand && io->len + 2 > io->size) mg_iobuf_resize(io, io->len + 2);\n+  if (expand && io->len + 2 > io->size) {\n+    /* grow buffer to accommodate char + NUL */\n+    mg_iobuf_resize(io, io->len + 2);\n+  }\n   if (io->len + 2 <= io->size) {\n     io->buf[io->len++] = (uint8_t) ch;\n-    io->buf[io->len] = 0;\n-  } else if (io->len < io->size) {\n-    io->buf[io->len++] = 0;  // Guarantee to 0-terminate\n+    io->buf[io->len] = '\\0';\n+  } else if (io->len + 1 <= io->size) {\n+    /* only room for NUL terminator */\n+    io->buf[io->len++] = '\\0';\n   }\n }\n \n\n--- a/src/fmt.c\n+++ b/src/fmt.c\n@@ -272,7 +272,8 @@\n       if (c == 'd' || c == 'u' || c == 'x' || c == 'X' || c == 'p' ||\n           c == 'g' || c == 'f') {\n         bool s = (c == 'd'), h = (c == 'x' || c == 'X' || c == 'p');\n-        char tmp[40];\n+        /* enlarge buffer to avoid overflow in general formatting */\n+        char tmp[128];\n         size_t xl = x ? 2 : 0;\n         if (c == 'g' || c == 'f') {\n           double v = va_arg(*ap, double);\n@@ -315,7 +316,8 @@\n         for (j = 0; minus && pr < w && j + pr < w; j++)\n           n += scpy(out, param, &pad, 1);\n       } else if (c == 'e' || c == 'E') {\n-\t\t  char tmp[8];\n+        /* enlarge buffer to avoid overflow in exponential formatting */\n+        char tmp[128];\n           double d = va_arg(*ap, double);\n           int64_t exponent = (int64_t)log10(my_fabs(d));\n           double mantissa = d / power(10, exponent);\n\n--- a/mongoose.c\n+++ b/mongoose.c\n@@ -774,7 +774,8 @@\n       if (c == 'd' || c == 'u' || c == 'x' || c == 'X' || c == 'p' ||\n           c == 'g' || c == 'f') {\n         bool s = (c == 'd'), h = (c == 'x' || c == 'X' || c == 'p');\n-        char tmp[40];\n+            /* enlarge buffer to avoid overflow in general formatting */\n+            char tmp[128];\n         size_t xl = x ? 2 : 0;\n         if (c == 'g' || c == 'f') {\n           double v = va_arg(*ap, double);\n@@ -817,7 +818,8 @@\n         for (j = 0; minus && pr < w && j + pr < w; j++)\n           n += scpy(out, param, &pad, 1);\n       } else if (c == 'e' || c == 'E') {\n-\t\t  char tmp[8];\n+            /* enlarge buffer to avoid overflow in exponential formatting */\n+            char tmp[128];\n           double d = va_arg(*ap, double);\n           int64_t exponent = (int64_t)log10(my_fabs(d));\n           double mantissa = d / power(10, exponent);\n",
  "stdout": "",
  "stderr": ""
}