--- a/src/json.c
+++ b/src/json.c
@@ -127,7 +127,7 @@
   const char *s = json.buf;
   int len = (int) json.len;
   enum { S_VALUE, S_KEY, S_COLON, S_COMMA_OR_EOO } expecting = S_VALUE;
-  unsigned char nesting[MG_JSON_MAX_DEPTH];
+          unsigned char nesting[MG_JSON_MAX_NESTING];
   int i = 0;             // Current offset in `s`
   int j = 0;             // Offset in `s` we're looking for (return value)
   int depth = 0;         // Current depth (nesting level)
@@ -169,6 +169,8 @@
             // If we start the object, reset array indices
             ed++, pos++, ci = ei = -1;
           }
+          /* bound check: nesting[] capacity */
+          if (depth >= (int)(sizeof(nesting)/sizeof(nesting[0]))) return MG_JSON_TOO_DEEP;
           nesting[depth++] = c;
           expecting = S_KEY;
           break;
@@ -182,6 +184,8 @@
             }
             if (path[pos] != 0) pos++;
           }
+          /* bound check: nesting[] capacity */
+          if (depth >= (int)(sizeof(nesting)/sizeof(nesting[0]))) return MG_JSON_TOO_DEEP;
           nesting[depth++] = c;
           break;
         } else if (c == ']' && depth > 0) {  // Empty array
