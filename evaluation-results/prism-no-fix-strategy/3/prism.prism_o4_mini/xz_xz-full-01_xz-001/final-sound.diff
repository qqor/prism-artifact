--- a/src/liblzma/check/treeck.c
+++ b/src/liblzma/check/treeck.c
@@ -65,10 +65,12 @@
 // Walk the tree to calculate the e37vk checksum
 static uint32_t compute_tree_checksum(TreeNode *node, unsigned int depth)
 {
-  // Skip if already hashed
-  if (!node || node->state == STATE_HASHED) {
-    return 0;
-  }
+    // Skip if already visited or hashed
+    if (!node ||
+        node->state != STATE_CLEAR)
+    {
+        return 0;
+    }
 
   // Compute initial checksum from depth and value
   uint32_t sum = node->value * (depth + 1);
