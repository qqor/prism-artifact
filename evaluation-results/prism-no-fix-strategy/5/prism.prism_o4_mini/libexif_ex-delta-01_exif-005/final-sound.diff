--- a/libexif/apple/exif-mnote-data-apple.c
+++ b/libexif/apple/exif-mnote-data-apple.c
@@ -62,7 +62,13 @@
 
     /*printf("%s\n", __FUNCTION__);*/
 
-    if (!d || !buf || (buf_size < 6 + 16)) {
+    if (!d || !buf) {
+        exif_log(md->log, EXIF_LOG_CODE_CORRUPT_DATA,
+                 "ExifMnoteDataApple", "Short MakerNote");
+        return;
+    }
+    size_t min_header = d->offset + 6 + 16;
+    if (buf_size < min_header) {
         exif_log(md->log, EXIF_LOG_CODE_CORRUPT_DATA,
                  "ExifMnoteDataApple", "Short MakerNote");
         return;
@@ -85,10 +91,10 @@
     tcount = (unsigned int) exif_get_short(buf + ofs + 14, d->order);
 
     /* Sanity check the offset */
-    if (buf_size < 6 + 16 + tcount * 6 + 4) {
+    size_t min_size = d->offset + 6 + 16 + tcount * 12 + 4;
+    if (buf_size < min_size) {
         exif_log(md->log, EXIF_LOG_CODE_CORRUPT_DATA,
                  "ExifMnoteDataApple", "Short MakerNote");
-        /*printf("%s(%d)\n", __FUNCTION__, __LINE__);*/
         return;
     }
 
