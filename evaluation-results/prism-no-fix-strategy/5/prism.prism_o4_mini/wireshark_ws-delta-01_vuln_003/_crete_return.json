{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-01_vuln_003",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.7320423000000001,
    "prompt_tokens": 548037,
    "completion_tokens": 29364
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-ber.c\n+++ b/epan/dissectors/packet-ber.c\n@@ -3174,25 +3174,21 @@\n dissect_ber_GeneralString(asn1_ctx_t *actx, proto_tree *tree, tvbuff_t *tvb, int offset, int hf_id, char *name_string, unsigned name_len)\n {\n     tvbuff_t *out_tvb = NULL;\n-    int8_t  tvb_len;\n-\n-    offset = dissect_ber_restricted_string(false, BER_UNI_TAG_GeneralString, actx, tree, tvb, offset, hf_id, (name_string) ? &out_tvb : NULL);\n-\n-    if (name_string) {\n-        /*\n-         * XXX - do we want to just get what's left in the tvbuff\n-         * if the full length isn't available in the tvbuff, or\n-         * do we want to throw an exception?\n-         */\n-        if (out_tvb) {\n-            tvb_len = tvb_get_uint8(tvb, offset);\n-            if ((unsigned)tvb_len >= name_len) {\n-                tvb_memcpy(out_tvb, (uint8_t*)name_string, 0, name_len-1);\n-            } else {\n-                tvb_memcpy(out_tvb, (uint8_t*)name_string, 0, tvb_len);\n-            }\n-            name_string[tvb_len] = '\\0';\n-        }\n+    guint8 tvb_len;\n+\n+    offset = dissect_ber_restricted_string(false, BER_UNI_TAG_GeneralString,\n+                                           actx, tree, tvb, offset,\n+                                           hf_id,\n+                                           (name_string) ? &out_tvb : NULL);\n+\n+    if (name_string && out_tvb) {\n+        /* Get length byte and clamp to maximum buffer size minus 1 for NUL. */\n+        tvb_len = tvb_get_uint8(tvb, offset);\n+        if (tvb_len >= name_len) {\n+            tvb_len = name_len - 1;\n+        }\n+        tvb_memcpy(out_tvb, name_string, 0, tvb_len);\n+        name_string[tvb_len] = '\\0';\n     }\n \n     return offset;\n",
  "stdout": "",
  "stderr": ""
}