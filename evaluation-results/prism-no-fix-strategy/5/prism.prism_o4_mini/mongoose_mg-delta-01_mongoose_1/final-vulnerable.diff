--- a/src/fmt.c
+++ b/src/fmt.c
@@ -272,8 +272,9 @@
       if (c == 'd' || c == 'u' || c == 'x' || c == 'X' || c == 'p' ||
           c == 'g' || c == 'f') {
         bool s = (c == 'd'), h = (c == 'x' || c == 'X' || c == 'p');
-        char tmp[40];
-        size_t xl = x ? 2 : 0;
+            /* scratch buffer for numeric conversions */
+            char tmp[128];
+            size_t xl = x ? 2 : 0;
         if (c == 'g' || c == 'f') {
           double v = va_arg(*ap, double);
           if (pr == ~0U) pr = 6;
@@ -315,17 +316,19 @@
         for (j = 0; minus && pr < w && j + pr < w; j++)
           n += scpy(out, param, &pad, 1);
       } else if (c == 'e' || c == 'E') {
-		  char tmp[8];
+          /* scratch buffers for mantissa and exponent */
+          char mantbuf[64];
+          char expbuf[32];
+          if (pr == ~0U) pr = 6;
           double d = va_arg(*ap, double);
           int64_t exponent = (int64_t)log10(my_fabs(d));
           double mantissa = d / power(10, exponent);
-          k = mg_dtoa(tmp, 10, mantissa, 8, c == 'e');
-          n += scpy(out, param, tmp, k);
-          out(c, param);
-          n++;
-		  k = mg_lld(tmp, exponent, 1, 0);
-          n += scpy(out, param, tmp, k);
-	  } else if (c == '%') {
+          k = mg_dtoa(mantbuf, sizeof(mantbuf), mantissa, pr, c == 'e');
+          n += scpy(out, param, mantbuf, k);
+          out(c, param); n++;
+          k = mg_lld(expbuf, exponent, 1, 0);
+          n += scpy(out, param, expbuf, k);
+      }
         out('%', param);
         n++;
       } else {
