{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-full-01_vuln_7",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 0.3962167,
    "prompt_tokens": 293117,
    "completion_tokens": 16770
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n@@ -33,6 +33,7 @@\n import java.util.List;\n import java.util.NoSuchElementException;\n import java.util.Set;\n+import java.util.IdentityHashMap;\n import org.apache.logging.log4j.Logger;\n import org.apache.logging.log4j.LogManager;\n \n@@ -179,7 +180,8 @@\n      */\n     private final class PageIterator implements Iterator<PDPage>\n     {\n-        private final Queue<COSDictionary> queue = new ArrayDeque<>();\n+    private final Queue<COSDictionary> queue = new ArrayDeque<>();\n+    private final Set<COSDictionary> visited = Collections.newSetFromMap(new IdentityHashMap<>());\n \n         private PageIterator(COSDictionary node)\n         {\n@@ -203,26 +205,31 @@\n          * @param node\n          * @return\n          */\n-        private List<COSDictionary> enqueueKids(COSDictionary node)\n-        {\n-            if (isPageTreeNode(node))\n-            {\n-                return getKids(node);\n+    private List<COSDictionary> enqueueKids(COSDictionary node)\n+    {\n+        // avoid cycles and null nodes\n+        if (node == null || !visited.add(node))\n+        {\n+            return Collections.emptyList();\n+        }\n+        if (isPageTreeNode(node))\n+        {\n+            return getKids(node);\n+        }\n+        else\n+        {\n+            if (COSName.PAGE.equals(node.getCOSName(COSName.TYPE)))\n+            {\n+                queue.add(node);\n             }\n             else\n             {\n-                if (node != null && COSName.PAGE.equals(node.getCOSName(COSName.TYPE)))\n-                {\n-                    queue.add(node);\n-                }\n-                else\n-                {\n-                    LOG.error(\"Page skipped due to an invalid or missing type {}\",\n-                            () -> (node == null ? \"(null)\" : node.getCOSName(COSName.TYPE)));\n-                }\n-            }\n-            return Collections.EMPTY_LIST;\n-        }\n+                LOG.error(\"Page skipped due to an invalid or missing type {}\",\n+                          () -> node.getCOSName(COSName.TYPE));\n+            }\n+        }\n+        return Collections.emptyList();\n+    }\n \n         @Override\n         public boolean hasNext()\n",
  "stdout": "",
  "stderr": ""
}