{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 2.5293114,
    "prompt_tokens": 1915798,
    "completion_tokens": 95894
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -17,6 +17,10 @@\n package org.apache.tika.cli;\n \n import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import java.nio.file.Path;\n+import java.nio.file.Files;\n+import java.io.IOException;\n \n import java.io.BufferedReader;\n import java.io.File;\n@@ -1157,15 +1161,26 @@\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n-            //if file already exists, prepend uuid\n-            if (outputFile.exists()) {\n-                String fileName = FilenameUtils.getName(normalizedName);\n-                outputFile = new File(extractDir, UUID\n-                        .randomUUID()\n-                        .toString() + \"-\" + fileName);\n-            }\n-            return outputFile;\n+    // use Path to resolve and prevent path traversal\n+    Path base = extractDir.toPath().toAbsolutePath().normalize();\n+    Path targetPath = base.resolve(normalizedName).normalize();\n+    if (!targetPath.startsWith(base)) {\n+        throw new SecurityException(\"File path traversal attempt: \" + normalizedName);\n+    }\n+    // ensure parent directories exist\n+    try {\n+        if (targetPath.getParent() != null) {\n+            Files.createDirectories(targetPath.getParent());\n+        }\n+    } catch (IOException e) {\n+        LOG.warn(\"Unable to create directories for {}\", targetPath.getParent(), e);\n+    }\n+    File outputFile = targetPath.toFile();\n+    if (outputFile.exists()) {\n+        String fileName = FilenameUtils.getName(normalizedName);\n+        outputFile = new File(extractDir, UUID.randomUUID() + \"-\" + fileName);\n+    }\n+    return outputFile;\n         }\n \n         private String getExtension(MediaType contentType) {\n",
  "stdout": "",
  "stderr": ""
}