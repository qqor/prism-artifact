diff --git a/src/net_builtin.c b/src/net_builtin.c
index 793874f4..b5db2ca0 100644
--- a/src/net_builtin.c
+++ b/src/net_builtin.c
@@ -799,7 +799,7 @@ static void rx_ip(struct mg_tcpip_if *ifp, struct pkt *pkt) {
     struct mg_connection *c = getpeer(ifp->mgr, pkt, false);
     if (c) mg_error(c, "Received fragmented packet");
   } else if (pkt->ip->proto == 1) {
-    pkt->icmp = (struct icmp *) (pkt->ip + 1);
+    pkt->icmp = (struct icmp *) pkt->pay.buf;
     if (pkt->pay.len < sizeof(*pkt->icmp)) return;
     mkpay(pkt, pkt->icmp + 1);
     rx_icmp(ifp, pkt);
