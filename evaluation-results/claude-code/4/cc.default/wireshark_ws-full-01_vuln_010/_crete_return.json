{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_010",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/epan/dissectors/packet-netbios.c b/epan/dissectors/packet-netbios.c\nindex 9d55d615db..c9b76bc972 100644\n--- a/epan/dissectors/packet-netbios.c\n+++ b/epan/dissectors/packet-netbios.c\n@@ -691,6 +691,7 @@ dissect_netb_terminate_trace( tvbuff_t *tvb, packet_info *pinfo _U_, int offset,\n \tuint8_t byte;\n \tint i = 0;\n \tint index = 0;\n+\tint max_sig_bytes;\n \n     if (!tree)\n         return 0;\n@@ -705,8 +706,10 @@ dissect_netb_terminate_trace( tvbuff_t *tvb, packet_info *pinfo _U_, int offset,\n \t/* Allocate buffer for signature field */\n \tif (flag & 0x80) {\n \t\tsignature = g_malloc( NB_SIZE_HMAC + 1);\n+\t\tmax_sig_bytes = NB_SIZE_HMAC / 2;\n \t} else {\n \t\tsignature = g_malloc( NB_SIZE_TMAC + 1);\n+\t\tmax_sig_bytes = NB_SIZE_TMAC / 2;\n \t}\n \n \tif (signature == NULL)\n@@ -719,7 +722,7 @@ dissect_netb_terminate_trace( tvbuff_t *tvb, packet_info *pinfo _U_, int offset,\n     proto_tree_add_item(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, 8, ENC_NA);\n \n \t/* Convert signature field to a string */\n-\twhile ( tvb_offset_exists(tvb, offset + NB_SIGNATURE + i) ) {\n+\twhile ( i < max_sig_bytes && tvb_offset_exists(tvb, offset + NB_SIGNATURE + i) ) {\n \t\tbyte = tvb_get_uint8(tvb, offset + NB_SIGNATURE + i);\n \n \t\tsignature[index++] = hex_digits[byte >> 4];\n@@ -729,10 +732,10 @@ dissect_netb_terminate_trace( tvbuff_t *tvb, packet_info *pinfo _U_, int offset,\n \t}\n \n \tsignature[index] = '\\0';\n-\t\n+\n \tproto_tree_add_string(ttree, hf_netb_trace_signature, tvb, offset + NB_SIGNATURE, i - 1, signature);\n \n-\tfree(signature);\n+\tg_free(signature);\n \n \treturn 0;\n }\n",
  "stdout": "",
  "stderr": ""
}