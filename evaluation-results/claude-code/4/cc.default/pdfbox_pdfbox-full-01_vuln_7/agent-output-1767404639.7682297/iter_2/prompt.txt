I tried to fix a timeout after 25 seconds vulnerability causing the crash log in the <crash_log> below.
I failed to fix the vulnerability with the following patches:

```diff
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
index 8c7600ca3..7c98e3917 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
@@ -128,6 +128,12 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
                     COSNumber rangeWidth = (COSNumber) rangeWidthBase;
                     int startRange = firstCode.intValue();
                     int endRange = secondCode.intValue();
+                    // PDFBOX-5873: Prevent timeout from malicious PDF with extremely large range
+                    if (endRange - startRange > 0xFFFF)
+                    {
+                        LOG.warn("Width range too large, skipping {} to {}", startRange, endRange);
+                        continue;
+                    }
                     float width = rangeWidth.floatValue();
                     for (int i = startRange; i <= endRange; i++)
                     {
@@ -178,6 +184,14 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
                 {
                     int first = c.intValue();
                     int last = ((COSNumber) next).intValue();
+                    // PDFBOX-5873: Prevent timeout from malicious PDF with extremely large range
+                    if (last - first > 0xFFFF)
+                    {
+                        LOG.warn("Vertical displacement range too large, skipping {} to {}", first, last);
+                        // Skip the w1y, v1x, v1y values
+                        i += 3;
+                        continue;
+                    }
                     COSNumber w1y = (COSNumber) w2Array.getObject(++i);
                     COSNumber v1x = (COSNumber) w2Array.getObject(++i);
                     COSNumber v1y = (COSNumber) w2Array.getObject(++i);

``````diff
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
index 8c7600ca3..e6890b222 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
@@ -18,7 +18,9 @@ package org.apache.pdfbox.pdmodel.font;
 
 import java.io.IOException;
 import java.io.InputStream;
+import java.util.ArrayList;
 import java.util.HashMap;
+import java.util.List;
 import java.util.Map;
 import org.apache.logging.log4j.Logger;
 import org.apache.logging.log4j.LogManager;
@@ -48,10 +50,14 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
     protected final PDType0Font parent;
 
     private Map<Integer, Float> widths;
+    // PDFBOX-5873: Store width ranges for lazy lookup to prevent timeout attacks
+    private List<int[]> widthRanges; // each entry: [startCID, endCID, width*1000]
     private float defaultWidth;
     private float averageWidth;
 
     private final Map<Integer, Float> verticalDisplacementY = new HashMap<>(); // w1y
+    // PDFBOX-5873: Store vertical displacement ranges for lazy lookup
+    private List<float[]> verticalRanges; // each entry: [startCID, endCID, w1y, v1x, v1y]
     private final Map<Integer, Vector> positionVectors = new HashMap<>();     // v
     private final float[] dw2 = { 880, -1000 };
 
@@ -75,6 +81,8 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
     {
         // see 9.7.4.3, "Glyph Metrics in CIDFonts"
         widths = new HashMap<>();
+        // PDFBOX-5873: Use lazy range lookup to prevent timeout from malicious PDFs with large ranges
+        widthRanges = new ArrayList<>();
         COSArray wArray = dict.getCOSArray(COSName.W);
         if (wArray != null)
         {
@@ -129,10 +137,9 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
                     int startRange = firstCode.intValue();
                     int endRange = secondCode.intValue();
                     float width = rangeWidth.floatValue();
-                    for (int i = startRange; i <= endRange; i++)
-                    {
-                        widths.put(i, width);
-                    }
+                    // PDFBOX-5873: Store range instead of iterating to prevent timeout attack
+                    // Only store as range; lookup happens lazily in getWidthForCID
+                    widthRanges.add(new int[] { startRange, endRange, Math.round(width * 1000) });
                 }
             }
         }
@@ -141,6 +148,8 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
     private void readVerticalDisplacements()
     {
         // default position vector and vertical displacement vector
+        // PDFBOX-5873: Use lazy range lookup to prevent timeout from malicious PDFs with large ranges
+        verticalRanges = new ArrayList<>();
         COSArray dw2Array = dict.getCOSArray(COSName.DW2);
         if (dw2Array != null)
         {
@@ -181,11 +190,10 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
                     COSNumber w1y = (COSNumber) w2Array.getObject(++i);
                     COSNumber v1x = (COSNumber) w2Array.getObject(++i);
                     COSNumber v1y = (COSNumber) w2Array.getObject(++i);
-                    for (int cid = first; cid <= last; cid++)
-                    {
-                        verticalDisplacementY.put(cid, w1y.floatValue());
-                        positionVectors.put(cid, new Vector(v1x.floatValue(), v1y.floatValue()));
-                    }
+                    // PDFBOX-5873: Store range instead of iterating to prevent timeout attack
+                    // Only store as range; lookup happens lazily
+                    verticalRanges.add(new float[] { first, last, w1y.floatValue(),
+                            v1x.floatValue(), v1y.floatValue() });
                 }
             }
         }
@@ -274,6 +282,15 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
         Float width = widths.get(cid);
         if (width == null)
         {
+            // PDFBOX-5873: Lazy lookup from ranges to prevent timeout attack
+            for (int[] range : widthRanges)
+            {
+                if (cid >= range[0] && cid <= range[1])
+                {
+                    // range[2] is width * 1000, so divide by 1000
+                    return range[2] / 1000f;
+                }
+            }
             width = getDefaultWidth();
         }
         return width;
@@ -282,7 +299,20 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
     @Override
     public boolean hasExplicitWidth(int code) throws IOException
     {
-        return widths.get(codeToCID(code)) != null;
+        int cid = codeToCID(code);
+        if (widths.get(cid) != null)
+        {
+            return true;
+        }
+        // PDFBOX-5873: Also check ranges for explicit width
+        for (int[] range : widthRanges)
+        {
+            if (cid >= range[0] && cid <= range[1])
+            {
+                return true;
+            }
+        }
+        return false;
     }
 
     @Override
@@ -292,6 +322,14 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
         Vector v = positionVectors.get(cid);
         if (v == null)
         {
+            // PDFBOX-5873: Lazy lookup from ranges to prevent timeout attack
+            for (float[] range : verticalRanges)
+            {
+                if (cid >= range[0] && cid <= range[1])
+                {
+                    return new Vector(range[3], range[4]);
+                }
+            }
             v = getDefaultPositionVector(cid);
         }
         return v;
@@ -309,6 +347,14 @@ public abstract class PDCIDFont implements COSObjectable, PDFontLike, PDVectorFo
         Float w1y = verticalDisplacementY.get(cid);
         if (w1y == null)
         {
+            // PDFBOX-5873: Lazy lookup from ranges to prevent timeout attack
+            for (float[] range : verticalRanges)
+            {
+                if (cid >= range[0] && cid <= range[1])
+                {
+                    return range[2];
+                }
+            }
             w1y = dw2[1];
         }
         return w1y;

```

Explain why the patches failed and provide a new patch to fix the vulnerability.
Do not repeat the same mistakes in the new patch.
Try a completely different approach to fix the vulnerability.
NEVER fix files outside the source directory.
NEVER do any git operations in or outside the source directory.

Below is the crash log:

<crash_log>
== ERROR: libFuzzer: timeout after 25 seconds

Stack traces of all JVM threads:
Thread[Common-Cleaner,8,InnocuousThreadGroup]
	at java.base@17.0.2/java.lang.Object.wait(Native Method)
	at java.base@17.0.2/java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:155)
	at java.base@17.0.2/jdk.internal.ref.CleanerImpl.run(CleanerImpl.java:140)
	at java.base@17.0.2/java.lang.Thread.run(Thread.java:833)
	at java.base@17.0.2/jdk.internal.misc.InnocuousThread.run(InnocuousThread.java:162)

Thread[Finalizer,8,system]
	at java.base@17.0.2/java.lang.Object.wait(Native Method)
	at java.base@17.0.2/java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:155)
	at java.base@17.0.2/java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:176)
	at java.base@17.0.2/java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:172)

Thread[Attach Listener,9,system]

Thread[Reference Handler,10,system]
	at java.base@17.0.2/java.lang.ref.Reference.waitForReferencePendingList(Native Method)
	at java.base@17.0.2/java.lang.ref.Reference.processPendingReferences(Reference.java:253)
	at java.base@17.0.2/java.lang.ref.Reference$ReferenceHandler.run(Reference.java:215)

Thread[main,5,main]
	at app//com.code_intelligence.jazzer.driver.FuzzTargetRunner.dumpAllStackTraces(FuzzTargetRunner.java:534)

Thread[Signal Dispatcher,9,system]

Thread[process reaper,10,system]
	at java.base@17.0.2/jdk.internal.misc.Unsafe.park(Native Method)
	at java.base@17.0.2/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
	at java.base@17.0.2/java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:401)
	at java.base@17.0.2/java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:903)
	at java.base@17.0.2/java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1061)
	at java.base@17.0.2/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1122)
	at java.base@17.0.2/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
	at java.base@17.0.2/java.lang.Thread.run(Thread.java:833)

Thread[Cleaner-0,5,InnocuousThreadGroup]
	at java.base@17.0.2/java.lang.Object.wait(Native Method)
	at java.base@17.0.2/java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:155)
	at java.base@17.0.2/jdk.internal.ref.CleanerImpl.run(CleanerImpl.java:140)
	at java.base@17.0.2/java.lang.Thread.run(Thread.java:833)
	at java.base@17.0.2/jdk.internal.misc.InnocuousThread.run(InnocuousThread.java:162)

Thread[Notification Thread,9,system]

Garbage collector stats:
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl (took 2 ms, size +14%)
INFO: detected a native library load, enabling interception for libc functions
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl$1 (took 1 ms, size +8%)
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl$2 (took 0 ms, size +4%)
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl$3 (took 0 ms, size +4%)
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl$4 (took 0 ms, size +6%)
INFO: Instrumented com.sun.management.internal.DiagnosticCommandImpl (took 3 ms, size +16%)
INFO: Instrumented com.sun.management.DiagnosticCommandMBean (took 0 ms, size +0%)
INFO: Instrumented com.sun.management.internal.PlatformMBeanProviderImpl$5 (took 0 ms, size +6%)
INFO: Instrumented com.sun.management.internal.GarbageCollectorExtImpl (took 1 ms, size +13%)
INFO: Instrumented com.sun.management.GarbageCollectorMXBean (took 0 ms, size +0%)
INFO: Instrumented com.sun.jmx.mbeanserver.GetPropertyAction (took 0 ms, size +13%)
INFO: Instrumented com.sun.jmx.mbeanserver.Util (took 2 ms, size +13%)

PS MarkSweep: 0 collections took 0ms
PS Scavenge: 97 collections took 161ms

SUMMARY: libFuzzer: timeout
subprocess command returned a non-zero exit status: 70
INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/pdfbox:/out -v /tmp/tmponzwe_m_:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce PDFExtractTextFuzzer -runs=100.

</crash_log>