{
  "project_name": "libxml2",
  "vulnerability_identifier": "libxml2_lx-delta-03_vuln_004",
  "source_directory": "/home/user/crete/.cache/official-afc-libxml2",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/encoding.c b/encoding.c\nindex adecdcc6..4d0acd69 100644\n--- a/encoding.c\n+++ b/encoding.c\n@@ -2846,6 +2846,7 @@ UTF32ToUTF8(unsigned char *out, int *outlen,\n     const unsigned char *instart = in;\n     const unsigned char *inend = in + (*inlen & ~1);\n     unsigned char *outstart = out;\n+    unsigned char *outend = out + *outlen;\n     unsigned long int b0, b1, b2, b3, c, d;\n     int ret = XML_ENC_ERR_SPACE;\n \n@@ -2865,15 +2866,21 @@ UTF32ToUTF8(unsigned char *out, int *outlen,\n         c = b0 | b1 | b2 | b3;\n \n         if (c < 0x80) {\n+            if (out >= outend)\n+                break;\n             out[0] = c;\n             in += 4;\n             out += 1;\n         } else if (c < 0x800) {\n+            if (outend - out < 2)\n+                break;\n             out[0] = (c >> 6)   | 0xC0;\n             out[1] = (c & 0x3F) | 0x80;\n             in += 4;\n             out += 2;\n         } else if ((c & 0xF800) != 0xD800) {\n+            if (outend - out < 3)\n+                break;\n             out[0] =  (c >> 12)         | 0xE0;\n             out[1] = ((c >>  6) & 0x3F) | 0x80;\n             out[2] =  (c        & 0x3F) | 0x80;\n@@ -2892,6 +2899,8 @@ UTF32ToUTF8(unsigned char *out, int *outlen,\n                 ret = XML_ERR_INTERNAL_ERROR;\n                 break;\n             }\n+            if (outend - out < 4)\n+                break;\n             /*\n                 simplified due to encoding errors encountered with:\n \n",
  "stdout": "",
  "stderr": ""
}