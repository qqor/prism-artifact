diff --git a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java
index 651fee520..efc4173d5 100644
--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java
+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java
@@ -119,6 +119,9 @@ public class MAPIAttribute {
       try(UnsynchronizedByteArrayInputStream inp = UnsynchronizedByteArrayInputStream.builder().setByteArray(parent.getData()).get()) {
          // First up, get the number of attributes
          int count = LittleEndian.readInt(inp);
+         if (count < 0 || count > MAX_RECORD_COUNT) {
+            throw new IOException("Invalid attribute count: " + count + ", max allowed: " + MAX_RECORD_COUNT);
+         }
          List<MAPIAttribute> attrs = new ArrayList<>();
 
          // Now, read each one in in turn
@@ -187,6 +190,9 @@ public class MAPIAttribute {
             int values = 1;
             if(isMV || isVL) {
                values = LittleEndian.readInt(inp);
+               if (values < 0 || values > MAX_RECORD_COUNT) {
+                  throw new IOException("Invalid values count: " + values + ", max allowed: " + MAX_RECORD_COUNT);
+               }
             }
 
             if (type == Types.NULL && values > 1) {
