{
  "project_name": "log4j2",
  "vulnerability_identifier": "log4j2_log4j2-delta-01_vuln_0",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-logging-log4j2",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java b/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java\nindex 90e082a9f..da5821ed4 100644\n--- a/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java\n+++ b/core/src/main/java/org/apache/logging/log4j/core/lookup/JndiLookup.java\n@@ -55,6 +55,11 @@ public class JndiLookup implements StrLookup {\n             return null;\n         }\n \n+        // Security fix: Block remote JNDI lookups to prevent RCE\n+        if (!isAllowedJndiProtocol(key)) {\n+            return null;\n+        }\n+\n         try {\n             InitialContext ctx = new InitialContext();\n             return (String) ctx.lookup(convertJndiName(key));\n@@ -63,6 +68,31 @@ public class JndiLookup implements StrLookup {\n         }\n     }\n \n+    /**\n+     * Validate that the JNDI name uses only allowed protocols.\n+     * Only local java: protocol is allowed to prevent remote code execution.\n+     * @param jndiName The name of the resource.\n+     * @return true if the protocol is allowed, false otherwise.\n+     */\n+    private boolean isAllowedJndiProtocol(String jndiName) {\n+        if (jndiName == null) {\n+            return false;\n+        }\n+\n+        String lowerCaseName = jndiName.toLowerCase();\n+\n+        // Block dangerous remote protocols\n+        if (lowerCaseName.startsWith(\"ldap:\") || lowerCaseName.startsWith(\"ldaps:\") ||\n+            lowerCaseName.startsWith(\"rmi:\") || lowerCaseName.startsWith(\"dns:\") ||\n+            lowerCaseName.startsWith(\"iiop:\") || lowerCaseName.startsWith(\"corba:\") ||\n+            lowerCaseName.startsWith(\"nds:\") || lowerCaseName.startsWith(\"nis:\")) {\n+            return false;\n+        }\n+\n+        // Only allow java: protocol or names without protocol (which get java:comp/env/ prefix)\n+        return lowerCaseName.startsWith(\"java:\") || jndiName.indexOf(':') == -1;\n+    }\n+\n     /**\n      * Convert the given JNDI name to the actual JNDI name to use.\n      * Default implementation applies the \"java:comp/env/\" prefix\n",
  "stdout": "",
  "stderr": ""
}