diff --git a/poi/src/main/java/org/apache/poi/ss/format/CellFormatPart.java b/poi/src/main/java/org/apache/poi/ss/format/CellFormatPart.java
index ea8eaa37b..8aa954a70 100644
--- a/poi/src/main/java/org/apache/poi/ss/format/CellFormatPart.java
+++ b/poi/src/main/java/org/apache/poi/ss/format/CellFormatPart.java
@@ -183,7 +183,15 @@ public class CellFormatPart {
      */
     public CellFormatPart(Locale locale, String desc) {
         Matcher m = FORMAT_PAT.matcher(desc);
-        if (!m.matches()) {
+        boolean matches;
+        try {
+            matches = m.matches();
+        } catch (StackOverflowError e) {
+            // Complex format patterns can cause catastrophic regex backtracking
+            // leading to stack overflow. Catch this and convert to a more graceful exception.
+            throw new IllegalArgumentException("Format pattern is too complex and cannot be parsed: " + quote(desc));
+        }
+        if (!matches) {
             throw new IllegalArgumentException("Unrecognized format: " + quote(
                     desc));
         }
@@ -336,6 +344,7 @@ public class CellFormatPart {
         Matcher m = SPECIFICATION_PAT.matcher(fdesc);
         boolean couldBeDate = false;
         boolean seenZero = false;
+        try {
         while (m.find()) {
             String repl = m.group(0);
             Iterator<String> codePoints = CodepointsUtil.iteratorFor(repl);
@@ -383,6 +392,10 @@ public class CellFormatPart {
                 }
             }
         }
+        } catch (StackOverflowError e) {
+            // Complex format patterns can cause catastrophic regex backtracking
+            throw new IllegalArgumentException("Format pattern is too complex and cannot be parsed: " + quote(fdesc));
+        }
 
         // Nothing definitive was found, so we figure out it deductively
         if (couldBeDate)
@@ -507,34 +520,39 @@ public class CellFormatPart {
         // For formats that don't use "'" we don't do any of this
         Matcher m = SPECIFICATION_PAT.matcher(fdesc);
         StringBuffer fmt = new StringBuffer();
-        while (m.find()) {
-            String part = group(m, 0);
-            if (!part.isEmpty()) {
-                String repl = partHandler.handlePart(m, part, type, fmt);
-                if (repl == null) {
-                    switch (part.charAt(0)) {
-                    case '\"':
-                        repl = quoteSpecial(part.substring(1,
-                                part.length() - 1), type);
-                        break;
-                    case '\\':
-                        repl = quoteSpecial(part.substring(1), type);
-                        break;
-                    case '_':
-                        repl = " ";
-                        break;
-                    case '*': //!! We don't do this for real, we just put in 3 of them
-                        repl = expandChar(part);
-                        break;
-                    default:
-                        repl = part;
-                        break;
+        try {
+            while (m.find()) {
+                String part = group(m, 0);
+                if (!part.isEmpty()) {
+                    String repl = partHandler.handlePart(m, part, type, fmt);
+                    if (repl == null) {
+                        switch (part.charAt(0)) {
+                        case '\"':
+                            repl = quoteSpecial(part.substring(1,
+                                    part.length() - 1), type);
+                            break;
+                        case '\\':
+                            repl = quoteSpecial(part.substring(1), type);
+                            break;
+                        case '_':
+                            repl = " ";
+                            break;
+                        case '*': //!! We don't do this for real, we just put in 3 of them
+                            repl = expandChar(part);
+                            break;
+                        default:
+                            repl = part;
+                            break;
+                        }
                     }
+                    m.appendReplacement(fmt, Matcher.quoteReplacement(repl));
                 }
-                m.appendReplacement(fmt, Matcher.quoteReplacement(repl));
             }
+            m.appendTail(fmt);
+        } catch (StackOverflowError e) {
+            // Complex format patterns can cause catastrophic regex backtracking
+            throw new IllegalArgumentException("Format pattern is too complex and cannot be parsed: " + quote(fdesc));
         }
-        m.appendTail(fmt);
 
         if (type.isSpecial('\'')) {
             // Now the next pass for quoted characters: Remove '' chars, making "'a''b'" into "'ab'"
