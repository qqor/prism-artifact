{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_7",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\nindex 96f49d4e0..6f43fd4f0 100644\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n@@ -22,8 +22,6 @@ import java.io.InputStream;\n import java.io.InputStreamReader;\n import java.io.Reader;\n import java.io.UncheckedIOException;\n-import java.net.URL;\n-import java.net.URLConnection;\n import java.nio.charset.Charset;\n import java.nio.charset.UnsupportedCharsetException;\n import java.util.Arrays;\n@@ -47,9 +45,6 @@ import org.apache.tika.detect.AutoDetectReader;\n import org.apache.tika.detect.EncodingDetector;\n import org.apache.tika.exception.TikaConfigException;\n import org.apache.tika.exception.TikaException;\n-import org.apache.tika.extractor.EmbeddedDocumentExtractor;\n-import org.apache.tika.extractor.EmbeddedDocumentUtil;\n-import org.apache.tika.io.TikaInputStream;\n import org.apache.tika.metadata.Metadata;\n import org.apache.tika.metadata.Property;\n import org.apache.tika.metadata.TikaCoreProperties;\n@@ -57,7 +52,6 @@ import org.apache.tika.mime.MediaType;\n import org.apache.tika.parser.AbstractEncodingDetectorParser;\n import org.apache.tika.parser.ParseContext;\n import org.apache.tika.sax.XHTMLContentHandler;\n-import org.apache.tika.utils.ExceptionUtils;\n import org.apache.tika.utils.StringUtils;\n \n /**\n@@ -268,20 +262,14 @@ public class TextAndCSVParser extends AbstractEncodingDetectorParser {\n     private void processURL(String urlString, String name, XHTMLContentHandler xhtml,\n                             Metadata parentMetadata,\n                             ParseContext context) throws IOException, SAXException {\n-        EmbeddedDocumentExtractor ex = EmbeddedDocumentUtil.getEmbeddedDocumentExtractor(context);\n-        Metadata metadata = new Metadata();\n-        metadata.set(TikaCoreProperties.RESOURCE_NAME_KEY, name);\n-        try {\n-            URL url = new URL(urlString);\n-            URLConnection connection = url.openConnection();\n-            connection.setConnectTimeout(5000);\n-            try (TikaInputStream tis = TikaInputStream.get(connection.getInputStream())) {\n-                ex.parseEmbedded(tis, xhtml, metadata, false);\n-            }\n-        } catch (Exception e) {\n-            parentMetadata.set(TikaCoreProperties.EMBEDDED_EXCEPTION,\n-                    ExceptionUtils.getStackTrace(e));\n-        }\n+        // SSRF mitigation: Do not automatically fetch URLs from untrusted CSV content\n+        // This prevents Server-Side Request Forgery attacks where malicious CSV files\n+        // could cause the server to make requests to arbitrary URLs including internal services.\n+        // The hyperlink is still preserved in the output, but not fetched.\n+        // If URL fetching is required, it should be explicitly enabled with proper validation.\n+\n+        // Store the URL reference in metadata for informational purposes without fetching\n+        parentMetadata.add(\"X-TIKA-Parsed-Hyperlink\", urlString);\n     }\n \n \n",
  "stdout": "",
  "stderr": ""
}