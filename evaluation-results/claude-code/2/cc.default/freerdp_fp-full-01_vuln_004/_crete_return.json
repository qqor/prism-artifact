{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-full-01_vuln_004",
  "source_directory": "/home/user/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "vulnerable",
  "diff": "diff --git a/libfreerdp/core/gcc.c b/libfreerdp/core/gcc.c\nindex d135d8353..b9c29f1cc 100644\n--- a/libfreerdp/core/gcc.c\n+++ b/libfreerdp/core/gcc.c\n@@ -1859,7 +1859,7 @@ BOOL gcc_read_client_network_data(wStream* s, rdpMcs* mcs)\n \tif (blockLength < 4 + (UINT8)mcs->channelCount * 12)\n \t\treturn FALSE;\n \n-\tif (mcs->channelCount > CHANNEL_MAX_COUNT)\n+\tif (mcs->channelCount >= CHANNEL_MAX_COUNT)\n \t\treturn FALSE;\n \n \t/* channelDefArray */\n",
  "stdout": "+ FUZZER=TestFuzzCoreServer\r\n+ shift\r\n+ '[' '!' -v TESTCASE ']'\r\n+ TESTCASE=/testcase\r\n+ '[' '!' -f /testcase ']'\r\n+ export RUN_FUZZER_MODE=interactive\r\n+ RUN_FUZZER_MODE=interactive\r\n+ export FUZZING_ENGINE=libfuzzer\r\n+ FUZZING_ENGINE=libfuzzer\r\n+ export SKIP_SEED_CORPUS=1\r\n+ SKIP_SEED_CORPUS=1\r\n+ run_fuzzer TestFuzzCoreServer -runs=100 /testcase\r\nvm.mmap_rnd_bits = 28\r\n/out/TestFuzzCoreServer -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -timeout_exitcode=0 < /dev/null\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 200080089\r\nINFO: Loaded 1 modules   (70193 inline 8-bit counters): 70193 [0x5649fe76a594, 0x5649fe77b7c5), \r\nINFO: Loaded 1 PC tables (70193 PCs): 70193 [0x5649fe77b7c8,0x5649fe88dad8), \r\n/out/TestFuzzCoreServer: Running 1 inputs 100 time(s) each.\r\nRunning: /testcase\r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: *************************************************\r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: This build is using [runtime-check] build options:\r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: * 'WITH_VERBOSE_WINPR_ASSERT=ON'\r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: \r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: [runtime-check] build options might slow down the application\r\n[19:24:37:014] [18:00000012] [WARN][com.freerdp.core.rdp] - [log_build_warn][0x519000000080]: *************************************************\r\n[19:24:37:015] [18:00000012] [WARN][com.freerdp.core] - [freerdp_tcp_set_keep_alive_mode]: setsockopt() SOL_SOCKET, SO_KEEPALIVE\r\n[19:24:37:015] [18:00000012] [WARN][com.freerdp.core] - [freerdp_tcp_set_keep_alive_mode]: setsockopt() IPPROTO_TCP, TCP_KEEPIDLE\r\n[19:24:37:015] [18:00000012] [WARN][com.freerdp.core] - [freerdp_tcp_set_keep_alive_mode]: setsockopt() SOL_TCP, TCP_KEEPCNT\r\n[19:24:37:015] [18:00000012] [WARN][com.freerdp.core] - [freerdp_tcp_set_keep_alive_mode]: setsockopt() SOL_TCP, TCP_KEEPINTVL\r\n[19:24:37:015] [18:00000012] [WARN][com.freerdp.core] - [freerdp_tcp_set_keep_alive_mode]: setsockopt() SOL_TCP, TCP_USER_TIMEOUT\r\n[19:24:37:016] [18:00000012] [ERROR][com.freerdp.core.fastpath] - [fastpath_send_update_pdu]: fast path update size (2) exceeds the client's maximum request size (0)\r\n[19:24:37:016] [18:00000012] [ERROR][com.freerdp.core.fastpath] - [fastpath_recv_update]: Fastpath update Synchronize [3] failed, status 0\r\n[19:24:37:016] [18:00000012] [ERROR][com.freerdp.core.fastpath] - [fastpath_recv_update_data]: fastpath_recv_update() - -1\r\n[19:24:37:016] [18:00000012] [ERROR][com.freerdp.core.fastpath] - [fastpath_recv_updates]: fastpath_recv_update_data() fail\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [rdp_read_security_header][0x519000000080]: invalid security header length, have 0, must be >= 4\r\n[19:24:37:016] [18:00000012] [ERROR][com.freerdp.core] - [tpdu_read_header]: tpdu length 88 > tpkt header length 0\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [Stream_CheckAndLogRequiredLengthWLogExVa][0x519000000080]: [rdp_read_share_control_header(/src/FreeRDP/libfreerdp/core/rdp.c:314)] invalid length, got 169, require at least 16699 [element size=1]\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 0: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 1: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 2: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 3: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:016] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 4: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 5: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 6: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 7: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 8: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 9: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 10: dli_fname=/lib/x86_64-linux-gnu/libc.so.6 [0x7fd29a945000], dli_sname=__libc_start_main [0x7fd29a968f90]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 11: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.freerdp.core.rdp] - [winpr_log_backtrace_ex][0x519000000080]: 12: unresolvable, address=(nil)\r\n[19:24:37:017] [18:00000012] [ERROR][com.freerdp.core.update] - [update_recv_altsec_window_order]: Stream short orderSize\r\n[19:24:37:017] [18:00000012] [ERROR][com.freerdp.core.surface] - [update_recv_surfcmds]: unknown cmdType 0x4141\r\n[19:24:37:017] [18:00000012] [ERROR][com.freerdp.core] - [tpdu_read_header]: tpdu length 65 > tpkt header length 0\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [Stream_CheckAndLogRequiredLengthWLogExVa]: [rdp_recv_demand_active(/src/FreeRDP/libfreerdp/core/capabilities.c:4528)] invalid length, got 126, require at least 22616 [element size=1]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 0: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 1: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 2: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 3: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 4: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 5: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 6: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 7: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 8: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 9: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 10: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 11: dli_fname=/lib/x86_64-linux-gnu/libc.so.6 [0x7fd29a945000], dli_sname=__libc_start_main [0x7fd29a968f90]\r\n[19:24:37:017] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 12: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.winpr.wStream] - [winpr_log_backtrace_ex]: 13: unresolvable, address=(nil)\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [Stream_CheckAndLogRequiredLengthWLogExVa]: [rdp_recv_confirm_active(/src/FreeRDP/libfreerdp/core/capabilities.c:4660)] invalid length, got 116, require at least 22532 [element size=1]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 0: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 1: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 2: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 3: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 4: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 5: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 6: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 7: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 8: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 9: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 10: dli_fname=/lib/x86_64-linux-gnu/libc.so.6 [0x7fd29a945000], dli_sname=__libc_start_main [0x7fd29a968f90]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 11: dli_fname=/out/TestFuzzCoreServer [0x5649fd892000], dli_sname=(null) [(nil)]\r\n[19:24:37:018] [18:00000012] [WARN][com.freerdp.core.capabilities] - [winpr_log_backtrace_ex]: 12: unresolvable, address=(nil)\r\n[19:24:37:018] [18:00000012] [ERROR][com.freerdp.core] - [tpdu_read_header]: tpdu length 65 > tpkt header length 0\r\n=================================================================\r\n==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x519000001d60 at pc 0x5649fe12cd91 bp 0x7ffe9c6143d0 sp 0x7ffe9c6143c8\r\nWRITE of size 8 at 0x519000001d60 thread T0\r\nSCARINESS: 42 (8-byte-write-heap-buffer-overflow)\r\n    #0 0x5649fe12cd90 in Stream_Read /src/FreeRDP/winpr/include/winpr/stream.h:703:3\r\n    #1 0x5649fe12cd90 in gcc_read_client_network_data /src/FreeRDP/libfreerdp/core/gcc.c:1875:3\r\n    #2 0x5649fe12cd90 in gcc_read_client_data_blocks /src/FreeRDP/libfreerdp/core/gcc.c:617:10\r\n    #3 0x5649fe12700b in gcc_read_conference_create_request /src/FreeRDP/libfreerdp/core/gcc.c:414:7\r\n    #4 0x5649fe06f2ff in mcs_recv_connect_initial /src/FreeRDP/libfreerdp/core/mcs.c:700:7\r\n    #5 0x5649fde46efb in freerdp_is_valid_mcs_create_request /src/FreeRDP/libfreerdp/core/freerdp.c:1441:16\r\n    #6 0x5649fddce785 in test_server /src/FreeRDP/libfreerdp/core/test/TestFuzzCoreServer.c:82:3\r\n    #7 0x5649fddce785 in LLVMFuzzerTestOneInput /src/FreeRDP/libfreerdp/core/test/TestFuzzCoreServer.c:106:2\r\n    #8 0x5649fdc85100 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #9 0x5649fdc70375 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #10 0x5649fdc75e0f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #11 0x5649fdca10b2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #12 0x7fd29a969082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n    #13 0x5649fdc6855d in _start (/out/TestFuzzCoreServer+0x3d655d)\r\n\r\nDEDUP_TOKEN: Stream_Read--gcc_read_client_network_data--gcc_read_client_data_blocks\r\n0x519000001d60 is located 0 bytes after 992-byte region [0x519000001980,0x519000001d60)\r\nallocated by thread T0 here:\r\n    #0 0x5649fdd91099 in calloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:75:3\r\n    #1 0x5649fe0749b6 in mcs_new /src/FreeRDP/libfreerdp/core/mcs.c:1446:34\r\n    #2 0x5649fde46ee4 in freerdp_is_valid_mcs_create_request /src/FreeRDP/libfreerdp/core/freerdp.c:1438:16\r\n    #3 0x5649fddce785 in test_server /src/FreeRDP/libfreerdp/core/test/TestFuzzCoreServer.c:82:3\r\n    #4 0x5649fddce785 in LLVMFuzzerTestOneInput /src/FreeRDP/libfreerdp/core/test/TestFuzzCoreServer.c:106:2\r\n    #5 0x5649fdc85100 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #6 0x5649fdc70375 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #7 0x5649fdc75e0f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #8 0x5649fdca10b2 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #9 0x7fd29a969082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n\r\nDEDUP_TOKEN: __interceptor_calloc--mcs_new--freerdp_is_valid_mcs_create_request\r\nSUMMARY: AddressSanitizer: heap-buffer-overflow /src/FreeRDP/winpr/include/winpr/stream.h:703:3 in Stream_Read\r\nShadow bytes around the buggy address:\r\n  0x519000001a80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x519000001b00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x519000001b80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x519000001c00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n  0x519000001c80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\r\n=>0x519000001d00: 00 00 00 00 00 00 00 00 00 00 00 00[fa]fa fa fa\r\n  0x519000001d80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x519000001e00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x519000001e80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x519000001f00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x519000001f80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==18==ABORTING\r\nsubprocess command returned a non-zero exit status: 1\n",
  "stderr": "INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/freerdp:/out -v /tmp/tmp5sy82ai3:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce TestFuzzCoreServer -runs=100.\n"
}