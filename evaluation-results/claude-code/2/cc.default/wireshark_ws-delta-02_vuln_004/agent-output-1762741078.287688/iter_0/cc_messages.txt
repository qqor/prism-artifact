
================================================================================
Message 0: SystemMessage
================================================================================
SystemMessage(subtype='init', data={'type': 'system', 'subtype': 'init', 'cwd': '/home/qqor/crete/.cache/official-afc-wireshark', 'session_id': 'a873aa44-5792-4811-a90e-a4e561dfba6c', 'tools': ['Task', 'Bash', 'Glob', 'Grep', 'ExitPlanMode', 'Read', 'Edit', 'Write', 'NotebookEdit', 'WebFetch', 'TodoWrite', 'WebSearch', 'BashOutput', 'KillShell', 'Skill', 'SlashCommand'], 'mcp_servers': [], 'model': 'claude-sonnet-4-5-20250929', 'permissionMode': 'bypassPermissions', 'slash_commands': ['compact', 'context', 'cost', 'init', 'pr-comments', 'release-notes', 'todos', 'review', 'security-review'], 'apiKeySource': 'none', 'claude_code_version': '2.0.36', 'output_style': 'default', 'agents': ['general-purpose', 'statusline-setup', 'Explore', 'Plan'], 'skills': [], 'plugins': [], 'uuid': 'de237050-bbb5-4b04-a64d-002f021857cf'})

================================================================================
Message 1: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text="I'll analyze the crash log and create a patch to fix the stack-buffer-overflow bug.\n\nLet me start by examining the relevant source file:")], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 2: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01BsytyV8GZiw5Y81NA7nRhh', name='Read', input={'file_path': '/src/wireshark/epan/dissectors/packet-icmp.c'})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 3: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01BsytyV8GZiw5Y81NA7nRhh', content='<tool_use_error>File does not exist.</tool_use_error>', is_error=True)], parent_tool_use_id=None)

================================================================================
Message 4: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text='Let me search for the source directory:')], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 5: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01Nc29ZoJwred5qJrjD6612M', name='Bash', input={'command': 'find . -name "packet-icmp.c" -type f 2>/dev/null | head -5', 'description': 'Find packet-icmp.c file'})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 6: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01Nc29ZoJwred5qJrjD6612M', content='./epan/dissectors/packet-icmp.c', is_error=False)], parent_tool_use_id=None)

================================================================================
Message 7: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01VMeaBE5DKjuESMvZzFYDS2', name='Bash', input={'command': 'pwd', 'description': 'Show current directory'})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 8: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01VMeaBE5DKjuESMvZzFYDS2', content='/home/qqor/crete/.cache/official-afc-wireshark', is_error=False)], parent_tool_use_id=None)

================================================================================
Message 9: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text='Now let me read the packet-icmp.c file, focusing on the problematic area around line 927:')], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 10: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01UQEJvuZoMPGbEbA3xvXQgB', name='Read', input={'file_path': '/home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c', 'offset': 900, 'limit': 100})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 11: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01UQEJvuZoMPGbEbA3xvXQgB', content='   900→\tuint16_t obj_length;\n   901→\tuint8_t c_type;\n   902→\tuint8_t ident_name[ICMP_MAX_IDENT_NAME_LENGTH];\n   903→\tbool unknown_object;\n   904→\tuint32_t afi;\n   905→\tuint32_t addr_length;\n   906→\n   907→\tunknown_object = false;\n   908→\t/* Object length */\n   909→\tobj_length = tvb_get_ntohs(tvb, offset);\n   910→\n   911→\t/* C-Type */\n   912→\tc_type = tvb_get_uint8(tvb, offset + 3);\n   913→\n   914→\tproto_item_set_text(tf_object, "Interface Identification Object");\n   915→\tif (tvb_reported_length_remaining(tvb, offset) < 5) {\n   916→\t\t/* Not enough room in the packet ! return unknown_object = true */\n   917→\t\treturn true;\n   918→\t}\n   919→\n   920→\tti = proto_tree_add_uint(ext_object_tree, hf_icmp_ext_c_type, tvb, offset + 3, 1, c_type);\n   921→\tproto_item_append_text(ti, " (%s)", val_to_str(c_type, ext_echo_ident_str, "Unknown C-Type %u"));\n   922→\toffset += 4;\n   923→\n   924→\tswitch(c_type) {\n   925→\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n   926→\t\t\t/* Identification Name must be printable*/\n   927→\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n   928→\n   929→\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n   930→\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n   931→\t\t\t\t\tbreak;\n   932→\n   933→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n   934→\t\t\tbreak;\n   935→\t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n   936→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n   937→\t\t\tbreak;\n   938→\t\tcase ICMP_EXT_ECHO_IDENT_ADDRESS:\n   939→\t\t\tproto_tree_add_item_ret_uint(ext_object_tree, hf_icmp_int_ident_afi, tvb, offset, 2, ENC_BIG_ENDIAN, &afi);\n   940→\t\t\toffset += 2;\n   941→\t\t\tproto_tree_add_item_ret_uint(ext_object_tree, hf_icmp_int_ident_addr_length, tvb, offset, 1, ENC_BIG_ENDIAN, &addr_length);\n   942→\t\t\toffset += 1;\n   943→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_reserved, tvb, offset, 1, ENC_NA);\n   944→\t\t\toffset += 1;\n   945→\t\t\tswitch(afi){\n   946→\t\t\t\tcase AFNUM_INET: /* IPv4 */\n   947→\t\t\t\t\twhile(addr_length >= 4 && tvb_reported_length_remaining(tvb, offset) >= 4) {\n   948→\t\t\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_ipv4, tvb, offset, 4, ENC_BIG_ENDIAN);\n   949→\t\t\t\t\t\toffset += 4;\n   950→\t\t\t\t\t\taddr_length -= 4;\n   951→\t\t\t\t\t}\n   952→\t\t\t\t\tbreak;\n   953→\t\t\t\tcase AFNUM_INET6: /* IPv6 */\n   954→\t\t\t\t\twhile(addr_length >= 16 && tvb_reported_length_remaining(tvb, offset) >= 16) {\n   955→\t\t\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_ipv6, tvb, offset, 16, ENC_NA);\n   956→\t\t\t\t\t\toffset += 16;\n   957→\t\t\t\t\t\taddr_length -= 16;\n   958→\t\t\t\t\t}\n   959→\t\t\t\t\tbreak;\n   960→\t\t\t\tdefault: /* Unknown ?! */\n   961→\t\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_address, tvb, offset, tvb_reported_length_remaining(tvb, offset), ENC_NA);\n   962→\t\t\t}\n   963→\t}\n   964→\n   965→\treturn unknown_object;\n   966→\n   967→}\t\t\t\t/*end dissect_interface_identification_object */\n   968→\n   969→static int\n   970→dissect_icmp_extension(tvbuff_t * tvb, packet_info * pinfo, proto_tree * tree, void* data _U_)\n   971→{\n   972→\tint offset = 0;\n   973→\tuint8_t version;\n   974→\tuint8_t class_num;\n   975→\tuint8_t c_type;\n   976→\tuint16_t obj_length, obj_trunc_length, checksum;\n   977→\tproto_item *ti, *tf_object;\n   978→\tproto_tree *ext_tree, *ext_object_tree;\n   979→\tint obj_end_offset;\n   980→\tunsigned reported_length;\n   981→\tbool unknown_object;\n   982→\tuint8_t int_info_obj_count;\n   983→\n   984→\tint_info_obj_count = 0;\n   985→\n   986→\treported_length = tvb_reported_length_remaining(tvb, offset);\n   987→\n   988→\t/* Add a tree for multi-part extensions RFC 4884 */\n   989→\tti = proto_tree_add_none_format(tree, hf_icmp_ext, tvb,\n   990→\t\t\t\t\toffset, reported_length,\n   991→\t\t\t\t\t"ICMP Multi-Part Extensions");\n   992→\n   993→\tif (reported_length < 4 /* Common header */ ) {\n   994→\t\treturn offset;\n   995→\t}\n   996→\n   997→\text_tree = proto_item_add_subtree(ti, ett_icmp_ext);\n   998→\n   999→\t/* Version */\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n', is_error=None)], parent_tool_use_id=None)

================================================================================
Message 12: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text='Now let me check what the maximum ident name length is defined as:')], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 13: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_0164U7KianaHxEYhSz78WDSs', name='Grep', input={'pattern': 'ICMP_MAX_IDENT_NAME_LENGTH', 'path': '/home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c', 'output_mode': 'content'})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 14: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_0164U7KianaHxEYhSz78WDSs', content='373:#define ICMP_MAX_IDENT_NAME_LENGTH\t128\n902:\tuint8_t ident_name[ICMP_MAX_IDENT_NAME_LENGTH];\n\n[Showing results with pagination = limit: 20, offset: 0]', is_error=None)], parent_tool_use_id=None)

================================================================================
Message 15: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text='Now I can see the issue clearly. The problem is at line 927:\n\n```c\ntvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n```\n\nThe buffer `ident_name` is declared as `uint8_t ident_name[ICMP_MAX_IDENT_NAME_LENGTH]` where `ICMP_MAX_IDENT_NAME_LENGTH` is 128 bytes. However, the code copies `obj_length - 4` bytes into this buffer without checking if `obj_length - 4` exceeds 128 bytes. This causes a stack buffer overflow when `obj_length - 4 > 128`.\n\nLet me create a patch to fix this:')], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 16: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01QXkNd2RmovfRMynrCrmGSR', name='Read', input={'file_path': '/home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c', 'offset': 920, 'limit': 15})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 17: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01QXkNd2RmovfRMynrCrmGSR', content='   920→\tti = proto_tree_add_uint(ext_object_tree, hf_icmp_ext_c_type, tvb, offset + 3, 1, c_type);\n   921→\tproto_item_append_text(ti, " (%s)", val_to_str(c_type, ext_echo_ident_str, "Unknown C-Type %u"));\n   922→\toffset += 4;\n   923→\n   924→\tswitch(c_type) {\n   925→\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n   926→\t\t\t/* Identification Name must be printable*/\n   927→\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n   928→\n   929→\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n   930→\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n   931→\t\t\t\t\tbreak;\n   932→\n   933→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n   934→\t\t\tbreak;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n', is_error=None)], parent_tool_use_id=None)

================================================================================
Message 18: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text="Now I'll create the patch to fix the buffer overflow. The fix needs to limit the copy length to not exceed `ICMP_MAX_IDENT_NAME_LENGTH`:")], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 19: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01NdSssd55xfx8kYn3ujUpRW', name='Edit', input={'file_path': '/home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c', 'old_string': '\tswitch(c_type) {\n\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n\t\t\t/* Identification Name must be printable*/\n\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n\n\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n\t\t\t\t\tbreak;\n\n\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n\t\t\tbreak;', 'new_string': '\tswitch(c_type) {\n\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n\t\t\t/* Identification Name must be printable*/\n\t\t\t{\n\t\t\t\tuint32_t copy_length = obj_length - 4;\n\t\t\t\tif (copy_length > ICMP_MAX_IDENT_NAME_LENGTH) {\n\t\t\t\t\tcopy_length = ICMP_MAX_IDENT_NAME_LENGTH;\n\t\t\t\t}\n\t\t\t\ttvb_memcpy(tvb, ident_name, offset, copy_length);\n\n\t\t\t\tfor (unsigned i = 0; i < copy_length; i++)\n\t\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n\t\t\t\t\t\tbreak;\n\n\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n\t\t\t}\n\t\t\tbreak;'})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 20: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01NdSssd55xfx8kYn3ujUpRW', content='The file /home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c has been updated. Here\'s the result of running `cat -n` on a snippet of the edited file:\n   920→\tti = proto_tree_add_uint(ext_object_tree, hf_icmp_ext_c_type, tvb, offset + 3, 1, c_type);\n   921→\tproto_item_append_text(ti, " (%s)", val_to_str(c_type, ext_echo_ident_str, "Unknown C-Type %u"));\n   922→\toffset += 4;\n   923→\n   924→\tswitch(c_type) {\n   925→\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n   926→\t\t\t/* Identification Name must be printable*/\n   927→\t\t\t{\n   928→\t\t\t\tuint32_t copy_length = obj_length - 4;\n   929→\t\t\t\tif (copy_length > ICMP_MAX_IDENT_NAME_LENGTH) {\n   930→\t\t\t\t\tcopy_length = ICMP_MAX_IDENT_NAME_LENGTH;\n   931→\t\t\t\t}\n   932→\t\t\t\ttvb_memcpy(tvb, ident_name, offset, copy_length);\n   933→\n   934→\t\t\t\tfor (unsigned i = 0; i < copy_length; i++)\n   935→\t\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n   936→\t\t\t\t\t\tbreak;\n   937→\n   938→\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n   939→\t\t\t}\n   940→\t\t\tbreak;\n   941→\t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n   942→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n   943→\t\t\tbreak;\n   944→\t\tcase ICMP_EXT_ECHO_IDENT_ADDRESS:', is_error=None)], parent_tool_use_id=None)

================================================================================
Message 21: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text='Perfect! Now let me verify the fix by reading the modified code once more:')], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 22: AssistantMessage
================================================================================
AssistantMessage(content=[ToolUseBlock(id='toolu_01EALwELfyYA4gCo58sHHswi', name='Read', input={'file_path': '/home/qqor/crete/.cache/official-afc-wireshark/epan/dissectors/packet-icmp.c', 'offset': 924, 'limit': 20})], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 23: UserMessage
================================================================================
UserMessage(content=[ToolResultBlock(tool_use_id='toolu_01EALwELfyYA4gCo58sHHswi', content='   924→\tswitch(c_type) {\n   925→\t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n   926→\t\t\t/* Identification Name must be printable*/\n   927→\t\t\t{\n   928→\t\t\t\tuint32_t copy_length = obj_length - 4;\n   929→\t\t\t\tif (copy_length > ICMP_MAX_IDENT_NAME_LENGTH) {\n   930→\t\t\t\t\tcopy_length = ICMP_MAX_IDENT_NAME_LENGTH;\n   931→\t\t\t\t}\n   932→\t\t\t\ttvb_memcpy(tvb, ident_name, offset, copy_length);\n   933→\n   934→\t\t\t\tfor (unsigned i = 0; i < copy_length; i++)\n   935→\t\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n   936→\t\t\t\t\t\tbreak;\n   937→\n   938→\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n   939→\t\t\t}\n   940→\t\t\tbreak;\n   941→\t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n   942→\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n   943→\t\t\tbreak;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n', is_error=None)], parent_tool_use_id=None)

================================================================================
Message 24: AssistantMessage
================================================================================
AssistantMessage(content=[TextBlock(text="Excellent! The patch has been successfully applied. Let me create a summary of what was fixed:\n\n## Summary\n\nI've successfully created and applied a patch to fix the **AddressSanitizer: stack-buffer-overflow** bug in the Wireshark ICMP packet dissector.\n\n### The Problem\nThe crash occurred in `dissect_interface_identification_object()` at line 927 of `packet-icmp.c`. The code was copying `obj_length - 4` bytes into a fixed-size buffer `ident_name[ICMP_MAX_IDENT_NAME_LENGTH]` (128 bytes) without validating that the source data size doesn't exceed the buffer capacity:\n\n```c\ntvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n```\n\nWhen `obj_length - 4 > 128`, this caused a stack buffer overflow (writing 256 bytes as shown in the crash log).\n\n### The Fix\nThe patch adds bounds checking to limit the copy length to the buffer size:\n\n```c\n{\n    uint32_t copy_length = obj_length - 4;\n    if (copy_length > ICMP_MAX_IDENT_NAME_LENGTH) {\n        copy_length = ICMP_MAX_IDENT_NAME_LENGTH;\n    }\n    tvb_memcpy(tvb, ident_name, offset, copy_length);\n    \n    for (unsigned i = 0; i < copy_length; i++)\n        if (!g_ascii_isprint(ident_name[i]))\n            break;\n    \n    proto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n}\n```\n\nThe fix ensures that:\n1. The copy length is calculated as `obj_length - 4`\n2. If this exceeds `ICMP_MAX_IDENT_NAME_LENGTH` (128), it's capped at that value\n3. Only the safe amount of data is copied into the buffer\n4. The loop also uses the safe `copy_length` to avoid reading beyond the buffer\n\nThis prevents the stack buffer overflow while maintaining the original functionality of the dissector.")], model='claude-sonnet-4-5-20250929', parent_tool_use_id=None)

================================================================================
Message 25: ResultMessage
================================================================================
ResultMessage(subtype='success', duration_ms=51041, duration_api_ms=64117, is_error=False, num_turns=9, session_id='a873aa44-5792-4811-a90e-a4e561dfba6c', total_cost_usd=0.11702954999999997, usage={'input_tokens': 25, 'cache_creation_input_tokens': 8375, 'cache_read_input_tokens': 150031, 'output_tokens': 2075, 'server_tool_use': {'web_search_requests': 0, 'web_fetch_requests': 0}, 'service_tier': 'standard', 'cache_creation': {'ephemeral_1h_input_tokens': 0, 'ephemeral_5m_input_tokens': 8375}}, result="Excellent! The patch has been successfully applied. Let me create a summary of what was fixed:\n\n## Summary\n\nI've successfully created and applied a patch to fix the **AddressSanitizer: stack-buffer-overflow** bug in the Wireshark ICMP packet dissector.\n\n### The Problem\nThe crash occurred in `dissect_interface_identification_object()` at line 927 of `packet-icmp.c`. The code was copying `obj_length - 4` bytes into a fixed-size buffer `ident_name[ICMP_MAX_IDENT_NAME_LENGTH]` (128 bytes) without validating that the source data size doesn't exceed the buffer capacity:\n\n```c\ntvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n```\n\nWhen `obj_length - 4 > 128`, this caused a stack buffer overflow (writing 256 bytes as shown in the crash log).\n\n### The Fix\nThe patch adds bounds checking to limit the copy length to the buffer size:\n\n```c\n{\n    uint32_t copy_length = obj_length - 4;\n    if (copy_length > ICMP_MAX_IDENT_NAME_LENGTH) {\n        copy_length = ICMP_MAX_IDENT_NAME_LENGTH;\n    }\n    tvb_memcpy(tvb, ident_name, offset, copy_length);\n    \n    for (unsigned i = 0; i < copy_length; i++)\n        if (!g_ascii_isprint(ident_name[i]))\n            break;\n    \n    proto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n}\n```\n\nThe fix ensures that:\n1. The copy length is calculated as `obj_length - 4`\n2. If this exceeds `ICMP_MAX_IDENT_NAME_LENGTH` (128), it's capped at that value\n3. Only the safe amount of data is copied into the buffer\n4. The loop also uses the safe `copy_length` to avoid reading beyond the buffer\n\nThis prevents the stack buffer overflow while maintaining the original functionality of the dissector.")
