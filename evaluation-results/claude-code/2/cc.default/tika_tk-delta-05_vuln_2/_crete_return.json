{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\nindex 703e21c48..26f944c16 100644\n--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1157,7 +1157,21 @@ public class TikaCLI {\n             } catch (IllegalArgumentException e) {\n                 LOG.warn(\"couldn't url decode name {}\", normalizedName);\n             }\n-            File outputFile = new File(extractDir, normalizedName);\n+\n+            // Create the output file and validate it's within extractDir to prevent path traversal\n+            File outputFile;\n+            try {\n+                outputFile = new File(extractDir, normalizedName);\n+                // Validate that the canonical path is within the extraction directory\n+                String canonicalExtractDir = extractDir.getCanonicalPath();\n+                String canonicalOutputPath = outputFile.getCanonicalPath();\n+                if (!canonicalOutputPath.startsWith(canonicalExtractDir + File.separator) &&\n+                    !canonicalOutputPath.equals(canonicalExtractDir)) {\n+                    throw new IOException(\"Path traversal attempt detected: \" + normalizedName);\n+                }\n+            } catch (IOException e) {\n+                throw new RuntimeException(\"Invalid output file path: \" + normalizedName, e);\n+            }\n             //if file already exists, prepend uuid\n             if (outputFile.exists()) {\n                 String fileName = FilenameUtils.getName(normalizedName);\n",
  "stdout": "",
  "stderr": ""
}