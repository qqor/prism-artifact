{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-01_vuln_9",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\nindex e3df836c0..c50ffec7d 100644\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n@@ -45,9 +45,6 @@ import org.apache.tika.metadata.Property;\n import org.apache.tika.metadata.TikaCoreProperties;\n import org.apache.tika.mime.MediaType;\n import org.apache.tika.parser.ParseContext;\n-import org.apache.tika.parser.Parser;\n-import org.apache.tika.parser.external.CompositeExternalParser;\n-import org.apache.tika.parser.external.ExternalParser;\n import org.apache.tika.sax.TextContentHandler;\n import org.apache.tika.sax.XHTMLContentHandler;\n import org.apache.tika.utils.StringUtils;\n@@ -61,7 +58,6 @@ class HtmlHandler extends TextContentHandler {\n             Pattern.compile(\"\\\\s*(-?\\\\d+\\\\.\\\\d+)[,\\\\s]+(-?\\\\d+\\\\.\\\\d+)\\\\s*\");\n \n     private static final Map<String, Property> META_HEADER_MAPPINGS = new HashMap<>();\n-    private static final MediaType JPEG = MediaType.image(\"jpeg\");\n     static {\n         META_HEADER_MAPPINGS.put(\"author\", TikaCoreProperties.CREATOR);\n         META_HEADER_MAPPINGS.put(\"title\", TikaCoreProperties.TITLE);\n@@ -359,10 +355,6 @@ class HtmlHandler extends TextContentHandler {\n             //swallow\n             return;\n         }\n-        int added = 0;\n-        if (metadata.get(\"html_meta:exiftool_path\") != null) {\n-            added = configureExifTool(metadata.get(\"html_meta:exiftool_path\"));\n-        }\n         //do anything with attrs?\n         Metadata m = new Metadata();\n         m.set(TikaCoreProperties.EMBEDDED_RESOURCE_TYPE,\n@@ -377,100 +369,10 @@ class HtmlHandler extends TextContentHandler {\n                 embeddedDocumentExtractor.parseEmbedded(stream, xhtml, m, true);\n             } catch (IOException e) {\n                 EmbeddedDocumentUtil.recordEmbeddedStreamException(e, metadata);\n-            } finally {\n-                resetExifTool(added);\n             }\n         }\n     }\n \n-    private int configureExifTool(String path) {\n-        ExternalParser exifToolParser = getExistingExifToolParser();\n-        int retVal = 0;\n-        if (exifToolParser == null) {\n-            CompositeExternalParser exParser =\n-                    (CompositeExternalParser) EmbeddedDocumentUtil.tryToFindExistingLeafParser(CompositeExternalParser.class,\n-                            context);\n-            if (exParser == null) {\n-                //lasciate ogne speranza\n-                return 2;\n-            }\n-            exifToolParser = new ExternalParser();\n-            retVal = 1;\n-            Map<MediaType, Parser> parsers = exParser.getParsers(context);\n-            parsers.put(JPEG, exifToolParser);\n-            exParser.setParsers(parsers);\n-        }\n-        Set<MediaType> supported = new HashSet<>(exifToolParser.getSupportedTypes(context));\n-        supported.add(JPEG);\n-        exifToolParser.setCommand(path, \"${INPUT}\");\n-        exifToolParser.setSupportedTypes(supported);\n-        return retVal;\n-    }\n-\n-    private void resetExifTool(int added) {\n-        if (added == 2) {\n-            return;\n-        }\n-        CompositeExternalParser exParser =\n-                (CompositeExternalParser) EmbeddedDocumentUtil.tryToFindExistingLeafParser(CompositeExternalParser.class,\n-                        context);\n-        if (exParser == null) {\n-            return;\n-        }\n-        if (added == 1) {\n-            Map<MediaType, Parser> parsers = exParser.getParsers();\n-            parsers.remove(JPEG);\n-            return;\n-        }\n-        ExternalParser exifToolParser = getExistingExifToolParser();\n-        if (exifToolParser == null) {\n-            return;\n-        }\n-        Set<MediaType> supported = new HashSet<>(exifToolParser.getSupportedTypes(context));\n-        Set<MediaType> newSupported = new HashSet<>();\n-        for (MediaType m : supported) {\n-            if (!m.getSubtype().equals(\"jpeg\")) {\n-                newSupported.add(m);\n-            }\n-        }\n-        exifToolParser.setCommand(\"exiftool\", \"${INPUT}\");\n-        exifToolParser.setSupportedTypes(newSupported);\n-        metadata.remove(\"exiftool_path\");\n-        Map<MediaType, Parser> updated = new HashMap<>();\n-        for (Map.Entry<MediaType, Parser> e : exParser.getParsers().entrySet()) {\n-            if (e.getValue() instanceof ExternalParser) {\n-                ExternalParser p = (ExternalParser) e.getValue();\n-                if (ExternalParser.check(p.getCommand())) {\n-                    for (MediaType mediaType : p.getSupportedTypes()) {\n-                        updated.put(mediaType, p);\n-                    }\n-                }\n-            }\n-        }\n-        exParser.setParsers(updated);\n-    }\n-\n-    private ExternalParser getExistingExifToolParser() {\n-        CompositeExternalParser exParser =\n-                (CompositeExternalParser) EmbeddedDocumentUtil.tryToFindExistingLeafParser(CompositeExternalParser.class,\n-                        context);\n-        if (exParser == null) {\n-            return null;\n-        }\n-        for (Parser p : exParser.getAllComponentParsers()) {\n-            if (p instanceof ExternalParser) {\n-                String[] args = (((ExternalParser) p).getCommand());\n-                for (int i = 0; i < args.length; i++) {\n-                    if (args[i].contains(\"exiftool\")) {\n-                        return (ExternalParser) p;\n-                    }\n-                }\n-            }\n-        }\n-        return null;\n-    }\n-\n-\n     private void writeScript() throws SAXException {\n         //don't write an attached macro if there is no content\n         //we may want to revisit this behavior\n",
  "stdout": "",
  "stderr": ""
}