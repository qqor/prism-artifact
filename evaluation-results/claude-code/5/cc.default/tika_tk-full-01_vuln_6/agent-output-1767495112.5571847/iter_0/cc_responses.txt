
================================================================================
Response 1
================================================================================
I can see the path traversal vulnerability. The issue is on line 43 where `tae.getName()` from the tar archive is used directly to construct the target path without validating that the resolved path stays within the `extractDir`. A malicious tar file could contain entries like `../../../etc/passwd` that would write files outside the intended extraction directory.

The fix needs to verify that the normalized target path starts with the extract directory (canonical path check). Let me create the patch:

================================================================================
Response 2
================================================================================
The patch has been applied. Here's a summary of the fix:

## Path Traversal Vulnerability Fix

**File:** `tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java`

**Vulnerability:** The original code at line 43 resolved tar entry names directly without validating that the resulting path stays within the extraction directory. A malicious tar archive could contain entries with names like `../../../etc/passwd` or `q/r/../../jazzer-traversal` that would allow writing files outside the intended extraction directory.

**Fix:** Added a path traversal check that:
1. Normalizes the target path (removes `.` and `..` components)
2. Converts the extraction directory to an absolute normalized path
3. Verifies the target path starts with the extraction directory
4. Throws an `IOException` if a path traversal attempt is detected

This ensures that even if a tar entry contains `../` sequences, the file will only be extracted if its final resolved path remains within the designated extraction directory.
