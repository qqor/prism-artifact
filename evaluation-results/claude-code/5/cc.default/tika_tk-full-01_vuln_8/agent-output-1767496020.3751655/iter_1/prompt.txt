I tried to fix a com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS Command Injection vulnerability causing the crash log in the <crash_log> below.
I failed to fix the vulnerability with the following patches:

```diff
diff --git a/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java b/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java
index 402fef32a..e410c023a 100644
--- a/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java
+++ b/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java
@@ -20,25 +20,14 @@ import java.io.EOFException;
 import java.io.IOException;
 import java.io.InputStream;
 import java.nio.charset.StandardCharsets;
-import java.nio.file.Files;
-import java.nio.file.Path;
-import java.nio.file.Paths;
-import java.nio.file.StandardCopyOption;
 import java.util.Locale;
 
-import org.apache.commons.io.FileUtils;
-import org.apache.commons.io.FilenameUtils;
 import org.apache.commons.io.IOUtils;
-import org.apache.commons.io.input.CloseShieldInputStream;
 
-import org.apache.tika.io.TikaInputStream;
 import org.apache.tika.metadata.Metadata;
 import org.apache.tika.metadata.Property;
 import org.apache.tika.metadata.TikaCoreProperties;
 import org.apache.tika.mime.MediaType;
-import org.apache.tika.utils.FileProcessResult;
-import org.apache.tika.utils.ProcessUtils;
-import org.apache.tika.utils.StringUtils;
 
 /**
  * Simple detector to determine if a shell script is no-arg shell script.
@@ -47,7 +36,6 @@ public class ShellCodeDetector implements Detector {
 
     public static final Property SHELL_NO_ARGS = Property.externalBoolean("sh:no_args");
 
-    private static final int MAX_LENGTH = 64;
     private static final MediaType SHELL_SCRIPT = MediaType.application("x-sh");
     private static final int SNIFF_LENGTH = 4;
     @Override
@@ -80,33 +68,8 @@ public class ShellCodeDetector implements Detector {
         if (! isShell) {
             return MediaType.OCTET_STREAM;
         }
-        String fileName = metadata.get(TikaCoreProperties.RESOURCE_NAME_KEY);
-        if (StringUtils.isBlank(fileName)) {
-            return isShell(isShell);
-        }
-        //now test for no-arg shell script
-        TikaInputStream tis = TikaInputStream.get(CloseShieldInputStream.wrap(input));
-        fileName = FilenameUtils.getName(fileName);
-        fileName = fileName.replaceAll("[^-_0-9A-Za-z.]+", "");
-        fileName = fileName.replaceAll("\\.\\.", "");
-
-        if (fileName.length() > MAX_LENGTH) {
-            fileName = fileName.substring(fileName.length() - MAX_LENGTH);
-        }
-        Path cwd = Paths.get(".").toAbsolutePath().normalize();
-        Path tmpDir = Files.createTempDirectory(cwd, "tika-shell-detect-");
-        Path tmpFile = tmpDir.resolve(fileName);
-        Files.copy(tis.getPath(), tmpFile, StandardCopyOption.REPLACE_EXISTING);
-        ProcessBuilder pb = new ProcessBuilder(fileName);
-        pb.directory(tmpDir.toFile());
-        try {
-            FileProcessResult result = ProcessUtils.execute(pb, 20000, 100000, 100000);
-            if (result.getExitValue() == 0) {
-                metadata.set(SHELL_NO_ARGS, true);
-            }
-        } finally {
-            FileUtils.deleteDirectory(tmpDir.toFile());
-        }
+        // Removed shell script execution to prevent OS Command Injection vulnerability.
+        // Executing user-provided shell scripts allows arbitrary code execution.
         return SHELL_SCRIPT;
     }
 

```

Explain why the patches failed and provide a new patch to fix the vulnerability.
Do not repeat the same mistakes in the new patch.
Try a completely different approach to fix the vulnerability.
NEVER fix files outside the source directory.
NEVER do any git operations in or outside the source directory.

Below is the crash log:

<crash_log>
== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS Command Injection
Executing OS commands with attacker-controlled data can lead to remote code execution.
	at com.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook(OsCommandInjection.java:63)
	at java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1110)
	at java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1073)
	at org.apache.tika.utils.ProcessUtils.execute(ProcessUtils.java:94)
	at org.apache.tika.detect.ShellCodeDetector.detect(ShellCodeDetector.java:103)
	at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:84)
	at org.apache.tika.cli.TikaCLI$FileEmbeddedDocumentExtractor.parseEmbedded(TikaCLI.java:1092)
	at org.apache.tika.parser.pkg.PackageParser.parseEntry(PackageParser.java:481)
	at org.apache.tika.parser.pkg.PackageParser.parseEntries(PackageParser.java:386)
	at org.apache.tika.parser.pkg.PackageParser._parse(PackageParser.java:336)
	at org.apache.tika.parser.pkg.PackageParser.parse(PackageParser.java:259)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:204)
	at org.apache.tika.cli.TikaCLI$OutputType.process(TikaCLI.java:1056)
	at org.apache.tika.cli.TikaCLI.process(TikaCLI.java:485)
	at org.apache.tika.cli.TikaCLI.main(TikaCLI.java:237)
	at com.example.TikaAppUnpackerFuzzer.parseOne(TikaAppUnpackerFuzzer.java:74)
	at com.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput(TikaAppUnpackerFuzzer.java:54)
DEDUP_TOKEN: d7514645016ef7a8
== libFuzzer crashing input ==
reproducer_path='.'; Java reproducer written to ./Crash_cb2cb4dffbd51e8e7fdd4e8bd9b41882e40ade92.java

subprocess command returned a non-zero exit status: 77
INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/tika:/out -v /tmp/tmp2kzlgsrk:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce TikaAppUnpackerFuzzer -runs=100.

</crash_log>