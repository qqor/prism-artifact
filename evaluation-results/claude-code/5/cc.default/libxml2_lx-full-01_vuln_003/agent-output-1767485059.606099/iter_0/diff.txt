diff --git a/parser.c b/parser.c
index 836b4a4f..b31d067c 100644
--- a/parser.c
+++ b/parser.c
@@ -4002,7 +4002,7 @@ xmlExpandPEsInEntityValue(xmlParserCtxtPtr ctxt, xmlSBuf *buf,
 
                 // Grow the buffer to handle the input
                 xmlSBufGrow(buf, str - chunk);
-                xmlSBufAddEntitySecure(buf, ent->name, ent->length);
+                xmlSBufAddEntitySecure(buf, ent->name, xmlStrlen(ent->name));
 
                 chunk = str;
             } else {
