I tried to fix a com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS Command Injection vulnerability causing the crash log in the <crash_log> below.
I failed to fix the vulnerability with the following patches:

```diff
diff --git a/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java b/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java
index 429258e46..c9a9816ed 100644
--- a/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java
+++ b/tika-core/src/main/java/org/apache/tika/parser/external/ExternalParser.java
@@ -224,6 +224,7 @@ public class ExternalParser implements Parser {
      * @see Runtime#exec(String[])
      */
     public void setCommand(String... command) {
+        validateCommand(command);
         this.command = command;
     }
 
@@ -259,6 +260,36 @@ public class ExternalParser implements Parser {
         this.metadataPatterns = patterns;
     }
 
+    /**
+     * Validates that the command does not contain dangerous characters or patterns
+     * that could lead to command injection attacks.
+     *
+     * @param command the command to validate
+     * @throws IllegalArgumentException if the command contains dangerous patterns
+     */
+    private void validateCommand(String... command) {
+        if (command == null || command.length == 0) {
+            return;
+        }
+
+        for (String arg : command) {
+            if (arg == null) {
+                continue;
+            }
+
+            // Check for shell metacharacters and other dangerous patterns
+            if (arg.contains(";") || arg.contains("|") || arg.contains("&") ||
+                arg.contains("`") || arg.contains("$") || arg.contains("(") ||
+                arg.contains(")") || arg.contains("<") || arg.contains(">") ||
+                arg.contains("\"") || arg.contains("'") || arg.contains("\\") ||
+                arg.contains("\n") || arg.contains("\r")) {
+
+                throw new IllegalArgumentException(
+                    "Command contains potentially dangerous characters that could lead to command injection");
+            }
+        }
+    }
+
     /**
      * Executes the configured external command and passes the given document
      * stream as a simple XHTML document to the given SAX content handler.
diff --git a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java
index e3df836c0..f7271b562 100644
--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java
+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java
@@ -361,7 +361,20 @@ class HtmlHandler extends TextContentHandler {
         }
         int added = 0;
         if (metadata.get("html_meta:exiftool_path") != null) {
-            added = configureExifTool(metadata.get("html_meta:exiftool_path"));
+            String exifToolPath = metadata.get("html_meta:exiftool_path");
+
+            // Validate the exiftool path to prevent command injection
+            if (!isValidExifToolPath(exifToolPath)) {
+                LOG.warn("Potentially unsafe exiftool path detected and ignored: " + exifToolPath);
+                return;
+            }
+
+            try {
+                added = configureExifTool(exifToolPath);
+            } catch (IllegalArgumentException e) {
+                LOG.warn("Invalid exiftool command rejected: " + e.getMessage());
+                return;
+            }
         }
         //do anything with attrs?
         Metadata m = new Metadata();
@@ -383,7 +396,24 @@ class HtmlHandler extends TextContentHandler {
         }
     }
 
+    /**
+     * Validates that the exiftool path does not contain dangerous patterns
+     */
+    private boolean isValidExifToolPath(String path) {
+        if (path == null || path.trim().isEmpty()) {
+            return false;
+        }
+
+        // Reject paths with shell metacharacters
+        return !path.matches(".*[;|&`$()\"'\\\\<>\n\r].*");
+    }
+
     private int configureExifTool(String path) {
+        // Additional validation before use
+        if (!isValidExifToolPath(path)) {
+            throw new IllegalArgumentException("Invalid exiftool path");
+        }
+
         ExternalParser exifToolParser = getExistingExifToolParser();
         int retVal = 0;
         if (exifToolParser == null) {

```

Explain why the patches failed and provide a new patch to fix the vulnerability.
Do not repeat the same mistakes in the new patch.
Try a completely different approach to fix the vulnerability.
NEVER fix files outside the source directory.
NEVER do any git operations in or outside the source directory.

Below is the crash log:

<crash_log>
== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS Command Injection
Executing OS commands with attacker-controlled data can lead to remote code execution.
	at com.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook(OsCommandInjection.java:63)
	at java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1110)
	at java.base/java.lang.ProcessBuilder.start(ProcessBuilder.java:1073)
	at java.base/java.lang.Runtime.exec(Runtime.java:594)
	at java.base/java.lang.Runtime.exec(Runtime.java:453)
	at org.apache.tika.parser.external.ExternalParser.parse(ExternalParser.java:314)
	at org.apache.tika.parser.external.ExternalParser.parse(ExternalParser.java:274)
	at org.apache.tika.parser.ParserDecorator.parse(ParserDecorator.java:153)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:204)
	at org.apache.tika.parser.DelegatingParser.parse(DelegatingParser.java:71)
	at org.apache.tika.extractor.ParsingEmbeddedDocumentExtractor.parseEmbedded(ParsingEmbeddedDocumentExtractor.java:101)
	at org.apache.tika.parser.html.HtmlHandler.handleDataURIScheme(HtmlHandler.java:377)
	at org.apache.tika.parser.html.HtmlHandler.startElement(HtmlHandler.java:175)
	at org.apache.tika.sax.ContentHandlerDecorator.startElement(ContentHandlerDecorator.java:125)
	at org.apache.tika.parser.html.XHTMLDowngradeHandler.startElement(XHTMLDowngradeHandler.java:59)
	at org.apache.tika.parser.html.JSoupParser$TikaNodeFilter.head(JSoupParser.java:211)
	at org.jsoup.select.NodeTraversor.filter(NodeTraversor.java:92)
	at org.apache.tika.parser.html.JSoupParser.parse(JSoupParser.java:137)
	at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:298)
	at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:204)
	at com.example.HtmlParserFuzzer.parseOne(HtmlParserFuzzer.java:69)
	at com.example.HtmlParserFuzzer.fuzzerTestOneInput(HtmlParserFuzzer.java:40)
DEDUP_TOKEN: 3c99eeb1380e104c
== libFuzzer crashing input ==
reproducer_path='.'; Java reproducer written to ./Crash_2d2c3704f3d4b60708a06dd5cbddd3cb026c8502.java

subprocess command returned a non-zero exit status: 77
INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/user/aixcc/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/tika:/out -v /tmp/tmpxhd0twp5:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce HtmlParserFuzzer -runs=100.

</crash_log>