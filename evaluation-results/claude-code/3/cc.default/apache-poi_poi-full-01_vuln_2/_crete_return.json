{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_2",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java b/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java\nindex 96cca3285..98bed4e39 100644\n--- a/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java\n+++ b/poi/src/main/java/org/apache/poi/poifs/dev/POIFSDump.java\n@@ -95,7 +95,24 @@ public final class POIFSDump {\n             }\n         }\n     }\n-    \n+\n+    /**\n+     * Sanitize a filename to prevent path traversal attacks.\n+     * Removes any path separators and parent directory references.\n+     *\n+     * @param name the original filename\n+     * @return sanitized filename safe for use in file operations\n+     */\n+    private static String sanitizeFilename(String name) {\n+        if (name == null) {\n+            return \"unnamed\";\n+        }\n+        // Remove path separators and parent directory references\n+        // Replace with underscore to maintain readability\n+        String sanitized = name.replace(\"/\", \"_\").replace(\"\\\\\", \"_\").replace(\"..\", \"_\");\n+        return sanitized.trim().isEmpty() ? \"unnamed\" : sanitized.trim();\n+    }\n+\n     public static void dump(DirectoryEntry root, File parent) throws IOException {\n         for(Iterator<Entry> it = root.getEntries(); it.hasNext();){\n             Entry entry = it.next();\n@@ -105,12 +122,12 @@ public final class POIFSDump {\n                 try (DocumentInputStream is = new DocumentInputStream(node)) {\n                    bytes = IOUtils.toByteArray(is);\n                 }\n-                try (OutputStream out = Files.newOutputStream(new File(parent, node.getName().trim()).toPath())) {\n+                try (OutputStream out = Files.newOutputStream(new File(parent, sanitizeFilename(node.getName())).toPath())) {\n                     out.write(bytes);\n                 }\n             } else if (entry instanceof DirectoryEntry){\n                 DirectoryEntry dir = (DirectoryEntry)entry;\n-                File file = new File(parent, entry.getName());\n+                File file = new File(parent, sanitizeFilename(entry.getName()));\n                 if(!file.exists() && !file.mkdirs()) {\n                     throw new IOException(\"Could not create directory \" + file);\n                 }\n",
  "stdout": "",
  "stderr": ""
}