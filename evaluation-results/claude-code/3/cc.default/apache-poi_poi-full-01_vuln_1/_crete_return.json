{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/home/qqor/aixcc/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\nindex 651fee520..9ac7f7f95 100644\n--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n@@ -168,6 +168,15 @@ public class MAPIAttribute {\n                   if (mplen < 0) {\n                      throw new IOException(\"Did not expect negative value: \" + mplen);\n                   }\n+                  // Validate mplen to prevent OOM - max reasonable property name length\n+                  // Unicode strings need 2 bytes per character, so divide by 2 to get char count\n+                  // Limit to 10000 characters (20000 bytes) for property names\n+                  int maxPropertyNameLength = 10000;\n+                  if (mplen > maxPropertyNameLength * 2) {\n+                     throw new IOException(\"Property name length \" + mplen +\n+                           \" exceeds maximum allowed length of \" + (maxPropertyNameLength * 2) +\n+                           \" bytes\");\n+                  }\n                   byte[] mpdata = new byte[mplen];\n                   if (IOUtils.readFully(inp, mpdata) < 0) {\n                      throw new IOException(\"Not enough data to read \" + mplen + \" bytes for attribute name\");\ndiff --git a/poi/src/main/java/org/apache/poi/util/StringUtil.java b/poi/src/main/java/org/apache/poi/util/StringUtil.java\nindex c1bb52154..574fd855f 100644\n--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java\n+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java\n@@ -91,6 +91,13 @@ public final class StringUtil {\n             throw new IllegalArgumentException(\"Illegal length \" + len);\n         }\n \n+        // Additional validation to prevent OOM - check against MAX_RECORD_LENGTH\n+        if (len > MAX_RECORD_LENGTH / 2) {\n+            throw new IllegalArgumentException(\"String length \" + len +\n+                  \" exceeds maximum allowed length of \" + (MAX_RECORD_LENGTH / 2) +\n+                  \" characters\");\n+        }\n+\n         return new String(string, offset, len * 2, UTF16LE);\n     }\n \n",
  "stdout": "",
  "stderr": ""
}