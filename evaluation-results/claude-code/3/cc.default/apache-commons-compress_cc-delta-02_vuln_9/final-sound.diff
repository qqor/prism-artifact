diff --git a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java
index 6aef44a30..bda4c3e28 100644
--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java
+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java
@@ -178,7 +178,9 @@ protected void incrementCodeSize() {
     protected void initializeTables(final int maxCodeSize) {
         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException
         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException
-        if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {
+        // maxCodeSize must not be larger than 31, as this would cause integer overflow and potential OutOfMemoryError
+        // In practice, limiting to 20 bits (1MB of table space) is reasonable for most use cases
+        if (maxCodeSize > 20 || 1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {
             // TODO test against prefixes.length and characters.length?
             throw new IllegalArgumentException("maxCodeSize " + maxCodeSize + " is out of bounds.");
         }
@@ -207,6 +209,11 @@ protected void initializeTables(final int maxCodeSize, final int memoryLimiKiB)
             throw new IllegalArgumentException("maxCodeSize is " + maxCodeSize + ", must be bigger than 0");
         }
 
+        // Enforce reasonable upper bound to prevent OutOfMemoryError even when no memory limit is set
+        if (maxCodeSize > 20) {
+            throw new IllegalArgumentException("maxCodeSize " + maxCodeSize + " is too large (max 20)");
+        }
+
         if (memoryLimiKiB > -1) {
             final int maxTableSize = 1 << maxCodeSize;
             // account for potential overflow
