{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-02_vuln_9",
  "source_directory": "/home/user/aixcc/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 0.0,
    "prompt_tokens": 0,
    "completion_tokens": 0
  },
  "variant": "sound",
  "diff": "diff --git a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\nindex 6aef44a30..bda4c3e28 100644\n--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n@@ -178,7 +178,9 @@ protected void incrementCodeSize() {\n     protected void initializeTables(final int maxCodeSize) {\n         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException\n         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException\n-        if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n+        // maxCodeSize must not be larger than 31, as this would cause integer overflow and potential OutOfMemoryError\n+        // In practice, limiting to 20 bits (1MB of table space) is reasonable for most use cases\n+        if (maxCodeSize > 20 || 1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n             // TODO test against prefixes.length and characters.length?\n             throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" is out of bounds.\");\n         }\n@@ -207,6 +209,11 @@ protected void initializeTables(final int maxCodeSize, final int memoryLimiKiB)\n             throw new IllegalArgumentException(\"maxCodeSize is \" + maxCodeSize + \", must be bigger than 0\");\n         }\n \n+        // Enforce reasonable upper bound to prevent OutOfMemoryError even when no memory limit is set\n+        if (maxCodeSize > 20) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" is too large (max 20)\");\n+        }\n+\n         if (memoryLimiKiB > -1) {\n             final int maxTableSize = 1 << maxCodeSize;\n             // account for potential overflow\n",
  "stdout": "",
  "stderr": ""
}