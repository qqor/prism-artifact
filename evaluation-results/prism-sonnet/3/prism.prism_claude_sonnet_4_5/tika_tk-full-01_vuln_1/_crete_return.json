{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_1",
  "source_directory": "/home/qqor/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 2.075211,
    "prompt_tokens": 599537,
    "completion_tokens": 18440
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/RTFParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/RTFParser.java\n@@ -55,6 +55,8 @@\n     private int memoryLimitInKb = EMB_OBJ_MAX_BYTES / 1024;\n     @Field\n     private boolean ignoreListMarkup = false;\n+    @Field\n+    private boolean disableJavaObjectDeserialization = true;\n \n     public Set<MediaType> getSupportedTypes(ParseContext context) {\n         return SUPPORTED_TYPES;\n@@ -90,7 +92,8 @@\n     public void parseInline(InputStream is, ContentHandler handler, Metadata metadata, ParseContext context)\n             throws TikaException, IOException, SAXException {\n         RTFEmbObjHandler embObjHandler =\n-                new RTFEmbObjHandler(handler, metadata, context, getMemoryLimitInKb());\n+                new RTFEmbObjHandler(handler, metadata, context, getMemoryLimitInKb(), \n+                        disableJavaObjectDeserialization);\n         final TextExtractor ert = new TextExtractor(handler, metadata, embObjHandler);\n         ert.setIgnoreListMarkup(ignoreListMarkup);\n         ert.extract(is);\n@@ -112,4 +115,13 @@\n         this.memoryLimitInKb = memoryLimitInKb;\n         USE_STATIC = false;\n     }\n+\n+    public boolean isJavaObjectDeserializationDisabled() {\n+        return disableJavaObjectDeserialization;\n+    }\n+\n+    @Field\n+    public void setDisableJavaObjectDeserialization(boolean disable) {\n+        this.disableJavaObjectDeserialization = disable;\n+    }\n }\n\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/RTFEmbObjHandler.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-microsoft-module/src/main/java/org/apache/tika/parser/microsoft/rtf/RTFEmbObjHandler.java\n@@ -67,6 +67,7 @@\n     private final EmbeddedDocumentUtil embeddedDocumentUtil;\n     private final UnsynchronizedByteArrayOutputStream os;\n     private final int memoryLimitInKb;\n+    private final boolean disableJavaObjectDeserialization;\n \n     private boolean isPictBitmap = false;\n     //high hex cached for writing hexpair chars (data)\n@@ -82,11 +83,12 @@\n     private EMB_STATE state = EMB_STATE.NADA;\n \n     protected RTFEmbObjHandler(ContentHandler handler, Metadata metadata, ParseContext context,\n-                               int memoryLimitInKb) {\n+                               int memoryLimitInKb, boolean disableJavaObjectDeserialization) {\n         this.handler = handler;\n         this.embeddedDocumentUtil = new EmbeddedDocumentUtil(context);\n         os = UnsynchronizedByteArrayOutputStream.builder().get();\n         this.memoryLimitInKb = memoryLimitInKb;\n+        this.disableJavaObjectDeserialization = disableJavaObjectDeserialization;\n     }\n \n     protected void startPict() {\n@@ -211,6 +213,12 @@\n             extractObj(bytes, handler, metadata);\n \n         } else if (state == EMB_STATE.JAVA_OBJDATA) {\n+            if (disableJavaObjectDeserialization) {\n+                throw new TikaException(\n+                    \"Java object deserialization from RTF files is disabled for security reasons. \" +\n+                    \"To enable, set disableJavaObjectDeserialization=false in RTFParser configuration.\"\n+                );\n+            }\n             try {\n                 Object obj = new ObjectInputStream(\n                         UnsynchronizedByteArrayInputStream.builder().setByteArray(bytes)\n",
  "stdout": "",
  "stderr": ""
}