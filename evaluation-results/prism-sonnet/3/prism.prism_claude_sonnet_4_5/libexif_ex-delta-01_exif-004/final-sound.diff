--- a/libexif/apple/exif-mnote-data-apple.c
+++ b/libexif/apple/exif-mnote-data-apple.c
@@ -24,6 +24,8 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
+
+#define CHECKOVERFLOW(offset,datasize,structsize) (( offset >= datasize) || (structsize > datasize) || (offset > datasize - structsize ))
 
 #include <libexif/exif-data.h>
 #include <libexif/exif-utils.h>
@@ -117,9 +119,10 @@
         } else {
             dofs = ofs + 8;
         }
-	if (dofs > buf_size) {
+	if (CHECKOVERFLOW(dofs, buf_size, dsize)) {
 		exif_log (md->log, EXIF_LOG_CODE_CORRUPT_DATA,
-                                  "ExifMnoteApplet", "Tag size overflow detected (%u vs size %u)", dofs, buf_size);
+                                  "ExifMnoteDataApple", "Tag data past end of buffer (%u > %u)", 
+                                  (unsigned)(dofs + dsize), buf_size);
 		continue;
 	}
         ofs += 12;
