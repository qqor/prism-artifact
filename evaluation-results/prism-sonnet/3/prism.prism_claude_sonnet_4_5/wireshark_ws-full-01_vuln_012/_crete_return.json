{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_012",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 2.009781,
    "prompt_tokens": 583112,
    "completion_tokens": 17363
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-zbee-zdp-management.c\n+++ b/epan/dissectors/packet-zbee-zdp-management.c\n@@ -190,30 +190,14 @@\n {\n     proto_item  *ti;\n     unsigned    i;\n-    size_t max_channel_count = 27;\n-    struct ZBChannel** channels_arr;\n-    char tmp[128];\n-\n-    unsigned   offset = 0;\n-    uint32_t channels;\n-    uint32_t channels_and_flags;\n+    unsigned    offset = 0;\n+    uint32_t    channels;\n \n     /* Get the channel bitmap. */\n-    channels_and_flags = tvb_get_letohl(tvb, offset);\n-    channels = channels_and_flags & 0xff;\n-\n-    /* bounds check */\n-    if (channels > max_channel_count)\n-        return;\n-\n-    channels_arr = (struct ZBChannel**)malloc(sizeof(struct ZBChannel*) * max_channel_count);\n-    for (i=0; i < max_channel_count; i++) {\n-        channels_arr[i] = (struct ZBChannel*)malloc(sizeof(struct ZBChannel));\n-        channels_arr[i]->free_text = 0;\n-    }\n+    channels = tvb_get_letohl(tvb, offset);\n \n     if (tree) {\n-        bool        first = 1;\n+        bool first = 1;\n         ti = proto_tree_add_uint_format(tree, hf_channel, tvb, offset, 4, channels, \"Scan Channels: \");\n \n         for (i=0; i<27; i++) {\n@@ -222,42 +206,17 @@\n                     proto_item_append_text(ti, \"%d\", i);\n                 } else {\n                     proto_item_append_text(ti, \", %d\", i);\n-                    sprintf(tmp, \"%d\", i);\n-                    channels_arr[i]->text = strdup(tmp);\n-                    channels_arr[i]->free_text = 1;\n-                    tmp[0] = '\\0';\n                 }\n                 if (channels & (2<<i)) {\n                     while ((channels&(2<<i)) && (i<26)) i++;\n                     proto_item_append_text(ti, \"-%d\", i);\n                 }\n                 first = 0;\n-                channels_arr[i]->channel_id = i;\n-                channels_arr[i]->channels = channels;\n             }\n         }\n         if (first)\n             proto_item_append_text(ti, \"None\");\n-        if (channels_and_flags & 0xfff4131b) {\n-            for (i=0; i <= channels; i++) {\n-                printf(\"DEBUG:\\t(0x%x/0x%x)\\t%d / 0x%x\\t%s\\n\",\n-                        i, channels,\n-                        channels_arr[i]->channel_id,\n-                        channels_arr[i]->channels,\n-                        channels_arr[i]->free_text,\n-                        channels_arr[i]->text);\n-            }\n-        }\n-    }\n-\n-    // return allocations to the heap\n-    for (i=0; i < max_channel_count; i++) {\n-        if (channels_arr[i]->free_text)\n-            free(channels_arr[i]->text);\n-        free(channels_arr[i]);\n-    }\n-\n-    free(channels_arr);\n+    }\n \n     offset += 4;\n \n",
  "stdout": "",
  "stderr": ""
}