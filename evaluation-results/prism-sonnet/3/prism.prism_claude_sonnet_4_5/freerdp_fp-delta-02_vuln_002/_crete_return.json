{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-delta-02_vuln_002",
  "source_directory": "/home/qqor/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 1.3105829999999998,
    "prompt_tokens": 352311,
    "completion_tokens": 16910
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/crypto/x509_utils.c\n+++ b/libfreerdp/crypto/x509_utils.c\n@@ -431,46 +431,30 @@\n }\n \n BOOL x509_validate_subject_aternative_names(const X509* cert) {\n-    STACK_OF(GENERAL_NAME) *san_names = NULL;\n-    int i, count;\n-    char *dns_name = NULL;\n \tBOOL result = TRUE;\n-\n-    // Get Subject Alternative Names (SAN)\n-    san_names = X509_get_ext_d2i(cert, NID_subject_alt_name, NULL, NULL);\n-    if (!san_names) {\n-        goto end;\n-    }\n-\n-    count = sk_GENERAL_NAME_num(san_names);\n-\n-    for (i = 0; i < count; i++) {\n-        GENERAL_NAME *gen_name = sk_GENERAL_NAME_value(san_names, i);\n-\n-        if (gen_name->type == GEN_DNS) {\n-\t\t\t// Allocate string length + 1 for security\n-\t\t\tdns_name = malloc( strlen((char *)ASN1_STRING_get0_data(gen_name->d.dNSName)) + 1);\n-\n-\t\t\tif (dns_name == NULL)\n-\t\t\t\tgoto end;\n-\t\t\t\n-\t\t\tmemcpy(dns_name, (char *)ASN1_STRING_get0_data(gen_name->d.dNSName),  \n-\t\t\t\tASN1_STRING_length(gen_name->d.dNSName)) ;\n-\t\t\t\n-            if (!verify_san(dns_name)) {\n-\t\t\t\tfree(dns_name);\n-\t\t\t\tresult = FALSE;\n-\t\t\t\tgoto end;\n-            } else {\n-\t\t\t\tfree(dns_name);\n-            }\n-        }\n-    }\n-\n-end:\n-    sk_GENERAL_NAME_pop_free(san_names, GENERAL_NAME_free);\n-\n-\treturn TRUE;\n+\tsize_t count = 0;\n+\tsize_t* lengths = NULL;\n+\n+\t// Use existing function to extract DNS names correctly\n+\tchar** dns_names = x509_utils_get_dns_names(cert, &count, &lengths);\n+\n+\t// No DNS names is a valid case (certificate may not have SAN extension)\n+\tif (!dns_names) {\n+\t\treturn TRUE;\n+\t}\n+\n+\t// Validate each DNS name\n+\tfor (size_t i = 0; i < count; i++) {\n+\t\tif (!verify_san(dns_names[i])) {\n+\t\t\tresult = FALSE;\n+\t\t\tbreak;  // Stop on first invalid DNS name\n+\t\t}\n+\t}\n+\n+\t// Proper cleanup with correct free functions\n+\tx509_utils_dns_names_free(count, lengths, dns_names);\n+\n+\treturn result;\n }\n \n char* x509_utils_get_email(const X509* x509)\n",
  "stdout": "",
  "stderr": ""
}