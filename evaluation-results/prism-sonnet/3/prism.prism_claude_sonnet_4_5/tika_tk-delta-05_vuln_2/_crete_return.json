{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-05_vuln_2",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 3.2703870000000004,
    "prompt_tokens": 916864,
    "completion_tokens": 34653
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java\n@@ -1099,6 +1099,17 @@\n             }\n             outputFile = getOutputFile(name, metadata, contentType);\n \n+            // Validate that the output file is within the extraction directory\n+            // This prevents path traversal attacks as a defense-in-depth measure\n+            try {\n+                Path outputPath = outputFile.toPath().toAbsolutePath().normalize();\n+                Path extractPath = extractDir.toPath().toAbsolutePath().normalize();\n+                if (!outputPath.startsWith(extractPath)) {\n+                    throw new IOException(\"Security: Path traversal attempt detected in entry name: \" + name);\n+                }\n+            } catch (SecurityException e) {\n+                throw new IOException(\"Failed to validate output path for entry: \" + name, e);\n+            }\n \n             File parent = outputFile.getParentFile();\n             if (!parent.exists()) {\n@@ -1138,7 +1149,9 @@\n             //defensively do this so that we don't get an exception\n             //from FilenameUtils.normalize\n             name = name.replaceAll(\"\\u0000\", \" \");\n-            String normalizedName = FilenameUtils.normalize(name);\n+            // First extract just the filename to prevent path traversal attacks\n+            // like \"../../../malicious.txt\" or \"q/r/s/t/../../traversal\"\n+            String normalizedName = FilenameUtils.normalize(FilenameUtils.getName(name));\n \n             if (normalizedName == null) {\n                 normalizedName = FilenameUtils.getName(name);\n",
  "stdout": "",
  "stderr": ""
}