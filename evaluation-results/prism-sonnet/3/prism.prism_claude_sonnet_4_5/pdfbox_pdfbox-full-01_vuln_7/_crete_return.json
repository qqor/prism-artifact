{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-full-01_vuln_7",
  "source_directory": "/home/user/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 2.0201610000000003,
    "prompt_tokens": 593982,
    "completion_tokens": 15881
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java\n@@ -18,6 +18,7 @@\n \n import java.util.ArrayDeque;\n import java.util.Collections;\n+import java.util.IdentityHashMap;\n import java.util.Iterator;\n import java.util.Queue;\n import org.apache.pdfbox.cos.COSArray;\n@@ -180,6 +181,11 @@\n     private final class PageIterator implements Iterator<PDPage>\n     {\n         private final Queue<COSDictionary> queue = new ArrayDeque<>();\n+        \n+        // To prevent infinite loops caused by circular references in malformed PDFs\n+        // Must use IdentityHashMap for reference-based equality checking\n+        private final Set<COSDictionary> visitedNodes = \n+                Collections.newSetFromMap(new IdentityHashMap<>());\n \n         private PageIterator(COSDictionary node)\n         {\n@@ -205,6 +211,17 @@\n          */\n         private List<COSDictionary> enqueueKids(COSDictionary node)\n         {\n+            // Check for circular reference before processing\n+            if (visitedNodes.contains(node))\n+            {\n+                LOG.error(\"Page tree node already visited, skipping to avoid infinite recursion\");\n+                return Collections.EMPTY_LIST;\n+            }\n+            \n+            // Mark node as visited\n+            visitedNodes.add(node);\n+            \n+            // Process the node\n             if (isPageTreeNode(node))\n             {\n                 return getKids(node);\n",
  "stdout": "",
  "stderr": ""
}