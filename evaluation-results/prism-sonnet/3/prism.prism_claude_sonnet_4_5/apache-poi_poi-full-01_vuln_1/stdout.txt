[2;36m[01/09/26 23:51:50][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=944575;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=756728;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp44lgnnfb[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/apache-poi_poi-full-01_vuln_1[0m [2m               [0m
[2;36m                    [0m         [35m/[0m[95magent-output-1768002710.9287212[0m                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file:                                                               [2m               [0m
[2;36m                    [0m         scripts/benchmark/afc-delta-full/apache-poi_poi-full-01_vuln_1.toml                  [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-poi[0m              [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Building Cached for CLEAN environment[1m)[0m        ]8;id=231774;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=338101;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m[01/09/26 23:54:12][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Building Cached for CLEAN environment[1m)[0m Took  ]8;id=45229;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=511520;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [1;36m141.87[0m seconds; [33mexception[0m=[3;91mFalse[0m                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running tests for Cached for CLEAN            ]8;id=899342;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=597240;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         environment[1m)[0m Started[33m...[0m                                                        [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running tests for Cached for CLEAN           ]8;id=341137;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=910020;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         environment[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=263940;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=206224;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m141[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=300198;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=382323;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/09/26 23:54:13][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.89[0m seconds;            ]8;id=378559;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=274878;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/09/26 23:54:15][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=573601;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=912430;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=709119;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=47032;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=340403;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=359341;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=505935;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=407414;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/09/26 23:54:16][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m1.17[0m seconds;            ]8;id=664145;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=314364;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=547994;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=817125;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/09/26 23:54:17][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.84[0m seconds;            ]8;id=375732;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=450482;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/09/26 23:54:24][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=858286;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=822030;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of  [2m                [0m
[2;36m                    [0m         memory [1m([0muse [32m'-Xmx921m'[0m to reproduce[1m)[0m                                                [2m                [0m
[2;36m                    [0m         Caused by: java.lang.OutOfMemoryError: Java heap space                              [2m                [0m
[2;36m                    [0m                 at java.base/java.lang.String.[1m<[0m[1;95minit[0m[39m>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00c00.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00400.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init[0m[1m>[0m[1m([0mHMEFMessage.jav[1;92ma:72[0m[1m)[0m              [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1m([0mPOIHMEFFuzzer.jav[1;92ma:32[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$DMH/[1;35m0x0000000800cb8800.invokeStaticInit[0m[1m([0mLambd [2m                [0m
[2;36m                    [0m         aForm$DMH[1m)[0m                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$MH/[1;35m0x0000000800d00c00.invoke[0m[1m([0mLambdaForm$MH[1m)[0m   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$MH/[1;35m0x0000000800d00400.invoke_MT[0m[1m([0mLambdaForm$MH [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: a36f54a5f0a295bd                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/09/26 23:54:45][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=200856;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=401505;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/10/26 00:00:12][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=449475;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=335327;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/10/26 00:01:07][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=834387;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=327680;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=532781;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=834177;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/10/26 00:01:08][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.92[0m seconds;            ]8;id=165357;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=4365;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Patching[1m)[0m Started[33m...[0m                          ]8;id=540823;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=744177;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpvj7kozeh[0m                                                 ]8;id=761345;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=116493;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/10/26 00:03:12][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Patching[1m)[0m Took [1;36m124.33[0m seconds;               ]8;id=628127;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=989445;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Checking build[1m)[0m Started[33m...[0m                    ]8;id=622005;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=845748;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/10/26 00:03:49][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Checking build[1m)[0m Took [1;36m36.74[0m seconds;          ]8;id=915097;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=313170;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running PoV[1m)[0m Started[33m...[0m                       ]8;id=600431;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=870578;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/10/26 00:03:55][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running PoV[1m)[0m Took [1;36m5.50[0m seconds;              ]8;id=380271;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=157175;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Testing[1m)[0m Started[33m...[0m                           ]8;id=265884;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=813773;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=72507;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=42094;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=649159;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=314741;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.84[0m seconds;            ]8;id=913107;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=812114;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/10/26 00:03:57][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=661528;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=914136;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.90[0m seconds;            ]8;id=93988;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=307350;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/10/26 00:03:58][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=310237;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=47281;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/10/26 00:03:59][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.84[0m seconds;            ]8;id=434823;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=779032;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=143548;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=429697;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java [2m                [0m
[2;36m                    [0m         +++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java [2m                [0m
[2;36m                    [0m         @@ [1;36m-44[0m,[1;36m6[0m +[1;36m44[0m,[1;36m9[0m @@                                                                   [2m                [0m
[2;36m                    [0m             private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;                 [2m                [0m
[2;36m                    [0m             private static int MAX_RECORD_LENGTH = 1_000_000;                               [2m                [0m
[2;36m                    [0m             private static int MAX_RECORD_COUNT = 10_000;                                   [2m                [0m
[2;36m                    [0m         +   [35m/[0m[35m/[0m arbitrarily selected; may need to increase                                   [2m                [0m
[2;36m                    [0m         +   private static final int DEFAULT_MAX_STRING_LENGTH = 100_000;                   [2m                [0m
[2;36m                    [0m         +   private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m             private final MAPIProperty property;                                            [2m                [0m
[2;36m                    [0m             private final int type;                                                         [2m                [0m
[2;36m                    [0m         @@ [1;36m-61[0m,[1;36m6[0m +[1;36m64[0m,[1;36m20[0m @@                                                                  [2m                [0m
[2;36m                    [0m              *[35m/[0m                                                                             [2m                [0m
[2;36m                    [0m             public static int [1;35mgetMaxRecordLength[0m[1m([0m[1m)[0m [1m{[0m                                        [2m                [0m
[2;36m                    [0m                return MAX_RECORD_LENGTH;                                                    [2m                [0m
[2;36m                    [0m         +   [1m}[0m                                                                               [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +   [35m/[0m**                                                                             [2m                [0m
[2;36m                    [0m         +    * @param length the max string length allowed for MAPI attribute names         [2m                [0m
[2;36m                    [0m         +    *[35m/[0m                                                                             [2m                [0m
[2;36m                    [0m         +   public static void [1;35msetMaxStringLength[0m[1m([0mint length[1m)[0m [1m{[0m                             [2m                [0m
[2;36m                    [0m         +      MAX_STRING_LENGTH = length;                                                  [2m                [0m
[2;36m                    [0m         +   [1m}[0m                                                                               [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +   [35m/[0m**                                                                             [2m                [0m
[2;36m                    [0m         +    * @return the max string length allowed for MAPI attribute names               [2m                [0m
[2;36m                    [0m         +    *[35m/[0m                                                                             [2m                [0m
[2;36m                    [0m         +   public static int [1;35mgetMaxStringLength[0m[1m([0m[1m)[0m [1m{[0m                                        [2m                [0m
[2;36m                    [0m         +      return MAX_STRING_LENGTH;                                                    [2m                [0m
[2;36m                    [0m             [1m}[0m                                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m             [35m/[0m**                                                                             [2m                [0m
[2;36m                    [0m         @@ [1;36m-168[0m,[1;36m7[0m +[1;36m185[0m,[1;36m7[0m @@                                                                 [2m                [0m
[2;36m                    [0m                            if [1m([0mmplen [1m<[0m[39m [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [39m                      throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m    [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m                   [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m-                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m+                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mmplen, [0m                   [2m                [0m
[2;36m                    [0m         [39mMAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m                   if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [39m                      throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen + [0m[32m" [0m [2m                [0m
[2;36m                    [0m         [32mbytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                         [2m                [0m
[2;36m                    [0m         [39m                   [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m@@ [0m[1;36m-228[0m[39m,[0m[1;36m7[0m[39m +[0m[1;36m245[0m[39m,[0m[1;36m9[0m[39m @@[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m           type == Types.DIRECTORY ||[0m                                               [2m                [0m
[2;36m                    [0m         [39m           type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [39m             [0m[35m/[0m[35m/[0m[39m Need to read the length, as it varies[0m                               [2m                [0m
[2;36m                    [0m         [39m-            return [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [39m+            int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [39m+            [0m[1;35mIOUtils.safelyAllocateCheck[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [39m+            return length;[0m                                                         [2m                [0m
[2;36m                    [0m         [39m       [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m             throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [39m       [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===Patch [0m[33mResult[0m[39m===[0m                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00c00.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00400.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===Evaluation [0m[33mReport[0m[39m===[0m                                                             [2m                [0m
[2;36m                    [0m         [39m# Evaluation Report[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Summary[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAn Out of Memory [0m[1;39m([0m[39mOOM[0m[1;39m)[0m[39m error occurs when processing HMEF [0m[1;39m([0m[39mTNEF[0m[1;39m)[0m[39m messages in Apache [0m [2m                [0m
[2;36m                    [0m         [39mPOI, specifically during the parsing of MAPI attributes. The fuzzer triggered a [0m    [2m                [0m
[2;36m                    [0m         [39m`java.lang.OutOfMemoryError` with a heap space limitation of 921MB, indicating [0m     [2m                [0m
[2;36m                    [0m         [39mexcessive memory allocation during string creation from Unicode LE data. This [0m      [2m                [0m
[2;36m                    [0m         [39mrepresents a potential Denial of Service [0m[1;39m([0m[39mDoS[0m[1;39m)[0m[39m vulnerability through resource [0m      [2m                [0m
[2;36m                    [0m         [39mexhaustion, classified as a low-severity security issue by the fuzzer.[0m              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Description[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Issue Details[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe issue manifests as a `java.lang.OutOfMemoryError: Java heap space` exception [0m   [2m                [0m
[2;36m                    [0m         [39mwrapped in a `FuzzerSecurityIssueLow` during fuzzing operations on Apache POI's [0m    [2m                [0m
[2;36m                    [0m         [39mHMEF message processing functionality. The error occurs during the parsing phase of[0m [2m                [0m
[2;36m                    [0m         [39mTNEF [0m[1;39m([0m[39mTransport Neutral Encapsulation Format[0m[1;39m)[0m[39m messages, specifically when handling [0m [2m                [0m
[2;36m                    [0m         [39mMAPI [0m[1;39m([0m[39mMessaging Application Programming Interface[0m[1;39m)[0m[39m attributes.[0m                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Stack Trace Analysis[0m                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe exception stack trace reveals the following execution path:[0m                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Entry Point**: `[0m[1;35mPOIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[1;39m)[0m[39m` - The fuzzer harness [0m      [2m                [0m
[2;36m                    [0m         [39minitiating the test[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Message Processing**: `HMEFMessage.<init>[0m[1;39m([0m[1;39m)[0m[39m` → `[0m[1;35mHMEFMessage.process[0m[1;39m([0m[1;39m)[0m[39m` → [0m      [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mHMEFMessage.processMessage[0m[1;39m([0m[1;39m)[0m[39m` - The message processing pipeline[0m                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Attribute Parsing**: `[0m[1;35mTNEFAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` → `TNEFMAPIAttribute.<init>[0m[1;39m([0m[1;39m)[0m[39m` →[0m [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mMAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` - Attribute creation and initialization[0m                    [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Failure Point**: `[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m` → `String.<init>[0m[1;39m([0m[1;39m)[0m[39m` - Memory [0m [2m                [0m
[2;36m                    [0m         [39mexhaustion during string allocation[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe memory exhaustion occurs at the lowest level of string creation from Unicode [0m   [2m                [0m
[2;36m                    [0m         [39mLittle Endian encoded data, suggesting that the input data specifies an excessively[0m [2m                [0m
[2;36m                    [0m         [39mlarge string length that the code attempts to allocate without proper validation.[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Vulnerability Type[0m                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis is classified as a **resource exhaustion vulnerability** that could enable [0m    [2m                [0m
[2;36m                    [0m         [39mDenial of Service [0m[1;39m([0m[39mDoS[0m[1;39m)[0m[39m attacks. An attacker could craft malicious TNEF messages [0m   [2m                [0m
[2;36m                    [0m         [39mwith inflated length fields that cause the application to attempt allocating [0m       [2m                [0m
[2;36m                    [0m         [39menormous amounts of memory, leading to application crashes or system instability.[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Key Observations[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Memory Allocation Point**: The failure occurs in [0m                              [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m` at line [0m[1;36m94[0m[39m, indicating this method reads a length [0m  [2m                [0m
[2;36m                    [0m         [39mfield and attempts to create a string of that size without bounds checking[0m          [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Attribute Processing Chain**: The issue surfaces during MAPI attribute [0m        [2m                [0m
[2;36m                    [0m         [39mcreation within TNEF attribute processing, suggesting the vulnerability is specific[0m [2m                [0m
[2;36m                    [0m         [39mto certain attribute types or malformed attribute data[0m                              [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Reproducibility**: The fuzzer provides a specific heap size [0m[1;39m([0m[39m921MB[0m[1;39m)[0m[39m and [0m       [2m                [0m
[2;36m                    [0m         [39mdeduplication token [0m[1;39m([0m[39ma36f54a5f0a295bd[0m[1;39m)[0m[39m, indicating this is a reproducible issue [0m    [2m                [0m
[2;36m                    [0m         [39mwith specific input data[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Security Classification**: Marked as [0m[32m"Low"[0m[39m severity, suggesting the impact is [0m [2m                [0m
[2;36m                    [0m         [39mlimited to resource exhaustion rather than data corruption or code execution[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Areas for Investigation[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mTo obtain a comprehensive understanding of this issue, the following codebase [0m      [2m                [0m
[2;36m                    [0m         [39mcomponents should be examined:[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **[0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m94[0m[1;39m)[0m[39m:[0m                 [2m                [0m
[2;36m                    [0m         [39m   - How length values are read from the input stream[0m                               [2m                [0m
[2;36m                    [0m         [39m   - Whether any bounds checking or validation exists before memory allocation[0m      [2m                [0m
[2;36m                    [0m         [39m   - Maximum allowed string lengths and validation logic[0m                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **[0m[1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m175[0m[1;39m)[0m[39m:[0m             [2m                [0m
[2;36m                    [0m         [39m   - How attribute data is parsed and passed to StringUtil[0m                          [2m                [0m
[2;36m                    [0m         [39m   - What validations are performed on attribute length fields[0m                      [2m                [0m
[2;36m                    [0m         [39m   - The structure and format of MAPI attributes[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **org.apache.poi.hmef.attribute.TNEFMAPIAttribute** constructor [0m[1;39m([0m[39mline [0m[1;36m41[0m[1;39m)[0m[39m:[0m       [2m                [0m
[2;36m                    [0m         [39m   - Initialization logic and data extraction from input streams[0m                    [2m                [0m
[2;36m                    [0m         [39m   - How attribute types and lengths are determined[0m                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **[0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m105[0m[1;39m)[0m[39m:[0m                 [2m                [0m
[2;36m                    [0m         [39m   - Overall message parsing logic and structure[0m                                    [2m                [0m
[2;36m                    [0m         [39m   - Whether any file size or attribute count limits exist[0m                          [2m                [0m
[2;36m                    [0m         [39m   - Input validation mechanisms at the message level[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **TNEF/HMEF Format Specifications**:[0m                                             [2m                [0m
[2;36m                    [0m         [39m   - Expected ranges for string lengths in MAPI attributes[0m                          [2m                [0m
[2;36m                    [0m         [39m   - Standard practices for handling malformed or oversized attribute data[0m          [2m                [0m
[2;36m                    [0m         [39m   - Maximum reasonable sizes for various attribute types[0m                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Initial Issue Log[0m                                                                [2m                [0m
[2;36m                    [0m         [39mHere is the initial issue log of the codebase:[0m                                      [2m                [0m
[2;36m                    [0m         [39m<issue>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00c00.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d00400.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.util;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static java.nio.charset.StandardCharsets.ISO_8859_1;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m: * Collection of string handling utilities[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:@Internal[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:public final class StringUtil [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = [0m[1;36m10000000[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    public static final Charset UTF16LE = StandardCharsets.UTF_16LE;[0m             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    public static final Charset UTF8 = StandardCharsets.UTF_8;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    public static final Charset WIN_1252 = [0m[1;35mCharset.forName[0m[1;39m([0m[32m"cp1252"[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:     * @param length the max record length allowed for StringUtil[0m                [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        MAX_RECORD_LENGTH = length;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * @return the max record length allowed for StringUtil[0m                      [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:70[0m[39m-[0m[1;36m120[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:     * @param len    the length of the final string[0m                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:     * @return the converted string, never [0m[1;39m{[0m[39m@code null[0m[1;39m}[0m[39m.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:     * @throws ArrayIndexOutOfBoundsException if offset is out of bounds for[0m     [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:     *                                        the byte array [0m[1;39m([0m[39mi.e., is negative [0m [2m                [0m
[2;36m                    [0m         [39mor is greater than or equal to[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:     *                                        string.length[0m[1;39m)[0m                     [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * @throws IllegalArgumentException       if len is too large [0m[1;39m([0m[39mi.e.,[0m         [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     *                                        there is not enough data in string[0m [2m                [0m
[2;36m                    [0m         [39mto create a String of that[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     *                                        length[0m[1;39m)[0m                            [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            final byte[0m[1;39m[[0m[1;39m][0m[39m string,[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            final int offset,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            final int len[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            throws ArrayIndexOutOfBoundsException, IllegalArgumentException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[39mlen == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[32m""[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39moffset < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[39moffset >= string.length[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:            throw new [0m[1;35mArrayIndexOutOfBoundsException[0m[1;39m([0m[32m"Illegal offset "[0m[39m + offset [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m" [0m[32m([0m[32mString data is of length "[0m[39m + string.length + [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39mlen < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[1;39m([0m[1;39m([0m[39mstring.length - offset[0m[1;39m)[0m[39m [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m < len[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Illegal length "[0m[39m + len[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mstring, offset, len * [0m[1;36m2[0m[39m, UTF16LE[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:     * Given a byte array of [0m[1;36m16[0m[39m-bit unicode characters in little endian[0m          [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:     * format [0m[1;39m([0m[39mmost important byte last[0m[1;39m)[0m[39m, return a Java String representation[0m    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:     * of it.[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:     * <p>[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:     * [0m[1;39m{[0m[39m [0m[1;36m0x16[0m[39m, [0m[1;36m0x00[0m[39m [0m[1;39m}[0m[39m -[0m[1;36m0x16[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:     * @param string the byte array to be converted[0m                             [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:     * @return the converted string, never [0m[1;39m{[0m[39m@code null[0m[1;39m}[0m                         [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m string[0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[39mstring.length == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return [0m[32m""[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m[39mstring, [0m[1;36m0[0m[39m, string.length [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * Convert String to [0m[1;36m16[0m[39m-bit unicode characters in little endian format[0m      [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:     * @param string the string[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:     * @return the byte array of [0m[1;36m16[0m[39m-bit unicode characters[0m                      [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35mgetToUnicodeLE[0m[1;39m([0m[39mString string[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: * A pure-MAPI attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class MAPIAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:   private final MAPIProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:160[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m20[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mmptype == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:                  [0m[35m/[0m[35m/[0m[39m It's based on a normal one[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                  int mpid = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:                  MAPIProperty base = [0m[1;35mMAPIProperty.get[0m[1;39m([0m[39mmpid[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:                  name = base.name;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:               [0m[35m/[0m[35m/[0m[39m Now create[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:               prop = [0m[1;35mMAPIProperty.createCustom[0m[1;39m([0m[39mid, type, name[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39mprop == MAPIProperty.UNKNOWN[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:               prop = [0m[1;35mMAPIProperty.createCustom[0m[1;39m([0m[39mid, type, [0m[32m"[0m[32m([0m[32munknown "[0m[39m + [0m        [2m                [0m
[2;36m                    [0m         [1;35mInteger.toHexString[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m + [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m184[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now read in the [0m[1;35mvalue[0m[1;39m([0m[39ms[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            int values = [0m[1;36m1[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39misMV || isVL[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:               values = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            if [0m[1;39m([0m[39mtype == Types.NULL && values > [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:               throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Placeholder/NULL arrays aren't [0m           [2m                [0m
[2;36m                    [0m         [32msupported."[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:               [0m[35m/[0m[35m/[0m[39m Create[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:               MAPIAttribute attr;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mtype == Types.UNICODE_STRING || type == Types.ASCII_STRING[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:                  attr = new [0m[1;35mMAPIStringAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m206[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mtype == Types.APP_TIME || type == Types.TIME[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m207[0m[39m:                  attr = new [0m[1;35mMAPIDateAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mid == MAPIProperty.RTF_COMPRESSED.id[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                  attr = new [0m[1;35mMAPIRtfAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:                  attr = new [0m[1;35mMAPIAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:               [0m[1;35mattrs.add[0m[1;39m([0m[39mattr[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:         [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:         [0m[35m/[0m[35m/[0m[39m All done[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:         return attrs;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:222[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m40[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:   private static int [0m[1;35mgetLength[0m[1;39m([0m[39mMAPIType type, InputStream inp[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:      if [0m[1;39m([0m[1;35mtype.isFixedLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:         return [0m[1;35mtype.getLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:      if [0m[1;39m([0m[39mtype == Types.ASCII_STRING ||[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:          type == Types.UNICODE_STRING ||[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:          type == Types.DIRECTORY ||[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:          type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[35m/[0m[35m/[0m[39m Need to read the length, as it varies[0m                            [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:            return [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m235[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:   private static void [0m[1;35mskipToBoundary[0m[1;39m([0m[39mint length, InputStream inp[0m[1;39m)[0m[39m throws [0m      [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:      [0m[35m/[0m[35m/[0m[39m Data is always padded out to a [0m[1;36m4[0m[39m byte boundary[0m                         [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mlength % [0m[1;36m4[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:         int toSkip = [0m[1;36m4[0m[39m - [0m[1;39m([0m[39mlength % [0m[1;36m4[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:         [0m[1;35minp.skip[0m[1;39m([0m[39mtoSkip[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m75[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: * An attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                           [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m: * Note - the types and IDs differ from standard Outlook/MAPI[0m                    [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m: *  ones, so we can't just re-use the HSMF ones.[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:public class TNEFAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 20_000_000;[0m              [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m             [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:   private final TNEFProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private final int checksum;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    * @param length the max record length allowed for TNEFAttribute[0m              [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:      MAX_RECORD_LENGTH = length;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    * @return the max record length allowed for TNEFAttribute[0m                    [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:   public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:      return MAX_RECORD_LENGTH;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    * Constructs a single new attribute from the id, type,[0m                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    *  and the contents of the stream[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   protected [0m[1;35mTNEFAttribute[0m[1;39m([0m[39mint id, int type, InputStream inp[0m[1;39m)[0m[39m throws IOException[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:      this.type = type;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:      int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:      property = [0m[1;35mTNEFProperty.getBest[0m[1;39m([0m[39mid, type[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:      data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:      [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, data[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      checksum = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFMAPIAttribute.jav[0m[1;92ma:1[0m [2m                [0m
[2;36m                    [0m         [39m-[0m[1;36m52[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m: * A TNEF Attribute holding MAPI Attributes, which applies to a [0m                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m: *  [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m[39m or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                       [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:public final class TNEFMAPIAttribute extends TNEFAttribute [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:   private final List<MAPIAttribute> attributes;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    * Constructs a single new mapi containing attribute from the [0m                [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    *  id, type, and the contents of the stream[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:   protected [0m[1;35mTNEFMAPIAttribute[0m[1;39m([0m[39mint id, int type, InputStream inp[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:      [0m[1;35msuper[0m[1;39m([0m[39mid, type, inp[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:      attributes = [0m[1;35mMAPIAttribute.create[0m[1;39m([0m[39mthis[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   public List<MAPIAttribute> [0m[1;35mgetMAPIAttributes[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                              [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:      return attributes;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:   public String [0m[1;35mtoString[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:      return [0m[32m"Attribute "[0m[39m + [0m[1;35mgetProperty[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m", [0m[32mtype[0m[32m="[0m[39m + [0m[1;35mgetType[0m[1;39m([0m[1;39m)[0m[39m +[0m              [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:             [0m[32m", "[0m[39m + [0m[1;35mattributes.size[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" MAPI Attributes"[0m[39m; [0m                     [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIStringAttribute.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:1[0m[39m-[0m[1;36m83[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import org.apache.logging.log4j.Logger;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.poi.logging.PoiLogManager;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m: * A pure-MAPI attribute holding a String, which applies[0m                         [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m: *  to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m[39m or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:public final class MAPIStringAttribute extends MAPIAttribute [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:   private static final Logger LOG = [0m                                            [2m                [0m
[2;36m                    [0m         [1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mMAPIStringAttribute.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:   private static final String CODEPAGE = [0m[32m"CP1252"[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   private final String data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   public [0m[1;35mMAPIStringAttribute[0m[1;39m([0m[39mMAPIProperty property, int type, byte[0m[1;39m[[0m[1;39m][0m[39m data[0m[1;39m)[0m[39m [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:      [0m[1;35msuper[0m[1;39m([0m[39mproperty, type, data[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:      String tmpData = null;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mtype == [0m[1;35mTypes.ASCII_STRING.getId[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:         tmpData = new [0m[1;35mString[0m[1;39m([0m[39mdata, [0m[1;35mCharset.forName[0m[1;39m([0m[39mCODEPAGE[0m[1;39m)[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mtype == [0m[1;35mTypes.UNICODE_STRING.getId[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:         tmpData = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:         throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Not a string type "[0m[39m + type[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:      [0m[35m/[0m[35m/[0m[39m Strip off the null terminator if present[0m                                [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:      [0m[1;35mif[0m[1;39m([0m[1;35mtmpData.endsWith[0m[1;39m([0m[32m"\0"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:         tmpData = [0m[1;35mtmpData.substring[0m[1;39m([0m[1;36m0[0m[39m, [0m[1;35mtmpData.length[0m[1;39m([0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:      this.data = tmpData;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:   public String [0m[1;35mgetDataString[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:      return data;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:   public String [0m[1;35mtoString[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:      return [0m[1;35mgetProperty[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" "[0m[39m + data;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    * Returns the string of an Attribute, converting as appropriate[0m              [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:   public static String [0m[1;35mgetAsString[0m[1;39m([0m[39mMAPIAttribute attr[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mattr == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:         return null;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mattr instanceof MAPIStringAttribute[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:         return [0m[1;39m([0m[1;39m([0m[39mMAPIStringAttribute[0m[1;39m)[0m[39mattr[0m[1;39m)[0m[1;35m.getDataString[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mattr instanceof MAPIRtfAttribute[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:         return [0m[1;39m([0m[1;39m([0m[39mMAPIRtfAttribute[0m[1;39m)[0m[39mattr[0m[1;39m)[0m[1;35m.getDataString[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:      [0m[1;35mLOG.atWarn[0m[1;39m([0m[1;39m)[0m[1;35m.log[0m[1;39m([0m[32m"Warning, non string property found: [0m[32m{[0m[32m}[0m[32m"[0m[39m, attr[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:      return null;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:  [0m[1;39m}[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:566[0m[39m-[0m[1;36m600[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m566[0m[39m:            return -1L;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m567[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m568[0m[39m:        return toSkip - remain;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m569[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m570[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m571[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyAllocate[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m572[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m573[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m574[0m[39m:        [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mlength[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m575[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m576[0m[39m:        return new byte[0m[1;39m[[0m[1;39m([0m[39mint[0m[1;39m)[0m[39mlength[0m[1;39m][0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m577[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m578[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m579[0m[39m:    public static void [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m580[0m[39m:        if [0m[1;39m([0m[39mlength < 0L[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m581[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array of length [0m [2m                [0m
[2;36m                    [0m         [32m< 0, but had "[0m[39m + length + [0m[32m" and "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m582[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m583[0m[39m:        if [0m[1;39m([0m[39mlength > [0m[1;39m([0m[39mlong[0m[1;39m)[0m[39mInteger.MAX_VALUE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m584[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array > [0m         [2m                [0m
[2;36m                    [0m         [32m"[0m[39m+Integer.MAX_VALUE[0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m585[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m586[0m[39m:        [0m[1;35mcheckLength[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m587[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m588[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m589[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyClone[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m src, int offset, int length, int [0m   [2m                [0m
[2;36m                    [0m         [39mmaxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m590[0m[39m:        if [0m[1;39m([0m[39msrc == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m591[0m[39m:            return null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m592[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m593[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m594[0m[39m:        if [0m[1;39m([0m[39moffset < [0m[1;36m0[0m[39m || length < [0m[1;36m0[0m[39m || maxLength < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m595[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Invalid offset/length specified: "[0m [2m                [0m
[2;36m                    [0m         [1;36m596[0m[39m:                    + [0m[32m"offset: "[0m[39m + offset + [0m[32m", lenght: "[0m[39m + length + [0m[32m", [0m         [2m                [0m
[2;36m                    [0m         [32mmaxLength: "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m597[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m598[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m599[0m[39m:        int realLength = [0m[1;35mMath.min[0m[1;39m([0m[39msrc.length - offset, length[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m600[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mrealLength, maxLength[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.poifs.filesystem;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.OutputStream;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.output.UnsynchronizedByteArrayOutputStream;[0m         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.util.LittleEndianByteArrayInputStream;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.util.LittleEndianConsts;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.util.LittleEndianInput;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.util.LittleEndianOutputStream;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m: * Represents an Ole10Native record which is wrapped around certain binary[0m       [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m: * files being embedded in OLE2 documents.<p>[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: * Ole10Native objects come in different shapes:[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: * <ul>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *     <li>unparsed: we can't identify its structure<[0m[35m/[0m[95mli[0m[39m>[0m                        [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m: *     <li>compact: same as unparsed but with a leading flag<[0m[35m/[0m[95mli[0m[39m>[0m                [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m: *     <li>parsed - Ole-Class [0m[32m"Package"[0m[39m: data + ASCII [0m                           [2m                [0m
[2;36m                    [0m         [39mlabel,command,filename<[0m[35m/[0m[95mli[0m[39m>[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m: *     <li>parsed - Ole-Class [0m[32m"Package2"[0m[39m: as above plus UTF16 [0m                   [2m                [0m
[2;36m                    [0m         [39mlabel,command,filename<[0m[35m/[0m[95mli[0m[39m>[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m: * <[0m[35m/[0m[95mul[0m[39m>[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:@[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unused"[0m[1;39m)[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:public class Ole10Native [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    public static final String OLE10_NATIVE = [0m[32m"\u0001Ole10Native"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:285[0m[39m-[0m[1;36m300[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    private static String [0m[1;35mreadAsciiLen[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:        return [0m[1;39m([0m[39mbuf.length == [0m[1;36m0[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mStringUtil.getFromCompressedUnicode[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size - [0m[1;36m1[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:    private static String [0m[1;35mreadUtf16[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size * [0m[1;36m2[0m[39m, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:        return [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m296[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m297[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m298[0m[39m:     * Returns the value of the totalSize field - the total length of the[0m       [2m                [0m
[2;36m                    [0m         [1;36m299[0m[39m:     * structure is totalSize + [0m[1;36m4[0m[39m [0m[1;39m([0m[39mvalue of this field + size of this field[0m[1;39m)[0m[39m.[0m   [2m                [0m
[2;36m                    [0m         [1;36m300[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:215[0m[39m-[0m[1;36m217[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35mtoByteArray[0m[1;39m([0m[39mInputStream stream, final int length, [0m     [2m                [0m
[2;36m                    [0m         [39mfinal int maxLength[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:        return [0m[1;35mtoByteArray[0m[1;39m([0m[39mstream, length, maxLength, true, length != [0m          [2m                [0m
[2;36m                    [0m         [39mInteger.MAX_VALUE[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:257[0m[39m-[0m[1;36m289[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:    private static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35mtoByteArray[0m[1;39m([0m[39mInputStream stream, final int length, [0m    [2m                [0m
[2;36m                    [0m         [39mfinal int maxLength,[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:                                      final boolean checkEOFException, final [0m   [2m                [0m
[2;36m                    [0m         [39mboolean isLengthKnown[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:        final int derivedMaxLength = [0m[1;35mMath.max[0m[1;39m([0m[39mmaxLength, [0m                       [2m                [0m
[2;36m                    [0m         [39mBYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39mlength != Integer.MAX_VALUE[0m[1;39m)[0m[39m || [0m[1;39m([0m[39mderivedMaxLength != [0m              [2m                [0m
[2;36m                    [0m         [39mInteger.MAX_VALUE[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:            [0m[1;35mcheckLength[0m[1;39m([0m[39mlength, derivedMaxLength[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:        final int derivedLen = isLengthKnown && length >= [0m[1;36m0[0m[39m ? [0m[1;35mMath.min[0m[1;39m([0m[39mlength, [0m [2m                [0m
[2;36m                    [0m         [39mderivedMaxLength[0m[1;39m)[0m[39m : derivedMaxLength;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:        final int byteArrayInitLen = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35mcalculateByteArrayInitLength[0m[1;39m([0m[39misLengthKnown, length, derivedMaxLength[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:        final int internalBufferLen = DEFAULT_BUFFER_SIZE;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:        try [0m[1;39m([0m[39mUnsynchronizedByteArrayOutputStream baos = [0m                        [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayOutputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setBufferSize[0m[1;39m([0m[39mbyteArrayInitLen[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m[39m [0m[1;39m{[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m buffer = new byte[0m[1;39m[[0m[39minternalBufferLen[0m[1;39m][0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:            int totalBytes = [0m[1;36m0[0m[39m, readBytes;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:            do [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:                readBytes = [0m[1;35mstream.read[0m[1;39m([0m[39mbuffer, [0m[1;36m0[0m[39m, [0m[1;35mMath.min[0m[1;39m([0m[39minternalBufferLen, [0m [2m                [0m
[2;36m                    [0m         [39mderivedLen - totalBytes[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:                totalBytes += [0m[1;35mMath.max[0m[1;39m([0m[39mreadBytes, [0m[1;36m0[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:                if [0m[1;39m([0m[39mreadBytes > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:                    [0m[1;35mbaos.write[0m[1;39m([0m[39mbuffer, [0m[1;36m0[0m[39m, readBytes[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:                [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mtotalBytes[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:            [0m[1;39m}[0m[39m while [0m[1;39m([0m[39mtotalBytes < derivedLen && readBytes > [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:            if [0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE < [0m[1;36m0[0m[39m && readBytes > [0m[1;36m-1[0m[39m && !isLengthKnown[0m [2m                [0m
[2;36m                    [0m         [39m&& [0m[1;35mstream.read[0m[1;39m([0m[1;39m)[0m[39m >= [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:                [0m[1;35mthrowRecordTruncationException[0m[1;39m([0m[39mderivedMaxLength[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:            if [0m[1;39m([0m[39mcheckEOFException && length >= [0m[1;36m0[0m[39m && derivedLen != [0m              [2m                [0m
[2;36m                    [0m         [39mInteger.MAX_VALUE && totalBytes < derivedLen[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:                throw new [0m[1;35mEOFException[0m[1;39m([0m[32m"unexpected EOF - expected len: "[0m[39m + [0m     [2m                [0m
[2;36m                    [0m         [39mderivedLen + [0m[32m" - actual len: "[0m[39m + totalBytes[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:            return [0m[1;35mbaos.toByteArray[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:301[0m[39m-[0m[1;36m315[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:    private static void [0m[1;35mcheckLength[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:        if [0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:            if [0m[1;39m([0m[39mlength > BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:                [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39mlength > maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:            [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m311[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m312[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m313[0m[39m:     * Returns an array [0m[1;39m([0m[39mthat shouldn't be written to![0m[1;39m)[0m[39m of the[0m                  [2m                [0m
[2;36m                    [0m         [1;36m314[0m[39m:     *  ByteBuffer. Will be of the requested length, or possibly[0m                [2m                [0m
[2;36m                    [0m         [1;36m315[0m[39m:     *  longer if that's easier.[0m                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:50[0m[39m-[0m[1;36m90[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    public static final String OLE10_NATIVE = [0m[32m"\u0001Ole10Native"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final Charset UTF8 = StandardCharsets.UTF_8;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = 100_000_000;[0m            [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    private static final int DEFAULT_MAX_STRING_LENGTH = [0m[1;36m1024[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:     * Default content of the \u0001Ole entry[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    private static final byte[0m[1;39m[[0m[1;39m][0m[39m OLE_MARKER_BYTES =[0m                               [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:            [0m[1;39m{[0m[1;36m1[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m2[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[39m, [0m[1;36m0[0m[1;39m}[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    private static final String OLE_MARKER_NAME = [0m[32m"\u0001Ole"[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    [0m[35m/[0m[35m/[0m[39m [0m[1;36m4[0m[39m bytes, total size of record not including this field[0m                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    private int totalSize;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    [0m[35m/[0m[35m/[0m[39m [0m[1;36m2[0m[39m bytes, unknown, mostly [0m[1;39m[[0m[1;36m02[0m[39m [0m[1;36m00[0m[1;39m][0m                                          [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    private short flags1 = [0m[1;36m2[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:    [0m[35m/[0m[35m/[0m[39m ASCIIZ, stored in this field without the terminating zero[0m                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    private String label;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    [0m[35m/[0m[35m/[0m[39m ASCIIZ, stored in this field without the terminating zero[0m                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    private String fileName;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    [0m[35m/[0m[35m/[0m[39m [0m[1;36m2[0m[39m bytes, unknown, mostly [0m[1;39m[[0m[1;36m00[0m[39m [0m[1;36m00[0m[1;39m][0m                                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    private short flags2;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    [0m[35m/[0m[35m/[0m[39m see below[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    private short unknown1 = [0m[1;36m3[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    [0m[35m/[0m[35m/[0m[39m ASCIIZ, stored in this field without the terminating zero[0m                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:    private String command;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:    [0m[35m/[0m[35m/[0m[39m varying size, the actual native data[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:    private byte[0m[1;39m[[0m[1;39m][0m[39m dataBuffer;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:    [0m[35m/[0m[35m/[0m[39m UTF16-LE String with leading length[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:    private String command2;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:    [0m[35m/[0m[35m/[0m[39m UTF16-LE String with leading length[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    private String label2;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    [0m[35m/[0m[35m/[0m[39m UTF16-LE String with leading length[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:    private String fileName2;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/HMEFMessage.jav[0m[1;92ma:1[0m[39m-[0m[1;36m90[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.hmef.attribute.MAPIAttribute;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.attribute.MAPIStringAttribute;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.attribute.TNEFAttribute;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hmef.attribute.TNEFMAPIAttribute;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hmef.attribute.TNEFProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m: * HMEF - Implementation of the Microsoft TNEF message[0m                           [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m: *  encoding format [0m[1;39m([0m[39maka winmail.dat[0m[1;39m)[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m: * See:[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: *   [0m[4;94mhttp://support.microsoft.com/kb/241538[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: *   [0m[4;94mhttp://en.wikipedia.org/wiki/Transport_Neutral_Encapsulation_Format[0m         [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *   [0m[4;94mhttp://search.cpan.org/dist/Convert-TNEF/[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:public final class HMEFMessage [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    public static final int [0m[1;33mHEAD[0m[39mER_SIGNATURE = [0m[1;36m0x223e9f78[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    @[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unused"[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    private int fileId;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    private final List<TNEFAttribute> messageAttributes = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    private final List<MAPIAttribute> mapiAttributes = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:    private final List<Attachment> attachments = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:     * @param inp input stream[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:     * @throws IOException If reading data from the stream fails[0m                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:     * @throws IllegalStateException a number of runtime exceptions can be [0m      [2m                [0m
[2;36m                    [0m         [39mthrown, especially if there are problems with the[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:     * input format[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    public [0m[1;35mHMEFMessage[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            [0m[35m/[0m[35m/[0m[39m Check the signature matches[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:            int sig = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            if [0m[1;39m([0m[39msig != [0m[1;33mHEAD[0m[39mER_SIGNATURE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:                        [0m[32m"TNEF signature not detected in file, "[0m[39m +[0m                [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:                        [0m[32m"expected "[0m[39m + [0m[1;33mHEAD[0m[39mER_SIGNATURE + [0m[32m" but got "[0m[39m + sig[0m       [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                [0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[35m/[0m[35m/[0m[39m Read the File ID[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            fileId = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now begin processing the contents[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:            [0m[1;35mprocess[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;35minp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    private void [0m[1;35mprocess[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:       int level;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:       do [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:           [0m[35m/[0m[35m/[0m[39m Fetch the level[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:           level = [0m[1;35minp.read[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:           [0m[35m/[0m[35m/[0m[39m Decide what to attach it to, based on the levels and IDs[0m           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:           switch [0m[1;39m([0m[39mlevel[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:               case TNEFProperty.LEVEL_MESSAGE:[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                   [0m[1;35mprocessMessage[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                   break;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                case TNEFProperty.LEVEL_ATTACHMENT:[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                   [0m[1;35mprocessAttachment[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/HMEFMessage.jav[0m[1;92ma:103[0m[39m-[0m[1;36m120[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:    void [0m[1;35mprocessMessage[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[39m Build the attribute[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        TNEFAttribute attr = [0m[1;35mTNEFAttribute.create[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;35mmessageAttributes.add[0m[1;39m([0m[39mattr[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        if [0m[1;39m([0m[39mattr instanceof TNEFMAPIAttribute[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            TNEFMAPIAttribute tnefMAPI = [0m[1;39m([0m[39mTNEFMAPIAttribute[0m[1;39m)[0m[39m attr;[0m              [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            [0m[1;35mmapiAttributes.addAll[0m[1;39m([0m[1;35mtnefMAPI.getMAPIAttributes[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:    void [0m[1;35mprocessAttachment[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[35m/[0m[35m/[0m[39m Build the attribute[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        TNEFAttribute attr = [0m[1;35mTNEFAttribute.create[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:        [0m[35m/[0m[35m/[0m[39m Previous attachment or a new one?[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:        if [0m[1;39m([0m[1;35mattachments.isEmpty[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:50[0m[39m-[0m[1;36m12[0m [2m                [0m
[2;36m                    [0m         [1;36m5[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    * @param length the max record length allowed for MAPIAttribute[0m              [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:   public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:      MAX_RECORD_LENGTH = length;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    * @return the max record length allowed for MAPIAttribute[0m                    [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:   public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:      return MAX_RECORD_LENGTH;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    * Constructs a single new attribute from[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    *  the contents of the stream[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:   public [0m[1;35mMAPIAttribute[0m[1;39m([0m[39mMAPIProperty property, int type, byte[0m[1;39m[[0m[1;39m][0m[39m data[0m[1;39m)[0m[39m [0m[1;39m{[0m          [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:      this.property = property;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      this.type = type;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:      this.data = [0m[1;35mdata.clone[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:   public MAPIProperty [0m[1;35mgetProperty[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:      return property;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:   public int [0m[1;35mgetType[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:      return type;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:   public byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35mgetData[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:      return data;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:   public String [0m[1;35mtoString[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:      String hex;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mdata.length <= [0m[1;36m16[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:         hex = [0m[1;35mHexDump.toHex[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:         byte[0m[1;39m[[0m[1;39m][0m[39m d = [0m[1;35mArrays.copyOf[0m[1;39m([0m[39mdata, [0m[1;36m16[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:         hex = [0m[1;35mHexDump.toHex[0m[1;39m([0m[39md[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:         hex = [0m[1;35mhex.substring[0m[1;39m([0m[1;36m0[0m[39m, [0m[1;35mhex.length[0m[1;39m([0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m + [0m[32m", ....[0m[32m][0m[32m"[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:      return property + [0m[32m" "[0m[39m + hex;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:   [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:    * Parses a MAPI Properties TNEF Attribute, and returns[0m                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:    *  the list of MAPI Attributes contained within it[0m                          [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:    *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:   public static List<MAPIAttribute> [0m[1;35mcreate[0m[1;39m([0m[39mTNEFAttribute parent[0m[1;39m)[0m[39m throws [0m       [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:      [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_MAPIPROPERTIES[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:         [0m[35m/[0m[35m/[0m[39m Regular MAPI Properties, normally on the message[0m                    [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:      else [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_ATTACHMENT[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:         [0m[35m/[0m[35m/[0m[39m MAPI Properties for an attachment[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:      else [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:         [0m[35m/[0m[35m/[0m[39m Something else, oh dear[0m[33m...[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:         throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                                    [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:               [0m[32m"Can only create from a MAPIProperty attribute, "[0m[39m +[0m              [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:               [0m[32m"instead received a "[0m[39m + [0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" one"[0m            [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:         [0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:      [0m[1;35mtry[0m[1;39m([0m[39mUnsynchronizedByteArrayInputStream inp = [0m                             [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[1;35mparent.getData[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:         [0m[35m/[0m[35m/[0m[39m First up, get the number of attributes[0m                              [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:         int count = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:         List<MAPIAttribute> attrs = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:         [0m[35m/[0m[35m/[0m[39m Now, read each one in in turn[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:         [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mi[0m[39m=[0m[1;36m0[0m[39m; i<count; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:162[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m81[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                  int mpid = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:                  MAPIProperty base = [0m[1;35mMAPIProperty.get[0m[1;39m([0m[39mmpid[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:                  name = base.name;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:               [0m[35m/[0m[35m/[0m[39m Now create[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:               prop = [0m[1;35mMAPIProperty.createCustom[0m[1;39m([0m[39mid, type, name[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:196[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m00[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:222[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m34[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:   private static int [0m[1;35mgetLength[0m[1;39m([0m[39mMAPIType type, InputStream inp[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:      if [0m[1;39m([0m[1;35mtype.isFixedLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:         return [0m[1;35mtype.getLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:      if [0m[1;39m([0m[39mtype == Types.ASCII_STRING ||[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:          type == Types.UNICODE_STRING ||[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:          type == Types.DIRECTORY ||[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:          type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[35m/[0m[35m/[0m[39m Need to read the length, as it varies[0m                            [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:            return [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hsmf/datatypes/Types.jav[0m[1;92ma:70[0m[39m-[0m[1;36m140[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    [0m[35m/[0m[39m** ClassId - OLE GUID *[0m[35m/[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:    public static final MAPIType CLS_ID = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x0048[0m[39m, [0m[32m"CLS ID GUID"[0m[39m, [0m   [2m                [0m
[2;36m                    [0m         [1;36m16[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    [0m[35m/[0m[39m** Binary - counted byte array *[0m[35m/[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public static final MAPIType BINARY = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x0102[0m[39m, [0m[32m"Binary"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     * An [0m[1;36m8[0m[39m-bit string, probably in CP1252, but don't quote us[0m[33m...[0m[39m Normally used[0m  [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * for everything before Outlook [0m[1;36m3.0[0m[39m, and some fields in Outlook [0m[1;36m3.0[0m[39m.[0m        [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:    public static final MAPIType ASCII_STRING = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x001E[0m[39m, [0m[32m"ASCII [0m     [2m                [0m
[2;36m                    [0m         [32mString"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:    [0m[35m/[0m[39m** A string, from Outlook [0m[1;36m3.0[0m[39m onwards. Normally unicode *[0m[35m/[0m                  [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:    public static final MAPIType UNICODE_STRING = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x001F[0m[39m, [0m[32m"Unicode [0m [2m                [0m
[2;36m                    [0m         [32mString"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:    [0m[35m/[0m[39m** MultiValued Properties *[0m[35m/[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:    public static final MAPIType MV_SHORT = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1002[0m[39m, [0m[32m"MV Short"[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [1;36m-1[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    public static final MAPIType MV_LONG = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1003[0m[39m, [0m[32m"MV Long"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    public static final MAPIType MV_FLOAT = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1004[0m[39m, [0m[32m"MV Float"[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [1;36m-1[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:    public static final MAPIType MV_DOUBLE = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1005[0m[39m, [0m[32m"MV Double"[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [1;36m-1[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:    public static final MAPIType MV_CURRENCY = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1006[0m[39m, [0m[32m"MV [0m         [2m                [0m
[2;36m                    [0m         [32mCurrency"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    public static final MAPIType MV_APP_TIME = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1007[0m[39m, [0m[32m"MV [0m         [2m                [0m
[2;36m                    [0m         [32mApplication Time"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    public static final MAPIType MV_LONG_LONG = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1014[0m[39m, [0m[32m"MV Long [0m   [2m                [0m
[2;36m                    [0m         [32mLong"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:    public static final MAPIType MV_TIME = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1040[0m[39m, [0m[32m"MV Time"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:    public static final MAPIType MV_CLS_ID = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1048[0m[39m, [0m[32m"MV CLS ID [0m    [2m                [0m
[2;36m                    [0m         [32mGUID"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:    public static final MAPIType MV_BINARY = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x1102[0m[39m, [0m[32m"MV Binary"[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [1;36m-1[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    public static final MAPIType MV_ASCII_STRING = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x101E[0m[39m, [0m[32m"MV [0m     [2m                [0m
[2;36m                    [0m         [32mASCII String"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:    public static final MAPIType MV_UNICODE_STRING = new [0m[1;35mMAPIType[0m[1;39m([0m[1;36m0x101F[0m[39m, [0m[32m"MV [0m   [2m                [0m
[2;36m                    [0m         [32mUnicode String"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:    [0m[35m/[0m[39m** MultiValued - Value part contains multiple values *[0m[35m/[0m                     [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:    public static final int MULTIVALUED_FLAG = [0m[1;36m0x1000[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:    public static final class MAPIType [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        private final int id;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        private final String name;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        private final int length;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        [0m[35m/[0m[39m**[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:         * Creates a standard, built-in type[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:         *[0m[35m/[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        private [0m[1;35mMAPIType[0m[1;39m([0m[39mint id, String name, int length[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            this.id = id;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            this.name = name;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            this.length = length;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:            [0m[1;35mbuiltInTypes.put[0m[1;39m([0m[39mid, this[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[35m/[0m[39m**[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:         * Creates a custom type[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:         *[0m[35m/[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:        private [0m[1;35mMAPIType[0m[1;39m([0m[39mint id, int length[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:            this.id = id;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:            this.name = [0m[1;35masCustomName[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:            this.length = length;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:            [0m[1;35mcustomTypes.put[0m[1;39m([0m[39mid, this[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:        [0m[35m/[0m[39m**[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:         * Returns the length, in bytes, of values of this type, or [0m[1;36m-1[0m[39m if it is[0m [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:         * a variable length type.[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:         *[0m[35m/[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        public int [0m[1;35mgetLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            return length;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:        [0m[35m/[0m[39m**[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:         * Is this type a fixed-length type, or a variable-length one?[0m          [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:         *[0m[35m/[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:        public boolean [0m[1;35misFixedLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            return [0m[1;39m([0m[1;39m([0m[39mlength != [0m[1;36m-1[0m[1;39m)[0m[39m && [0m[1;39m([0m[39mlength <= [0m[1;36m8[0m[1;39m)[0m[1;39m)[0m[39m || [0m[1;39m([0m[39mid == [0m                 [2m                [0m
[2;36m                    [0m         [39mTypes.CLS_ID.id[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:37[0m[39m-[0m[1;36m39[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 20_000_000;[0m              [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:64[0m[39m-[0m[1;36m72[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   protected [0m[1;35mTNEFAttribute[0m[1;39m([0m[39mint id, int type, InputStream inp[0m[1;39m)[0m[39m throws IOException[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:      this.type = type;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:      int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:      property = [0m[1;35mTNEFProperty.getBest[0m[1;39m([0m[39mid, type[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:      data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:      [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, data[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      checksum = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:105[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m25[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:   public static List<MAPIAttribute> [0m[1;35mcreate[0m[1;39m([0m[39mTNEFAttribute parent[0m[1;39m)[0m[39m throws [0m       [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:      [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_MAPIPROPERTIES[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:         [0m[35m/[0m[35m/[0m[39m Regular MAPI Properties, normally on the message[0m                    [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:      else [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_ATTACHMENT[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:         [0m[35m/[0m[35m/[0m[39m MAPI Properties for an attachment[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:      else [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:         [0m[35m/[0m[35m/[0m[39m Something else, oh dear[0m[33m...[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:         throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                                    [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:               [0m[32m"Can only create from a MAPIProperty attribute, "[0m[39m +[0m              [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:               [0m[32m"instead received a "[0m[39m + [0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" one"[0m            [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:         [0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:      [0m[1;35mtry[0m[1;39m([0m[39mUnsynchronizedByteArrayInputStream inp = [0m                             [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[1;35mparent.getData[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:         [0m[35m/[0m[35m/[0m[39m First up, get the number of attributes[0m                              [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:         int count = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:         List<MAPIAttribute> attrs = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:         [0m[35m/[0m[35m/[0m[39m Now, read each one in in turn[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:         [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mi[0m[39m=[0m[1;36m0[0m[39m; i<count; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:186[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m00[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now read in the [0m[1;35mvalue[0m[1;39m([0m[39ms[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            int values = [0m[1;36m1[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39misMV || isVL[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:               values = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            if [0m[1;39m([0m[39mtype == Types.NULL && values > [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:               throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Placeholder/NULL arrays aren't [0m           [2m                [0m
[2;36m                    [0m         [32msupported."[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:222[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m40[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:   private static int [0m[1;35mgetLength[0m[1;39m([0m[39mMAPIType type, InputStream inp[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:      if [0m[1;39m([0m[1;35mtype.isFixedLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:         return [0m[1;35mtype.getLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:      if [0m[1;39m([0m[39mtype == Types.ASCII_STRING ||[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:          type == Types.UNICODE_STRING ||[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:          type == Types.DIRECTORY ||[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:          type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[35m/[0m[35m/[0m[39m Need to read the length, as it varies[0m                            [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:            return [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m235[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:   private static void [0m[1;35mskipToBoundary[0m[1;39m([0m[39mint length, InputStream inp[0m[1;39m)[0m[39m throws [0m      [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:      [0m[35m/[0m[35m/[0m[39m Data is always padded out to a [0m[1;36m4[0m[39m byte boundary[0m                         [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mlength % [0m[1;36m4[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:         int toSkip = [0m[1;36m4[0m[39m - [0m[1;39m([0m[39mlength % [0m[1;36m4[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:         [0m[1;35minp.skip[0m[1;39m([0m[39mtoSkip[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:43[0m[39m-[0m[1;36m80[0m                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    private static final Logger LOG = [0m[1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mIOUtils.class[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:     * The default buffer size to use for the [0m[1;35mskip[0m[1;39m([0m[1;39m)[0m[39m methods.[0m                    [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    private static final int SKIP_BUFFER_SIZE = [0m[1;36m2048[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:     * The current set global allocation limit override,[0m                         [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:     * [0m[1;36m-1[0m[39m means limits are applied per record type.[0m                              [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    private static int BYTE_ARRAY_MAX_OVERRIDE = [0m[1;36m-1[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:     * The max init size of ByteArrayOutputStream.[0m                               [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:     * [0m[1;36m-1[0m[39m means init size of ByteArrayOutputStream could be up to [0m               [2m                [0m
[2;36m                    [0m         [39mInteger.MAX_VALUE[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    private static int MAX_BYTE_ARRAY_INIT_SIZE = [0m[1;36m-1[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:     * The default size of the bytearray used while reading input streams. This [0m [2m                [0m
[2;36m                    [0m         [39mis meant to be pretty small.[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:    private static final int DEFAULT_BUFFER_SIZE = [0m[1;36m4096[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    private [0m[1;35mIOUtils[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:        [0m[35m/[0m[35m/[0m[39m no instances of this class[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:     * @param maxOverride the max init size of ByteArrayOutputStream.[0m            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:     * [0m[1;36m-1[0m[39m [0m[1;39m([0m[39mthe default[0m[1;39m)[0m[39m means init size of ByteArrayOutputStream could be up to [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m[39m@link Integer#MAX_VALUE[0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:     * @since POI [0m[1;36m5.2[0m[39m.[0m[1;36m2[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    public static void [0m[1;35msetMaxByteArrayInitSize[0m[1;39m([0m[39mfinal int maxOverride[0m[1;39m)[0m[39m [0m[1;39m{[0m          [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        MAX_BYTE_ARRAY_INIT_SIZE = maxOverride;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:571[0m[39m-[0m[1;36m600[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m571[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyAllocate[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m572[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m573[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m574[0m[39m:        [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mlength[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m575[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m576[0m[39m:        return new byte[0m[1;39m[[0m[1;39m([0m[39mint[0m[1;39m)[0m[39mlength[0m[1;39m][0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m577[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m578[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m579[0m[39m:    public static void [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m580[0m[39m:        if [0m[1;39m([0m[39mlength < 0L[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m581[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array of length [0m [2m                [0m
[2;36m                    [0m         [32m< 0, but had "[0m[39m + length + [0m[32m" and "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m582[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m583[0m[39m:        if [0m[1;39m([0m[39mlength > [0m[1;39m([0m[39mlong[0m[1;39m)[0m[39mInteger.MAX_VALUE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m584[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array > [0m         [2m                [0m
[2;36m                    [0m         [32m"[0m[39m+Integer.MAX_VALUE[0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m585[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m586[0m[39m:        [0m[1;35mcheckLength[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m587[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m588[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m589[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyClone[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m src, int offset, int length, int [0m   [2m                [0m
[2;36m                    [0m         [39mmaxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m590[0m[39m:        if [0m[1;39m([0m[39msrc == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m591[0m[39m:            return null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m592[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m593[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m594[0m[39m:        if [0m[1;39m([0m[39moffset < [0m[1;36m0[0m[39m || length < [0m[1;36m0[0m[39m || maxLength < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m595[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Invalid offset/length specified: "[0m [2m                [0m
[2;36m                    [0m         [1;36m596[0m[39m:                    + [0m[32m"offset: "[0m[39m + offset + [0m[32m", lenght: "[0m[39m + length + [0m[32m", [0m         [2m                [0m
[2;36m                    [0m         [32mmaxLength: "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m597[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m598[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m599[0m[39m:        int realLength = [0m[1;35mMath.min[0m[1;39m([0m[39msrc.length - offset, length[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m600[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mrealLength, maxLength[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:53[0m[39m-[0m[1;36m57[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = 100_000_000;[0m            [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    private static final int DEFAULT_MAX_STRING_LENGTH = [0m[1;36m1024[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:285[0m[39m-[0m[1;36m295[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    private static String [0m[1;35mreadAsciiLen[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:        return [0m[1;39m([0m[39mbuf.length == [0m[1;36m0[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mStringUtil.getFromCompressedUnicode[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size - [0m[1;36m1[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:    private static String [0m[1;35mreadUtf16[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size * [0m[1;36m2[0m[39m, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:        return [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:51[0m[39m-[0m[1;36m57[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final Charset UTF8 = StandardCharsets.UTF_8;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = 100_000_000;[0m            [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    private static final int DEFAULT_MAX_STRING_LENGTH = [0m[1;36m1024[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:156[0m[39m-[0m[1;36m169[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:     * @param length the max string length allowed for Ole10Native[0m              [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:    public static void [0m[1;35msetMaxStringLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:        MAX_STRING_LENGTH = length;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:     * @return the max string length allowed for Ole10Native[0m                    [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:    public static int [0m[1;35mgetMaxStringLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:        return MAX_STRING_LENGTH;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:274[0m[39m-[0m[1;36m295[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:    private static String [0m[1;35mreadAsciiZ[0m[1;39m([0m[39mLittleEndianInput is[0m[1;39m)[0m[39m throws [0m              [2m                [0m
[2;36m                    [0m         [39mOle10NativeException [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:        [0m[35m/[0m[35m/[0m[39m arbitrary sized buffer - not sure how big strings can get in an [0m     [2m                [0m
[2;36m                    [0m         [39mOle10 record[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = new byte[0m[1;39m[[0m[39mMAX_STRING_LENGTH[0m[1;39m][0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:        for [0m[1;39m([0m[39mint [0m[33mi[0m[39m=[0m[1;36m0[0m[39m; i<buf.length; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:            if [0m[1;39m([0m[1;39m([0m[39mbuf[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = [0m[1;35mis.readByte[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:                return [0m[1;35mStringUtil.getFromCompressedUTF8[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, i[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:        throw new [0m[1;35mOle10NativeException[0m[1;39m([0m[32m"AsciiZ string was not null terminated [0m  [2m                [0m
[2;36m                    [0m         [32mafter "[0m[39m + MAX_STRING_LENGTH + [0m[32m" bytes - Exiting."[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    private static String [0m[1;35mreadAsciiLen[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:        return [0m[1;39m([0m[39mbuf.length == [0m[1;36m0[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mStringUtil.getFromCompressedUnicode[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size - [0m[1;36m1[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:    private static String [0m[1;35mreadUtf16[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size * [0m[1;36m2[0m[39m, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:        return [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:71[0m[39m-[0m[1;36m76[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:@[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unused"[0m[1;39m)[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:public class VBAMacroReader implements Closeable [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    private static final Logger LOGGER = [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mVBAMacroReader.class[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrary[0m[39m limit on size of strings to read, etc.[0m                           [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    private static final int MAX_STRING_LENGTH = [0m[1;36m20000[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:716[0m[39m-[0m[1;36m722[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m716[0m[39m:    private static String [0m[1;35mreadString[0m[1;39m([0m[39mInputStream stream, int length, Charset [0m   [2m                [0m
[2;36m                    [0m         [39mcharset[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m717[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buffer = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m718[0m[39m:        int bytesRead = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39mstream, buffer[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m719[0m[39m:        if [0m[1;39m([0m[39mbytesRead != length[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m720[0m[39m:            throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Tried to read: "[0m[39m+length +[0m                    [2m                [0m
[2;36m                    [0m         [1;36m721[0m[39m:                    [0m[32m", but could only read: "[0m[39m+bytesRead[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m722[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:781[0m[39m-[0m[1;36m787[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:    private String [0m[1;35mreadUnicodeString[0m[1;39m([0m[39mRLEDecompressingInputStream in, int [0m       [2m                [0m
[2;36m                    [0m         [39municodeNameRecordLength[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buffer = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeNameRecordLength, [0m        [2m                [0m
[2;36m                    [0m         [39mMAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:        int bytesRead = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39min, buffer[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:        if [0m[1;39m([0m[39mbytesRead != unicodeNameRecordLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:            throw new [0m[1;35mEOFException[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mbuffer, StringUtil.UTF16LE[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:167[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m77[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:37[0m[39m-[0m[1;36m39[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 20_000_000;[0m              [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: * A pure-MAPI attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class MAPIAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:   private final MAPIProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:167[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m77[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:186[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m02[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now read in the [0m[1;35mvalue[0m[1;39m([0m[39ms[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            int values = [0m[1;36m1[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39misMV || isVL[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:               values = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            if [0m[1;39m([0m[39mtype == Types.NULL && values > [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:               throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Placeholder/NULL arrays aren't [0m           [2m                [0m
[2;36m                    [0m         [32msupported."[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:               [0m[35m/[0m[35m/[0m[39m Create[0m                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Analysis Summary[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAfter analyzing the code snippets and evaluation report, I've identified the root [0m  [2m                [0m
[2;36m                    [0m         [39mcause of the OutOfMemoryError vulnerability:[0m                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Root Cause[0m                                                                      [2m                [0m
[2;36m                    [0m         [39mThe vulnerability exists in `MAPIAttribute.java` at line [0m[1;36m171[0m[39m, where custom MAPI [0m    [2m                [0m
[2;36m                    [0m         [39mproperty names are allocated without bounds checking:[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mint mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;  [0m[35m/[0m[35m/[0m[39m Read from untrusted input[0m                [2m                [0m
[2;36m                    [0m         [39mif [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + mplen[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;39m}[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;  [0m[35m/[0m[35m/[0m[39m ❌ VULNERABLE: No size limit validation[0m        [2m                [0m
[2;36m                    [0m         [1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [39mname = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;  [0m[35m/[0m[35m/[0m[39m Can cause OOM[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Attack Vector[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. A malicious TNEF message specifies a large `mplen` value for a custom property [0m  [2m                [0m
[2;36m                    [0m         [39mname[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Line [0m[1;36m171[0m[39m allocates the byte array without validation [0m[1;39m([0m[39mcan succeed if within JVM [0m [2m                [0m
[2;36m                    [0m         [39mheap[0m[1;39m)[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Line [0m[1;36m175[0m[39m calls `[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m` which multiplies the length by [0m[1;36m2[0m[39m [0m [2m                [0m
[2;36m                    [0m         [39minternally[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. The String constructor at `StringUtil.jav[0m[1;92ma:94[0m[39m` fails with OutOfMemoryError[0m       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why Current Protections Are Insufficient[0m                                        [2m                [0m
[2;36m                    [0m         [39m- **TNEFAttribute level**: Has 20MB limit, but this allows malicious data through[0m   [2m                [0m
[2;36m                    [0m         [39m- **MAPIAttribute values**: Has 1MB limit with `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mline [0m    [2m                [0m
[2;36m                    [0m         [1;36m198[0m[1;39m)[0m[39m - properly protected[0m                                                           [2m                [0m
[2;36m                    [0m         [39m- **MAPIAttribute names**: NO LIMIT - this is the vulnerability[0m                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe inconsistency is clear: line [0m[1;36m198[0m[39m uses `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, [0m             [2m                [0m
[2;36m                    [0m         [39mMAX_RECORD_LENGTH[0m[1;39m)[0m[39m` for attribute values, but line [0m[1;36m171[0m[39m uses direct allocation `new [0m [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m` for attribute names.[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Primary Fix: Add String-Specific Size Limits to MAPIAttribute[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mFollowing the established patterns in `Ole10Native` and `VBAMacroReader`, implement[0m [2m                [0m
[2;36m                    [0m         [39ma separate `MAX_STRING_LENGTH` constant for MAPI attribute names:[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m1[0m[39m: Add MAX_STRING_LENGTH constant**[0m                                          [2m                [0m
[2;36m                    [0m         [39m- Location: [0m                                                                        [2m                [0m
[2;36m                    [0m         [39m`poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java` [0m    [2m                [0m
[2;36m                    [0m         [39mafter line [0m[1;36m46[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m- Add:[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m  ```java[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m  [0m[35m/[0m[35m/[0m[39m arbitrarily selected; may need to increase[0m                                     [2m                [0m
[2;36m                    [0m         [39m  private static final int DEFAULT_MAX_STRING_LENGTH = 100_000;  [0m[35m/[0m[35m/[0m[39m 100KB[0m           [2m                [0m
[2;36m                    [0m         [39m  private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m                 [2m                [0m
[2;36m                    [0m         [39m  ```[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m- Rationale: 100KB is generous for MAPI property names [0m[1;39m([0m[39mwhich are identifiers[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mwhile preventing the attack. This is larger than Ole10Native's 1KB but smaller than[0m [2m                [0m
[2;36m                    [0m         [39mthe 1MB used for attribute values, reflecting that property names should be much [0m   [2m                [0m
[2;36m                    [0m         [39mshorter than property values.[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m2[0m[39m: Add getter/setter methods for configurability**[0m                           [2m                [0m
[2;36m                    [0m         [39m- Location: After the existing `[0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m` method [0m[1;39m([0m[39maround line [0m[1;36m64[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m- Add:[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m  ```java[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m  [0m[35m/[0m[39m**[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m   * @param length the max string length allowed for MAPI attribute names[0m           [2m                [0m
[2;36m                    [0m         [39m   *[0m[35m/[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m  public static void [0m[1;35msetMaxStringLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [39m      MAX_STRING_LENGTH = length;[0m                                                   [2m                [0m
[2;36m                    [0m         [39m  [0m[1;39m}[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m  [0m[35m/[0m[39m**[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m   * @return the max string length allowed for MAPI attribute names[0m                 [2m                [0m
[2;36m                    [0m         [39m   *[0m[35m/[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m  public static int [0m[1;35mgetMaxStringLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [39m      return MAX_STRING_LENGTH;[0m                                                     [2m                [0m
[2;36m                    [0m         [39m  [0m[1;39m}[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m  ```[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m- Rationale: This follows the pattern in Ole10Native and maintains API consistency [0m [2m                [0m
[2;36m                    [0m         [39mwith other POI components.[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m3[0m[39m: Replace vulnerable allocation at line [0m[1;36m171[0m[39m**[0m                               [2m                [0m
[2;36m                    [0m         [39m- Location: `MAPIAttribute.java` line [0m[1;36m171[0m                                           [2m                [0m
[2;36m                    [0m         [39m- Replace: `byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;`[0m                                       [2m                [0m
[2;36m                    [0m         [39m- With: `byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mmplen, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;`[0m         [2m                [0m
[2;36m                    [0m         [39m- Rationale: This applies the same protection pattern already used at line [0m[1;36m198[0m[39m for [0m [2m                [0m
[2;36m                    [0m         [39mattribute values. `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` will:[0m                                  [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m1[0m[39m. Validate `mplen` is not negative[0m                                               [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m2[0m[39m. Validate `mplen` doesn't exceed Integer.MAX_VALUE[0m                              [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m3[0m[39m. Validate `mplen` doesn't exceed MAX_STRING_LENGTH [0m[1;39m([0m[39m100KB[0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m         [39m  [0m[1;36m4[0m[39m. Throw `RecordFormatException` with a descriptive message if validation fails[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Secondary Enhancement: Add Early Validation in [0m[1;35mgetLength[0m[1;39m([0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mFor defense-in-depth and to provide better error messages, add pre-validation in [0m   [2m                [0m
[2;36m                    [0m         [39mthe `[0m[1;35mgetLength[0m[1;39m([0m[1;39m)[0m[39m` method:[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m4[0m[39m: Add validation in [0m[1;35mgetLength[0m[1;39m([0m[1;39m)[0m[39m method**[0m                                    [2m                [0m
[2;36m                    [0m         [39m- Location: `MAPIAttribute.java` lines [0m[1;36m222[0m[39m-[0m[1;36m234[0m[39m, after line [0m[1;36m231[0m                      [2m                [0m
[2;36m                    [0m         [39m- Modify the method to validate before returning:[0m                                   [2m                [0m
[2;36m                    [0m         [39m  ```java[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m  private static int [0m[1;35mgetLength[0m[1;39m([0m[39mMAPIType type, InputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [39m      if [0m[1;39m([0m[1;35mtype.isFixedLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [39m          return [0m[1;35mtype.getLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m      if [0m[1;39m([0m[39mtype == Types.ASCII_STRING || type == Types.UNICODE_STRING ||[0m             [2m                [0m
[2;36m                    [0m         [39m          type == Types.DIRECTORY || type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [39m          int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [39m          [0m[35m/[0m[35m/[0m[39m Pre-validate to fail fast with better error message[0m                    [2m                [0m
[2;36m                    [0m         [39m          [0m[1;35mIOUtils.safelyAllocateCheck[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [39m          return length;[0m                                                            [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m          throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m  [0m[1;39m}[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m  ```[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m- Rationale: This causes early failure with clear error messages when reading [0m      [2m                [0m
[2;36m                    [0m         [39mmalformed length fields, preventing issues downstream at line [0m[1;36m198[0m[39m.[0m                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Justification[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why This Is Optimal[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Follows Established Patterns**: The fix mirrors the approach used in [0m          [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mOle10Native.readUtf16[0m[1;39m([0m[1;39m)[0m[39m` and `[0m[1;35mVBAMacroReader.readString[0m[1;39m([0m[1;39m)[0m[39m`, ensuring consistency [0m  [2m                [0m
[2;36m                    [0m         [39macross the codebase.[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Minimal Changes**: Only adds constants and changes one line [0m[1;39m([0m[1;36m171[0m[1;39m)[0m[39m, minimizing [0m [2m                [0m
[2;36m                    [0m         [39mrisk of introducing new bugs.[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Defense-in-Depth**: Combines multiple validation layers:[0m                       [2m                [0m
[2;36m                    [0m         [39m   - Size validation before allocation [0m[1;39m([0m[39mStep [0m[1;36m3[0m[1;39m)[0m                                     [2m                [0m
[2;36m                    [0m         [39m   - Early validation in [0m[1;35mgetLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m([0m[39mStep [0m[1;36m4[0m[1;39m)[0m                                       [2m                [0m
[2;36m                    [0m         [39m   - Existing TNEFAttribute 20MB limit[0m                                              [2m                [0m
[2;36m                    [0m         [39m   - Existing MAPIAttribute 1MB limit for values[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Appropriate Limits**: 100KB for property names is:[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Much larger than typical MAPI property names need[0m                              [2m                [0m
[2;36m                    [0m         [39m   - Small enough to prevent memory exhaustion attacks[0m                              [2m                [0m
[2;36m                    [0m         [39m   - Aligned with the semantic difference between property names [0m[1;39m([0m[39midentifiers[0m[1;39m)[0m[39m and [0m [2m                [0m
[2;36m                    [0m         [39mvalues [0m[1;39m([0m[39mdata[0m[1;39m)[0m                                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **Configurable**: The getter/setter methods allow applications to adjust limits [0m [2m                [0m
[2;36m                    [0m         [39mif needed, following POI's existing patterns.[0m                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Preserves Existing Logic[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- **No functional changes**: The fix only adds bounds checking; all legitimate use [0m [2m                [0m
[2;36m                    [0m         [39mcases continue to work[0m                                                              [2m                [0m
[2;36m                    [0m         [39m- **No changes to parsing logic**: The TNEF/MAPI parsing flow remains unchanged[0m     [2m                [0m
[2;36m                    [0m         [39m- **No changes to string handling**: StringUtil methods remain unchanged[0m            [2m                [0m
[2;36m                    [0m         [39m- **Maintains API compatibility**: Only adds new methods, doesn't modify existing [0m  [2m                [0m
[2;36m                    [0m         [39msignatures[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m- **Test compatibility**: Existing tests will pass; only maliciously large inputs [0m  [2m                [0m
[2;36m                    [0m         [39mare rejected[0m                                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Addresses the Issue[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Prevents OOM at line [0m[1;36m171[0m[39m**: `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` rejects excessive [0m      [2m                [0m
[2;36m                    [0m         [39mallocations before they occur[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Prevents OOM at line [0m[1;36m175[0m[39m**: Since the byte array is limited to 100KB, the [0m     [2m                [0m
[2;36m                    [0m         [39msubsequent String creation cannot exhaust memory[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Provides clear error messages**: `RecordFormatException` indicates the limit [0m  [2m                [0m
[2;36m                    [0m         [39mwas exceeded, aiding debugging[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Eliminates DoS vector**: Attackers can no longer craft TNEF messages that [0m     [2m                [0m
[2;36m                    [0m         [39mcause memory exhaustion[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Potential Side Effects and Mitigation[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Potential Issue**: Legitimate files with unusually long custom property names [0m    [2m                [0m
[2;36m                    [0m         [39mmight be rejected.[0m                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Mitigation**: [0m                                                                    [2m                [0m
[2;36m                    [0m         [39m- The 100KB limit is extremely generous for property names[0m                          [2m                [0m
[2;36m                    [0m         [39m- The limit is configurable via `[0m[1;35msetMaxStringLength[0m[1;39m([0m[1;39m)[0m[39m`[0m                              [2m                [0m
[2;36m                    [0m         [39m- If needed, applications can increase the limit[0m                                    [2m                [0m
[2;36m                    [0m         [39m- Real-world MAPI property names are typically under 1KB[0m                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Potential Issue**: Files that previously loaded [0m[1;39m([0m[39mthough slowly or with OOM [0m       [2m                [0m
[2;36m                    [0m         [39merrors[0m[1;39m)[0m[39m will now fail with RecordFormatException.[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Mitigation**:[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m- This is the desired behavior - these are malformed or malicious files[0m             [2m                [0m
[2;36m                    [0m         [39m- Clear error messages help users understand the issue[0m                              [2m                [0m
[2;36m                    [0m         [39m- The exception can be caught and handled by applications if needed[0m                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Reference to Similar Solutions[0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Ole10Native [0m[1;39m([0m[39mlines [0m[1;36m285[0m[39m-[0m[1;36m295[0m[1;39m)[0m[39m**: Uses `[0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size * [0m[1;36m2[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mMAX_STRING_LENGTH[0m[1;39m)[0m[39m` with MAX_STRING_LENGTH = 1KB for string fields[0m                  [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **VBAMacroReader [0m[1;39m([0m[39mlines [0m[1;36m716[0m[39m-[0m[1;36m722[0m[39m, [0m[1;36m781[0m[39m-[0m[1;36m787[0m[1;39m)[0m[39m**: Uses [0m                               [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_STRING_LENGTH[0m[1;39m)[0m[39m` with MAX_STRING_LENGTH = 20KB[0m   [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **MAPIAttribute line [0m[1;36m198[0m[39m**: Already uses `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, [0m           [2m                [0m
[2;36m                    [0m         [39mMAX_RECORD_LENGTH[0m[1;39m)[0m[39m` for attribute values[0m                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix applies this same proven pattern to attribute names, which was the one [0m     [2m                [0m
[2;36m                    [0m         [39mlocation missing this protection.[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=80392;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=55023;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=736339;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=698679;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp44lgnnfb[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/apache-poi_poi-full-01_vuln_1[0m [2m               [0m
[2;36m                    [0m         [35m/[0m[95magent-output-1768003439.7670023[0m                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file:                                                               [2m               [0m
[2;36m                    [0m         scripts/benchmark/afc-delta-full/apache-poi_poi-full-01_vuln_1.toml                  [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-poi[0m              [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/10/26 00:04:02][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/user/crete/.cache/environments/[0m[95mapache-poi[0m     ]8;id=924962;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=152106;file:///home/user/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=152562;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=784905;file:///home/user/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mapache-poi[0m            [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=500430;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=472862;file:///home/user/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mapache-poi[0m             [2m               [0m
