{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-full-01_vuln_6",
  "source_directory": "/home/qqor/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 1.10952,
    "prompt_tokens": 307550,
    "completion_tokens": 12458
  },
  "variant": "sound",
  "diff": "--- a/fontbox/src/main/java/org/apache/fontbox/pfb/PfbParser.java\n+++ b/fontbox/src/main/java/org/apache/fontbox/pfb/PfbParser.java\n@@ -153,17 +153,28 @@\n                 throw new IOException(\"Incorrect record type: \" + recordType);\n             }\n \n-            int size = in.read();\n-            size += in.read() << 8;\n-            size += in.read() << 16;\n-            size += in.read() << 24;\n+            long byte1 = in.read();\n+            long byte2 = in.read();\n+            long byte3 = in.read();\n+            long byte4 = in.read();\n+            \n+            if (byte4 < 0) {\n+                throw new EOFException(\"EOF while reading PFB segment size\");\n+            }\n+            \n+            long size = byte1 + (byte2 << 8) + (byte3 << 16) + (byte4 << 24);\n             LOG.debug(\"record type: {}, segment size: {}\", recordType, size);\n-            long newTotal = total + size;\n+            \n+            if (size < 0 || size > MAX_LENGTH) {\n+                throw new IOException(\"Invalid PFB segment size: \" + size);\n+            }\n+            \n+            long newTotal = (long)total + size;\n             if (newTotal > MAX_LENGTH) {\n-                throw new IOException(\"record size would be too large: \" + newTotal);\n-            }\n-\n-            byte[] ar = new byte[size];\n+                throw new IOException(\"Cumulative PFB size too large: \" + newTotal);\n+            }\n+\n+            byte[] ar = new byte[(int)size];\n             int got = in.read(ar);\n             if (got != size)\n             {\n",
  "stdout": "",
  "stderr": ""
}