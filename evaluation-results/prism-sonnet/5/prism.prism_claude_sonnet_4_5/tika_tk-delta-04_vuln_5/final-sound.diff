--- a/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitter/fs/FileSystemEmitter.java
+++ b/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitter/fs/FileSystemEmitter.java
@@ -146,6 +146,22 @@
     public void emit(String path, InputStream inputStream, Metadata userMetadata, ParseContext parseContext) throws IOException, TikaEmitterException {
         Path target = basePath.resolve(path);
 
+        try {
+            if (!target.toRealPath().startsWith(basePath.toRealPath())) {
+                throw new TikaEmitterException(
+                    "Path traversal detected: resolved path must be a descendant of the base path. " +
+                    "Attempted path: " + path);
+            }
+        } catch (IOException e) {
+            Path normalizedTarget = target.toAbsolutePath().normalize();
+            Path normalizedBase = basePath.toAbsolutePath().normalize();
+            if (!normalizedTarget.startsWith(normalizedBase)) {
+                throw new TikaEmitterException(
+                    "Path traversal detected: resolved path must be a descendant of the base path. " +
+                    "Attempted path: " + path);
+            }
+        }
+
         if (!Files.isDirectory(target.getParent())) {
             Files.createDirectories(target.getParent());
         }

--- a/tika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHandler.java
+++ b/tika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHandler.java
@@ -19,6 +19,8 @@
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
+import java.nio.file.Path;
+import java.nio.file.Paths;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.Locale;
@@ -92,26 +94,32 @@
 
     private String addSubDirs(String embeddedPath) {
         StringBuilder sb = new StringBuilder();
-        //for safety
-        File cwd = new File(".");
-        File f = new File(cwd, embeddedPath);
-        String relPath = cwd.toPath().relativize(f.toPath()).toString();
-        if (relPath.startsWith("/")) {
-            relPath = relPath.substring(1);
-        }
-        relPath = relPath.replaceAll("\\.\\./", "/");
-        relPath = relPath.replaceAll("/+", "/");
-
-        String[] parts = relPath.split("[/\\\\]");
-        for (int i = 0; i < parts.length - 1; i++) {
-            //confirm there's a file name
-            if (containsAlphaNumeric(parts[i])) {
-                sb.append(parts[i] + "/attach/");
+        
+        Path normalizedPath = Paths.get(embeddedPath).normalize();
+        
+        int nameCount = normalizedPath.getNameCount();
+        for (int i = 0; i < nameCount - 1; i++) {
+            String part = normalizedPath.getName(i).toString();
+            if (part.equals(".") || part.equals("..")) {
+                continue;
+            }
+            if (containsAlphaNumeric(part)) {
+                sb.append(part).append("/attach/");
             } else {
-                sb.append(parts[i] + "/");
+                sb.append(part).append("/");
             }
         }
-        sb.append(parts[parts.length - 1]);
+        
+        if (nameCount > 0) {
+            String fileName = normalizedPath.getName(nameCount - 1).toString();
+            fileName = FilenameUtils.getName(fileName);
+            if (!fileName.isEmpty() && !fileName.equals(".") && !fileName.equals("..")) {
+                sb.append(fileName);
+            } else {
+                sb.append("extracted-").append(System.currentTimeMillis());
+            }
+        }
+        
         return sb.toString();
     }
 
