{
  "project_name": "pdfbox",
  "vulnerability_identifier": "pdfbox_pdfbox-delta-01_vuln_2",
  "source_directory": "/home/qqor/crete/.cache/official-afc-pdfbox",
  "llm_usage": {
    "total_cost": 1.4407590000000001,
    "prompt_tokens": 388428,
    "completion_tokens": 18365
  },
  "variant": "sound",
  "diff": "--- a/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n+++ b/pdfbox/src/main/java/org/apache/pdfbox/ocr/OCRStreamEngine.java\n@@ -33,7 +33,6 @@\n  */\n public class OCRStreamEngine {\n \n-    private static final String TESSERACT_PATH_KEY = \"tesseract-path\";\n     private PDFRenderer pdfRenderer = null;\n     private String tesseractPath = \"tesseract\";\n     private int pageIndex = 0;\n@@ -155,11 +154,7 @@\n     }\n \n     private String runTesseract(Path image) throws IOException {\n-        String actualTessPath = pdDocument.getDocumentInformation()\n-                .getCustomMetadataValue(TESSERACT_PATH_KEY);\n-        if (actualTessPath == null || actualTessPath.isEmpty()) {\n-            actualTessPath = tesseractPath;\n-        }\n+        String actualTessPath = tesseractPath;\n \n         Path txt = Paths.get(image.toAbsolutePath().toString());\n         doOCR(actualTessPath, image, txt);\n\n--- a/pdfbox/src/test/java/org/apache/pdfbox/ocr/TestOCR.java\n+++ b/pdfbox/src/test/java/org/apache/pdfbox/ocr/TestOCR.java\n@@ -50,17 +50,19 @@\n     }\n \n     @Test\n-    public void testOverride() throws Exception\n+    public void testMetadataIsIgnored() throws Exception\n     {\n-        if (!Files.isExecutable(Paths.get(\"/usr/my-bin/tesseract\")))\n+        if (TESSERACT_PATH == null)\n         {\n             return;\n         }\n-        Path p = Paths.get(TestOCR.class.getResource(\"testOCRCustomPath.pdf\").toURI());\n+        Path p = Paths.get(TestOCR.class.getResource(\"testOCR.pdf\").toURI());\n         PDDocument pdDocument = Loader.loadPDF(p.toFile());\n+        pdDocument.getDocumentInformation().setCustomMetadataValue(\"tesseract-path\", \"/malicious/path\");\n         OCRStreamEngine ocrStreamEngine = new OCRStreamEngine(pdDocument);\n-        ocrStreamEngine.setTesseractPath(\"some-other-path\");\n+        ocrStreamEngine.setTesseractPath(TESSERACT_PATH);\n         String txt = ocrStreamEngine.getText(1, 1);\n         assertTrue(txt.contains(\"Happy New Year\"));\n+        pdDocument.close();\n     }\n }\n",
  "stdout": "",
  "stderr": ""
}