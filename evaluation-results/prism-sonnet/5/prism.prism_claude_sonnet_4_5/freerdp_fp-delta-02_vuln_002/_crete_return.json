{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-delta-02_vuln_002",
  "source_directory": "/home/user/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 1.35462,
    "prompt_tokens": 380360,
    "completion_tokens": 14236
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/crypto/x509_utils.c\n+++ b/libfreerdp/crypto/x509_utils.c\n@@ -448,21 +448,24 @@\n         GENERAL_NAME *gen_name = sk_GENERAL_NAME_value(san_names, i);\n \n         if (gen_name->type == GEN_DNS) {\n-\t\t\t// Allocate string length + 1 for security\n-\t\t\tdns_name = malloc( strlen((char *)ASN1_STRING_get0_data(gen_name->d.dNSName)) + 1);\n-\n-\t\t\tif (dns_name == NULL)\n+\t\t\tunsigned char* utf8_string = NULL;\n+\t\t\tint length = ASN1_STRING_to_UTF8(&utf8_string, gen_name->d.dNSName);\n+\t\t\t\n+\t\t\tif (length < 0) {\n+\t\t\t\tWLog_ERR(TAG, \"ASN1_STRING_to_UTF8() failed for DNS name: %s\",\n+\t\t\t\t         ERR_error_string(ERR_get_error(), NULL));\n+\t\t\t\tresult = FALSE;\n \t\t\t\tgoto end;\n+\t\t\t}\n \t\t\t\n-\t\t\tmemcpy(dns_name, (char *)ASN1_STRING_get0_data(gen_name->d.dNSName),  \n-\t\t\t\tASN1_STRING_length(gen_name->d.dNSName)) ;\n+\t\t\tdns_name = (char*)utf8_string;\n \t\t\t\n             if (!verify_san(dns_name)) {\n-\t\t\t\tfree(dns_name);\n+\t\t\t\tOPENSSL_free(dns_name);\n \t\t\t\tresult = FALSE;\n \t\t\t\tgoto end;\n             } else {\n-\t\t\t\tfree(dns_name);\n+\t\t\t\tOPENSSL_free(dns_name);\n             }\n         }\n     }\n@@ -470,7 +473,7 @@\n end:\n     sk_GENERAL_NAME_pop_free(san_names, GENERAL_NAME_free);\n \n-\treturn TRUE;\n+\treturn result;\n }\n \n char* x509_utils_get_email(const X509* x509)\n",
  "stdout": "",
  "stderr": ""
}