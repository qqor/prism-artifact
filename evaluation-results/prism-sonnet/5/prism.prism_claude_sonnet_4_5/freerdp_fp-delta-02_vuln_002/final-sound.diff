--- a/libfreerdp/crypto/x509_utils.c
+++ b/libfreerdp/crypto/x509_utils.c
@@ -448,21 +448,24 @@
         GENERAL_NAME *gen_name = sk_GENERAL_NAME_value(san_names, i);
 
         if (gen_name->type == GEN_DNS) {
-			// Allocate string length + 1 for security
-			dns_name = malloc( strlen((char *)ASN1_STRING_get0_data(gen_name->d.dNSName)) + 1);
-
-			if (dns_name == NULL)
+			unsigned char* utf8_string = NULL;
+			int length = ASN1_STRING_to_UTF8(&utf8_string, gen_name->d.dNSName);
+			
+			if (length < 0) {
+				WLog_ERR(TAG, "ASN1_STRING_to_UTF8() failed for DNS name: %s",
+				         ERR_error_string(ERR_get_error(), NULL));
+				result = FALSE;
 				goto end;
+			}
 			
-			memcpy(dns_name, (char *)ASN1_STRING_get0_data(gen_name->d.dNSName),  
-				ASN1_STRING_length(gen_name->d.dNSName)) ;
+			dns_name = (char*)utf8_string;
 			
             if (!verify_san(dns_name)) {
-				free(dns_name);
+				OPENSSL_free(dns_name);
 				result = FALSE;
 				goto end;
             } else {
-				free(dns_name);
+				OPENSSL_free(dns_name);
             }
         }
     }
@@ -470,7 +473,7 @@
 end:
     sk_GENERAL_NAME_pop_free(san_names, GENERAL_NAME_free);
 
-	return TRUE;
+	return result;
 }
 
 char* x509_utils_get_email(const X509* x509)
