--- a/libfreerdp/crypto/certificate.c
+++ b/libfreerdp/crypto/certificate.c
@@ -1529,21 +1529,20 @@
 static BOOL freerdp_bio_read_pem_with_policy(BIO* bio, char** ppem, size_t* plength)
 {
 	BOOL rc = FALSE;
-	int status = -1;
 
 	WINPR_ASSERT(bio);
 	WINPR_ASSERT(ppem);
 
-	const uint16_t blocksize = 2048;
-	uint16_t offset = 0;
-	uint16_t length = blocksize;
+	const size_t blocksize = 2048;
+	size_t offset = 0;
+	size_t length = blocksize;
 	char* pem = NULL;
 
 	*ppem = NULL;
 	if (plength)
 		*plength = 0;
 
-	while (status != 0)
+	while (offset < length)
 	{
 		char* tmp = realloc(pem, length + 1);
 		if (!tmp)
@@ -1553,7 +1552,7 @@
 
 		ERR_clear_error();
 
-		status = BIO_read(bio, &pem[offset], (int)(length - offset));
+		const int status = BIO_read(bio, &pem[offset], (int)(length - offset));
 		if (status < 0)
 		{
 			WLog_ERR(TAG, "failed to read certificate");
@@ -1564,8 +1563,9 @@
 			break;
 
 		offset += (size_t)status;
+		if (length - offset > 0)
+			break;
 		length += blocksize;
-
 	}
 	pem[offset] = '\0';
 	*ppem = pem;
