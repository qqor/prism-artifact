--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java
@@ -18,6 +18,7 @@
 
 import java.util.ArrayDeque;
 import java.util.Collections;
+import java.util.IdentityHashMap;
 import java.util.Iterator;
 import java.util.Queue;
 import org.apache.pdfbox.cos.COSArray;
@@ -180,9 +181,15 @@
     private final class PageIterator implements Iterator<PDPage>
     {
         private final Queue<COSDictionary> queue = new ArrayDeque<>();
+        
+        // PDFBOX-5044: to prevent circular references causing infinite loops
+        // must be COSDictionary and not PDPage, because PDPage is newly created each time
+        private final Set<COSDictionary> visitedNodes = 
+            Collections.newSetFromMap(new IdentityHashMap<>());
 
         private PageIterator(COSDictionary node)
         {
+            visitedNodes.add(node);
             List<COSDictionary> kids = enqueueKids(node);
             while (!kids.isEmpty())
             {
@@ -190,7 +197,15 @@
 
                 for (COSDictionary kid : kids)
                 {
-                    newKids.addAll(enqueueKids(kid));
+                    if (visitedNodes.contains(kid))
+                    {
+                        LOG.warn("Circular reference detected in page tree, skipping already visited node");
+                    }
+                    else
+                    {
+                        visitedNodes.add(kid);
+                        newKids.addAll(enqueueKids(kid));
+                    }
                 }
                 kids = newKids;
             }
