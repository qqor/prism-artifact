{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_6",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 3.7543649999999995,
    "prompt_tokens": 1107775,
    "completion_tokens": 28736
  },
  "variant": "sound",
  "diff": "--- a/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n+++ b/tika-app/src/main/java/org/apache/tika/cli/TikaUntar.java\n@@ -40,11 +40,34 @@\n \n             while (tae != null) {\n                 if (tae.isFile()) {\n-                    Path target = extractDir.resolve(tae.getName()).normalize();\n-                    if (!Files.isDirectory(target.getParent())) {\n-                        Files.createDirectories(target.getParent());\n+                    try {\n+                        Path target = extractDir.resolve(tae.getName()).normalize();\n+                        \n+                        // Validation 1: Check for null bytes\n+                        if (tae.getName().contains(\"\\u0000\")) {\n+                            throw new IOException(\"Invalid entry name contains null byte: \" + tae.getName());\n+                        }\n+                        \n+                        // Validation 2: Check for absolute paths\n+                        Path entryPath = Paths.get(tae.getName());\n+                        if (entryPath.isAbsolute()) {\n+                            throw new IOException(\"Cannot extract entry with absolute path: \" + tae.getName());\n+                        }\n+                        \n+                        // Validation 3: Validate descendant relationship\n+                        Path normalizedExtractDir = extractDir.normalize().toAbsolutePath();\n+                        Path normalizedTarget = target.toAbsolutePath();\n+                        if (!normalizedTarget.startsWith(normalizedExtractDir)) {\n+                            throw new IOException(\"Entry is outside of the extraction directory: \" + tae.getName());\n+                        }\n+                        \n+                        if (!Files.isDirectory(target.getParent())) {\n+                            Files.createDirectories(target.getParent());\n+                        }\n+                        Files.write(target, tais.readAllBytes());\n+                    } catch (IOException e) {\n+                        System.err.println(\"Skipping entry '\" + tae.getName() + \"': \" + e.getMessage());\n                     }\n-                    Files.write(target, tais.readAllBytes());\n                 }\n                 tae = tais.getNextEntry();\n             }\n",
  "stdout": "",
  "stderr": ""
}