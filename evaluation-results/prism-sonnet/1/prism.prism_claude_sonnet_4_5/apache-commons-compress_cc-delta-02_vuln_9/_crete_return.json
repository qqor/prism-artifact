{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-02_vuln_9",
  "source_directory": "/home/user/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 2.179128,
    "prompt_tokens": 656471,
    "completion_tokens": 13981
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java\n@@ -36,6 +36,7 @@\n     private static final int MAGIC_2 = 0x9d;\n     private static final int BLOCK_MODE_MASK = 0x80;\n     private static final int MAX_CODE_SIZE_MASK = 0x1f;\n+    private static final int MAX_CODE_SIZE = 16;\n \n     /**\n      * Checks if the signature matches what is expected for a Unix compress file.\n@@ -80,6 +81,12 @@\n         }\n         blockMode = (thirdByte & BLOCK_MODE_MASK) != 0;\n         maxCodeSize = thirdByte & MAX_CODE_SIZE_MASK;\n+        if (maxCodeSize < 9 || maxCodeSize > MAX_CODE_SIZE) {\n+            throw new IOException(String.format(\n+                \"Invalid maxCodeSize %d in .Z header. Value must be between 9 and %d\",\n+                maxCodeSize, MAX_CODE_SIZE\n+            ));\n+        }\n         if (blockMode) {\n             setClearCode(DEFAULT_CODE_SIZE);\n         }\n\n--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n@@ -178,9 +178,13 @@\n     protected void initializeTables(final int maxCodeSize) {\n         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException\n         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException\n+        if (maxCodeSize < 8 || maxCodeSize > 31) {\n+            throw new IllegalArgumentException(\n+                \"maxCodeSize \" + maxCodeSize + \" is out of bounds (must be between 8 and 31)\"\n+            );\n+        }\n         if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n-            // TODO test against prefixes.length and characters.length?\n-            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" is out of bounds.\");\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" is invalid for current state.\");\n         }\n         final int maxTableSize = 1 << maxCodeSize;\n         prefixes = new int[maxTableSize];\n@@ -203,8 +207,10 @@\n      * @throws IllegalArgumentException if {@code maxCodeSize} is not bigger than 0\n      */\n     protected void initializeTables(final int maxCodeSize, final int memoryLimiKiB) throws MemoryLimitException {\n-        if (maxCodeSize <= 0) {\n-            throw new IllegalArgumentException(\"maxCodeSize is \" + maxCodeSize + \", must be bigger than 0\");\n+        if (maxCodeSize <= 0 || maxCodeSize > 31) {\n+            throw new IllegalArgumentException(\n+                \"maxCodeSize is \" + maxCodeSize + \", must be between 1 and 31\"\n+            );\n         }\n \n         if (memoryLimiKiB > -1) {\n",
  "stdout": "",
  "stderr": ""
}