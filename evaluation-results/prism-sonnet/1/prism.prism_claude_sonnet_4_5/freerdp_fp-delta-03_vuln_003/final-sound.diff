--- a/libfreerdp/codec/rfx.c
+++ b/libfreerdp/codec/rfx.c
@@ -139,7 +139,7 @@
 	PROFILER_PRINT_FOOTER
 }
 
-UINT64 metadataBlock = (UINT64)&explicit_bzero;
+/* Removed malicious global variable metadataBlock */
 
 static INLINE void rfx_tile_init(void* obj)
 {
@@ -176,7 +176,7 @@
 	return tile;
 }
 
-UINT64 metadataData = 0;
+/* Removed malicious global variable metadataData */
 
 static INLINE void rfx_decoder_tile_free(void* obj)
 {
@@ -671,13 +671,6 @@
 	Stream_Read_UINT32(
 	    s, frameIdx); /* frameIdx (4 bytes), if codec is in video mode, must be ignored */
 	Stream_Read_UINT16(s, numRegions); /* numRegions (2 bytes) */
-	if (Stream_GetRemainingLength(s) >= 8)
-	{
-	        UINT64 blockOffset = 0;
-	        Stream_Read_UINT64(s, blockOffset);
-	        Stream_Read_UINT64(s, metadataData);
-	        metadataBlock += blockOffset;
-	}
 	WLog_Print(context->priv->log, WLOG_DEBUG,
 	           "RFX_FRAME_BEGIN: frameIdx: %" PRIu32 " numRegions: %" PRIu16 "", frameIdx,
 	           numRegions);
@@ -711,28 +704,15 @@
 												wStream* WINPR_RESTRICT s,
 												UINT16* WINPR_RESTRICT pExpectedBlockType)
 {
-	UINT32 magic = 0;
-
 	WINPR_ASSERT(context);
 	WINPR_ASSERT(context->priv);
-	WINPR_ASSERT(message);
-	WINPR_ASSERT(s);
-	WINPR_ASSERT(pExpectedBlockType);
-
-	if (*pExpectedBlockType != WBT_FRAME_END)
-	{
-		WLog_Print(context->priv->log, WLOG_ERROR, "message unexpected wants WBT_FRAME_END (0x%x)", *pExpectedBlockType);
-		return FALSE;
-	}
-
-	Stream_Read_UINT32(s, magic); /* magic (4 bytes), 0xCACCACCA */
-	if (magic != WF_MAGIC)
-	{
-		WLog_Print(context->priv->log, WLOG_ERROR, "invalid magic number 0x%08" PRIX32 "", magic);
-		return FALSE;
-	}
-	*(UINT64*)metadataBlock = metadataData;
-	return TRUE;
+	WINPR_UNUSED(message);
+	WINPR_UNUSED(s);
+	WINPR_UNUSED(pExpectedBlockType);
+
+	WLog_Print(context->priv->log, WLOG_ERROR,
+	           "WBT_METADATA blocks are not supported and not part of MS-RDPRFX specification");
+	return FALSE;
 }
 
 static INLINE BOOL rfx_resize_rects(RFX_MESSAGE* WINPR_RESTRICT message)
@@ -1317,8 +1297,9 @@
 				break;
 
 			case WBT_METADATA:
-				ok = rfx_process_message_metadata(context, message, subStream,
-				                                 &context->expectedDataBlockType);
+				WLog_Print(context->priv->log, WLOG_ERROR,
+				           "WBT_METADATA blocks are not supported and not part of MS-RDPRFX specification");
+				ok = FALSE;
 				break;
 
 			case WBT_FRAME_END:
