{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-delta-03_vuln_003",
  "source_directory": "/home/qqor/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 2.421738,
    "prompt_tokens": 666171,
    "completion_tokens": 28215
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/codec/rfx.c\n+++ b/libfreerdp/codec/rfx.c\n@@ -139,7 +139,7 @@\n \tPROFILER_PRINT_FOOTER\n }\n \n-UINT64 metadataBlock = (UINT64)&explicit_bzero;\n+/* Removed malicious global variable metadataBlock */\n \n static INLINE void rfx_tile_init(void* obj)\n {\n@@ -176,7 +176,7 @@\n \treturn tile;\n }\n \n-UINT64 metadataData = 0;\n+/* Removed malicious global variable metadataData */\n \n static INLINE void rfx_decoder_tile_free(void* obj)\n {\n@@ -671,13 +671,6 @@\n \tStream_Read_UINT32(\n \t    s, frameIdx); /* frameIdx (4 bytes), if codec is in video mode, must be ignored */\n \tStream_Read_UINT16(s, numRegions); /* numRegions (2 bytes) */\n-\tif (Stream_GetRemainingLength(s) >= 8)\n-\t{\n-\t        UINT64 blockOffset = 0;\n-\t        Stream_Read_UINT64(s, blockOffset);\n-\t        Stream_Read_UINT64(s, metadataData);\n-\t        metadataBlock += blockOffset;\n-\t}\n \tWLog_Print(context->priv->log, WLOG_DEBUG,\n \t           \"RFX_FRAME_BEGIN: frameIdx: %\" PRIu32 \" numRegions: %\" PRIu16 \"\", frameIdx,\n \t           numRegions);\n@@ -711,28 +704,15 @@\n \t\t\t\t\t\t\t\t\t\t\t\twStream* WINPR_RESTRICT s,\n \t\t\t\t\t\t\t\t\t\t\t\tUINT16* WINPR_RESTRICT pExpectedBlockType)\n {\n-\tUINT32 magic = 0;\n-\n \tWINPR_ASSERT(context);\n \tWINPR_ASSERT(context->priv);\n-\tWINPR_ASSERT(message);\n-\tWINPR_ASSERT(s);\n-\tWINPR_ASSERT(pExpectedBlockType);\n-\n-\tif (*pExpectedBlockType != WBT_FRAME_END)\n-\t{\n-\t\tWLog_Print(context->priv->log, WLOG_ERROR, \"message unexpected wants WBT_FRAME_END (0x%x)\", *pExpectedBlockType);\n-\t\treturn FALSE;\n-\t}\n-\n-\tStream_Read_UINT32(s, magic); /* magic (4 bytes), 0xCACCACCA */\n-\tif (magic != WF_MAGIC)\n-\t{\n-\t\tWLog_Print(context->priv->log, WLOG_ERROR, \"invalid magic number 0x%08\" PRIX32 \"\", magic);\n-\t\treturn FALSE;\n-\t}\n-\t*(UINT64*)metadataBlock = metadataData;\n-\treturn TRUE;\n+\tWINPR_UNUSED(message);\n+\tWINPR_UNUSED(s);\n+\tWINPR_UNUSED(pExpectedBlockType);\n+\n+\tWLog_Print(context->priv->log, WLOG_ERROR,\n+\t           \"WBT_METADATA blocks are not supported and not part of MS-RDPRFX specification\");\n+\treturn FALSE;\n }\n \n static INLINE BOOL rfx_resize_rects(RFX_MESSAGE* WINPR_RESTRICT message)\n@@ -1317,8 +1297,9 @@\n \t\t\t\tbreak;\n \n \t\t\tcase WBT_METADATA:\n-\t\t\t\tok = rfx_process_message_metadata(context, message, subStream,\n-\t\t\t\t                                 &context->expectedDataBlockType);\n+\t\t\t\tWLog_Print(context->priv->log, WLOG_ERROR,\n+\t\t\t\t           \"WBT_METADATA blocks are not supported and not part of MS-RDPRFX specification\");\n+\t\t\t\tok = FALSE;\n \t\t\t\tbreak;\n \n \t\t\tcase WBT_FRAME_END:\n",
  "stdout": "",
  "stderr": ""
}