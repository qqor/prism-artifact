[2;36m[01/06/26 01:15:28][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=750869;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=630182;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpuwtkq2hi[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-full-01_vuln_8/[0m[95magent-[0m [2m               [0m
[2;36m                    [0m         [95moutput-1767662128.2803874[0m                                                            [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/tika_tk-full-01_vuln_8.toml             [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=107947;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=600589;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:17:13][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m104.80[0m ]8;id=965414;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=457920;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=306333;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=573849;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=134641;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=494230;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=244276;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=190484;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m104[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=543276;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=479162;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:17:14][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.90[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=318731;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=803874;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/06/26 01:17:15][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=40154;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=266144;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=560676;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=879578;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=467349;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=273237;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=576221;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=351685;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:17:17][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.22[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=715993;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=211252;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=553217;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=613567;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:17:18][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.88[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=248610;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=751996;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/06/26 01:17:30][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=280744;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=395909;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/06/26 01:17:50][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=350881;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=826130;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/06/26 01:22:38][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=662992;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=857758;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/06/26 01:24:25][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=244005;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=327517;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=203755;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=885574;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:24:26][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.99[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=418248;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=217185;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=771930;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=722701;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmp8d9afu7_[0m                                                 ]8;id=269809;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=156964;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/06/26 01:25:46][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m79.95[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=537203;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=200811;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=758792;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=179294;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:26:19][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m33.29[0m seconds;                ]8;id=658385;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=796723;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=934859;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=498592;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:26:31][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.76[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=944498;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=602943;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=80937;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=625212;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=26503;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=115211;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=126954;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=84294;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:26:32][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.93[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=407414;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=891487;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/06/26 01:26:33][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=736499;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=916075;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:26:34][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.97[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=764659;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=51975;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/06/26 01:26:35][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=586360;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=518216;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/06/26 01:26:36][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.93[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=907490;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=26;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=315259;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=991068;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         +++ b/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         @@ [1;36m-26[0m,[1;36m28[0m +[1;36m26[0m,[1;36m17[0m @@                                                                 [2m                [0m
[2;36m                    [0m          import java.nio.file.StandardCopyOption;                                           [2m                [0m
[2;36m                    [0m          import java.util.Locale;                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.FileUtils;                                            [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.FilenameUtils;                                        [2m                [0m
[2;36m                    [0m          import org.apache.commons.io.IOUtils;                                              [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.input.CloseShieldInputStream;                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -import org.apache.tika.io.TikaInputStream;                                         [2m                [0m
[2;36m                    [0m          import org.apache.tika.metadata.Metadata;                                          [2m                [0m
[2;36m                    [0m         -import org.apache.tika.metadata.Property;                                          [2m                [0m
[2;36m                    [0m          import org.apache.tika.metadata.TikaCoreProperties;                                [2m                [0m
[2;36m                    [0m          import org.apache.tika.mime.MediaType;                                             [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.FileProcessResult;                                    [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.ProcessUtils;                                         [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.StringUtils;                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m          [35m/[0m**                                                                                [2m                [0m
[2;36m                    [0m           * Simple detector to determine if a shell script is no-arg shell script.          [2m                [0m
[2;36m                    [0m           *[35m/[0m                                                                                [2m                [0m
[2;36m                    [0m          public class ShellCodeDetector implements Detector [1m{[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -    public static final Property SHELL_NO_ARGS =                                   [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1m([0m[32m"sh:no_args"[0m[1m)[0m;                                             [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -    private static final int MAX_LENGTH = [1;36m64[0m;                                      [2m                [0m
[2;36m                    [0m              private static final MediaType SHELL_SCRIPT = [1;35mMediaType.application[0m[1m([0m[32m"x-sh"[0m[1m)[0m;   [2m                [0m
[2;36m                    [0m              private static final int SNIFF_LENGTH = [1;36m4[0m;                                     [2m                [0m
[2;36m                    [0m              @Override                                                                      [2m                [0m
[2;36m                    [0m         @@ [1;36m-77[0m,[1;36m37[0m +[1;36m66[0m,[1;36m7[0m @@                                                                  [2m                [0m
[2;36m                    [0m                  [1m}[0m finally [1m{[0m                                                                [2m                [0m
[2;36m                    [0m                      [1;35minput.reset[0m[1m([0m[1m)[0m;                                                         [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        if [1m([0m! isShell[1m)[0m [1m{[0m                                                           [2m                [0m
[2;36m                    [0m         -            return MediaType.OCTET_STREAM;                                         [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        String fileName = [1;35mmetadata.get[0m[1m([0mTikaCoreProperties.RESOURCE_NAME_KEY[1m)[0m;      [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mStringUtils.isBlank[0m[1m([0mfileName[1m)[0m[1m)[0m [1m{[0m                                       [2m                [0m
[2;36m                    [0m         -            return [1;35misShell[0m[1m([0misShell[1m)[0m;                                               [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        [35m/[0m[35m/[0m[95mnow[0m test for no-arg shell script                                         [2m                [0m
[2;36m                    [0m         -        TikaInputStream tis =                                                      [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1m([0m[1;35mCloseShieldInputStream.wrap[0m[1m([0minput[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mFilenameUtils.getName[0m[1m([0mfileName[1m)[0m;                                [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m, [32m""[0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"\\.\\."[0m, [32m""[0m[1m)[0m;                              [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m > MAX_LENGTH[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -            fileName = [1;35mfileName.substring[0m[1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m - MAX_LENGTH[1m)[0m;         [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        Path cwd = [1;35mPaths.get[0m[1m([0m[32m"."[0m[1m)[0m[1;35m.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        Path tmpDir = [1;35mFiles.createTempDirectory[0m[1m([0mcwd, [32m"tika-shell-detect-"[0m[1m)[0m;        [2m                [0m
[2;36m                    [0m         -        Path tmpFile = [1;35mtmpDir.resolve[0m[1m([0mfileName[1m)[0m;                                   [2m                [0m
[2;36m                    [0m         -        [1;35mFiles.copy[0m[1m([0m[1;35mtis.getPath[0m[1m([0m[1m)[0m, tmpFile, StandardCopyOption.REPLACE_EXISTING[1m)[0m;   [2m                [0m
[2;36m                    [0m         -        ProcessBuilder pb = new [1;35mProcessBuilder[0m[1m([0mfileName[1m)[0m;                          [2m                [0m
[2;36m                    [0m         -        [1;35mpb.directory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                                             [2m                [0m
[2;36m                    [0m         -        try [1m{[0m                                                                      [2m                [0m
[2;36m                    [0m         -            FileProcessResult result = [1;35mProcessUtils.execute[0m[1m([0mpb, [1;36m20000[0m, [1;36m100000[0m,     [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1m)[0m;                                                                            [2m                [0m
[2;36m                    [0m         -            if [1m([0m[1;35mresult.getExitValue[0m[1m([0m[1m)[0m == [1;36m0[0m[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -                [1;35mmetadata.set[0m[1m([0mSHELL_NO_ARGS, true[1m)[0m;                                 [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -        [1m}[0m finally [1m{[0m                                                                [2m                [0m
[2;36m                    [0m         -            [1;35mFileUtils.deleteDirectory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        return SHELL_SCRIPT;                                                       [2m                [0m
[2;36m                    [0m         +        return [1;35misShell[0m[1m([0misShell[1m)[0m;                                                   [2m                [0m
[2;36m                    [0m              [1m}[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m              private MediaType [1;35misShell[0m[1m([0mboolean isShell[1m)[0m [1m{[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A critical security vulnerability has been detected through fuzzing that identifies [2m                [0m
[2;36m                    [0m         an OS Command Injection issue in Apache Tika. The vulnerability occurs during the   [2m                [0m
[2;36m                    [0m         processing of embedded documents when the ShellCodeDetector attempts to execute OS  [2m                [0m
[2;36m                    [0m         commands with potentially attacker-controlled data. This is classified as a         [2m                [0m
[2;36m                    [0m         critical security issue that could lead to remote code execution.                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The issue manifests as a `FuzzerSecurityIssueCritical` exception specifically       [2m                [0m
[2;36m                    [0m         identifying an OS Command Injection vulnerability. OS command injection occurs when [2m                [0m
[2;36m                    [0m         an application executes operating system commands using data that can be controlled [2m                [0m
[2;36m                    [0m         by an attacker, potentially allowing arbitrary command execution on the host        [2m                [0m
[2;36m                    [0m         system.                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The vulnerability type is explicitly stated as **OS Command Injection**, which is a [2m                [0m
[2;36m                    [0m         critical security flaw that can enable remote code execution. This type of          [2m                [0m
[2;36m                    [0m         vulnerability allows attackers to inject malicious commands into legitimate system  [2m                [0m
[2;36m                    [0m         calls, potentially compromising the entire system.                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         Based on the stack trace, the following execution flow leads to the vulnerability:  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. The entry point begins at `[1;35mTikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0m[1m)[0m` which     [2m                [0m
[2;36m                    [0m         processes fuzzer-generated input                                                    [2m                [0m
[2;36m                    [0m         [1;36m2[0m. The parsing chain proceeds through `[1;35mTikaCLI.main[0m[1m([0m[1m)[0m` → `[1;35mTikaCLI.process[0m[1m([0m[1m)[0m` →      [2m                [0m
[2;36m                    [0m         `TikaCLI$[1;35mOutputType.process[0m[1m([0m[1m)[0m`                                                      [2m                [0m
[2;36m                    [0m         [1;36m3[0m. Document parsing is handled by `[1;35mAutoDetectParser.parse[0m[1m([0m[1m)[0m` and                    [2m                [0m
[2;36m                    [0m         `[1;35mCompositeParser.parse[0m[1m([0m[1m)[0m`                                                           [2m                [0m
[2;36m                    [0m         [1;36m4[0m. Package parsing occurs through `PackageParser` methods: `[1;35mparse[0m[1m([0m[1m)[0m` → `[1;35m_parse[0m[1m([0m[1m)[0m` → [2m                [0m
[2;36m                    [0m         `[1;35mparseEntries[0m[1m([0m[1m)[0m` → `[1;35mparseEntry[0m[1m([0m[1m)[0m`                                                   [2m                [0m
[2;36m                    [0m         [1;36m5[0m. Embedded documents are extracted via                                             [2m                [0m
[2;36m                    [0m         `TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0m[1m)[0m`                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m. Content type detection is performed by `[1;35mCompositeDetector.detect[0m[1m([0m[1m)[0m`              [2m                [0m
[2;36m                    [0m         [1;36m7[0m. **The vulnerability is triggered at `[1;35mShellCodeDetector.detect[0m[1m([0m[1m)[0m` at line [1;36m103[0m**   [2m                [0m
[2;36m                    [0m         [1;36m8[0m. This leads to `[1;35mProcessUtils.execute[0m[1m([0m[1m)[0m` at line [1;36m94[0m, which calls                   [2m                [0m
[2;36m                    [0m         `[1;35mProcessBuilder.start[0m[1m([0m[1m)[0m`                                                            [2m                [0m
[2;36m                    [0m         [1;36m9[0m. The Jazzer sanitizer intercepts the call at                                      [2m                [0m
[2;36m                    [0m         `[1;35mOsCommandInjection.processImplStartHook[0m[1m([0m[1m)[0m` and raises the security exception       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         Key observations:                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - The vulnerability is detected during the detection phase of file processing,      [2m                [0m
[2;36m                    [0m         specifically when attempting to identify shell code                                 [2m                [0m
[2;36m                    [0m         - The issue occurs in the context of processing package files with embedded         [2m                [0m
[2;36m                    [0m         documents                                                                           [2m                [0m
[2;36m                    [0m         - The `ShellCodeDetector` class appears to execute external commands as part of its [2m                [0m
[2;36m                    [0m         detection logic                                                                     [2m                [0m
[2;36m                    [0m         - The `[1;35mProcessUtils.execute[0m[1m([0m[1m)[0m` method is the direct caller of the process execution [2m                [0m
[2;36m                    [0m         functionality                                                                       [2m                [0m
[2;36m                    [0m         - The security issue is triggered by the Jazzer fuzzing framework's sanitizer,      [2m                [0m
[2;36m                    [0m         indicating that untrusted input data flows into command execution                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         To obtain a holistic view of this issue, the following components should be         [2m                [0m
[2;36m                    [0m         investigated:                                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **ShellCodeDetector.java** [1m([0mline [1;36m103[0m[1m)[0m: Examine how this detector constructs and  [2m                [0m
[2;36m                    [0m         executes OS commands, and what input data influences the command construction       [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **ProcessUtils.java** [1m([0mline [1;36m94[0m[1m)[0m: Review the `[1;35mexecute[0m[1m([0m[1m)[0m` method to understand how [2m                [0m
[2;36m                    [0m         commands are built and whether input validation or sanitization is performed        [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **CompositeDetector.java** [1m([0mline [1;36m84[0m[1m)[0m: Understand how detectors are chained and   [2m                [0m
[2;36m                    [0m         how data flows between them                                                         [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **PackageParser.java**: Investigate how embedded documents are extracted and     [2m                [0m
[2;36m                    [0m         processed, particularly around lines [1;36m336[0m, [1;36m386[0m, and [1;36m481[0m                              [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **TikaCLI$FileEmbeddedDocumentExtractor.java** [1m([0mline [1;36m1092[0m[1m)[0m: Review how embedded  [2m                [0m
[2;36m                    [0m         documents are handled in the CLI context                                            [2m                [0m
[2;36m                    [0m         [1;36m6[0m. The overall architecture of Tika's detection mechanism to understand where input [2m                [0m
[2;36m                    [0m         validation should occur and how untrusted data flows through the system             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS[0m [2m                [0m
[2;36m                    [0m         [39mCommand Injection[0m                                                                   [2m                [0m
[2;36m                    [0m         [39mExecuting OS commands with attacker-controlled data can lead to remote code [0m        [2m                [0m
[2;36m                    [0m         [39mexecution.[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1;39m([0m[39mOsC[0m [2m                [0m
[2;36m                    [0m         [39mommandInjection.jav[0m[1;92ma:63[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1110[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1073[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1;39m([0m[39mProcessUtils.jav[0m[1;92ma:94[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1;39m([0m[39mShellCodeDetector.jav[0m[1;92ma:103[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1;39m([0m[39mCompositeDetector.jav[0m[1;92ma:84[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.tika.cli.TikaCLI$[0m[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1;39m([0m[39mTikaCLI.jav[0m [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.tika.cli.TikaCLI$[0m[1;35mOutputType.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:1056[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:485[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:237[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:54[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: d7514645016ef7a8[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:1[0m[39m-[0m[1;36m26[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.detect;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.EOFException;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:43[0m[39m-[0m[1;36m119[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m: * Simple detector to determine if a shell script is no-arg shell script.[0m        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/utils/ProcessUtils.jav[0m[1;92ma:1[0m[39m-[0m[1;36m26[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.utils;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.concurrent.ConcurrentHashMap;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.concurrent.TimeUnit;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/utils/ProcessUtils.jav[0m[1;92ma:77[0m[39m-[0m[1;36m153[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * This writes stdout and stderr to the FileProcessResult.[0m                   [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * @param pb[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * @param timeoutMillis[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * @param maxStdoutBuffer[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * @param maxStdErrBuffer[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * @return[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * @throws IOException[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    public static FileProcessResult [0m[1;35mexecute[0m[1;39m([0m[39mProcessBuilder pb,[0m                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                            long timeoutMillis,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                                            int maxStdoutBuffer, int [0m            [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:            throws IOException [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        Process p = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        String id = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            p = [0m[1;35mpb.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:            id = [0m[1;35mregister[0m[1;39m([0m[39mp[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            long elapsed = [0m[1;36m-1[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            long start = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:            StreamGobbler outGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getInputStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdoutBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            StreamGobbler errGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getErrorStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            Thread outThread = new [0m[1;35mThread[0m[1;39m([0m[39moutGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:            [0m[1;35moutThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Thread errThread = new [0m[1;35mThread[0m[1;39m([0m[39merrGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35merrThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            int exitValue = [0m[1;36m-1[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            boolean complete = false;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                complete = [0m[1;35mp.waitFor[0m[1;39m([0m[39mtimeoutMillis, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:                elapsed = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m - start;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:                if [0m[1;39m([0m[39mcomplete[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:                    exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:                    [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:                    boolean completed = [0m[1;35mp.waitFor[0m[1;39m([0m[1;36m500[0m[39m, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                    if [0m[1;39m([0m[39mcompleted[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:                        try [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                            exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalThreadStateException e[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:                            [0m[35m/[0m[35m/[0m[95mnot[0m[39m finished![0m                                     [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mInterruptedException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:                exitValue = [0m[1;36m-1000[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:            [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:                [0m[1;35moutThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:                [0m[1;35merrThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:            FileProcessResult result = new [0m[1;35mFileProcessResult[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:            result.processTimeMillis = elapsed;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            result.stderrLength = [0m[1;35merrGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            result.stdoutLength = [0m[1;35moutGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            result.isTimeout = ! complete;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            result.exitValue = exitValue;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            result.stdout = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35moutGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            result.stderr = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35merrGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:            result.stdoutTruncated = [0m[1;35moutGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            result.stderrTruncated = [0m[1;35merrGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:            return result;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mp != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            if [0m[1;39m([0m[39mid != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[1;35mrelease[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/CompositeDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m31[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Collection;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.mime.MediaTypeRegistry;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/CompositeDetector.jav[0m[1;92ma:36[0m[39m-[0m[1;36m135[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:public class CompositeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    private static final long serialVersionUID = 5980683158436430252L;[0m           [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    private final MediaTypeRegistry registry;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private final List<Detector> detectors;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:                             Collection<Class<? extends Detector>> [0m              [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:        if [0m[1;39m([0m[39mexcludeDetectors == null || [0m[1;35mexcludeDetectors.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:            this.detectors = detectors;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            this.detectors = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            for [0m[1;39m([0m[39mDetector d : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35misExcluded[0m[1;39m([0m[39mexcludeDetectors, [0m[1;35md.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:                    [0m[1;35mthis.detectors.add[0m[1;39m([0m[39md[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        this.registry = registry;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mregistry, detectors, null[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mList<Detector> detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mnew [0m[1;35mMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, detectors[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mDetector[0m[33m...[0m[39m detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mArrays.asList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        MediaType override = [0m[1;35mdetectOverrides[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        if [0m[1;39m([0m[39moverride != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:            return override;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        MediaType type = MediaType.OCTET_STREAM;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m have to iterate through all detectors because the override detector[0m [2m                [0m
[2;36m                    [0m         [39mmay[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[35m/[0m[35m/[0m[95mbe[0m[39m within a CompositeDetector[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        for [0m[1;39m([0m[39mDetector detector : [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            MediaType detected = [0m[1;35mdetector.detect[0m[1;39m([0m[39minput, metadata[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            if [0m[1;39m([0m[1;35mregistry.isSpecializationOf[0m[1;39m([0m[39mdetected, type[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                type = detected;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        return type;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param metadata[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return mediaType if a parseable mediatype was sent in via user or parser[0m [2m                [0m
[2;36m                    [0m         [39moverrides[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    private static MediaType [0m[1;35mdetectOverrides[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        String override = [0m                                                       [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_USER_OVERRIDE[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        override = [0m                                                             [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_PARSER_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:        return null;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * Returns the component detectors.[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:    public List<Detector> [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:        return [0m[1;35mCollections.unmodifiableList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:    private boolean [0m[1;35misExcluded[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m           [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                               Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:        return [0m[1;35mexcludeDetectors.contains[0m[1;39m([0m[39md[0m[1;39m)[0m[39m || [0m[1;35massignableFrom[0m[1;39m([0m[39mexcludeDetectors,[0m [2m                [0m
[2;36m                    [0m         [39md[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:    private boolean [0m[1;35massignableFrom[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m       [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                                   Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:        for [0m[1;39m([0m[39mClass<? extends Detector> e : excludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            if [0m[1;39m([0m[1;35me.isAssignableFrom[0m[1;39m([0m[39md[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:                return true;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        return false;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector:[0m[1;36m1[0m[39m-[0m[1;36m16[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:#  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:#  contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:#  this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:#  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:#  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:#  the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:#       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:#  Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:#  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:#  See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:#  limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:org.apache.tika.detect.ShellCodeDetector[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:450[0m[39m-[0m[1;36m490[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1080[0m[39m-[0m[1;36m1100[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:            File outputFile = null;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m1[0m[39m-[0m[1;36m31[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:<?xml [0m[33mversion[0m[39m=[0m[32m"1[0m[32m.0"[0m[39m [0m[33mencoding[0m[39m=[0m[32m"UTF[0m[32m-8"[0m[39m?>[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:<!--[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m              [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:  contributor license agreements.  See the NOTICE file distributed with[0m           [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:  this work for additional information regarding copyright ownership.[0m             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m         [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m            [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:  the License.  You may obtain a copy of the License at[0m                           [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:  [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:  Unless required by applicable law or agreed to in writing, software[0m            [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m              [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m       [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:  See the License for the specific language governing permissions and[0m            [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:  limitations under the License.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:-->[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:<properties>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:<[0m[35m/[0m[95mproperties[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:1055[0m[39m-[0m[1;36m1161[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1055[0m[39m:    private static class DetectorXmlLoader extends [0m                            [2m                [0m
[2;36m                    [0m         [39mXmlLoader<CompositeDetector, Detector> [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1056[0m[39m:        boolean [0m[1;35msupportsComposite[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1057[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1058[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1059[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1060[0m[39m:        String [0m[1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1061[0m[39m:            return [0m[32m"detectors"[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1062[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1063[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1064[0m[39m:        String [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1065[0m[39m:            return [0m[32m"detector"[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1066[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1067[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1068[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1069[0m[39m:        Class<? extends Detector> [0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1070[0m[39m:            return Detector.class;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1071[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1072[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1073[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1074[0m[39m:        Detector [0m[1;35mpreLoadOne[0m[1;39m([0m[39mClass<? extends Detector> loadedClass, String [0m     [2m                [0m
[2;36m                    [0m         [39mclassname,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1075[0m[39m:                            MimeTypes mimeTypes[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1076[0m[39m:            [0m[35m/[0m[35m/[0m[39m If they asked for the mime types as a detector, give[0m            [2m                [0m
[2;36m                    [0m         [1;36m1077[0m[39m:            [0m[35m/[0m[35m/[0m[39m  them the one we've already created. TIKA-[0m[1;36m1708[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1078[0m[39m:            if [0m[1;39m([0m[1;35mMimeTypes.class.equals[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1079[0m[39m:                return mimeTypes;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:            [0m[35m/[0m[35m/[0m[39m Continue with normal loading[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:            return null;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:        boolean [0m[1;35misComposite[0m[1;39m([0m[39mDetector loaded[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:            return loaded instanceof CompositeDetector;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:        boolean [0m[1;35misComposite[0m[1;39m([0m[39mClass<? extends Detector> loadedClass[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:            return [0m[1;35mCompositeDetector.class.isAssignableFrom[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:        CompositeDetector [0m[1;35mcreateDefault[0m[1;39m([0m[39mMimeTypes mimeTypes, ServiceLoader [0m    [2m                [0m
[2;36m                    [0m         [39mloader[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:            return [0m[1;35mgetDefaultDetector[0m[1;39m([0m[39mmimeTypes, loader[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:        CompositeDetector [0m[1;35mcreateComposite[0m[1;39m([0m[39mList<Detector> detectors, MimeTypes [0m [2m                [0m
[2;36m                    [0m         [39mmimeTypes,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:                                          ServiceLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            MediaTypeRegistry registry = [0m[1;35mmimeTypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:            return new [0m[1;35mCompositeDetector[0m[1;39m([0m[39mregistry, detectors[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:        Detector [0m[1;35mcreateComposite[0m[1;39m([0m[39mClass<? extends Detector> detectorClass,[0m      [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:                                 List<Detector> childDetectors,[0m                [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:                                 Set<Class<? extends Detector>> [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:                                 Map<String, Param> params, MimeTypes [0m         [2m                [0m
[2;36m                    [0m         [39mmimeTypes,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                                 ServiceLoader loader[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                throws InvocationTargetException, IllegalAccessException, [0m     [2m                [0m
[2;36m                    [0m         [39mInstantiationException [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:            Detector detector = null;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:            Constructor<? extends Detector> c;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:            MediaTypeRegistry registry = [0m[1;35mmimeTypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:            [0m[35m/[0m[35m/[0m[39m Try the possible default and composite detector constructors[0m    [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                    c = detectorClass[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                            [0m[1;35m.getConstructor[0m[1;39m([0m[39mMimeTypes.class, [0m                  [2m                [0m
[2;36m                    [0m         [39mServiceLoader.class, Collection.class[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mmimeTypes, loader, [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:                    c = detectorClass[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                            [0m[1;35m.getConstructor[0m[1;39m([0m[39mMediaTypeRegistry.class, [0m          [2m                [0m
[2;36m                    [0m         [39mList.class, Collection.class[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mregistry, childDetectors, [0m        [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:                    c = [0m[1;35mdetectorClass.getConstructor[0m[1;39m([0m[39mMediaTypeRegistry.class, [0m [2m                [0m
[2;36m                    [0m         [39mList.class[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mregistry, childDetectors[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:                    c = [0m[1;35mdetectorClass.getConstructor[0m[1;39m([0m[39mList.class[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mchildDetectors[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            return detector;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:        Detector [0m[1;35mdecorate[0m[1;39m([0m[39mDetector created, Element element[0m[1;39m)[0m[39m [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            return created; [0m[35m/[0m[35m/[0m[39m No decoration of Detectors[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:654[0m[39m-[0m[1;36m869[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m654[0m[39m:    private static abstract class XmlLoader<CT, T> [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m655[0m[39m:        protected static final String PARAMS_TAG_NAME = [0m[32m"params"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m656[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m657[0m[39m:        abstract boolean [0m[1;35msupportsComposite[0m[1;39m([0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m658[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m659[0m[39m:        abstract String [0m[1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m eg parsers[0m                       [2m                [0m
[2;36m                    [0m         [1;36m660[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m661[0m[39m:        abstract String [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m eg parser[0m                        [2m                [0m
[2;36m                    [0m         [1;36m662[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m663[0m[39m:        abstract Class<? extends T> [0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m Generics workaround[0m    [2m                [0m
[2;36m                    [0m         [1;36m664[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m665[0m[39m:        abstract boolean [0m[1;35misComposite[0m[1;39m([0m[39mT loaded[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m666[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m667[0m[39m:        abstract boolean [0m[1;35misComposite[0m[1;39m([0m[39mClass<? extends T> loadedClass[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m668[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m669[0m[39m:        abstract T [0m[1;35mpreLoadOne[0m[1;39m([0m[39mClass<? extends T> loadedClass, String classname,[0m [2m                [0m
[2;36m                    [0m         [39mMimeTypes mimeTypes[0m[1;39m)[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m670[0m[39m:                throws TikaException;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m671[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m672[0m[39m:        abstract CT [0m[1;35mcreateDefault[0m[1;39m([0m[39mMimeTypes mimeTypes, ServiceLoader loader[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m673[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m674[0m[39m:        abstract CT [0m[1;35mcreateComposite[0m[1;39m([0m[39mList<T> loaded, MimeTypes mimeTypes, [0m       [2m                [0m
[2;36m                    [0m         [39mServiceLoader loader[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m675[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m676[0m[39m:        abstract T [0m[1;35mcreateComposite[0m[1;39m([0m[39mClass<? extends T> compositeClass, List<T> [0m  [2m                [0m
[2;36m                    [0m         [39mchildren,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m677[0m[39m:                                   Set<Class<? extends T>> excludeChildren,[0m     [2m                [0m
[2;36m                    [0m         [1;36m678[0m[39m:                                   Map<String, Param> params, MimeTypes [0m        [2m                [0m
[2;36m                    [0m         [39mmimeTypes,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m679[0m[39m:                                   ServiceLoader loader[0m[1;39m)[0m                        [2m                [0m
[2;36m                    [0m         [1;36m680[0m[39m:                throws InvocationTargetException, IllegalAccessException, [0m      [2m                [0m
[2;36m                    [0m         [39mInstantiationException;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m681[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m682[0m[39m:        abstract T [0m[1;35mdecorate[0m[1;39m([0m[39mT created, Element element[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [1;36m683[0m[39m:                throws IOException, TikaException; [0m[35m/[0m[35m/[0m[39m eg explicit mime types[0m    [2m                [0m
[2;36m                    [0m         [1;36m684[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m685[0m[39m:        @[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unchecked"[0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m686[0m[39m:        CT [0m[1;35mloadOverall[0m[1;39m([0m[39mElement element, MimeTypes mimeTypes, ServiceLoader [0m     [2m                [0m
[2;36m                    [0m         [39mloader[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m687[0m[39m:                throws TikaException, IOException [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m688[0m[39m:            List<T> loaded = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m689[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m690[0m[39m:            [0m[35m/[0m[35m/[0m[39m Find the children of the parent tag, if any[0m                      [2m                [0m
[2;36m                    [0m         [1;36m691[0m[39m:            for [0m[1;39m([0m[39mElement le : [0m[1;35mgetTopLevelElementChildren[0m[1;39m([0m[39melement, [0m              [2m                [0m
[2;36m                    [0m         [1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m,[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m692[0m[39m:                    [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m693[0m[39m:                T loadedChild = [0m[1;35mloadOne[0m[1;39m([0m[39mle, mimeTypes, loader[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m694[0m[39m:                if [0m[1;39m([0m[39mloadedChild != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m695[0m[39m:                    [0m[1;35mloaded.add[0m[1;39m([0m[39mloadedChild[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m696[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m697[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m698[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m699[0m[39m:            [0m[35m/[0m[35m/[0m[39m Build the classes, and wrap as needed[0m                            [2m                [0m
[2;36m                    [0m         [1;36m700[0m[39m:            if [0m[1;39m([0m[1;35mloaded.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m701[0m[39m:                [0m[35m/[0m[35m/[0m[39m Nothing defined, create a Default[0m                            [2m                [0m
[2;36m                    [0m         [1;36m702[0m[39m:                return [0m[1;35mcreateDefault[0m[1;39m([0m[39mmimeTypes, loader[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m703[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35mloaded.size[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m704[0m[39m:                T single = [0m[1;35mloaded.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m705[0m[39m:                if [0m[1;39m([0m[1;35misComposite[0m[1;39m([0m[39msingle[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m706[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Single Composite defined, use that[0m                       [2m                [0m
[2;36m                    [0m         [1;36m707[0m[39m:                    return [0m[1;39m([0m[39mCT[0m[1;39m)[0m[39m single;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m708[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m709[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39m![0m[1;35msupportsComposite[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m710[0m[39m:                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                                  [2m                [0m
[2;36m                    [0m         [1;36m711[0m[39m:                        [0m[32m"Composite not supported for "[0m[39m + [0m[1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m +[0m   [2m                [0m
[2;36m                    [0m         [1;36m712[0m[39m:                                [0m[32m". Must specify only one child!"[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m713[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m714[0m[39m:            [0m[35m/[0m[35m/[0m[39m Wrap the defined parsers/detectors up in a Composite[0m             [2m                [0m
[2;36m                    [0m         [1;36m715[0m[39m:            return [0m[1;35mcreateComposite[0m[1;39m([0m[39mloaded, mimeTypes, loader[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m716[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m717[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m718[0m[39m:        T [0m[1;35mloadOne[0m[1;39m([0m[39mElement element, MimeTypes mimeTypes, ServiceLoader loader[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [1;36m719[0m[39m:                throws TikaException, IOException [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m720[0m[39m:            String name = [0m[1;35melement.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m721[0m[39m:            if [0m[1;39m([0m[1;35mname.isBlank[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m722[0m[39m:                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[32m"class attribute must not be [0m     [2m                [0m
[2;36m                    [0m         [32mempty: "[0m[39m + element[0m[1;39m)[0m[39m;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m723[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m724[0m[39m:            String initProbHandler = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35melement.getAttribute[0m[1;39m([0m[32m"initializableProblemHandler"[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m725[0m[39m:            InitializableProblemHandler initializableProblemHandler;[0m            [2m                [0m
[2;36m                    [0m         [1;36m726[0m[39m:            if [0m[1;39m([0m[1;35minitProbHandler.isBlank[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m727[0m[39m:                initializableProblemHandler = [0m                                  [2m                [0m
[2;36m                    [0m         [1;35mloader.getInitializableProblemHandler[0m[1;39m([0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m728[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m729[0m[39m:                initializableProblemHandler = [0m                                  [2m                [0m
[2;36m                    [0m         [1;35mgetInitializableProblemHandler[0m[1;39m([0m[39minitProbHandler[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m730[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m731[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m732[0m[39m:            T loaded;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m733[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m734[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m735[0m[39m:                Class<? extends T> loadedClass = [0m                               [2m                [0m
[2;36m                    [0m         [1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, name[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m736[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m737[0m[39m:                [0m[35m/[0m[35m/[0m[39m Do pre-load checks and short-circuits[0m                        [2m                [0m
[2;36m                    [0m         [1;36m738[0m[39m:                [0m[35m/[0m[35m/[0m[95mTODO[0m[39m : allow duplicate instances with different [0m              [2m                [0m
[2;36m                    [0m         [39mconfigurations[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m739[0m[39m:                loaded = [0m[1;35mpreLoadOne[0m[1;39m([0m[39mloadedClass, name, mimeTypes[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m740[0m[39m:                if [0m[1;39m([0m[39mloaded != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m741[0m[39m:                    return loaded;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m742[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m743[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m744[0m[39m:                [0m[35m/[0m[35m/[0m[39m Get any parameters [0m[35m/[0m[39m settings for the parser[0m                 [2m                [0m
[2;36m                    [0m         [1;36m745[0m[39m:                Map<String, Param> params = null;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m746[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m747[0m[39m:                    params = [0m[1;35mgetParams[0m[1;39m([0m[39melement[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m748[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m749[0m[39m:                    throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m750[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m751[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m752[0m[39m:                [0m[35m/[0m[35m/[0m[39m Is this a composite or decorated class? If so, support [0m      [2m                [0m
[2;36m                    [0m         [39mrecursion[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m753[0m[39m:                if [0m[1;39m([0m[1;35misComposite[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m754[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the child objects for it[0m                             [2m                [0m
[2;36m                    [0m         [1;36m755[0m[39m:                    List<T> children = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m756[0m[39m:                    NodeList childNodes = [0m                                      [2m                [0m
[2;36m                    [0m         [1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m757[0m[39m:                    if [0m[1;39m([0m[1;35mchildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m758[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mchildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m759[0m[39m:                            T loadedChild =[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m760[0m[39m:                                    [0m[1;35mloadOne[0m[1;39m([0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mchildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mmimeTypes, loader[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m761[0m[39m:                            if [0m[1;39m([0m[39mloadedChild != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m762[0m[39m:                                [0m[1;35mchildren.add[0m[1;39m([0m[39mloadedChild[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m763[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m764[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m765[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m766[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m767[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the list of children to exclude[0m                      [2m                [0m
[2;36m                    [0m         [1;36m768[0m[39m:                    Set<Class<? extends T>> excludeChildren = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m769[0m[39m:                    NodeList excludeChildNodes =[0m                                [2m                [0m
[2;36m                    [0m         [1;36m770[0m[39m:                            [0m[1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m  [2m                [0m
[2;36m                    [0m         [32m"-exclude"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m771[0m[39m:                    if [0m[1;39m([0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m772[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m773[0m[39m:                            Element excl = [0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mexcludeChildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m774[0m[39m:                            String exclName = [0m[1;35mexcl.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m775[0m[39m:                            try [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m776[0m[39m:                                excludeChildren[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m777[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.add[0m[1;39m([0m[1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, exclName[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m778[0m[39m:                            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mClassNotFoundException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m779[0m[39m:                                [0m[35m/[0m[35m/[0m[95mTIKA-3268[0m[39m -- This should stop the world.[0m      [2m                [0m
[2;36m                    [0m         [1;36m780[0m[39m:                                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                  [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:                                        [0m[32m"Class not found in -exclude list: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mexclName[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Create the Composite[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:                    loaded = [0m[1;35mcreateComposite[0m[1;39m([0m[39mloadedClass, children, [0m            [2m                [0m
[2;36m                    [0m         [39mexcludeChildren, params,[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:                            mimeTypes, loader[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m789[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m790[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Default constructor fallback[0m                             [2m                [0m
[2;36m                    [0m         [1;36m791[0m[39m:                    if [0m[1;39m([0m[39mloaded == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m792[0m[39m:                        loaded = [0m[1;35mnewInstance[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m793[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m794[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m795[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Regular class, create as-is[0m                              [2m                [0m
[2;36m                    [0m         [1;36m796[0m[39m:                    loaded = [0m[1;35mnewInstance[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m797[0m[39m:                    [0m[35m/[0m[35m/[0m[39m TODO Support arguments, needed for Translators etc[0m       [2m                [0m
[2;36m                    [0m         [1;36m798[0m[39m:                    [0m[35m/[0m[35m/[0m[39m See the thread [0m[32m"Configuring parsers and translators"[0m[39m for[0m [2m                [0m
[2;36m                    [0m         [39mdetails[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m799[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m800[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m801[0m[39m:                [0m[35m/[0m[35m/[0m[95mAssigning[0m[39m the params to bean fields/setters[0m                   [2m                [0m
[2;36m                    [0m         [1;36m802[0m[39m:                [0m[1;35mAnnotationUtils.assignFieldParams[0m[1;39m([0m[39mloaded, params[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m803[0m[39m:                if [0m[1;39m([0m[39mloaded instanceof Initializable[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m804[0m[39m:                    [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m loaded[0m[1;39m)[0m[1;35m.initialize[0m[1;39m([0m[39mparams[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m805[0m[39m:                    [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m [0m                                           [2m                [0m
[2;36m                    [0m         [39mloaded[0m[1;39m)[0m[1;35m.checkInitialization[0m[1;39m([0m[39minitializableProblemHandler[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m806[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m807[0m[39m:                [0m[35m/[0m[35m/[0m[39m Have any decoration performed, eg explicit mimetypes[0m         [2m                [0m
[2;36m                    [0m         [1;36m808[0m[39m:                loaded = [0m[1;35mdecorate[0m[1;39m([0m[39mloaded, element[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m809[0m[39m:                [0m[35m/[0m[35m/[0m[39m All done with setup[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m810[0m[39m:                return loaded;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m811[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mClassNotFoundException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m812[0m[39m:                if [0m[1;39m([0m[1;35mloader.getLoadErrorHandler[0m[1;39m([0m[1;39m)[0m[39m == LoadErrorHandler.THROW[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m813[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Use a different exception signature here[0m                 [2m                [0m
[2;36m                    [0m         [1;36m814[0m[39m:                    throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m815[0m[39m:                            [0m[32m"Unable to find a "[0m[39m + [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" class:[0m [2m                [0m
[2;36m                    [0m         [32m"[0m[39m + name, e[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m816[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m817[0m[39m:                [0m[35m/[0m[35m/[0m[39m Report the problem[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m818[0m[39m:                [0m[1;35mloader.getLoadErrorHandler[0m[1;39m([0m[1;39m)[0m[1;35m.handleLoadError[0m[1;39m([0m[39mname, e[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m819[0m[39m:                return null;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m820[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalAccessException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m821[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m                                        [2m                [0m
[2;36m                    [0m         [1;36m822[0m[39m:                        [0m[32m"Unable to access a "[0m[39m + [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" class: "[0m [2m                [0m
[2;36m                    [0m         [39m+ name, e[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m823[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mInvocationTargetException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m824[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m                                        [2m                [0m
[2;36m                    [0m         [1;36m825[0m[39m:                        [0m[32m"Unable to create a "[0m[39m + [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" class: "[0m [2m                [0m
[2;36m                    [0m         [39m+ name, e[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m826[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mInstantiationException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m827[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m                                        [2m                [0m
[2;36m                    [0m         [1;36m828[0m[39m:                        [0m[32m"Unable to instantiate a "[0m[39m + [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" [0m    [2m                [0m
[2;36m                    [0m         [32mclass: "[0m[39m + name, e[0m[1;39m)[0m[39m;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m829[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m830[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m                                        [2m                [0m
[2;36m                    [0m         [1;36m831[0m[39m:                        [0m[32m"Unable to find the right constructor for "[0m[39m + [0m          [2m                [0m
[2;36m                    [0m         [1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m +[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m832[0m[39m:                                [0m[32m" class: "[0m[39m + name, e[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m833[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m834[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m835[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m836[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m837[0m[39m:        T [0m[1;35mnewInstance[0m[1;39m([0m[39mClass<? extends T> loadedClass[0m[1;39m)[0m                           [2m                [0m
[2;36m                    [0m         [1;36m838[0m[39m:                throws IllegalAccessException, InstantiationException, [0m         [2m                [0m
[2;36m                    [0m         [39mNoSuchMethodException,[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m839[0m[39m:                InvocationTargetException [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m840[0m[39m:            return [0m[1;35mloadedClass.getDeclaredConstructor[0m[1;39m([0m[1;39m)[0m[1;35m.newInstance[0m[1;39m([0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m841[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m842[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m843[0m[39m:        [0m[35m/[0m[39m**[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m844[0m[39m:         * Gets parameters from a given[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m845[0m[39m:         *[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m846[0m[39m:         * @param el xml node which has [0m[1;39m{[0m[39m@link #PARAMS_TAG_NAME[0m[1;39m}[0m[39m child[0m          [2m                [0m
[2;36m                    [0m         [1;36m847[0m[39m:         * @return Map of key values read from xml[0m                              [2m                [0m
[2;36m                    [0m         [1;36m848[0m[39m:         *[0m[35m/[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m849[0m[39m:        Map<String, Param> [0m[1;35mgetParams[0m[1;39m([0m[39mElement el[0m[1;39m)[0m[39m throws TikaException [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m850[0m[39m:            Map<String, Param> params = new HashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m851[0m[39m:            for [0m[1;39m([0m[39mNode child = [0m[1;35mel.getFirstChild[0m[1;39m([0m[1;39m)[0m[39m; child != null; child = [0m       [2m                [0m
[2;36m                    [0m         [1;35mchild.getNextSibling[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m852[0m[39m:                if [0m[1;39m([0m[1;35mPARAMS_TAG_NAME.equals[0m[1;39m([0m[1;35mchild.getNodeName[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m[39m [0m[35m/[0m[35m/[0m[95mfound[0m[39m the [0m [2m                [0m
[2;36m                    [0m         [39mnode[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m853[0m[39m:                    if [0m[1;39m([0m[1;35mchild.hasChildNodes[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m[39m [0m[35m/[0m[35m/[0m[95mit[0m[39m has children[0m              [2m                [0m
[2;36m                    [0m         [1;36m854[0m[39m:                        NodeList childNodes = [0m[1;35mchild.getChildNodes[0m[1;39m([0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m855[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mchildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m856[0m[39m:                            Node item = [0m[1;35mchildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m857[0m[39m:                            if [0m[1;39m([0m[1;35mitem.getNodeType[0m[1;39m([0m[1;39m)[0m[39m == Node.ELEMENT_NODE[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m858[0m[39m:                                Param<?> param = [0m[1;35mParam.load[0m[1;39m([0m[39mitem[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m859[0m[39m:                                [0m[1;35mparams.put[0m[1;39m([0m[1;35mparam.getName[0m[1;39m([0m[1;39m)[0m[39m, param[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m860[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m861[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m862[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m863[0m[39m:                    break; [0m[35m/[0m[35m/[0m[95monly[0m[39m the first one is used[0m                         [2m                [0m
[2;36m                    [0m         [1;36m864[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m865[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m866[0m[39m:            return params;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m867[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m868[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m869[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:46[0m[39m-[0m[1;36m119[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-extended/tika-parser-scientific-module/src/main/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/parser/gdal/GDALParser.jav[0m[1;92ma:1[0m[39m-[0m[1;36m56[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.tika.parser.gdal;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m[35m/[0m[35m/[0m[95mJDK[0m[39m imports[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import static org.apache.tika.parser.external.ExternalParser.IN[0m[1;33mPUT[0m[39m_FILE_TOKEN;[0m   [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.io.Reader;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.io.StringReader;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Scanner;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.regex.Matcher;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import org.apache.tika.config.TikaTaskTimeout;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.tika.io.TemporaryResources;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import org.apache.tika.metadata.ExternalProcess;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import org.apache.tika.parser.Parser;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import org.apache.tika.parser.external.ExternalParser;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import org.apache.tika.sax.XHTMLContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-extended/tika-parser-scientific-module/src/main/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/parser/gdal/GDALParser.jav[0m[1;92ma:154[0m[39m-[0m[1;36m202[0m                                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:    public [0m[1;35mGDALParser[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:        [0m[1;35msetCommand[0m[1;39m([0m[32m"gdalinfo $[0m[32m{[0m[32mIN[0m[1;33mPUT[0m[32m}[0m[32m"[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:    public String [0m[1;35mgetCommand[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:        return this.command;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:    public void [0m[1;35msetCommand[0m[1;39m([0m[39mString command[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:        this.command = command;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:    public String [0m[1;35mprocessCommand[0m[1;39m([0m[39mInputStream stream[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:        TikaInputStream tis = [0m[1;39m([0m[39mTikaInputStream[0m[1;39m)[0m[39m stream;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:        String pCommand = this.command;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:            if [0m[1;39m([0m[1;35mthis.command.contains[0m[1;39m([0m[39mIN[0m[1;33mPUT[0m[39m_FILE_TOKEN[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                pCommand = [0m[1;35mthis.command.replace[0m[1;39m([0m[39mIN[0m[1;33mPUT[0m[39m_FILE_TOKEN, [0m              [2m                [0m
[2;36m                    [0m         [1;35mtis.getFile[0m[1;39m([0m[1;39m)[0m[1;35m.getPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"exception processing command"[0m[39m, e[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:        return pCommand;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:    public Set<MediaType> [0m[1;35mgetSupportedTypes[0m[1;39m([0m[39mParseContext context[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:        return SUPPORTED_TYPES;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m184[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:    public void [0m[1;35mparse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mExternalParser.check[0m[1;39m([0m[32m"gdalinfo"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:        [0m[35m/[0m[35m/[0m[39m first set up and run GDAL[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:        [0m[35m/[0m[35m/[0m[39m process the command[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:        TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:        TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mstream, tmp, metadata[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m runCommand = [0m[1;35mprocessCommand[0m[1;39m([0m[39mtis[0m[1;39m)[0m[1;35m.split[0m[1;39m([0m[32m"\\s+"[0m[39m, [0m[1;36m-1[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:        long localTimeoutMillis = [0m[1;35mTikaTaskTimeout.getTimeoutMillis[0m[1;39m([0m[39mcontext, [0m    [2m                [0m
[2;36m                    [0m         [39mtimeoutMs[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:        FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mnew [0m                    [2m                [0m
[2;36m                    [0m         [1;35mProcessBuilder[0m[1;39m([0m[39mrunCommand[0m[1;39m)[0m[39m,[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:                localTimeoutMillis, maxStdOut, maxStdErr[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/parser/external2/ExternalParser.jav[0m[1;92ma:66[0m[39m-[0m[1;36m161[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:public class ExternalParser implements Parser, Initializable [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    public static final long DEFAULT_TIMEOUT_MS = [0m[1;36m60000[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public static final String IN[0m[1;33mPUT[0m[39m_FILE_TOKEN = [0m[32m"$[0m[32m{[0m[32mIN[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    public static final String OUT[0m[1;33mPUT[0m[39m_FILE_TOKEN = [0m[32m"$[0m[32m{[0m[32mOUT[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    private static Pattern IN[0m[1;33mPUT[0m[39m_TOKEN_MATCHER = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\$\\[0m[32m{[0m[32mIN[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    private static Pattern OUT[0m[1;33mPUT[0m[39m_TOKEN_MATCHER = [0m                               [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\$\\[0m[32m{[0m[32mOUT[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    private static final Logger LOG = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35mLoggerFactory.getLogger[0m[1;39m([0m[39mExternalParser.class[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    private Set<MediaType> supportedTypes = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:    private List<String> commandLine = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:    private Parser outputParser = EmptyParser.INSTANCE;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:    private boolean returnStdout = false;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    private boolean returnStderr = true;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:    private long timeoutMs = DEFAULT_TIMEOUT_MS;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    private int maxStdErr = [0m[1;36m10000[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:    private int maxStdOut = [0m[1;36m10000[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:    public Set<MediaType> [0m[1;35mgetSupportedTypes[0m[1;39m([0m[39mParseContext context[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        return supportedTypes;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:    public void [0m[1;35mparse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m may remain null, depending on whether the external parser writes[0m [2m                [0m
[2;36m                    [0m         [39mto a file[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        Path outFile = null;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        try [0m[1;39m([0m[39mTemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mstream, tmp, metadata[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            Path p = [0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            List<String> thisCommandLine = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            Matcher inputMatcher = [0m[1;35mIN[0m[1;33mPUT[0m[1;35m_TOKEN_MATCHER.matcher[0m[1;39m([0m[32m""[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            Matcher outputMatcher = [0m[1;35mOUT[0m[1;33mPUT[0m[1;35m_TOKEN_MATCHER.matcher[0m[1;39m([0m[32m""[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            boolean outputFileInCommandline = false;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            for [0m[1;39m([0m[39mString c : commandLine[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:                if [0m[1;39m([0m[1;35minputMatcher.reset[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;35m.find[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:                    String updated = [0m[1;35mc.replace[0m[1;39m([0m[39mIN[0m[1;33mPUT[0m[39m_FILE_TOKEN,[0m                [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mp.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mupdated[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35moutputMatcher.reset[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;35m.find[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                    outFile = [0m[1;35mFiles.createTempFile[0m[1;39m([0m[32m"tika-external2-"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:                    String updated = [0m[1;35mc.replace[0m[1;39m([0m[39mOUT[0m[1;33mPUT[0m[39m_FILE_TOKEN,[0m               [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35moutFile.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mupdated[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                    outputFileInCommandline = true;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mc[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            FileProcessResult result = null;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            long localTimeoutMillis = [0m[1;35mTikaTaskTimeout.getTimeoutMillis[0m[1;39m([0m[39mcontext,[0m [2m                [0m
[2;36m                    [0m         [39mtimeoutMs[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            if [0m[1;39m([0m[39moutputFileInCommandline[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:                result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mnew [0m                              [2m                [0m
[2;36m                    [0m         [1;35mProcessBuilder[0m[1;39m([0m[39mthisCommandLine[0m[1;39m)[0m[39m,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:                        localTimeoutMillis, maxStdOut, maxStdErr[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:                outFile = [0m[1;35mFiles.createTempFile[0m[1;39m([0m[32m"tika-external2-"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:                result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mnew [0m                              [2m                [0m
[2;36m                    [0m         [1;35mProcessBuilder[0m[1;39m([0m[39mthisCommandLine[0m[1;39m)[0m[39m,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:                        localTimeoutMillis, outFile, maxStdErr[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.IS_TIMEOUT, [0m[1;35mresult.isTimeout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.EXIT_VALUE, [0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT_LENGTH, [0m                       [2m                [0m
[2;36m                    [0m         [1;35mresult.getStdoutLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT_IS_TRUNCATED,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:                    [0m[1;35mresult.isStdoutTruncated[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR_LENGTH, [0m                       [2m                [0m
[2;36m                    [0m         [1;35mresult.getStderrLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR_IS_TRUNCATED,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:                    [0m[1;35mresult.isStderrTruncated[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mreturnStdout[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT, [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            if [0m[1;39m([0m[39mreturnStderr[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR, [0m[1;35mresult.getStderr[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:            XHTMLContentHandler xhtml = new [0m[1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, [0m       [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mxhtml.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:            [0m[1;35mhandleOutput[0m[1;39m([0m[39mresult, outFile, xhtml, metadata, context[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mxhtml.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:            if [0m[1;39m([0m[39moutFile != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:                [0m[1;35mFiles.delete[0m[1;39m([0m[39moutFile[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1079[0m[39m-[0m[1;36m1092[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1079[0m[39m:    private class FileEmbeddedDocumentExtractor implements [0m                    [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentExtractor [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:19[0m[39m-[0m[1;36m109[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.File;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.FileInputStream;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.FileOutputStream;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.io.OutputStream;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.io.OutputStreamWriter;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.io.PrintStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.io.PrintWriter;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.io.Serializable;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.io.UnsupportedEncodingException;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.io.Writer;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.lang.reflect.Field;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.net.URI;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import java.util.Comparator;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import java.util.Map.Entry;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import java.util.TreeSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import javax.xml.transform.OutputKeys;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import javax.xml.transform.TransformerConfigurationException;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import javax.xml.transform.sax.SAXTransformerFactory;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import javax.xml.transform.sax.TransformerHandler;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import javax.xml.transform.stream.StreamResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:import org.apache.logging.log4j.Level;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:import org.xml.sax.helpers.DefaultHandler;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:import org.apache.tika.Tika;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:import org.apache.tika.async.cli.TikaAsyncCLI;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:import org.apache.tika.config.TikaConfig;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:import org.apache.tika.config.TikaConfigSerializer;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:import org.apache.tika.detect.CompositeDetector;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:import org.apache.tika.detect.Detector;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:import org.apache.tika.extractor.DefaultEmbeddedStreamTranslator;[0m                [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentExtractor;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:import org.apache.tika.extractor.EmbeddedStreamTranslator;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:import org.apache.tika.fork.ForkParser;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:import org.apache.tika.gui.TikaGUI;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:import org.apache.tika.language.detect.LanguageHandler;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:import org.apache.tika.mime.MediaTypeRegistry;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:import org.apache.tika.mime.MimeType;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:import org.apache.tika.mime.MimeTypeException;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:import org.apache.tika.mime.MimeTypes;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:import org.apache.tika.parser.AutoDetectParser;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:import org.apache.tika.parser.CompositeParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:import org.apache.tika.parser.DigestingParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:import org.apache.tika.parser.NetworkParser;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:import org.apache.tika.parser.Parser;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:import org.apache.tika.parser.ParserDecorator;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:import org.apache.tika.parser.PasswordProvider;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:import org.apache.tika.parser.RecursiveParserWrapper;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:import org.apache.tika.parser.digestutils.CommonsDigester;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:import org.apache.tika.parser.pdf.PDFParserConfig;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:import org.apache.tika.sax.BasicContentHandlerFactory;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:import org.apache.tika.sax.BodyContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:import org.apache.tika.sax.ContentHandlerFactory;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:import org.apache.tika.sax.ExpandedTitleContentHandler;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:import org.apache.tika.sax.RecursiveParserWrapperHandler;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:import org.apache.tika.sax.WriteOutContentHandler;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:import org.apache.tika.sax.boilerpipe.BoilerpipeContentHandler;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:import org.apache.tika.serialization.JsonMetadata;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:import org.apache.tika.serialization.JsonMetadataList;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:import org.apache.tika.xmp.XMPMetadata;[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/DefaultDetector.jav[0m[1;92ma:40[0m[39m-[0m[1;36m110[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:public class DefaultDetector extends CompositeDetector [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private static final long serialVersionUID = -8170114575326908027L;[0m          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    private transient final ServiceLoader loader;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader,[0m                [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:                           Collection<Class<? extends Detector>> [0m                [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        [0m[1;35msuper[0m[1;39m([0m[1;35mtypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mtypes, loader, [0m  [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        this.loader = loader;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, loader, Collections.EMPTY_SET[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[39mloader[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[39m, loader[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * Finds all statically loadable detectors and sort the list by name,[0m        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     * rather than discovery order. Detectors are used in the given order,[0m       [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     * so put the Tika parsers last so that non-Tika [0m[1;39m([0m[39muser supplied[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * parsers can take precedence.[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * If an [0m[1;39m{[0m[39m@link OverrideDetector[0m[1;39m}[0m[39m is loaded, it takes precedence over[0m        [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * all other detectors.[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * @param loader service loader[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * @return ordered list of statically loadable detectors[0m                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    private static List<Detector> [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mMimeTypes types, [0m          [2m                [0m
[2;36m                    [0m         [39mServiceLoader loader,[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                                                      Collection<Class<? extends[0m [2m                [0m
[2;36m                    [0m         [39mDetector>>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                                              excludeDetectors[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        List<Detector> detectors =[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                [0m[1;35mloader.loadStaticServiceProviders[0m[1;39m([0m[39mDetector.class, [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;35mServiceLoaderUtils.sortLoadedClasses[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        [0m[35m/[0m[35m/[0m[95mlook[0m[39m for the override index and put that first[0m                         [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        int overrideIndex = [0m[1;36m-1[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        int i = [0m[1;36m0[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        for [0m[1;39m([0m[39mDetector detector : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            if [0m[1;39m([0m[39mdetector instanceof OverrideDetector[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                overrideIndex = i;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:                break;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            i++;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        if [0m[1;39m([0m[39moverrideIndex > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Detector detector = [0m[1;35mdetectors.remove[0m[1;39m([0m[39moverrideIndex[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35mdetectors.add[0m[1;39m([0m[1;36m0[0m[39m, detector[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[35m/[0m[35m/[0m[39m Finally the Tika MimeTypes as a fallback[0m                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        [0m[1;35mdetectors.add[0m[1;39m([0m[39mtypes[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        return detectors;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:46[0m[39m-[0m[1;36m111[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector:[0m[1;36m1[0m[39m-[0m[1;36m16[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:#  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:#  contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:#  this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:#  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:#  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:#  the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:#       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:#  Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:#  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:#  See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:#  limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:org.apache.tika.detect.ShellCodeDetector[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m18[0m[39m-[0m[1;36m30[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:<properties>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:654[0m[39m-[0m[1;36m788[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m654[0m[39m:    private static abstract class XmlLoader<CT, T> [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m655[0m[39m:        protected static final String PARAMS_TAG_NAME = [0m[32m"params"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m656[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m657[0m[39m:        abstract boolean [0m[1;35msupportsComposite[0m[1;39m([0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m658[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m659[0m[39m:        abstract String [0m[1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m eg parsers[0m                       [2m                [0m
[2;36m                    [0m         [1;36m660[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m661[0m[39m:        abstract String [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m eg parser[0m                        [2m                [0m
[2;36m                    [0m         [1;36m662[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m663[0m[39m:        abstract Class<? extends T> [0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m; [0m[35m/[0m[35m/[0m[39m Generics workaround[0m    [2m                [0m
[2;36m                    [0m         [1;36m664[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m665[0m[39m:        abstract boolean [0m[1;35misComposite[0m[1;39m([0m[39mT loaded[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m666[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m667[0m[39m:        abstract boolean [0m[1;35misComposite[0m[1;39m([0m[39mClass<? extends T> loadedClass[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m668[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m669[0m[39m:        abstract T [0m[1;35mpreLoadOne[0m[1;39m([0m[39mClass<? extends T> loadedClass, String classname,[0m [2m                [0m
[2;36m                    [0m         [39mMimeTypes mimeTypes[0m[1;39m)[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m670[0m[39m:                throws TikaException;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m671[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m672[0m[39m:        abstract CT [0m[1;35mcreateDefault[0m[1;39m([0m[39mMimeTypes mimeTypes, ServiceLoader loader[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m673[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m674[0m[39m:        abstract CT [0m[1;35mcreateComposite[0m[1;39m([0m[39mList<T> loaded, MimeTypes mimeTypes, [0m       [2m                [0m
[2;36m                    [0m         [39mServiceLoader loader[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m675[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m676[0m[39m:        abstract T [0m[1;35mcreateComposite[0m[1;39m([0m[39mClass<? extends T> compositeClass, List<T> [0m  [2m                [0m
[2;36m                    [0m         [39mchildren,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m677[0m[39m:                                   Set<Class<? extends T>> excludeChildren,[0m     [2m                [0m
[2;36m                    [0m         [1;36m678[0m[39m:                                   Map<String, Param> params, MimeTypes [0m        [2m                [0m
[2;36m                    [0m         [39mmimeTypes,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m679[0m[39m:                                   ServiceLoader loader[0m[1;39m)[0m                        [2m                [0m
[2;36m                    [0m         [1;36m680[0m[39m:                throws InvocationTargetException, IllegalAccessException, [0m      [2m                [0m
[2;36m                    [0m         [39mInstantiationException;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m681[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m682[0m[39m:        abstract T [0m[1;35mdecorate[0m[1;39m([0m[39mT created, Element element[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [1;36m683[0m[39m:                throws IOException, TikaException; [0m[35m/[0m[35m/[0m[39m eg explicit mime types[0m    [2m                [0m
[2;36m                    [0m         [1;36m684[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m685[0m[39m:        @[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unchecked"[0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m686[0m[39m:        CT [0m[1;35mloadOverall[0m[1;39m([0m[39mElement element, MimeTypes mimeTypes, ServiceLoader [0m     [2m                [0m
[2;36m                    [0m         [39mloader[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m687[0m[39m:                throws TikaException, IOException [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m688[0m[39m:            List<T> loaded = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m689[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m690[0m[39m:            [0m[35m/[0m[35m/[0m[39m Find the children of the parent tag, if any[0m                      [2m                [0m
[2;36m                    [0m         [1;36m691[0m[39m:            for [0m[1;39m([0m[39mElement le : [0m[1;35mgetTopLevelElementChildren[0m[1;39m([0m[39melement, [0m              [2m                [0m
[2;36m                    [0m         [1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m,[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m692[0m[39m:                    [0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m693[0m[39m:                T loadedChild = [0m[1;35mloadOne[0m[1;39m([0m[39mle, mimeTypes, loader[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m694[0m[39m:                if [0m[1;39m([0m[39mloadedChild != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m695[0m[39m:                    [0m[1;35mloaded.add[0m[1;39m([0m[39mloadedChild[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m696[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m697[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m698[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m699[0m[39m:            [0m[35m/[0m[35m/[0m[39m Build the classes, and wrap as needed[0m                            [2m                [0m
[2;36m                    [0m         [1;36m700[0m[39m:            if [0m[1;39m([0m[1;35mloaded.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m701[0m[39m:                [0m[35m/[0m[35m/[0m[39m Nothing defined, create a Default[0m                            [2m                [0m
[2;36m                    [0m         [1;36m702[0m[39m:                return [0m[1;35mcreateDefault[0m[1;39m([0m[39mmimeTypes, loader[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m703[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35mloaded.size[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m704[0m[39m:                T single = [0m[1;35mloaded.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m705[0m[39m:                if [0m[1;39m([0m[1;35misComposite[0m[1;39m([0m[39msingle[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m706[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Single Composite defined, use that[0m                       [2m                [0m
[2;36m                    [0m         [1;36m707[0m[39m:                    return [0m[1;39m([0m[39mCT[0m[1;39m)[0m[39m single;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m708[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m709[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39m![0m[1;35msupportsComposite[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m710[0m[39m:                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                                  [2m                [0m
[2;36m                    [0m         [1;36m711[0m[39m:                        [0m[32m"Composite not supported for "[0m[39m + [0m[1;35mgetParentTagName[0m[1;39m([0m[1;39m)[0m[39m +[0m   [2m                [0m
[2;36m                    [0m         [1;36m712[0m[39m:                                [0m[32m". Must specify only one child!"[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m713[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m714[0m[39m:            [0m[35m/[0m[35m/[0m[39m Wrap the defined parsers/detectors up in a Composite[0m             [2m                [0m
[2;36m                    [0m         [1;36m715[0m[39m:            return [0m[1;35mcreateComposite[0m[1;39m([0m[39mloaded, mimeTypes, loader[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m716[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m717[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m718[0m[39m:        T [0m[1;35mloadOne[0m[1;39m([0m[39mElement element, MimeTypes mimeTypes, ServiceLoader loader[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [1;36m719[0m[39m:                throws TikaException, IOException [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m720[0m[39m:            String name = [0m[1;35melement.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m721[0m[39m:            if [0m[1;39m([0m[1;35mname.isBlank[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m722[0m[39m:                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[32m"class attribute must not be [0m     [2m                [0m
[2;36m                    [0m         [32mempty: "[0m[39m + element[0m[1;39m)[0m[39m;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m723[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m724[0m[39m:            String initProbHandler = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35melement.getAttribute[0m[1;39m([0m[32m"initializableProblemHandler"[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m725[0m[39m:            InitializableProblemHandler initializableProblemHandler;[0m            [2m                [0m
[2;36m                    [0m         [1;36m726[0m[39m:            if [0m[1;39m([0m[1;35minitProbHandler.isBlank[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m727[0m[39m:                initializableProblemHandler = [0m                                  [2m                [0m
[2;36m                    [0m         [1;35mloader.getInitializableProblemHandler[0m[1;39m([0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m728[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m729[0m[39m:                initializableProblemHandler = [0m                                  [2m                [0m
[2;36m                    [0m         [1;35mgetInitializableProblemHandler[0m[1;39m([0m[39minitProbHandler[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m730[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m731[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m732[0m[39m:            T loaded;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m733[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m734[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m735[0m[39m:                Class<? extends T> loadedClass = [0m                               [2m                [0m
[2;36m                    [0m         [1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, name[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m736[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m737[0m[39m:                [0m[35m/[0m[35m/[0m[39m Do pre-load checks and short-circuits[0m                        [2m                [0m
[2;36m                    [0m         [1;36m738[0m[39m:                [0m[35m/[0m[35m/[0m[95mTODO[0m[39m : allow duplicate instances with different [0m              [2m                [0m
[2;36m                    [0m         [39mconfigurations[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m739[0m[39m:                loaded = [0m[1;35mpreLoadOne[0m[1;39m([0m[39mloadedClass, name, mimeTypes[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m740[0m[39m:                if [0m[1;39m([0m[39mloaded != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m741[0m[39m:                    return loaded;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m742[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m743[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m744[0m[39m:                [0m[35m/[0m[35m/[0m[39m Get any parameters [0m[35m/[0m[39m settings for the parser[0m                 [2m                [0m
[2;36m                    [0m         [1;36m745[0m[39m:                Map<String, Param> params = null;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m746[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m747[0m[39m:                    params = [0m[1;35mgetParams[0m[1;39m([0m[39melement[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m748[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m749[0m[39m:                    throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m750[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m751[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m752[0m[39m:                [0m[35m/[0m[35m/[0m[39m Is this a composite or decorated class? If so, support [0m      [2m                [0m
[2;36m                    [0m         [39mrecursion[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m753[0m[39m:                if [0m[1;39m([0m[1;35misComposite[0m[1;39m([0m[39mloadedClass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m754[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the child objects for it[0m                             [2m                [0m
[2;36m                    [0m         [1;36m755[0m[39m:                    List<T> children = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m756[0m[39m:                    NodeList childNodes = [0m                                      [2m                [0m
[2;36m                    [0m         [1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m757[0m[39m:                    if [0m[1;39m([0m[1;35mchildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m758[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mchildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m759[0m[39m:                            T loadedChild =[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m760[0m[39m:                                    [0m[1;35mloadOne[0m[1;39m([0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mchildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mmimeTypes, loader[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m761[0m[39m:                            if [0m[1;39m([0m[39mloadedChild != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m762[0m[39m:                                [0m[1;35mchildren.add[0m[1;39m([0m[39mloadedChild[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m763[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m764[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m765[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m766[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m767[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the list of children to exclude[0m                      [2m                [0m
[2;36m                    [0m         [1;36m768[0m[39m:                    Set<Class<? extends T>> excludeChildren = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m769[0m[39m:                    NodeList excludeChildNodes =[0m                                [2m                [0m
[2;36m                    [0m         [1;36m770[0m[39m:                            [0m[1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m  [2m                [0m
[2;36m                    [0m         [32m"-exclude"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m771[0m[39m:                    if [0m[1;39m([0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m772[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m773[0m[39m:                            Element excl = [0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mexcludeChildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m774[0m[39m:                            String exclName = [0m[1;35mexcl.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m775[0m[39m:                            try [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m776[0m[39m:                                excludeChildren[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m777[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.add[0m[1;39m([0m[1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, exclName[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m778[0m[39m:                            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mClassNotFoundException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m779[0m[39m:                                [0m[35m/[0m[35m/[0m[95mTIKA-3268[0m[39m -- This should stop the world.[0m      [2m                [0m
[2;36m                    [0m         [1;36m780[0m[39m:                                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                  [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:                                        [0m[32m"Class not found in -exclude list: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mexclName[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Create the Composite[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:                    loaded = [0m[1;35mcreateComposite[0m[1;39m([0m[39mloadedClass, children, [0m            [2m                [0m
[2;36m                    [0m         [39mexcludeChildren, params,[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:                            mimeTypes, loader[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy for OS Command Injection Vulnerability in ShellCodeDetector[0m         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m1[0m[39m. Root Cause Analysis[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe vulnerability stems from **ShellCodeDetector executing untrusted file content [0m  [2m                [0m
[2;36m                    [0m         [39mas OS commands during the detection phase**. Specifically:[0m                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- **Line [0m[1;36m100[0m[39m**: `ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;` - Creates a [0m    [2m                [0m
[2;36m                    [0m         [39mprocess with user-controlled filename as the command[0m                                [2m                [0m
[2;36m                    [0m         [39m- **Line [0m[1;36m99[0m[39m**: `[0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, [0m                                 [2m                [0m
[2;36m                    [0m         [39mStandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;` - Copies attacker-controlled content to temp[0m [2m                [0m
[2;36m                    [0m         [39mfile[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m- **Line [0m[1;36m103[0m[39m**: `[0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m[1;36m100000[0m[1;39m)[0m[39m;` - Executes the [0m  [2m                [0m
[2;36m                    [0m         [39mfile[0m                                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mEven with sanitization [0m[1;39m([0m[39mlines [0m[1;36m90[0m[39m-[0m[1;36m91[0m[1;39m)[0m[39m, the filename can be legitimate command names [0m [2m                [0m
[2;36m                    [0m         [39mlike [0m[32m"bash"[0m[39m, [0m[32m"sh"[0m[39m, [0m[32m"python"[0m[39m, etc., which when executed will run the malicious file [0m [2m                [0m
[2;36m                    [0m         [39mcontent.[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Architectural Violation**: Detectors should perform passive analysis only. [0m       [2m                [0m
[2;36m                    [0m         [39mExecuting code during detection violates security principles, as it occurs before [0m  [2m                [0m
[2;36m                    [0m         [39many security context is established.[0m                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m2[0m[39m. Fix Strategy[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mI will implement a **multi-layered approach** that removes the command execution [0m   [2m                [0m
[2;36m                    [0m         [39mfrom ShellCodeDetector while preserving shell script detection capabilities:[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m#### Step [0m[1;36m1[0m[39m: Modify ShellCodeDetector to Remove Command Execution[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**File**: `tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java`[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Changes**:[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Remove all code related to command execution [0m[1;39m([0m[39mlines [0m[1;36m87[0m[39m-[0m[1;36m109[0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Keep only passive detection logic:[0m                                               [2m                [0m
[2;36m                    [0m         [39m   - File extension check [0m[1;39m([0m[39m.sh, .bash[0m[1;39m)[0m[39m - lines [0m[1;36m56[0m[39m-[0m[1;36m62[0m                                [2m                [0m
[2;36m                    [0m         [39m   - Shebang detection [0m[1;39m([0m[39m#![0m[35m/[0m[1;39m)[0m[39m - lines [0m[1;36m67[0m[39m-[0m[1;36m79[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Remove the SHELL_NO_ARGS property functionality since it requires execution[0m      [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Return SHELL_SCRIPT MediaType based solely on passive indicators[0m                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Rationale**: This preserves the shell script detection capability while [0m          [2m                [0m
[2;36m                    [0m         [39mcompletely eliminating the command injection vulnerability. The detector will still[0m [2m                [0m
[2;36m                    [0m         [39midentify shell scripts correctly through passive analysis of file extensions and [0m   [2m                [0m
[2;36m                    [0m         [39mshebangs.[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m#### Step [0m[1;36m2[0m[39m: Remove ShellCodeDetector from Default Service Provider Registration [0m   [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mOptional but Recommended[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**File**: [0m                                                                          [2m                [0m
[2;36m                    [0m         [39m`tika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector`[0m    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Changes**:[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m- Comment out or remove line [0m[1;36m16[0m[39m: `org.apache.tika.detect.ShellCodeDetector`[0m         [2m                [0m
[2;36m                    [0m         [39m- Add a comment explaining the security rationale[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Rationale**: Even with the execution removed, explicitly excluding it from [0m       [2m                [0m
[2;36m                    [0m         [39mauto-loading provides defense-in-depth. However, this is optional if Step [0m[1;36m1[0m[39m is [0m     [2m                [0m
[2;36m                    [0m         [39mimplemented, as the modified detector poses no security risk.[0m                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m3[0m[39m. Implementation Details[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m#### Detailed Patch for [0m[1;35mShellCodeDetector.detect[0m[1;39m([0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe modified [0m[1;35mdetect[0m[1;39m([0m[1;39m)[0m[39m method should:[0m                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39mLines [0m[1;36m54[0m[39m-[0m[1;36m86[0m[39m: Keep as-is [0m[1;39m([0m[39mpassive detection of shell script indicators[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39mLines [0m[1;36m87[0m[39m-[0m[1;36m110[0m[39m: Replace with:[0m                                                         [2m                [0m
[2;36m                    [0m         [39m- Return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m directly[0m                                                  [2m                [0m
[2;36m                    [0m         [39m- Remove all ProcessBuilder, ProcessUtils.execute, file copying logic[0m               [2m                [0m
[2;36m                    [0m         [39m- Remove the SHELL_NO_ARGS metadata setting[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Specific changes**:[0m                                                               [2m                [0m
[2;36m                    [0m         [39m- Remove imports no longer needed: `TikaInputStream`, file operations imports [0m      [2m                [0m
[2;36m                    [0m         [39mrelated to temp file creation[0m                                                       [2m                [0m
[2;36m                    [0m         [39m- Remove the SHELL_NO_ARGS property constant [0m[1;39m([0m[39mline [0m[1;36m48[0m[1;39m)[0m[39m as it can no longer be [0m      [2m                [0m
[2;36m                    [0m         [39mdetermined without execution[0m                                                        [2m                [0m
[2;36m                    [0m         [39m- The [0m[1;35misShell[0m[1;39m([0m[1;39m)[0m[39m helper method [0m[1;39m([0m[39mlines [0m[1;36m113[0m[39m-[0m[1;36m118[0m[1;39m)[0m[39m remains unchanged[0m                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m#### What Logic Must Be Preserved[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Must Keep**:[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. File extension checking [0m[1;39m([0m[39mlines [0m[1;36m56[0m[39m-[0m[1;36m62[0m[1;39m)[0m[39m - identifies .sh and .bash files[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Shebang detection [0m[1;39m([0m[39mlines [0m[1;36m67[0m[39m-[0m[1;36m79[0m[1;39m)[0m[39m - reads first [0m[1;36m4[0m[39m bytes to check for #![0m[35m/[0m           [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Input stream mark/reset handling [0m[1;39m([0m[39mlines [0m[1;36m68[0m[39m, [0m[1;36m78[0m[1;39m)[0m[39m - ensures stream is not consumed[0m [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. EOFException handling [0m[1;39m([0m[39mlines [0m[1;36m75[0m[39m-[0m[1;36m76[0m[1;39m)[0m[39m - gracefully handles short files[0m             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Return value logic - MediaType.OCTET_STREAM for non-shell files, SHELL_SCRIPT [0m   [2m                [0m
[2;36m                    [0m         [39mfor shell files[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Must Remove**:[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. All file execution logic [0m[1;39m([0m[39mlines [0m[1;36m87[0m[39m-[0m[1;36m109[0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. TikaInputStream wrapping for execution [0m[1;39m([0m[39mline [0m[1;36m88[0m[1;39m)[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Filename sanitization for command execution [0m[1;39m([0m[39mlines [0m[1;36m89[0m[39m-[0m[1;36m95[0m[1;39m)[0m                        [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Temporary directory and file creation [0m[1;39m([0m[39mlines [0m[1;36m96[0m[39m-[0m[1;36m99[0m[1;39m)[0m                              [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. ProcessBuilder instantiation and execution [0m[1;39m([0m[39mlines [0m[1;36m100[0m[39m-[0m[1;36m103[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. SHELL_NO_ARGS metadata setting [0m[1;39m([0m[39mlines [0m[1;36m104[0m[39m-[0m[1;36m106[0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. Cleanup of temporary directories [0m[1;39m([0m[39mline [0m[1;36m108[0m[1;39m)[0m                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m4[0m[39m. Justification[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Why This is the Optimal Approach**:[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Complete Security Fix**: Eliminates all command execution, removing the attack[0m [2m                [0m
[2;36m                    [0m         [39mvector entirely[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Preserves Core Functionality**: Shell script detection still works through [0m    [2m                [0m
[2;36m                    [0m         [39mpassive analysis[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **No Breaking Changes to Detection API**: The detector still returns the correct[0m [2m                [0m
[2;36m                    [0m         [39mMediaType[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Minimal Code Changes**: Only removes the vulnerable code path, doesn't [0m        [2m                [0m
[2;36m                    [0m         [39mrestructure the class[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **No Impact on Other Components**: ProcessUtils, CompositeDetector, [0m             [2m                [0m
[2;36m                    [0m         [39mDefaultDetector all remain unchanged[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. **Follows Security Best Practices**: Detectors should never execute code; this [0m  [2m                [0m
[2;36m                    [0m         [39maligns the implementation with security principles[0m                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Why Passive Detection is Sufficient**:[0m                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- File extensions [0m[1;39m([0m[39m.sh, .bash[0m[1;39m)[0m[39m are reliable indicators for most use cases[0m           [2m                [0m
[2;36m                    [0m         [39m- Shebang detection [0m[1;39m([0m[39m#![0m[35m/bin/[0m[95msh[0m[39m, #![0m[35m/bin/[0m[95mbash[0m[1;39m)[0m[39m identifies scripts without extensions[0m  [2m                [0m
[2;36m                    [0m         [39m- The SHELL_NO_ARGS property was a [0m[32m"nice-to-have"[0m[39m feature, not essential for [0m       [2m                [0m
[2;36m                    [0m         [39mdocument processing[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m- Users who need advanced shell script analysis can implement custom parsers with [0m  [2m                [0m
[2;36m                    [0m         [39mproper security controls[0m                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**How it Preserves Existing Logic**:[0m                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- All non-execution detection logic remains intact[0m                                  [2m                [0m
[2;36m                    [0m         [39m- The method signature and return types are unchanged[0m                               [2m                [0m
[2;36m                    [0m         [39m- Integration with CompositeDetector and DefaultDetector works identically[0m          [2m                [0m
[2;36m                    [0m         [39m- Existing tests for passive detection will continue to pass[0m                        [2m                [0m
[2;36m                    [0m         [39m- Only tests specifically checking SHELL_NO_ARGS property would need updates[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Addressing Potential Side Effects**:[0m                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **SHELL_NO_ARGS property no longer set**: This feature is lost, but it's [0m        [2m                [0m
[2;36m                    [0m         [39macceptable as it required unsafe command execution[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Detection accuracy unchanged**: Passive indicators [0m[1;39m([0m[39mextension + shebang[0m[1;39m)[0m[39m [0m      [2m                [0m
[2;36m                    [0m         [39mprovide sufficient accuracy[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Performance improvement**: Removing execution actually improves performance by[0m [2m                [0m
[2;36m                    [0m         [39meliminating process spawning overhead[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Test updates needed**: Tests checking for SHELL_NO_ARGS should be updated to [0m  [2m                [0m
[2;36m                    [0m         [39mreflect the new behavior[0m                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m5[0m[39m. Similar Patterns in Codebase[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe modified approach aligns with other safe detectors in Tika:[0m                     [2m                [0m
[2;36m                    [0m         [39m- **MimeTypes detector**: Pure content-based detection without execution[0m            [2m                [0m
[2;36m                    [0m         [39m- **MagicDetector**: Reads file headers only, no execution[0m                          [2m                [0m
[2;36m                    [0m         [39m- **NameDetector**: Extension-based detection only[0m                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis contrasts with parsers like **GDALParser** and **ExternalParser** which:[0m       [2m                [0m
[2;36m                    [0m         [39m- Execute external tools but do so in the **parsing phase** [0m[1;39m([0m[39mnot detection[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m- Use **configured tool paths** [0m[1;39m([0m[39mnot user-controlled commands[0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m         [39m- Implement **safety checks** [0m[1;39m([0m[1;35mExternalParser.check[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m before execution[0m             [2m                [0m
[2;36m                    [0m         [39m- Are **opt-in** and configurable, not auto-loaded for all files[0m                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m6[0m[39m. Testing Considerations[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAfter applying the fix:[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Security Tests**: Verify that crafted shell scripts cannot trigger command [0m    [2m                [0m
[2;36m                    [0m         [39mexecution[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Functional Tests**: Ensure shell script detection still works via extension [0m   [2m                [0m
[2;36m                    [0m         [39mand shebang[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Integration Tests**: Verify PackageParser and TikaCLI work correctly with [0m     [2m                [0m
[2;36m                    [0m         [39mmodified detector[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Regression Tests**: Ensure no other detectors or parsers are affected[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix is surgical and focused, modifying only the vulnerable ShellCodeDetector [0m   [2m                [0m
[2;36m                    [0m         [39mclass without touching the core detection infrastructure, utility functions, or [0m    [2m                [0m
[2;36m                    [0m         [39mother components.[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/06/26 01:26:37][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=652595;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=382780;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=330420;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=566163;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpuwtkq2hi[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-full-01_vuln_8/[0m[95magent-[0m [2m               [0m
[2;36m                    [0m         [95moutput-1767662797.038435[0m                                                             [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/tika_tk-full-01_vuln_8.toml             [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/06/26 01:26:39][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/user/crete/.cache/environments/[0m[95mtika[0m           ]8;id=609201;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=762820;file:///home/user/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=173214;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=562155;file:///home/user/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=521381;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=16412;file:///home/user/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
