[2;36m[01/05/26 11:32:56][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=299003;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=647689;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpwaxcqvse[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/apache-poi_poi-full-01_vuln_1[0m [2m               [0m
[2;36m                    [0m         [35m/[0m[95magent-output-1767612776.0202281[0m                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/apache-poi_poi-full-01_vuln_1.toml      [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-poi[0m              [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Building Cached for CLEAN environment[1m)[0m        ]8;id=976689;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=995314;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m[01/05/26 11:35:41][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Building Cached for CLEAN environment[1m)[0m Took  ]8;id=873086;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=305574;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [1;36m165.74[0m seconds; [33mexception[0m=[3;91mFalse[0m                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running tests for Cached for CLEAN            ]8;id=918829;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=560052;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         environment[1m)[0m Started[33m...[0m                                                        [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running tests for Cached for CLEAN           ]8;id=672049;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=902204;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         environment[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=825599;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=537726;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m165[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=917547;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=441559;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:35:42][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m1.05[0m seconds;            ]8;id=359764;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=32815;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/05/26 11:35:44][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=472884;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=889271;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=614420;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=720006;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=996090;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=85833;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=950098;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=502460;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:35:45][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m1.35[0m seconds;            ]8;id=577844;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=996288;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/05/26 11:35:46][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=147464;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=384639;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:35:47][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.91[0m seconds;            ]8;id=27064;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=94908;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/05/26 11:35:53][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=428735;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=383339;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of  [2m                [0m
[2;36m                    [0m         memory [1m([0muse [32m'-Xmx921m'[0m to reproduce[1m)[0m                                                [2m                [0m
[2;36m                    [0m         Caused by: java.lang.OutOfMemoryError: Java heap space                              [2m                [0m
[2;36m                    [0m                 at java.base/java.lang.String.[1m<[0m[1;95minit[0m[39m>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04800.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04000.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init[0m[1m>[0m[1m([0mHMEFMessage.jav[1;92ma:72[0m[1m)[0m              [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1m([0mPOIHMEFFuzzer.jav[1;92ma:32[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$DMH/[1;35m0x0000000800cb8800.invokeStaticInit[0m[1m([0mLambd [2m                [0m
[2;36m                    [0m         aForm$DMH[1m)[0m                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$MH/[1;35m0x0000000800d04800.invoke[0m[1m([0mLambdaForm$MH[1m)[0m   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         java.base/java.lang.invoke.LambdaForm$MH/[1;35m0x0000000800d04000.invoke_MT[0m[1m([0mLambdaForm$MH [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: a36f54a5f0a295bd                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/05/26 11:36:17][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=536181;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=205839;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/05/26 11:40:26][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=372908;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=914516;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/05/26 11:41:01][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=87272;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=311939;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=481904;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=645063;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:41:02][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m1.02[0m seconds;            ]8;id=454826;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=243725;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/05/26 11:41:03][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Patching[1m)[0m Started[33m...[0m                          ]8;id=100737;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=254309;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpo3zsnnhg[0m                                                 ]8;id=342893;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=964544;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/05/26 11:43:13][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Patching[1m)[0m Took [1;36m130.56[0m seconds;               ]8;id=461258;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=571773;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Checking build[1m)[0m Started[33m...[0m                    ]8;id=683810;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=667649;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:43:50][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Checking build[1m)[0m Took [1;36m36.95[0m seconds;          ]8;id=663303;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=345059;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running PoV[1m)[0m Started[33m...[0m                       ]8;id=803357;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=259144;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:43:56][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Running PoV[1m)[0m Took [1;36m5.82[0m seconds;              ]8;id=94177;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=832710;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Testing[1m)[0m Started[33m...[0m                           ]8;id=153437;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=898657;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=156845;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=26197;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=188251;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=802209;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:43:57][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.85[0m seconds;            ]8;id=210441;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=763202;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m[01/05/26 11:43:58][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=449160;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=124676;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:43:59][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.84[0m seconds;            ]8;id=622637;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=399468;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Started[33m...[0m                     ]8;id=364109;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=178654;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/05/26 11:44:00][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mapache-poi Setting owner[1m)[0m Took [1;36m0.94[0m seconds;            ]8;id=110301;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=253488;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=784233;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=515266;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java [2m                [0m
[2;36m                    [0m         +++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java [2m                [0m
[2;36m                    [0m         @@ [1;36m-168[0m,[1;36m7[0m +[1;36m168[0m,[1;36m7[0m @@                                                                 [2m                [0m
[2;36m                    [0m                            if [1m([0mmplen [1m<[0m[39m [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [39m                      throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m    [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m                   [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m-                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m+                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mmplen, [0m                   [2m                [0m
[2;36m                    [0m         [39mMAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m                   if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [39m                      throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen + [0m[32m" [0m [2m                [0m
[2;36m                    [0m         [32mbytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                         [2m                [0m
[2;36m                    [0m         [39m                   [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===Patch [0m[33mResult[0m[39m===[0m                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m===[0m[33mIssue[0m[39m===[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04800.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04000.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m===Evaluation [0m[33mReport[0m[39m===[0m                                                             [2m                [0m
[2;36m                    [0m         [39m# Evaluation Report[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Summary[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAn Out of Memory [0m[1;39m([0m[39mOOM[0m[1;39m)[0m[39m error occurs in the Apache POI library when processing HMEF [0m [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mTNEF[0m[1;39m)[0m[39m message files. The fuzzer discovered an input that causes the application to[0m [2m                [0m
[2;36m                    [0m         [39mexhaust the Java heap space [0m[1;39m([0m[39m921MB[0m[1;39m)[0m[39m, triggering a `java.lang.OutOfMemoryError` [0m     [2m                [0m
[2;36m                    [0m         [39mduring string creation from Unicode data. The error propagates through the HMEF [0m    [2m                [0m
[2;36m                    [0m         [39mmessage processing pipeline, specifically during MAPI attribute creation.[0m           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Description[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Issue Overview[0m                                                                  [2m                [0m
[2;36m                    [0m         [39mThe issue manifests as a `FuzzerSecurityIssueLow` with an underlying [0m               [2m                [0m
[2;36m                    [0m         [39m`java.lang.OutOfMemoryError: Java heap space` exception. This occurs during the [0m    [2m                [0m
[2;36m                    [0m         [39mparsing and processing of HMEF [0m[1;39m([0m[39mMicrosoft TNEF format[0m[1;39m)[0m[39m messages in the Apache POI [0m  [2m                [0m
[2;36m                    [0m         [39mlibrary. The fuzzer identified a specific input that consistently reproduces this [0m  [2m                [0m
[2;36m                    [0m         [39mmemory exhaustion condition with a heap size of 921MB.[0m                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Vulnerability Type[0m                                                              [2m                [0m
[2;36m                    [0m         [39mThis represents a resource exhaustion vulnerability, specifically a [0m                [2m                [0m
[2;36m                    [0m         [39mdenial-of-service [0m[1;39m([0m[39mDoS[0m[1;39m)[0m[39m condition caused by uncontrolled memory allocation. The [0m    [2m                [0m
[2;36m                    [0m         [39mfuzzer classifies it as a security issue of low severity, likely because it can [0m    [2m                [0m
[2;36m                    [0m         [39mcause application crashes or service unavailability when processing maliciously [0m    [2m                [0m
[2;36m                    [0m         [39mcrafted or malformed TNEF files.[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Stack Trace Analysis[0m                                                            [2m                [0m
[2;36m                    [0m         [39mThe exception stack trace reveals the following execution path:[0m                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Entry Point**: `[0m[1;35mPOIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[1;39m)[0m[39m` - The fuzzer harness that [0m [2m                [0m
[2;36m                    [0m         [39mfeeds input to the HMEF message processor[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Message Processing Chain**:[0m                                                    [2m                [0m
[2;36m                    [0m         [39m   - `HMEFMessage.<init>[0m[1;39m([0m[1;39m)[0m[39m` - Constructor initializing the HMEF message[0m             [2m                [0m
[2;36m                    [0m         [39m   - `[0m[1;35mHMEFMessage.process[0m[1;39m([0m[1;39m)[0m[39m` - Main processing method[0m                               [2m                [0m
[2;36m                    [0m         [39m   - `[0m[1;35mHMEFMessage.processMessage[0m[1;39m([0m[1;39m)[0m[39m` - Core message processing logic[0m                 [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Attribute Handling**:[0m                                                          [2m                [0m
[2;36m                    [0m         [39m   - `[0m[1;35mTNEFAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` - Creates TNEF attributes from the input[0m              [2m                [0m
[2;36m                    [0m         [39m   - `TNEFMAPIAttribute.<init>[0m[1;39m([0m[1;39m)[0m[39m` - Initializes MAPI attributes within TNEF[0m         [2m                [0m
[2;36m                    [0m         [39m   - `[0m[1;35mMAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` - Creates MAPI attribute objects[0m                      [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Failure Point**: `[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m` at line [0m[1;36m94[0m[39m, which calls [0m      [2m                [0m
[2;36m                    [0m         [39m`String.<init>[0m[1;39m([0m[1;39m)[0m[39m` where the OOM error occurs[0m                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Key Observations[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Memory Allocation in String Creation**: The OOM error occurs during string [0m    [2m                [0m
[2;36m                    [0m         [39mobject creation [0m[1;39m([0m[39m`java.lang.String.<init>[0m[1;39m([0m[1;39m)[0m[39m`[0m[1;39m)[0m[39m called from [0m                          [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m`, suggesting that the code attempts to allocate an [0m  [2m                [0m
[2;36m                    [0m         [39mexcessively large string from Unicode Little Endian encoded data.[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **MAPI Attribute Processing**: The error occurs specifically during MAPI [0m        [2m                [0m
[2;36m                    [0m         [39mattribute creation [0m[1;39m([0m[39m`[0m[1;35mMAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` at line [0m[1;36m175[0m[1;39m)[0m[39m, indicating that the [0m     [2m                [0m
[2;36m                    [0m         [39mproblematic data is likely within a MAPI attribute field in the TNEF file.[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Reproducible Condition**: The specific heap size requirement [0m[1;39m([0m[39m921MB[0m[1;39m)[0m[39m and the [0m  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN suggest this is a reproducible condition with a specific crafted input [0m [2m                [0m
[2;36m                    [0m         [39mpattern.[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Areas for Investigation[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mTo understand the full scope of this issue, the following components should be [0m     [2m                [0m
[2;36m                    [0m         [39mexamined:[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m94[0m[1;39m)[0m[39m: [0m                                    [2m                [0m
[2;36m                    [0m         [39m   - How does this method determine the length of the string to create?[0m             [2m                [0m
[2;36m                    [0m         [39m   - Is there any validation of the length parameter before allocation?[0m             [2m                [0m
[2;36m                    [0m         [39m   - What is the source of the length value?[0m                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **[0m[1;35mMAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m175[0m[1;39m)[0m[39m:[0m                                           [2m                [0m
[2;36m                    [0m         [39m   - How does it parse and extract string length information from the input?[0m        [2m                [0m
[2;36m                    [0m         [39m   - Are there bounds checks on attribute data sizes?[0m                               [2m                [0m
[2;36m                    [0m         [39m   - What validation occurs before calling StringUtil methods?[0m                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **TNEFMAPIAttribute and TNEFAttribute** [0m[1;39m([0m[39mlines [0m[1;36m41[0m[39m and [0m[1;36m86[0m[1;39m)[0m[39m:[0m                       [2m                [0m
[2;36m                    [0m         [39m   - How do these classes parse attribute headers and data sections?[0m                [2m                [0m
[2;36m                    [0m         [39m   - Is there validation of attribute length fields against available data?[0m         [2m                [0m
[2;36m                    [0m         [39m   - Are there sanity checks on attribute sizes?[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **[0m[1;35mHMEFMessage.processMessage[0m[1;39m([0m[1;39m)[0m[39m** [0m[1;39m([0m[39mline [0m[1;36m105[0m[1;39m)[0m[39m:[0m                                     [2m                [0m
[2;36m                    [0m         [39m   - What input validation occurs before processing attributes?[0m                     [2m                [0m
[2;36m                    [0m         [39m   - Are there global size limits or validation checks?[0m                             [2m                [0m
[2;36m                    [0m         [39m   - How does the parser handle potentially malformed length fields?[0m                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **Input Format Specification**:[0m                                                  [2m                [0m
[2;36m                    [0m         [39m   - TNEF file format specifications regarding MAPI attribute encoding[0m              [2m                [0m
[2;36m                    [0m         [39m   - Expected size limits for string attributes in TNEF/MAPI format[0m                 [2m                [0m
[2;36m                    [0m         [39m   - How length fields are encoded [0m[1;39m([0m[39me.g., [0m[1;36m16[0m[39m-bit, [0m[1;36m32[0m[39m-bit integers[0m[1;39m)[0m                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe investigation should focus on identifying where untrusted length values from [0m   [2m                [0m
[2;36m                    [0m         [39mthe input file are used to allocate memory without proper validation or bounds [0m     [2m                [0m
[2;36m                    [0m         [39mchecking, particularly in the string creation and attribute parsing code paths.[0m     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Initial Issue Log[0m                                                                [2m                [0m
[2;36m                    [0m         [39mHere is the initial issue log of the codebase:[0m                                      [2m                [0m
[2;36m                    [0m         [39m<issue>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueLow: Out of [0m [2m                [0m
[2;36m                    [0m         [39mmemory [0m[1;39m([0m[39muse [0m[32m'-Xmx921m'[0m[39m to reproduce[0m[1;39m)[0m                                                [2m                [0m
[2;36m                    [0m         [39mCaused by: java.lang.OutOfMemoryError: Java heap space[0m                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/java.lang.String.<init>[0m[1;39m([0m[39mString.jav[0m[1;92ma:657[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.util.StringUtil.getFromUnicodeLE[0m[1;39m([0m[39mStringUtil.jav[0m[1;92ma:94[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.MAPIAttribute.create[0m[1;39m([0m[39mMAPIAttribute.jav[0m[1;92ma:175[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.poi.hmef.attribute.TNEFMAPIAttribute.<init>[0m[1;39m([0m[39mTNEFMAPIAttribute.jav[0m[1;92ma:41[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.poi.hmef.attribute.TNEFAttribute.create[0m[1;39m([0m[39mTNEFAttribute.jav[0m[1;92ma:86[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.processMessage[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:105[0m[1;39m)[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.hmef.HMEFMessage.process[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:87[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.poi.hmef.HMEFMessage.<init>[0m[1;39m([0m[39mHMEFMessage.jav[0m[1;92ma:72[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.poi.POIHMEFFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mPOIHMEFFuzzer.jav[0m[1;92ma:32[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$DMH/[0m[1;35m0x0000000800cb8800.invokeStaticInit[0m[1;39m([0m[39mLambd[0m [2m                [0m
[2;36m                    [0m         [39maForm$DMH[0m[1;39m)[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04800.invoke[0m[1;39m([0m[39mLambdaForm$MH[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39mjava.base/java.lang.invoke.LambdaForm$MH/[0m[1;35m0x0000000800d04000.invoke_MT[0m[1;39m([0m[39mLambdaForm$MH[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: a36f54a5f0a295bd[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:70[0m[39m-[0m[1;36m95[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:     * @param len    the length of the final string[0m                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:     * @return the converted string, never [0m[1;39m{[0m[39m@code null[0m[1;39m}[0m[39m.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:     * @throws ArrayIndexOutOfBoundsException if offset is out of bounds for[0m     [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:     *                                        the byte array [0m[1;39m([0m[39mi.e., is negative [0m [2m                [0m
[2;36m                    [0m         [39mor is greater than or equal to[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:     *                                        string.length[0m[1;39m)[0m                     [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * @throws IllegalArgumentException       if len is too large [0m[1;39m([0m[39mi.e.,[0m         [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     *                                        there is not enough data in string[0m [2m                [0m
[2;36m                    [0m         [39mto create a String of that[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     *                                        length[0m[1;39m)[0m                            [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            final byte[0m[1;39m[[0m[1;39m][0m[39m string,[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            final int offset,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            final int len[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            throws ArrayIndexOutOfBoundsException, IllegalArgumentException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[39mlen == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[32m""[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39moffset < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[39moffset >= string.length[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:            throw new [0m[1;35mArrayIndexOutOfBoundsException[0m[1;39m([0m[32m"Illegal offset "[0m[39m + offset [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m" [0m[32m([0m[32mString data is of length "[0m[39m + string.length + [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39mlen < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[1;39m([0m[1;39m([0m[39mstring.length - offset[0m[1;39m)[0m[39m [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m < len[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Illegal length "[0m[39m + len[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mstring, offset, len * [0m[1;36m2[0m[39m, UTF16LE[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: * A pure-MAPI attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class MAPIAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:   private final MAPIProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:40[0m[39m-[0m[1;36m75[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:   private final TNEFProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private final int checksum;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    * @param length the max record length allowed for TNEFAttribute[0m              [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:      MAX_RECORD_LENGTH = length;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    * @return the max record length allowed for TNEFAttribute[0m                    [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:   public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:      return MAX_RECORD_LENGTH;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    * Constructs a single new attribute from the id, type,[0m                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    *  and the contents of the stream[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   protected [0m[1;35mTNEFAttribute[0m[1;39m([0m[39mint id, int type, InputStream inp[0m[1;39m)[0m[39m throws IOException[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:      this.type = type;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:      int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:      property = [0m[1;35mTNEFProperty.getBest[0m[1;39m([0m[39mid, type[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:      data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:      [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, data[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      checksum = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:160[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m77[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mmptype == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:                  [0m[35m/[0m[35m/[0m[39m It's based on a normal one[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                  int mpid = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:                  MAPIProperty base = [0m[1;35mMAPIProperty.get[0m[1;39m([0m[39mmpid[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:                  name = base.name;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:20[0m[39m-[0m[1;36m35[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:185[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m43[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now read in the [0m[1;35mvalue[0m[1;39m([0m[39ms[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            int values = [0m[1;36m1[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39misMV || isVL[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:               values = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            if [0m[1;39m([0m[39mtype == Types.NULL && values > [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:               throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Placeholder/NULL arrays aren't [0m           [2m                [0m
[2;36m                    [0m         [32msupported."[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:               [0m[35m/[0m[35m/[0m[39m Create[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:               MAPIAttribute attr;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mtype == Types.UNICODE_STRING || type == Types.ASCII_STRING[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:                  attr = new [0m[1;35mMAPIStringAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m206[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mtype == Types.APP_TIME || type == Types.TIME[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m207[0m[39m:                  attr = new [0m[1;35mMAPIDateAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mid == MAPIProperty.RTF_COMPRESSED.id[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                  attr = new [0m[1;35mMAPIRtfAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:                  attr = new [0m[1;35mMAPIAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:               [0m[1;35mattrs.add[0m[1;39m([0m[39mattr[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:         [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:         [0m[35m/[0m[35m/[0m[39m All done[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:         return attrs;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:   private static int [0m[1;35mgetLength[0m[1;39m([0m[39mMAPIType type, InputStream inp[0m[1;39m)[0m[39m throws [0m         [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:      if [0m[1;39m([0m[1;35mtype.isFixedLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:         return [0m[1;35mtype.getLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:      if [0m[1;39m([0m[39mtype == Types.ASCII_STRING ||[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:          type == Types.UNICODE_STRING ||[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:          type == Types.DIRECTORY ||[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:          type == Types.BINARY[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[35m/[0m[35m/[0m[39m Need to read the length, as it varies[0m                            [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:            return [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Unknown type "[0m[39m + type[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m235[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:   private static void [0m[1;35mskipToBoundary[0m[1;39m([0m[39mint length, InputStream inp[0m[1;39m)[0m[39m throws [0m      [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:      [0m[35m/[0m[35m/[0m[39m Data is always padded out to a [0m[1;36m4[0m[39m byte boundary[0m                         [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mlength % [0m[1;36m4[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:         int toSkip = [0m[1;36m4[0m[39m - [0m[1;39m([0m[39mlength % [0m[1;36m4[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:         [0m[1;35minp.skip[0m[1;39m([0m[39mtoSkip[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m241[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m242[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m243[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIStringAttribute.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:1[0m[39m-[0m[1;36m56[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import org.apache.logging.log4j.Logger;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.poi.logging.PoiLogManager;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m: * A pure-MAPI attribute holding a String, which applies[0m                         [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m: *  to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m[39m or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:public final class MAPIStringAttribute extends MAPIAttribute [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:   private static final Logger LOG = [0m                                            [2m                [0m
[2;36m                    [0m         [1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mMAPIStringAttribute.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:   private static final String CODEPAGE = [0m[32m"CP1252"[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   private final String data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   public [0m[1;35mMAPIStringAttribute[0m[1;39m([0m[39mMAPIProperty property, int type, byte[0m[1;39m[[0m[1;39m][0m[39m data[0m[1;39m)[0m[39m [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:      [0m[1;35msuper[0m[1;39m([0m[39mproperty, type, data[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:      String tmpData = null;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mtype == [0m[1;35mTypes.ASCII_STRING.getId[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:         tmpData = new [0m[1;35mString[0m[1;39m([0m[39mdata, [0m[1;35mCharset.forName[0m[1;39m([0m[39mCODEPAGE[0m[1;39m)[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mtype == [0m[1;35mTypes.UNICODE_STRING.getId[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:         tmpData = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:         throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Not a string type "[0m[39m + type[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:      [0m[35m/[0m[35m/[0m[39m Strip off the null terminator if present[0m                                [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:      [0m[1;35mif[0m[1;39m([0m[1;35mtmpData.endsWith[0m[1;39m([0m[32m"\0"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:         tmpData = [0m[1;35mtmpData.substring[0m[1;39m([0m[1;36m0[0m[39m, [0m[1;35mtmpData.length[0m[1;39m([0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:      [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:      this.data = tmpData;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIStringAttribute.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:20[0m[39m-[0m[1;36m28[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import org.apache.logging.log4j.Logger;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.poi.logging.PoiLogManager;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:1[0m[39m-[0m[1;36m53[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.util;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static java.nio.charset.StandardCharsets.ISO_8859_1;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m: * Collection of string handling utilities[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:@Internal[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:public final class StringUtil [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = [0m[1;36m10000000[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    public static final Charset UTF16LE = StandardCharsets.UTF_16LE;[0m             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    public static final Charset UTF8 = StandardCharsets.UTF_8;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    public static final Charset WIN_1252 = [0m[1;35mCharset.forName[0m[1;39m([0m[32m"cp1252"[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:     * @param length the max record length allowed for StringUtil[0m                [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        MAX_RECORD_LENGTH = length;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * @return the max record length allowed for StringUtil[0m                      [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:        return MAX_RECORD_LENGTH;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:571[0m[39m-[0m[1;36m587[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m571[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyAllocate[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m572[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m573[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m574[0m[39m:        [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mlength[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m575[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m576[0m[39m:        return new byte[0m[1;39m[[0m[1;39m([0m[39mint[0m[1;39m)[0m[39mlength[0m[1;39m][0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m577[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m578[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m579[0m[39m:    public static void [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m580[0m[39m:        if [0m[1;39m([0m[39mlength < 0L[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m581[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array of length [0m [2m                [0m
[2;36m                    [0m         [32m< 0, but had "[0m[39m + length + [0m[32m" and "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m582[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m583[0m[39m:        if [0m[1;39m([0m[39mlength > [0m[1;39m([0m[39mlong[0m[1;39m)[0m[39mInteger.MAX_VALUE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m584[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array > [0m         [2m                [0m
[2;36m                    [0m         [32m"[0m[39m+Integer.MAX_VALUE[0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m585[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m586[0m[39m:        [0m[1;35mcheckLength[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m587[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:129[0m[39m-[0m[1;36m139[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:    private static void [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        [0m[1;35mif[0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE != [0m[1;36m-1[0m[39m && length > BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:    private static void [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mlong length[0m[1;39m)[0m[39m [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:        [0m[1;35mif[0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE != [0m[1;36m-1[0m[39m && length > BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:301[0m[39m-[0m[1;36m310[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:    private static void [0m[1;35mcheckLength[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:        if [0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:            if [0m[1;39m([0m[39mlength > BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:                [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39mlength > maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:            [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:107[0m[39m-[0m[1;36m112[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m[39mbyte[0m[1;39m[[0m[1;39m][0m[39m string[0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[39mstring.length == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return [0m[32m""[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m[39mstring, [0m[1;36m0[0m[39m, string.length [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:79[0m[39m-[0m[1;36m95[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            final byte[0m[1;39m[[0m[1;39m][0m[39m string,[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            final int offset,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            final int len[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            throws ArrayIndexOutOfBoundsException, IllegalArgumentException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[39mlen == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[32m""[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39moffset < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[39moffset >= string.length[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:            throw new [0m[1;35mArrayIndexOutOfBoundsException[0m[1;39m([0m[32m"Illegal offset "[0m[39m + offset [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m" [0m[32m([0m[32mString data is of length "[0m[39m + string.length + [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39mlen < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[1;39m([0m[1;39m([0m[39mstring.length - offset[0m[1;39m)[0m[39m [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m < len[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Illegal length "[0m[39m + len[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mstring, offset, len * [0m[1;36m2[0m[39m, UTF16LE[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/hpsf/UnicodeString.jav[0m[1;92ma:19[0m[39m-[0m[1;36m31[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.OutputStream;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.UnsupportedEncodingException;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.logging.log4j.Logger;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.logging.PoiLogManager;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.util.CodePageUtil;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.util.Internal;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.util.LittleEndianByteArrayInputStream;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.util.LittleEndianConsts;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/hpsf/UnicodeString.jav[0m[1;92ma:39[0m[39m-[0m[1;36m75[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    public void [0m[1;35mread[0m[1;39m([0m[39mLittleEndianByteArrayInputStream lei[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:        final int length = [0m[1;35mlei.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:        final int unicodeBytes = length*[0m[1;36m2[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:        _value = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeBytes, [0m                           [2m                [0m
[2;36m                    [0m         [1;35mCodePageString.getMaxRecordLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        [0m[35m/[0m[35m/[0m[39m If Length is zero, this field MUST be zero bytes in length. If Length[0m [2m                [0m
[2;36m                    [0m         [39mis[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        [0m[35m/[0m[35m/[0m[39m nonzero, this field MUST be a null-terminated array of [0m[1;36m16[0m[39m-bit Unicode[0m [2m                [0m
[2;36m                    [0m         [39mcharacters, followed by[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:        [0m[35m/[0m[35m/[0m[39m zero padding to a multiple of [0m[1;36m4[0m[39m bytes. The string represented by this[0m [2m                [0m
[2;36m                    [0m         [39mfield SHOULD NOT[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:        [0m[35m/[0m[35m/[0m[39m contain embedded or additional trailing null characters.[0m              [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:        [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:        if [0m[1;39m([0m[39mlength == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:            return;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:        final int offset = [0m[1;35mlei.getReadIndex[0m[1;39m([0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35mlei.readFully[0m[1;39m([0m[39m_value[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39m_value[0m[1;39m[[0m[39municodeBytes-[0m[1;36m2[0m[1;39m][0m[39m != [0m[1;36m0[0m[39m || _value[0m[1;39m[[0m[39municodeBytes-[0m[1;36m1[0m[1;39m][0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            String msg = [0m[32m"UnicodeString started at offset #"[0m[39m + offset + [0m[32m" is not[0m [2m                [0m
[2;36m                    [0m         [32mNULL-terminated"[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            throw new [0m[1;35mIllegalPropertySetDataException[0m[1;39m([0m[39mmsg[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:        [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;35mTypedPropertyValue.skipPadding[0m[1;39m([0m[39mlei[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:    public byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35mgetValue[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:        return _value;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    public String [0m[1;35mtoJavaString[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        if [0m[1;39m([0m[39m _value.length == [0m[1;36m0[0m[39m [0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            return null;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:        String result = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39m _value, [0m[1;36m0[0m[39m, _value.length >>[0m [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m [0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/hpsf/CodePageString.jav[0m[1;92ma:29[0m[39m-[0m[1;36m56[0m                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:@Internal[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:public class CodePageString [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = 100_000;[0m                [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    private static final Logger LOG = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mCodePageString.class[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    private byte[0m[1;39m[[0m[1;39m][0m[39m _value;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:     * @param length the max record length allowed for CodePageString[0m            [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:    public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        MAX_RECORD_LENGTH = length;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:     * @return the max record length allowed for CodePageString[0m                  [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:    public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        return MAX_RECORD_LENGTH;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    public void [0m[1;35mread[0m[1;39m([0m[39m LittleEndianByteArrayInputStream lei [0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        int offset = [0m[1;35mlei.getReadIndex[0m[1;39m([0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        int size = [0m[1;35mlei.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        _value = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39msize, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:781[0m[39m-[0m[1;36m788[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:    private String [0m[1;35mreadUnicodeString[0m[1;39m([0m[39mRLEDecompressingInputStream in, int [0m       [2m                [0m
[2;36m                    [0m         [39municodeNameRecordLength[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buffer = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeNameRecordLength, [0m        [2m                [0m
[2;36m                    [0m         [39mMAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:        int bytesRead = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39min, buffer[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:        if [0m[1;39m([0m[39mbytesRead != unicodeNameRecordLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:            throw new [0m[1;35mEOFException[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mbuffer, StringUtil.UTF16LE[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:71[0m[39m-[0m[1;36m77[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:@[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unused"[0m[1;39m)[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:public class VBAMacroReader implements Closeable [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    private static final Logger LOGGER = [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mPoiLogManager.getLogger[0m[1;39m([0m[39mVBAMacroReader.class[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrary[0m[39m limit on size of strings to read, etc.[0m                           [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    private static final int MAX_STRING_LENGTH = [0m[1;36m20000[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    protected static final String VBA_PROJECT_OOXML = [0m[32m"vbaProject.bin"[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:781[0m[39m-[0m[1;36m788[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:    private String [0m[1;35mreadUnicodeString[0m[1;39m([0m[39mRLEDecompressingInputStream in, int [0m       [2m                [0m
[2;36m                    [0m         [39municodeNameRecordLength[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buffer = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeNameRecordLength, [0m        [2m                [0m
[2;36m                    [0m         [39mMAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:        int bytesRead = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39min, buffer[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:        if [0m[1;39m([0m[39mbytesRead != unicodeNameRecordLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:            throw new [0m[1;35mEOFException[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mbuffer, StringUtil.UTF16LE[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/macros/VBAMacroReader.jav[0m[1;92ma:716[0m[39m-[0m[1;36m720[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m716[0m[39m:    private static String [0m[1;35mreadString[0m[1;39m([0m[39mInputStream stream, int length, Charset [0m   [2m                [0m
[2;36m                    [0m         [39mcharset[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m717[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buffer = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m718[0m[39m:        int bytesRead = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39mstream, buffer[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m719[0m[39m:        if [0m[1;39m([0m[39mbytesRead != length[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m720[0m[39m:            throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Tried to read: "[0m[39m+length +[0m                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:56[0m[39m-[0m[1;36m57[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    private static final int DEFAULT_MAX_STRING_LENGTH = [0m[1;36m1024[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:285[0m[39m-[0m[1;36m295[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    private static String [0m[1;35mreadAsciiLen[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:        return [0m[1;39m([0m[39mbuf.length == [0m[1;36m0[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mStringUtil.getFromCompressedUnicode[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size - [0m[1;36m1[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:    private static String [0m[1;35mreadUtf16[0m[1;39m([0m[39mLittleEndianByteArrayInputStream leis[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mthrows IOException [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        int size = [0m[1;35mleis.readInt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        byte[0m[1;39m[[0m[1;39m][0m[39m buf = [0m[1;35mIOUtils.toByteArray[0m[1;39m([0m[39mleis, size * [0m[1;36m2[0m[39m, MAX_STRING_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:        return [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mbuf, [0m[1;36m0[0m[39m, size[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:165[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m80[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:               [0m[35m/[0m[35m/[0m[39m Now create[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:               prop = [0m[1;35mMAPIProperty.createCustom[0m[1;39m([0m[39mid, type, name[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/HMEFMessage.jav[0m[1;92ma:1[0m[39m-[0m[1;36m33[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.hmef.attribute.MAPIAttribute;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.attribute.MAPIStringAttribute;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.attribute.TNEFAttribute;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hmef.attribute.TNEFMAPIAttribute;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hmef.attribute.TNEFProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/HMEFMessage.jav[0m[1;92ma:57[0m[39m-[0m[1;36m76[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    public [0m[1;35mHMEFMessage[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            [0m[35m/[0m[35m/[0m[39m Check the signature matches[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:            int sig = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            if [0m[1;39m([0m[39msig != [0m[1;33mHEAD[0m[39mER_SIGNATURE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:                        [0m[32m"TNEF signature not detected in file, "[0m[39m +[0m                [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:                        [0m[32m"expected "[0m[39m + [0m[1;33mHEAD[0m[39mER_SIGNATURE + [0m[32m" but got "[0m[39m + sig[0m       [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                [0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[35m/[0m[35m/[0m[39m Read the File ID[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            fileId = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now begin processing the contents[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:            [0m[1;35mprocess[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;35minp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/HMEFMessage.jav[0m[1;92ma:78[0m[39m-[0m[1;36m105[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    private void [0m[1;35mprocess[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:       int level;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:       do [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:           [0m[35m/[0m[35m/[0m[39m Fetch the level[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:           level = [0m[1;35minp.read[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:           [0m[35m/[0m[35m/[0m[39m Decide what to attach it to, based on the levels and IDs[0m           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:           switch [0m[1;39m([0m[39mlevel[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:               case TNEFProperty.LEVEL_MESSAGE:[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                   [0m[1;35mprocessMessage[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                   break;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                case TNEFProperty.LEVEL_ATTACHMENT:[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                   [0m[1;35mprocessAttachment[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                   break;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:               [0m[35m/[0m[35m/[0m[39m ignore trailing newline[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                case [0m[32m'\r'[0m[39m:[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:                case [0m[32m'\n'[0m[39m:[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:                case TNEFProperty.LEVEL_END_OF_FILE:[0m                             [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:                    break;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:                default:[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                    throw new [0m[1;35mIllegalStateException[0m[1;39m([0m[32m"Unhandled level "[0m[39m + level[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        [0m[1;39m}[0m[39m while [0m[1;39m([0m[39mlevel != TNEFProperty.LEVEL_END_OF_FILE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:    void [0m[1;35mprocessMessage[0m[1;39m([0m[39mInputStream inp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[39m Build the attribute[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        TNEFAttribute attr = [0m[1;35mTNEFAttribute.create[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m35[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m: * An attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                           [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m: * Note - the types and IDs differ from standard Outlook/MAPI[0m                    [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m: *  ones, so we can't just re-use the HSMF ones.[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:public class TNEFAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:40[0m[39m-[0m[1;36m73[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:   private final TNEFProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private final int checksum;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    * @param length the max record length allowed for TNEFAttribute[0m              [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:      MAX_RECORD_LENGTH = length;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    * @return the max record length allowed for TNEFAttribute[0m                    [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:   public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:      return MAX_RECORD_LENGTH;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:   [0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:   [0m[35m/[0m[39m**[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    * Constructs a single new attribute from the id, type,[0m                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    *  and the contents of the stream[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    *[0m[35m/[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:   protected [0m[1;35mTNEFAttribute[0m[1;39m([0m[39mint id, int type, InputStream inp[0m[1;39m)[0m[39m throws IOException[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:      this.type = type;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:      int length = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:      property = [0m[1;35mTNEFProperty.getBest[0m[1;39m([0m[39mid, type[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:      data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlength, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:      [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, data[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:      [0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:      checksum = [0m[1;35mLittleEndian.readUShort[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:   [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:165[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m77[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:196[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m00[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:571[0m[39m-[0m[1;36m587[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m571[0m[39m:    public static byte[0m[1;39m[[0m[1;39m][0m[39m [0m[1;35msafelyAllocate[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m572[0m[39m:        [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m573[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m574[0m[39m:        [0m[1;35mcheckByteSizeLimit[0m[1;39m([0m[39mlength[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m575[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m576[0m[39m:        return new byte[0m[1;39m[[0m[1;39m([0m[39mint[0m[1;39m)[0m[39mlength[0m[1;39m][0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m577[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m578[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m579[0m[39m:    public static void [0m[1;35msafelyAllocateCheck[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m580[0m[39m:        if [0m[1;39m([0m[39mlength < 0L[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m581[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array of length [0m [2m                [0m
[2;36m                    [0m         [32m< 0, but had "[0m[39m + length + [0m[32m" and "[0m[39m + maxLength[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m582[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m583[0m[39m:        if [0m[1;39m([0m[39mlength > [0m[1;39m([0m[39mlong[0m[1;39m)[0m[39mInteger.MAX_VALUE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m584[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[32m"Can't allocate an array > [0m         [2m                [0m
[2;36m                    [0m         [32m"[0m[39m+Integer.MAX_VALUE[0m[1;39m)[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m585[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m586[0m[39m:        [0m[1;35mcheckLength[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m587[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:301[0m[39m-[0m[1;36m310[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:    private static void [0m[1;35mcheckLength[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:        if [0m[1;39m([0m[39mBYTE_ARRAY_MAX_OVERRIDE > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:            if [0m[1;39m([0m[39mlength > BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:                [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, BYTE_ARRAY_MAX_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39mlength > maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:            [0m[1;35mthrowRFE[0m[1;39m([0m[39mlength, maxLength[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/IOUtils.jav[0m[1;92ma:621[0m[39m-[0m[1;36m627[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m621[0m[39m:    private static void [0m[1;35mthrowRFE[0m[1;39m([0m[39mlong length, int maxLength[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m622[0m[39m:        throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[1;35mString.format[0m[1;39m([0m[39mLocale.ROOT, [0m[32m"Tried to [0m   [2m                [0m
[2;36m                    [0m         [32mallocate an array of length %,d"[0m[39m +[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m623[0m[39m:                        [0m[32m", but the maximum length for this record type is [0m      [2m                [0m
[2;36m                    [0m         [32m%,d.%n"[0m[39m +[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m624[0m[39m:                        [0m[32m"If the file is not corrupt and not large, please open [0m [2m                [0m
[2;36m                    [0m         [32man issue on bugzilla to request %n"[0m[39m +[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m625[0m[39m:                        [0m[32m"increasing the maximum allowable size for this record [0m [2m                [0m
[2;36m                    [0m         [32mtype.%n"[0m[39m+[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m626[0m[39m:                        [0m[32m"You can set a higher override value with [0m              [2m                [0m
[2;36m                    [0m         [32mIOUtils.setByteArrayMaxOverride[0m[32m([0m[32m)[0m[32m"[0m[39m, length, maxLength[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m627[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/RecordFormatException.jav[0m[1;92ma:27[0m[39m-[0m[1;36m56[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:public class RecordFormatException[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    extends RuntimeException[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m[1;39m{[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:    public [0m[1;35mRecordFormatException[0m[1;39m([0m[39mString exception[0m[1;39m)[0m                               [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:    [0m[1;39m{[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:        [0m[1;35msuper[0m[1;39m([0m[39mexception[0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    [0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    public [0m[1;35mRecordFormatException[0m[1;39m([0m[39mString exception, Throwable thr[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:      [0m[1;35msuper[0m[1;39m([0m[39mexception, thr[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    [0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    public [0m[1;35mRecordFormatException[0m[1;39m([0m[39mThrowable thr[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:      [0m[1;35msuper[0m[1;39m([0m[39mthr[0m[1;39m)[0m[39m;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:     * Syntactic sugar to check whether a RecordFormatException should[0m           [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:     * be thrown.  If assertTrue is <code>false<[0m[35m/[0m[95mcode[0m[39m>, this will throw this[0m     [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:     * exception with the message.[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:     * @param assertTrue If false, the exception is thrown, if true, no action [0m  [2m                [0m
[2;36m                    [0m         [39mis performed[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * @param message The message to include in the thrown exception[0m             [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    public static void [0m[1;35mcheck[0m[1;39m([0m[39mboolean assertTrue, String message[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:        if [0m[1;39m([0m[39m! assertTrue[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            throw new [0m[1;35mRecordFormatException[0m[1;39m([0m[39mmessage[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:[0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:20[0m[39m-[0m[1;36m35[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:165[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m77[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:33[0m[39m-[0m[1;36m53[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = [0m[1;36m10000000[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    public static final Charset UTF16LE = StandardCharsets.UTF_16LE;[0m             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    public static final Charset UTF8 = StandardCharsets.UTF_8;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:    public static final Charset WIN_1252 = [0m[1;35mCharset.forName[0m[1;39m([0m[32m"cp1252"[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:     * @param length the max record length allowed for StringUtil[0m                [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public static void [0m[1;35msetMaxRecordLength[0m[1;39m([0m[39mint length[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        MAX_RECORD_LENGTH = length;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * @return the max record length allowed for StringUtil[0m                      [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    public static int [0m[1;35mgetMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:        return MAX_RECORD_LENGTH;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/util/StringUtil.jav[0m[1;92ma:79[0m[39m-[0m[1;36m95[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static String [0m[1;35mgetFromUnicodeLE[0m[1;39m([0m                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            final byte[0m[1;39m[[0m[1;39m][0m[39m string,[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            final int offset,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            final int len[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            throws ArrayIndexOutOfBoundsException, IllegalArgumentException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[39mlen == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[32m""[0m[39m;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39moffset < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[39moffset >= string.length[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:            throw new [0m[1;35mArrayIndexOutOfBoundsException[0m[1;39m([0m[32m"Illegal offset "[0m[39m + offset [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m" [0m[32m([0m[32mString data is of length "[0m[39m + string.length + [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        if [0m[1;39m([0m[1;39m([0m[39mlen < [0m[1;36m0[0m[1;39m)[0m[39m || [0m[1;39m([0m[1;39m([0m[1;39m([0m[39mstring.length - offset[0m[1;39m)[0m[39m [0m[35m/[0m[39m [0m[1;36m2[0m[1;39m)[0m[39m < len[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Illegal length "[0m[39m + len[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        return new [0m[1;35mString[0m[1;39m([0m[39mstring, offset, len * [0m[1;36m2[0m[39m, UTF16LE[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/TNEFAttribute.jav[0m[1;92ma:37[0m[39m-[0m[1;36m39[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 20_000_000;[0m              [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:   private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:43[0m[39m-[0m[1;36m46[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/hpsf/CodePageString.jav[0m[1;92ma:32[0m[39m-[0m[1;36m33[0m                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:    private static final int DEFAULT_MAX_RECORD_LENGTH = 100_000;[0m                [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:    private static int MAX_RECORD_LENGTH = DEFAULT_MAX_RECORD_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi/src/main/java/org/apache/poi/poifs/filesystem/Ole10Native.jav[0m[1;92ma:56[0m[39m-[0m[1;36m57[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    private static final int DEFAULT_MAX_STRING_LENGTH = [0m[1;36m1024[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:    private static int MAX_STRING_LENGTH = DEFAULT_MAX_STRING_LENGTH;[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m* ====================================================================[0m           [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:   Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:   contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:   this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:   The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:   [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:   the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:   Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:   distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:   See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:   limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:==================================================================== *[0m[35m/[0m          [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:package org.apache.poi.hmef.attribute;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.poi.hmef.Attachment;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.poi.hmef.HMEFMessage;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.poi.hsmf.datatypes.MAPIProperty;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.poi.hsmf.datatypes.Types;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.poi.hsmf.datatypes.Types.MAPIType;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.poi.util.HexDump;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.poi.util.IOUtils;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.poi.util.LittleEndian;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.poi.util.StringUtil;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m: * A pure-MAPI attribute which applies to a [0m[1;39m{[0m[39m@link HMEFMessage[0m[1;39m}[0m                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m: *  or one of its [0m[1;39m{[0m[39m@link Attachment[0m[1;39m}[0m[39ms.[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class MAPIAttribute [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:   [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m selected; may need to increase[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:   private static final int DEFAULT_MAX_RECORD_LENGTH = 1_000_000;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:   private static int MAX_RECORD_LENGTH = 1_000_000;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:   private static int MAX_RECORD_COUNT = 10_000;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:   private final MAPIProperty property;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:   private final int type;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:   private final byte[0m[1;39m[[0m[1;39m][0m[39m data;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:105[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m25[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:   public static List<MAPIAttribute> [0m[1;35mcreate[0m[1;39m([0m[39mTNEFAttribute parent[0m[1;39m)[0m[39m throws [0m       [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:      [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_MAPIPROPERTIES[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:         [0m[35m/[0m[35m/[0m[39m Regular MAPI Properties, normally on the message[0m                    [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:      else [0m[1;35mif[0m[1;39m([0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m == TNEFProperty.ID_ATTACHMENT[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:         [0m[35m/[0m[35m/[0m[39m MAPI Properties for an attachment[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:      else [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:         [0m[35m/[0m[35m/[0m[39m Something else, oh dear[0m[33m...[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:         throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                                    [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:               [0m[32m"Can only create from a MAPIProperty attribute, "[0m[39m +[0m              [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:               [0m[32m"instead received a "[0m[39m + [0m[1;35mparent.getProperty[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m" one"[0m            [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:         [0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:      [0m[1;35mtry[0m[1;39m([0m[39mUnsynchronizedByteArrayInputStream inp = [0m                             [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[1;35mparent.getData[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:         [0m[35m/[0m[35m/[0m[39m First up, get the number of attributes[0m                              [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:         int count = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:         List<MAPIAttribute> attrs = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:         [0m[35m/[0m[35m/[0m[39m Now, read each one in in turn[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:         [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mi[0m[39m=[0m[1;36m0[0m[39m; i<count; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:150[0m[39m-[0m[1;36m1[0m [2m                [0m
[2;36m                    [0m         [1;36m80[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            MAPIProperty prop = [0m[1;35mMAPIProperty.get[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39mid >= [0m[1;36m0x8000[0m[39m && id <= [0m[1;36m0xFFFF[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m guid = new byte[0m[1;39m[[0m[1;36m16[0m[1;39m][0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:               if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, guid[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:                  throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read guid"[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:               int mptype = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:               [0m[35m/[0m[35m/[0m[39m Get the name of it[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:               String name;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mmptype == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:                  [0m[35m/[0m[35m/[0m[39m It's based on a normal one[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                  int mpid = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:                  MAPIProperty base = [0m[1;35mMAPIProperty.get[0m[1;39m([0m[39mmpid[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:                  name = base.name;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:                  [0m[35m/[0m[35m/[0m[39m Custom name was stored[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:                  int mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:                  if [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mmplen[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                  byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                  if [0m[1;39m([0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minp, mpdata[0m[1;39m)[0m[39m < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                     throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Not enough data to read "[0m[39m + mplen +[0m [2m                [0m
[2;36m                    [0m         [32m" bytes for attribute name"[0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                  [0m[1;39m}[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                  name = [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                  [0m[1;35mskipToBoundary[0m[1;39m([0m[39mmplen, inp[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:               [0m[35m/[0m[35m/[0m[39m Now create[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:               prop = [0m[1;35mMAPIProperty.createCustom[0m[1;39m([0m[39mid, type, name[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:185[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m15[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:            [0m[35m/[0m[35m/[0m[39m Now read in the [0m[1;35mvalue[0m[1;39m([0m[39ms[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            int values = [0m[1;36m1[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:            [0m[1;35mif[0m[1;39m([0m[39misMV || isVL[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:               values = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            if [0m[1;39m([0m[39mtype == Types.NULL && values > [0m[1;36m1[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:               throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Placeholder/NULL arrays aren't [0m           [2m                [0m
[2;36m                    [0m         [32msupported."[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:            [0m[1;35mfor[0m[1;39m([0m[39mint [0m[33mj[0m[39m=[0m[1;36m0[0m[39m; j<values; j++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:               int len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:               byte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:               [0m[1;35minp.read[0m[1;39m([0m[39mdata[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:               [0m[1;35mskipToBoundary[0m[1;39m([0m[39mlen, inp[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:               [0m[35m/[0m[35m/[0m[39m Create[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:               MAPIAttribute attr;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:               [0m[1;35mif[0m[1;39m([0m[39mtype == Types.UNICODE_STRING || type == Types.ASCII_STRING[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:                  attr = new [0m[1;35mMAPIStringAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m206[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mtype == Types.APP_TIME || type == Types.TIME[0m[1;39m)[0m[39m [0m[1;39m{[0m        [2m                [0m
[2;36m                    [0m         [1;36m207[0m[39m:                  attr = new [0m[1;35mMAPIDateAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;35mif[0m[1;39m([0m[39mid == MAPIProperty.RTF_COMPRESSED.id[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                  attr = new [0m[1;35mMAPIRtfAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:               [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:                  attr = new [0m[1;35mMAPIAttribute[0m[1;39m([0m[39mprop, typeId, data[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:               [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:               [0m[1;35mattrs.add[0m[1;39m([0m[39mattr[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:         [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mpoi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:236[0m[39m-[0m[1;36m2[0m [2m                [0m
[2;36m                    [0m         [1;36m43[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:   private static void [0m[1;35mskipToBoundary[0m[1;39m([0m[39mint length, InputStream inp[0m[1;39m)[0m[39m throws [0m      [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:      [0m[35m/[0m[35m/[0m[39m Data is always padded out to a [0m[1;36m4[0m[39m byte boundary[0m                         [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:      [0m[1;35mif[0m[1;39m([0m[39mlength % [0m[1;36m4[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:         int toSkip = [0m[1;36m4[0m[39m - [0m[1;39m([0m[39mlength % [0m[1;36m4[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:         [0m[1;35minp.skip[0m[1;39m([0m[39mtoSkip[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m241[0m[39m:      [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m242[0m[39m:   [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m243[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m1[0m[39m. Root Cause Analysis[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe Out of Memory error occurs in `[0m[1;35mMAPIAttribute.create[0m[1;39m([0m[1;39m)[0m[39m` at line [0m[1;36m171[0m[39m in [0m          [2m                [0m
[2;36m                    [0m         [39m`poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java`. [0m   [2m                [0m
[2;36m                    [0m         [39mWhen processing custom MAPI property names [0m[1;39m([0m[39mproperties with ID >= [0m[1;36m0x8000[0m[1;39m)[0m[39m, the [0m     [2m                [0m
[2;36m                    [0m         [39mcode:[0m                                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Reads `mplen` [0m[1;39m([0m[39mproperty name length in bytes[0m[1;39m)[0m[39m from untrusted input[0m               [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Only validates that `mplen` is not negative[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Directly allocates a byte array without size limit validation**: `byte[0m[1;39m[[0m[1;39m][0m[39m [0m      [2m                [0m
[2;36m                    [0m         [39mmpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;`[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Calls `[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[39mmpdata, [0m[1;36m0[0m[39m, [0m[1;39m([0m[39mmplen/[0m[1;36m2[0m[1;39m)[0m[1;36m-1[0m[1;39m)[0m[39m` which attempts to [0m   [2m                [0m
[2;36m                    [0m         [39mcreate a String[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mIf `mplen` contains a maliciously large value [0m[1;39m([0m[39me.g., 500MB[0m[1;39m)[0m[39m, this causes OOM during[0m [2m                [0m
[2;36m                    [0m         [39meither:[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m- The byte array allocation at line [0m[1;36m171[0m[39m, or[0m                                         [2m                [0m
[2;36m                    [0m         [39m- The String object creation at line [0m[1;36m175[0m[39m [0m[1;39m([0m[39mwhich requires additional memory for the [0m [2m                [0m
[2;36m                    [0m         [39mString's internal character array[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m2[0m[39m. Code Inconsistency[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe vulnerability exists due to inconsistent use of safe allocation patterns within[0m [2m                [0m
[2;36m                    [0m         [39mthe same file:[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Vulnerable code** [0m[1;39m([0m[39mlines [0m[1;36m167[0m[39m-[0m[1;36m171[0m[1;39m)[0m[39m:[0m                                                [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mint mplen = [0m[1;35mLittleEndian.readInt[0m[1;39m([0m[39minp[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [39mif [0m[1;39m([0m[39mmplen < [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m   throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Did not expect negative value: "[0m[39m + mplen[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;39m}[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;  [0m[35m/[0m[35m/[0m[39m UNSAFE - no limit![0m                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Safe code** in the same method [0m[1;39m([0m[39mline [0m[1;36m198[0m[1;39m)[0m[39m:[0m                                        [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mint len = [0m[1;35mgetLength[0m[1;39m([0m[39mtype, inp[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[1;39m][0m[39m data = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;  [0m[35m/[0m[35m/[0m[39m SAFE - with 1MB [0m  [2m                [0m
[2;36m                    [0m         [39mlimit![0m                                                                              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m3[0m[39m. Fix Implementation[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Primary Fix Location**: [0m                                                          [2m                [0m
[2;36m                    [0m         [39m`poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.jav[0m[1;92ma:171[0m[39m`[0m [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Change Required**: Replace the unsafe direct byte array allocation with [0m          [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m`:[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Before [0m[1;39m([0m[39mLine [0m[1;36m171[0m[1;39m)[0m[39m:**[0m                                                              [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**After [0m[1;39m([0m[39mLine [0m[1;36m171[0m[1;39m)[0m[39m:**[0m                                                               [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mbyte[0m[1;39m[[0m[1;39m][0m[39m mpdata = [0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mmplen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m4[0m[39m. Why This Fix is Optimal[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Prevents OOM**: The fix validates `mplen` against `MAX_RECORD_LENGTH` [0m[1;39m([0m[1;36m1[0m[39m,[0m[1;36m000[0m[39m,[0m[1;36m000[0m[39m [0m [2m                [0m
[2;36m                    [0m         [39mbytes = 1MB[0m[1;39m)[0m[39m before allocation. If `mplen` exceeds this limit, [0m                     [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` throws a `RecordFormatException` with a clear error [0m     [2m                [0m
[2;36m                    [0m         [39mmessage instead of causing OOM.[0m                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Maintains Consistency**: [0m                                                         [2m                [0m
[2;36m                    [0m         [39m- Line [0m[1;36m198[0m[39m in the same method already uses `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mlen, [0m            [2m                [0m
[2;36m                    [0m         [39mMAX_RECORD_LENGTH[0m[1;39m)[0m[39m` for regular attribute values[0m                                    [2m                [0m
[2;36m                    [0m         [39m- TNEFAttribute [0m[1;39m([0m[39mparent class[0m[1;39m)[0m[39m uses `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` at line [0m[1;36m69[0m           [2m                [0m
[2;36m                    [0m         [39m- All similar string parsing code [0m[1;39m([0m[39mUnicodeString, CodePageString, VBAMacroReader, [0m  [2m                [0m
[2;36m                    [0m         [39mOle10Native[0m[1;39m)[0m[39m uses safe allocation patterns[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Follows Codebase Patterns**: The codebase consistently uses [0m                      [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` throughout:[0m                                              [2m                [0m
[2;36m                    [0m         [39m- [0m[1;35mUnicodeString.read[0m[1;39m([0m[1;39m)[0m[39m at line [0m[1;36m42[0m[39m: `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeBytes, [0m           [2m                [0m
[2;36m                    [0m         [1;35mCodePageString.getMaxRecordLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m`[0m                                               [2m                [0m
[2;36m                    [0m         [39m- [0m[1;35mCodePageString.read[0m[1;39m([0m[1;39m)[0m[39m at line [0m[1;36m56[0m[39m: `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39msize, [0m                  [2m                [0m
[2;36m                    [0m         [39mMAX_RECORD_LENGTH[0m[1;39m)[0m[39m`[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m- [0m[1;35mVBAMacroReader.readUnicodeString[0m[1;39m([0m[1;39m)[0m[39m at line [0m[1;36m782[0m[39m: [0m                                  [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39municodeNameRecordLength, MAX_STRING_LENGTH[0m[1;39m)[0m[39m`[0m                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**No Additional Dependencies**: The required import `org.apache.poi.util.IOUtils` [0m  [2m                [0m
[2;36m                    [0m         [39mis already present at line [0m[1;36m33[0m[39m, so no additional imports are needed.[0m                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Appropriate Limit**: The `MAX_RECORD_LENGTH` of 1MB [0m[1;39m([0m[39mdefined at line [0m[1;36m45[0m[1;39m)[0m[39m is [0m      [2m                [0m
[2;36m                    [0m         [39mappropriate for MAPI attribute data, as evidenced by its use for regular attribute [0m [2m                [0m
[2;36m                    [0m         [39mvalues at line [0m[1;36m198[0m[39m.[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m5[0m[39m. Validation Mechanism[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe `[0m[1;35mIOUtils.safelyAllocate[0m[1;39m([0m[1;39m)[0m[39m` method provides comprehensive validation:[0m            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Negative check**: Validates length >= [0m[1;36m0[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Integer overflow check**: Validates length <= Integer.MAX_VALUE[0m                [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Size limit check**: Validates length <= maxLength [0m[1;39m([0m[39m1MB in this case[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Clear error**: Throws `RecordFormatException` with detailed message if [0m        [2m                [0m
[2;36m                    [0m         [39mvalidation fails[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m6[0m[39m. Preserving Existing Logic[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix preserves all existing logic:[0m                                               [2m                [0m
[2;36m                    [0m         [39m- The negative validation at lines [0m[1;36m168[0m[39m-[0m[1;36m170[0m[39m becomes redundant but harmless [0m          [2m                [0m
[2;36m                    [0m         [1;39m([0m[39msafelyAllocate also checks for negative[0m[1;39m)[0m                                           [2m                [0m
[2;36m                    [0m         [39m- The `[0m[1;35mIOUtils.readFully[0m[1;39m([0m[1;39m)[0m[39m` call at line [0m[1;36m172[0m[39m remains unchanged[0m                      [2m                [0m
[2;36m                    [0m         [39m- The `[0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m` call at line [0m[1;36m175[0m[39m remains unchanged[0m            [2m                [0m
[2;36m                    [0m         [39m- The `[0m[1;35mskipToBoundary[0m[1;39m([0m[1;39m)[0m[39m` call at line [0m[1;36m176[0m[39m remains unchanged[0m                         [2m                [0m
[2;36m                    [0m         [39m- All error handling and data processing logic is preserved[0m                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m7[0m[39m. No Side Effects[0m                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Does not break existing functionality**:[0m                                          [2m                [0m
[2;36m                    [0m         [39m- Valid TNEF files with property names under 1MB will continue to work[0m              [2m                [0m
[2;36m                    [0m         [39m- The 1MB limit is reasonable for MAPI property names [0m[1;39m([0m[39mproperty names are typically[0m [2m                [0m
[2;36m                    [0m         [39mvery short, under a few KB[0m[1;39m)[0m                                                         [2m                [0m
[2;36m                    [0m         [39m- If legitimate files with larger property names exist [0m[1;39m([0m[39mextremely unlikely[0m[1;39m)[0m[39m, users [0m [2m                [0m
[2;36m                    [0m         [39mcan increase the limit via `[0m[1;35mMAPIAttribute.setMaxRecordLength[0m[1;39m([0m[1;39m)[0m[39m`[0m                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Does not modify fuzzing harness**: The fix is entirely within the source code [0m    [2m                [0m
[2;36m                    [0m         [39mparsing logic, not in the test harness.[0m                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Does not modify external libraries**: The fix only modifies Apache POI internal [0m  [2m                [0m
[2;36m                    [0m         [39mcode.[0m                                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Does not break tests**: The fix adds validation that will only reject [0m            [2m                [0m
[2;36m                    [0m         [39mmalformed/malicious input that would have caused OOM anyway.[0m                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m8[0m[39m. Alternative Approaches Considered and Rejected[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m1[0m[39m: Add validation in [0m[1;35mStringUtil.getFromUnicodeLE[0m[1;39m([0m[1;39m)[0m[39m**[0m                  [2m                [0m
[2;36m                    [0m         [39m- Rejected because StringUtil is a general utility class that shouldn't enforce [0m    [2m                [0m
[2;36m                    [0m         [39mdomain-specific limits[0m                                                              [2m                [0m
[2;36m                    [0m         [39m- Different callers may have different reasonable limits[0m                            [2m                [0m
[2;36m                    [0m         [39m- The root cause is at the allocation site, not in the utility method[0m               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m2[0m[39m: Catch OutOfMemoryError**[0m                                           [2m                [0m
[2;36m                    [0m         [39m- Rejected because catching OOM is unreliable and doesn't prevent the issue[0m         [2m                [0m
[2;36m                    [0m         [39m- OOM can occur at any point during allocation or string creation[0m                   [2m                [0m
[2;36m                    [0m         [39m- Proper prevention is better than trying to recover from OOM[0m                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m3[0m[39m: Use a smaller MAX_RECORD_LENGTH**[0m                                  [2m                [0m
[2;36m                    [0m         [39m- Not necessary; 1MB is already a reasonable and conservative limit[0m                 [2m                [0m
[2;36m                    [0m         [39m- Consistent with the limit used for regular attribute values in the same class[0m     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m9[0m[39m. Summary[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis is a single-line fix that:[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Replaces unsafe allocation with safe allocation using an established codebase [0m   [2m                [0m
[2;36m                    [0m         [39mpattern[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Prevents denial-of-service via memory exhaustion[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Provides clear error messages for malformed files[0m                                [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Maintains consistency with the rest of the codebase[0m                              [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Has no impact on valid files or existing functionality[0m                           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. Requires no new dependencies or imports[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**File to Patch**: [0m                                                                 [2m                [0m
[2;36m                    [0m         [39m`poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java`[0m     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Line to Change**: Line [0m[1;36m171[0m                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Change**: `byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = new byte[0m[1;39m[[0m[39mmplen[0m[1;39m][0m[39m;` → `byte[0m[1;39m[[0m[1;39m][0m[39m mpdata = [0m                  [2m                [0m
[2;36m                    [0m         [1;35mIOUtils.safelyAllocate[0m[1;39m([0m[39mmplen, MAX_RECORD_LENGTH[0m[1;39m)[0m[39m;`[0m                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/05/26 11:44:01][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=146252;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=954589;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=136302;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=536695;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmpwaxcqvse[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/apache-poi_poi-full-01_vuln_1[0m [2m               [0m
[2;36m                    [0m         [35m/[0m[95magent-output-1767613441.1655762[0m                                                     [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc/apache-poi_poi-full-01_vuln_1.toml      [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-poi[0m              [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/05/26 11:44:03][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/qqor/crete/.cache/environments/[0m[95mapache-poi[0m     ]8;id=326476;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=970472;file:///home/qqor/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=932584;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=964287;file:///home/qqor/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mapache-poi[0m            [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=775410;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=395570;file:///home/qqor/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mapache-poi[0m             [2m               [0m
