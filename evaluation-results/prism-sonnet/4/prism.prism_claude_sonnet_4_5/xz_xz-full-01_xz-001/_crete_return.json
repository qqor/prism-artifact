{
  "project_name": "xz",
  "vulnerability_identifier": "xz_xz-full-01_xz-001",
  "source_directory": "/home/qqor/crete/.cache/official-afc-xz",
  "llm_usage": {
    "total_cost": 1.6017299999999999,
    "prompt_tokens": 444480,
    "completion_tokens": 17886
  },
  "variant": "sound",
  "diff": "--- a/src/liblzma/check/treeck.c\n+++ b/src/liblzma/check/treeck.c\n@@ -85,11 +85,35 @@\n     node->state = STATE_HASHED;\n   }\n \n-  // Free the node and edges\n+  return sum;\n+}\n+\n+// Free the tree structure using post-order traversal\n+static void free_tree(TreeNode *node)\n+{\n+  // Handle NULL nodes\n+  if (!node) {\n+    return;\n+  }\n+\n+  // Only free nodes that were fully processed during checksum computation\n+  // This prevents double-freeing in case of cycles (backlinks)\n+  if (node->state != STATE_HASHED) {\n+    return;\n+  }\n+\n+  // Mark node as being freed to handle cycles/backlinks\n+  // Reuse the state field: STATE_CLEAR indicates \"freed or being freed\"\n+  node->state = STATE_CLEAR;\n+\n+  // Recursively free all children first (post-order traversal)\n+  for (size_t i = 0; i < node->edge_count; ++i) {\n+    free_tree(node->edges[i]);\n+  }\n+\n+  // Free the edges array and the node itself\n   free(node->edges);\n   free(node);\n-\n-  return sum;\n }\n \n extern LZMA_API(uint32_t)\n@@ -98,6 +122,7 @@\n   unsigned long seed = hash_data(buf, size);\n   TreeNode *root = create_tree(buf, size, 0, 16, seed, NULL);\n   checksum ^= compute_tree_checksum(root, 0);\n+  free_tree(root);\n   return checksum;\n }\n \n",
  "stdout": "",
  "stderr": ""
}