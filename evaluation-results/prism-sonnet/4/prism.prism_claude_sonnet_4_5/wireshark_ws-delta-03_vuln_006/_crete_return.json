{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-03_vuln_006",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 11.604836999999996,
    "prompt_tokens": 3031254,
    "completion_tokens": 167405
  },
  "variant": "vulnerable",
  "diff": "--- a/epan/dissectors/packet-irc.c\n+++ b/epan/dissectors/packet-irc.c\n@@ -25,11 +25,12 @@\n  *  https://www.ietf.org/archive/id/draft-oakley-irc-ctcp-02.txt\n  */\n \n- #include \"config.h\"\n-\n- #include <epan/packet.h>\n- #include <epan/expert.h>\n- #include <wsutil/array.h>\n+#include \"config.h\"\n+\n+#include <epan/packet.h>\n+#include <epan/expert.h>\n+#include <wsutil/array.h>\n+#include <wsutil/wmem/wmem.h>\n  \n  void proto_register_irc(void);\n  void proto_reg_handoff_irc(void);\n@@ -327,124 +328,122 @@\n      proto_tree_add_item(tree, hf_irc_request_command_quit_message, tvb, offset, end, ENC_ASCII);\n  }\n  \n- static void\n- dissect_irc_join(tvbuff_t *tvb, proto_item *item, int offset)\n- {\n-     proto_tree *tree;\n-     int start_offset;\n-     int end_offset;\n-     int length;\n-     uint8_t *channel_name;\n- \n-     if (tvb_get_uint8(tvb, offset) != '#')\n-         return;\n-     \n-     start_offset = offset;\n- \n-     channel_name = malloc(CHANNELLEN+1);\n- \n-     if (channel_name == NULL ) {\n-         return;\n-     }\n- \n-     tree = proto_item_add_subtree(item, ett_irc_request_command_join);\n-     \n-     /* Parse the channels to join*/\n-     while(tvb_offset_exists(tvb, start_offset) ) {\n-         // Find the comma\n-         length = tvb_captured_length_remaining(tvb, start_offset);\n-         end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n- \n-         if ( end_offset == -1 ) {\n-             proto_tree_add_item(tree, hf_irc_request_command_join_channel, tvb, start_offset, length, ENC_ASCII);\n-             \n-             memset(channel_name, 0, CHANNELLEN+1);\n-             tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-             proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-             free(channel_name);\n-             return;\n-         }\n- \n-         memset(channel_name, 0, CHANNELLEN+1);\n-         tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-         proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-         proto_tree_add_item(tree, hf_irc_request_command_join_channel, tvb, start_offset, length, ENC_ASCII);\n-         start_offset = end_offset + 1;\n-     }\n- \n-     free(channel_name);\n-     return;\n- }\n- \n- static void\n- dissect_irc_part(tvbuff_t *tvb, proto_item *item, int offset)\n- {\n-     proto_tree *tree;\n-     int start_offset;\n-     int end_offset;\n-     int length;\n-     uint8_t *channel_name;\n- \n-     if (tvb_get_uint8(tvb, offset) != '#')\n-         return;\n-     \n-     channel_name = malloc(CHANNELLEN+1);\n- \n-     if (channel_name == NULL ) {\n-         return;\n-     }\n- \n-     start_offset = offset;\n- \n-     tree = proto_item_add_subtree(item, ett_irc_request_command_part);\n- \n-     while(tvb_offset_exists(tvb, start_offset) ) {\n-         length = tvb_captured_length_remaining(tvb, start_offset);\n-         end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n- \n-         if ( end_offset == -1 ) {\n-             int start_message = tvb_find_uint8(tvb, start_offset, length, ':');\n- \n-             if ( start_message == -1 ) {\n-                 proto_tree_add_item(tree, hf_irc_request_command_part_channel, tvb, start_offset, length, ENC_ASCII);\n-                 \n-                 memset(channel_name, 0, CHANNELLEN+1);\n-                 tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-                 proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-                 free(channel_name);\n-                 return;\n-             }\n- \n-             length = start_message-start_offset;\n- \n-             proto_tree_add_item(tree, hf_irc_request_command_part_channel, tvb, start_offset, length, ENC_ASCII);\n-             \n-             memset(channel_name, 0, CHANNELLEN+1);\n-             tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-             proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-             start_message++;\n-             length = tvb_captured_length_remaining(tvb, start_message);\n-             proto_tree_add_item(tree, hf_irc_request_command_part_message, tvb, start_message, length, ENC_ASCII);\n- \n-             free(channel_name);\n-             return;\n-         }\n- \n-         memset(channel_name, 0, CHANNELLEN+1);\n-         tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n-         proto_item_append_text(tree, \"Channel: %s\", channel_name);\n- \n-         proto_tree_add_item(tree, hf_irc_request_command_join_channel, tvb, start_offset, length, ENC_ASCII);\n-         start_offset = end_offset + 1;\n-     }\n- \n-     free(channel_name);\n-     return;\n- }\n+static void\n+dissect_irc_join(tvbuff_t *tvb, proto_item *item, int offset)\n+{\n+    proto_tree *tree;\n+    int start_offset;\n+    int end_offset;\n+    int length;\n+    int copy_length;\n+    uint8_t *channel_name;\n+\n+    if (tvb_get_uint8(tvb, offset) != '#')\n+        return;\n+    \n+    start_offset = offset;\n+\n+    channel_name = (uint8_t *)wmem_alloc(wmem_packet_scope(), CHANNELLEN+1);\n+\n+    if (channel_name == NULL ) {\n+        return;\n+    }\n+\n+    tree = proto_item_add_subtree(item, ett_irc_request_command_join);\n+    \n+    /* Parse the channels to join*/\n+    while(tvb_offset_exists(tvb, start_offset) ) {\n+        length = tvb_captured_length_remaining(tvb, start_offset);\n+        end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n+\n+        if ( end_offset == -1 ) {\n+            proto_tree_add_item(tree, hf_irc_request_command_join_channel, tvb, start_offset, length, ENC_ASCII);\n+            \n+            memset(channel_name, 0, CHANNELLEN+1);\n+            tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n+            proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+            return;\n+        }\n+\n+        copy_length = end_offset - start_offset;\n+        memset(channel_name, 0, CHANNELLEN+1);\n+        tvb_memcpy(tvb, channel_name, start_offset, (copy_length < CHANNELLEN) ? copy_length : CHANNELLEN);\n+        proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+        proto_tree_add_item(tree, hf_irc_request_command_join_channel, tvb, start_offset, copy_length, ENC_ASCII);\n+        start_offset = end_offset + 1;\n+    }\n+\n+    return;\n+}\n+ \n+static void\n+dissect_irc_part(tvbuff_t *tvb, proto_item *item, int offset)\n+{\n+    proto_tree *tree;\n+    int start_offset;\n+    int end_offset;\n+    int length;\n+    int copy_length;\n+    uint8_t *channel_name;\n+\n+    if (tvb_get_uint8(tvb, offset) != '#')\n+        return;\n+    \n+    channel_name = (uint8_t *)wmem_alloc(wmem_packet_scope(), CHANNELLEN+1);\n+\n+    if (channel_name == NULL ) {\n+        return;\n+    }\n+\n+    start_offset = offset;\n+\n+    tree = proto_item_add_subtree(item, ett_irc_request_command_part);\n+\n+    while(tvb_offset_exists(tvb, start_offset) ) {\n+        length = tvb_captured_length_remaining(tvb, start_offset);\n+        end_offset = tvb_find_uint8(tvb, start_offset, length, ',');\n+\n+        if ( end_offset == -1 ) {\n+            int start_message = tvb_find_uint8(tvb, start_offset, length, ':');\n+\n+            if ( start_message == -1 ) {\n+                proto_tree_add_item(tree, hf_irc_request_command_part_channel, tvb, start_offset, length, ENC_ASCII);\n+                \n+                memset(channel_name, 0, CHANNELLEN+1);\n+                tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n+                proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+                return;\n+            }\n+\n+            length = start_message-start_offset;\n+\n+            proto_tree_add_item(tree, hf_irc_request_command_part_channel, tvb, start_offset, length, ENC_ASCII);\n+            \n+            memset(channel_name, 0, CHANNELLEN+1);\n+            tvb_memcpy(tvb, channel_name, start_offset, (length < CHANNELLEN) ? length : CHANNELLEN);\n+            proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+            start_message++;\n+            length = tvb_captured_length_remaining(tvb, start_message);\n+            proto_tree_add_item(tree, hf_irc_request_command_part_message, tvb, start_message, length, ENC_ASCII);\n+\n+            return;\n+        }\n+\n+        copy_length = end_offset - start_offset;\n+        memset(channel_name, 0, CHANNELLEN+1);\n+        tvb_memcpy(tvb, channel_name, start_offset, (copy_length < CHANNELLEN) ? copy_length : CHANNELLEN);\n+        proto_item_append_text(tree, \"Channel: %s\", channel_name);\n+\n+        proto_tree_add_item(tree, hf_irc_request_command_part_channel, tvb, start_offset, copy_length, ENC_ASCII);\n+        start_offset = end_offset + 1;\n+    }\n+\n+    return;\n+}\n  \n  static void\n  dissect_irc_privmsg(tvbuff_t *tvb, proto_item *item, int offset)\n",
  "stdout": "+ FUZZER=handler_irc\r\n+ shift\r\n+ '[' '!' -v TESTCASE ']'\r\n+ TESTCASE=/testcase\r\n+ '[' '!' -f /testcase ']'\r\n+ export RUN_FUZZER_MODE=interactive\r\n+ RUN_FUZZER_MODE=interactive\r\n+ export FUZZING_ENGINE=libfuzzer\r\n+ FUZZING_ENGINE=libfuzzer\r\n+ export SKIP_SEED_CORPUS=1\r\n+ SKIP_SEED_CORPUS=1\r\n+ run_fuzzer handler_irc -runs=100 /testcase\r\nvm.mmap_rnd_bits = 28\r\n/out/handler_irc -rss_limit_mb=2560 -timeout=25 -runs=100 /testcase -max_len=1024 -timeout_exitcode=0 < /dev/null\r\noss-fuzzshark: disabling: ip\r\noss-fuzzshark: disabling: udp\r\noss-fuzzshark: disabling: udplite\r\noss-fuzzshark: disabling: ospf\r\noss-fuzzshark: disabling: bgp\r\noss-fuzzshark: disabling: dhcp\r\noss-fuzzshark: disabling: json\r\noss-fuzzshark: disabling: snort\r\noss-fuzzshark: configured for dissector: irc\r\nINFO: Running with entropic power schedule (0xFF, 100).\r\nINFO: Seed: 3750775486\r\nINFO: Loaded 1 modules   (420539 inline 8-bit counters): 420539 [0xa9f93a0, 0xaa5fe5b), \r\nINFO: Loaded 1 PC tables (420539 PCs): 420539 [0xaa5fe60,0xb0caa10), \r\n/out/handler_irc: Running 1 inputs 100 time(s) each.\r\nRunning: /testcase\r\n=================================================================\r\n==18==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x5060001c64f3 at pc 0x000005072fe4 bp 0x7fff98bca550 sp 0x7fff98bc9d10\r\nWRITE of size 132 at 0x5060001c64f3 thread T0\r\nSCARINESS: 45 (multi-byte-write-heap-buffer-overflow)\r\n    #0 0x5072fe3 in __asan_memcpy /src/llvm-project/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:63:3\r\n    #1 0x798508a in memcpy /usr/include/x86_64-linux-gnu/bits/string_fortified.h:34:10\r\n    #2 0x798508a in tvb_memcpy /src/wireshark/epan/tvbuff.c:945:10\r\n    #3 0x6cd14d8 in dissect_irc_names /src/wireshark/epan/dissectors/packet-irc.c:562:10\r\n    #4 0x6ccfef6 in dissect_irc_request_command /src/wireshark/epan/dissectors/packet-irc.c:701:10\r\n    #5 0x6ccfef6 in dissect_irc_request /src/wireshark/epan/dissectors/packet-irc.c:810:6\r\n    #6 0x6ccfef6 in dissect_irc /src/wireshark/epan/dissectors/packet-irc.c:1113:18\r\n    #7 0x5b8733d in call_dissector_through_handle /src/wireshark/epan/packet.c:887:9\r\n    #8 0x5b8733d in call_dissector_work /src/wireshark/epan/packet.c:975:9\r\n    #9 0x5b91f94 in call_dissector_only /src/wireshark/epan/packet.c:3621:8\r\n    #10 0x5b91f94 in call_all_postdissectors /src/wireshark/epan/packet.c:4166:3\r\n    #11 0x544cf47 in dissect_frame /src/wireshark/epan/dissectors/packet-frame.c:1438:5\r\n    #12 0x5b8733d in call_dissector_through_handle /src/wireshark/epan/packet.c:887:9\r\n    #13 0x5b8733d in call_dissector_work /src/wireshark/epan/packet.c:975:9\r\n    #14 0x5b82e37 in call_dissector_only /src/wireshark/epan/packet.c:3621:8\r\n    #15 0x5b82e37 in call_dissector_with_data /src/wireshark/epan/packet.c:3634:8\r\n    #16 0x5b82e37 in dissect_record /src/wireshark/epan/packet.c:687:3\r\n    #17 0x52bf9b0 in epan_dissect_run /src/wireshark/epan/epan.c:666:2\r\n    #18 0x50b63c8 in LLVMFuzzerTestOneInput /src/wireshark/fuzz/fuzzshark.c:359:2\r\n    #19 0x4f690a0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #20 0x4f536c5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #21 0x4f5915f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #22 0x4f85052 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #23 0x7f69b57c1082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n    #24 0x4f4b8ad in _start (/out/handler_irc+0x4f4b8ad)\r\n\r\nDEDUP_TOKEN: __asan_memcpy--memcpy--tvb_memcpy\r\n0x5060001c64f3 is located 0 bytes after 51-byte region [0x5060001c64c0,0x5060001c64f3)\r\nallocated by thread T0 here:\r\n    #0 0x507505f in malloc /src/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:68:3\r\n    #1 0x6cd1441 in dissect_irc_names /src/wireshark/epan/dissectors/packet-irc.c:536:21\r\n    #2 0x6ccfef6 in dissect_irc_request_command /src/wireshark/epan/dissectors/packet-irc.c:701:10\r\n    #3 0x6ccfef6 in dissect_irc_request /src/wireshark/epan/dissectors/packet-irc.c:810:6\r\n    #4 0x6ccfef6 in dissect_irc /src/wireshark/epan/dissectors/packet-irc.c:1113:18\r\n    #5 0x5b8733d in call_dissector_through_handle /src/wireshark/epan/packet.c:887:9\r\n    #6 0x5b8733d in call_dissector_work /src/wireshark/epan/packet.c:975:9\r\n    #7 0x5b91f94 in call_dissector_only /src/wireshark/epan/packet.c:3621:8\r\n    #8 0x5b91f94 in call_all_postdissectors /src/wireshark/epan/packet.c:4166:3\r\n    #9 0x544cf47 in dissect_frame /src/wireshark/epan/dissectors/packet-frame.c:1438:5\r\n    #10 0x5b8733d in call_dissector_through_handle /src/wireshark/epan/packet.c:887:9\r\n    #11 0x5b8733d in call_dissector_work /src/wireshark/epan/packet.c:975:9\r\n    #12 0x5b82e37 in call_dissector_only /src/wireshark/epan/packet.c:3621:8\r\n    #13 0x5b82e37 in call_dissector_with_data /src/wireshark/epan/packet.c:3634:8\r\n    #14 0x5b82e37 in dissect_record /src/wireshark/epan/packet.c:687:3\r\n    #15 0x52bf9b0 in epan_dissect_run /src/wireshark/epan/epan.c:666:2\r\n    #16 0x50b63c8 in LLVMFuzzerTestOneInput /src/wireshark/fuzz/fuzzshark.c:359:2\r\n    #17 0x4f690a0 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13\r\n    #18 0x4f536c5 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6\r\n    #19 0x4f5915f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9\r\n    #20 0x4f85052 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10\r\n    #21 0x7f69b57c1082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 5792732f783158c66fb4f3756458ca24e46e827d)\r\n\r\nDEDUP_TOKEN: __interceptor_malloc--dissect_irc_names--dissect_irc_request_command\r\nSUMMARY: AddressSanitizer: heap-buffer-overflow /usr/include/x86_64-linux-gnu/bits/string_fortified.h:34:10 in memcpy\r\nShadow bytes around the buggy address:\r\n  0x5060001c6200: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa\r\n  0x5060001c6280: 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00\r\n  0x5060001c6300: 00 00 00 fa fa fa fa fa 00 00 00 00 00 00 00 fa\r\n  0x5060001c6380: fa fa fa fa 00 00 00 00 00 00 00 fa fa fa fa fa\r\n  0x5060001c6400: 00 00 00 00 00 00 00 fa fa fa fa fa 00 00 00 00\r\n=>0x5060001c6480: 00 00 00 fa fa fa fa fa 00 00 00 00 00 00[03]fa\r\n  0x5060001c6500: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x5060001c6580: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x5060001c6600: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x5060001c6680: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\n  0x5060001c6700: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\r\nShadow byte legend (one shadow byte represents 8 application bytes):\r\n  Addressable:           00\r\n  Partially addressable: 01 02 03 04 05 06 07 \r\n  Heap left redzone:       fa\r\n  Freed heap region:       fd\r\n  Stack left redzone:      f1\r\n  Stack mid redzone:       f2\r\n  Stack right redzone:     f3\r\n  Stack after return:      f5\r\n  Stack use after scope:   f8\r\n  Global redzone:          f9\r\n  Global init order:       f6\r\n  Poisoned by user:        f7\r\n  Container overflow:      fc\r\n  Array cookie:            ac\r\n  Intra object redzone:    bb\r\n  ASan internal:           fe\r\n  Left alloca redzone:     ca\r\n  Right alloca redzone:    cb\r\n==18==ABORTING\r\nMS: 0 ; base unit: 0000000000000000000000000000000000000000\r\n0x4e,0x41,0x4d,0x45,0x53,0x20,0x23,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x61,0x2c,0x23,0x68,0x65,0x6c,0x6c,0x6f,0xa,\r\nNAMES #aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,#hello\\012\r\nsubprocess command returned a non-zero exit status: 1\n",
  "stderr": "INFO:__main__:Running: docker run --privileged --shm-size=2g --platform linux/amd64 --rm -i -e HELPER=True -e ARCHITECTURE=x86_64 -v /home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/wireshark:/out -v /tmp/tmpfz85lhg2:/testcase -t ghcr.io/aixcc-finals/base-runner:v1.3.0 reproduce handler_irc -runs=100.\n"
}