{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-07_vuln_013",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 2.057217,
    "prompt_tokens": 616764,
    "completion_tokens": 13795
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-gvcp.c\n+++ b/epan/dissectors/packet-gvcp.c\n@@ -981,8 +981,10 @@\n \tuint32_t value = 0;\n \t\n \tvalue = tvb_get_letohl(tvb, offset);\n-\tgvcp_register_number[gvcp_register_count] = addr;\n-\tgvcp_register_value[gvcp_register_count++] = value;\n+\tif (gvcp_register_count < GVCP_MAX_REGISTER_COUNT) {\n+\t\tgvcp_register_number[gvcp_register_count] = addr;\n+\t\tgvcp_register_value[gvcp_register_count++] = value;\n+\t}\n \n \tswitch (addr)\n \t{\n@@ -1496,8 +1498,10 @@\n \tuint32_t value = 0;\n \t\n \tvalue = tvb_get_letohl(tvb, offset);\n-\tgvcp_register_number[gvcp_register_count] = addr;\n-\tgvcp_register_value[gvcp_register_count++] = value;\n+\tif (gvcp_register_count < GVCP_MAX_REGISTER_COUNT) {\n+\t\tgvcp_register_number[gvcp_register_count] = addr;\n+\t\tgvcp_register_value[gvcp_register_count++] = value;\n+\t}\n \n \tswitch (addr)\n \t{\n@@ -1782,6 +1786,11 @@\n \tbool is_custom_register = false;\n \tint num_registers = length / 8; /* divide by 8 because we are counting register-value pairs */\n \tproto_tree *subtree = NULL;\n+\n+\t/* Clamp num_registers to remaining capacity */\n+\tif (num_registers > (int)(GVCP_MAX_REGISTER_COUNT - gvcp_register_count)) {\n+\t\tnum_registers = (int)(GVCP_MAX_REGISTER_COUNT - gvcp_register_count);\n+\t}\n \n \tif (gvcp_trans)\n \t{\n@@ -2273,6 +2282,11 @@\n \n \toffset = startoffset;\n \tnum_registers = length / 4;\n+\n+\t/* Clamp num_registers to remaining capacity */\n+\tif (num_registers > (GVCP_MAX_REGISTER_COUNT - gvcp_register_count)) {\n+\t\tnum_registers = GVCP_MAX_REGISTER_COUNT - gvcp_register_count;\n+\t}\n \n \tif (gvcp_trans && gvcp_trans->addr_list)\n \t{\n@@ -2538,6 +2552,9 @@\n \t\treturn 0;\n \t}\n \n+\t/* Reset global register counter for new packet */\n+\tgvcp_register_count = 0;\n+\n \t/* check for valid key/ack code */\n \tkey_code = (char) tvb_get_uint8(tvb, offset);\n \tack_code = tvb_get_ntohs(tvb, offset+2);\n",
  "stdout": "",
  "stderr": ""
}