{
  "project_name": "lcms",
  "vulnerability_identifier": "lcms_cm-full-01_lcms-002",
  "source_directory": "/home/user/crete/.cache/official-afc-little-cms",
  "llm_usage": {
    "total_cost": 11.932875000000005,
    "prompt_tokens": 3690845,
    "completion_tokens": 57356
  },
  "variant": "sound",
  "diff": "--- a/src/cmsvirt.c\n+++ b/src/cmsvirt.c\n@@ -1070,6 +1070,7 @@\n     cmsHPROFILE hICC = NULL;\n     cmsUInt32Number i, nColors;\n     cmsNAMEDCOLORLIST *nc2 = NULL, *Original = NULL;\n+    cmsUInt16Number index_buffer;\n \n     // Create an empty placeholder\n     hICC = cmsCreateProfilePlaceholder(v->ContextID);\n@@ -1094,13 +1095,16 @@\n     nc2 ->ColorantCount = cmsPipelineOutputChannels(v ->Lut);\n \n     // Make sure we have proper formatters\n-    cmsChangeBuffersFormat(xform, TYPE_NAMED_COLOR_INDEX,\n+    if (!cmsChangeBuffersFormat(xform, TYPE_GRAY_16,\n         FLOAT_SH(0) | COLORSPACE_SH(_cmsLCMScolorSpace(v ->ExitColorSpace))\n-        | BYTES_SH(2) | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)));\n+        | BYTES_SH(2) | CHANNELS_SH(cmsChannelsOfColorSpace(v ->ExitColorSpace)))) {\n+        goto Error;\n+    }\n \n     // Apply the transfor to colorants.\n     for (i=0; i < nColors; i++) {\n-        cmsDoTransform(xform, &i, nc2 ->List[i].DeviceColorant, 1);\n+        index_buffer = (cmsUInt16Number)i;\n+        cmsDoTransform(xform, &index_buffer, nc2 ->List[i].DeviceColorant, 1);\n     }\n \n     if (!cmsWriteTag(hICC, cmsSigNamedColor2Tag, (void*) nc2)) goto Error;\n@@ -1109,6 +1113,7 @@\n     return hICC;\n \n Error:\n+    if (nc2 != NULL) cmsFreeNamedColorList(nc2);\n     if (hICC != NULL) cmsCloseProfile(hICC);\n     return NULL;\n }\n",
  "stdout": "",
  "stderr": ""
}