[2;36m[01/12/26 05:05:35][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=567517;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=345621;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp0rm9tbm0[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-delta-05_vuln_2/[0m[95magent[0m [2m               [0m
[2;36m                    [0m         [95m-output-1768194335.6012669[0m                                                           [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-delta-05_vuln_2.toml [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=368322;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=307346;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:07:23][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m107.61[0m ]8;id=307817;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=231747;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=584711;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=799841;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=72031;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=361367;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=869333;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=683760;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m107[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=963898;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=943755;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:07:24][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.95[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=827702;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=366769;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/12/26 05:07:26][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=46468;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=926074;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=396159;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=783310;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=746576;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=886390;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=656246;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=758671;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:07:27][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.33[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=806328;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=329320;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=243930;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=747432;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:07:28][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.95[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=520231;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=118545;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/12/26 05:07:41][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=355955;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=477740;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp13713179174467699886/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp13713179174467699886/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/12/26 05:08:05][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=117041;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=550079;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/12/26 05:12:32][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=213487;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=539666;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/12/26 05:14:18][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=938724;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=72552;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=125190;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=532044;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:14:19][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.99[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=544071;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=530022;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/12/26 05:14:20][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=639664;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=466052;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpcdgc4t_5[0m                                                 ]8;id=112416;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=737957;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/12/26 05:15:33][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m73.72[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=425844;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=331366;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=944490;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=40383;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:16:07][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m33.35[0m seconds;                ]8;id=894012;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=261667;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=526935;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=893321;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:16:19][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.87[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=256731;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=216547;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=411751;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=68646;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=755061;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=231254;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=350895;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=796212;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:16:20][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.97[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=616971;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=644025;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/12/26 05:16:21][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=353657;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=825793;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:16:22][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.96[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=538685;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=487864;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=611533;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=786859;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/12/26 05:16:23][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.96[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=816429;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=965034;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/12/26 05:16:24][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=442130;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=522087;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java                       [2m                [0m
[2;36m                    [0m         +++ b/tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java                       [2m                [0m
[2;36m                    [0m         @@ [1;36m-1138[0m,[1;36m29[0m +[1;36m1138[0m,[1;36m68[0m @@                                                             [2m                [0m
[2;36m                    [0m                      [35m/[0m[35m/[0m[95mdefensively[0m do this so that we don't get an exception                [2m                [0m
[2;36m                    [0m                      [35m/[0m[35m/[0m[95mfrom[0m FilenameUtils.normalize                                         [2m                [0m
[2;36m                    [0m                      name = [1;35mname.replaceAll[0m[1m([0m[32m"\u0000"[0m, [32m" "[0m[1m)[0m;                                 [2m                [0m
[2;36m                    [0m         -            String normalizedName = [1;35mFilenameUtils.normalize[0m[1m([0mname[1m)[0m;                 [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -            if [1m([0mnormalizedName == null[1m)[0m [1m{[0m                                          [2m                [0m
[2;36m                    [0m         -                normalizedName = [1;35mFilenameUtils.getName[0m[1m([0mname[1m)[0m;                      [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -            if [1m([0mnormalizedName == null[1m)[0m [1m{[0m                                          [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m[95mstrip[0m off initial C:[35m/[0m or ~[35m/[0m or [35m/[0m early to prevent issues             [2m                [0m
[2;36m                    [0m         +            int prefixLength = [1;35mFilenameUtils.getPrefixLength[0m[1m([0mname[1m)[0m;                [2m                [0m
[2;36m                    [0m         +            if [1m([0mprefixLength > [1;36m-1[0m[1m)[0m [1m{[0m                                               [2m                [0m
[2;36m                    [0m         +                name = [1;35mname.substring[0m[1m([0mprefixLength[1m)[0m;                               [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m Use Tika's [1;35mgetName[0m[1m([0m[1m)[0m to strip all directory components first        [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m This prevents path traversal by removing [35m/[0m, \, and : separators     [2m                [0m
[2;36m                    [0m         +            String baseName = [1;35morg.apache.tika.io.FilenameUtils.getName[0m[1m([0mname[1m)[0m;      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m If [1;35mgetName[0m[1m([0m[1m)[0m returns empty [1m([0mfor paths like [32m"."[0m or [32m".."[0m[1m)[0m, use        [2m                [0m
[2;36m                    [0m         fallback                                                                            [2m                [0m
[2;36m                    [0m         +            String normalizedName;                                                 [2m                [0m
[2;36m                    [0m         +            if [1m([0mbaseName == null || [1;35mbaseName.isEmpty[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m                          [2m                [0m
[2;36m                    [0m                          normalizedName = [32m"file"[0m + count++ + ext;                           [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -            [35m/[0m[35m/[0m[95mstrip[0m off initial C:[35m/[0m or ~[35m/[0m or [35m/[0m                                     [2m                [0m
[2;36m                    [0m         -            int prefixLength = [1;35mFilenameUtils.getPrefixLength[0m[1m([0mnormalizedName[1m)[0m;      [2m                [0m
[2;36m                    [0m         -            if [1m([0mprefixLength > [1;36m-1[0m[1m)[0m [1m{[0m                                               [2m                [0m
[2;36m                    [0m         -                normalizedName = [1;35mnormalizedName.substring[0m[1m([0mprefixLength[1m)[0m;           [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +            [1m}[0m else [1m{[0m                                                               [2m                [0m
[2;36m                    [0m         +                [35m/[0m[35m/[0m Now normalize the basename to handle special characters         [2m                [0m
[2;36m                    [0m         +                [35m/[0m[35m/[0m Apache Commons IO [1;35mnormalize[0m[1m([0m[1m)[0m is safe here since directories    [2m                [0m
[2;36m                    [0m         are already stripped                                                                [2m                [0m
[2;36m                    [0m         +                normalizedName = [1;35mFilenameUtils.normalize[0m[1m([0mbaseName[1m)[0m;                [2m                [0m
[2;36m                    [0m         +                if [1m([0mnormalizedName == null || [1;35mnormalizedName.isEmpty[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m          [2m                [0m
[2;36m                    [0m         +                    normalizedName = [32m"file"[0m + count++ + ext;                       [2m                [0m
[2;36m                    [0m         +                [1m}[0m                                                                  [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m                      try [1m{[0m                                                                  [2m                [0m
[2;36m                    [0m                          normalizedName = [1;35mURLDecoder.decode[0m[1m([0mnormalizedName, UTF_8[1m)[0m;         [2m                [0m
[2;36m                    [0m                      [1m}[0m catch [1m([0mIllegalArgumentException e[1m)[0m [1m{[0m                                 [2m                [0m
[2;36m                    [0m                          [1;35mLOG.warn[0m[1m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m, normalizedName[1m)[0m;           [2m                [0m
[2;36m                    [0m                      [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m                      File outputFile = new [1;35mFile[0m[1m([0mextractDir, normalizedName[1m)[0m;                [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +            [35m/[0m[35m/[0m Validate the canonical path stays within extractDir                 [2m                [0m
[2;36m                    [0m         +            try [1m{[0m                                                                  [2m                [0m
[2;36m                    [0m         +                String canonicalExtractDir = [1;35mextractDir.getCanonicalPath[0m[1m([0m[1m)[0m;        [2m                [0m
[2;36m                    [0m         +                String canonicalOutputPath = [1;35moutputFile.getCanonicalPath[0m[1m([0m[1m)[0m;        [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +                [35m/[0m[35m/[0m Check if output file is within the extraction directory         [2m                [0m
[2;36m                    [0m         +                if [1m([0m![1;35mcanonicalOutputPath.startsWith[0m[1m([0mcanonicalExtractDir +          [2m                [0m
[2;36m                    [0m         File.separator[1m)[0m &&                                                                  [2m                [0m
[2;36m                    [0m         +                    ![1;35mcanonicalOutputPath.equals[0m[1m([0mcanonicalExtractDir[1m)[0m[1m)[0m [1m{[0m            [2m                [0m
[2;36m                    [0m         +                    [35m/[0m[35m/[0m Path traversal detected - fall back to safe filename        [2m                [0m
[2;36m                    [0m         +                    [1;35mLOG.warn[0m[1m([0m[32m"Path traversal attempt detected for file: [0m[32m{[0m[32m}[0m[32m"[0m,       [2m                [0m
[2;36m                    [0m         name[1m)[0m;                                                                              [2m                [0m
[2;36m                    [0m         +                    String safeName =                                              [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.io.FilenameUtils.getName[0m[1m([0mnormalizedName[1m)[0m;                           [2m                [0m
[2;36m                    [0m         +                    if [1m([0msafeName == null || [1;35msafeName.isEmpty[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m                  [2m                [0m
[2;36m                    [0m         +                        safeName = [32m"file"[0m + count++ + ext;                         [2m                [0m
[2;36m                    [0m         +                    [1m}[0m                                                              [2m                [0m
[2;36m                    [0m         +                    outputFile = new [1;35mFile[0m[1m([0mextractDir, safeName[1m)[0m;                   [2m                [0m
[2;36m                    [0m         +                [1m}[0m                                                                  [2m                [0m
[2;36m                    [0m         +            [1m}[0m catch [1m([0mIOException e[1m)[0m [1m{[0m                                              [2m                [0m
[2;36m                    [0m         +                [35m/[0m[35m/[0m If canonical path resolution fails, use safe fallback           [2m                [0m
[2;36m                    [0m         +                [1;35mLOG.warn[0m[1m([0m[32m"Failed to resolve canonical path for: [0m[32m{[0m[32m}[0m[32m"[0m,               [2m                [0m
[2;36m                    [0m         normalizedName, e[1m)[0m;                                                                 [2m                [0m
[2;36m                    [0m         +                String safeName = [32m"file"[0m + count++ + ext;                          [2m                [0m
[2;36m                    [0m         +                outputFile = new [1;35mFile[0m[1m([0mextractDir, safeName[1m)[0m;                       [2m                [0m
[2;36m                    [0m         +            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m                      [35m/[0m[35m/[0m[95mif[0m file already exists, prepend uuid                                 [2m                [0m
[2;36m                    [0m                      if [1m([0m[1;35moutputFile.exists[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m                                             [2m                [0m
[2;36m                    [0m         -                String fileName = [1;35mFilenameUtils.getName[0m[1m([0mnormalizedName[1m)[0m;           [2m                [0m
[2;36m                    [0m         +                String fileName =                                                  [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.io.FilenameUtils.getName[0m[1m([0mnormalizedName[1m)[0m;                           [2m                [0m
[2;36m                    [0m         +                if [1m([0mfileName == null || [1;35mfileName.isEmpty[0m[1m([0m[1m)[0m[1m)[0m [1m{[0m                      [2m                [0m
[2;36m                    [0m         +                    [35m/[0m[35m/[0m Use safe fallback instead of potentially unsafe             [2m                [0m
[2;36m                    [0m         normalizedName                                                                      [2m                [0m
[2;36m                    [0m         +                    fileName = [32m"file"[0m + count++ + ext;                             [2m                [0m
[2;36m                    [0m         +                [1m}[0m                                                                  [2m                [0m
[2;36m                    [0m                          outputFile = new [1;35mFile[0m[1m([0mextractDir, UUID                             [2m                [0m
[2;36m                    [0m                                  [1;35m.randomUUID[0m[1m([0m[1m)[0m                                              [2m                [0m
[2;36m                    [0m                                  [1;35m.toString[0m[1m([0m[1m)[0m + [32m"-"[0m + fileName[1m)[0m;                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp13713179174467699886/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:304[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1m([0mFilePathTraversa [2m                [0m
[2;36m                    [0m         l.jav[1;92ma:288[0m[1m)[0m                                                                         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1m([0mFilePathTraversal.jav[1;92ma:256[0m[1m)[0m                                                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1057[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:486[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:238[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: ea76e639355e804b                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A critical file path traversal vulnerability has been detected in Apache Tika's     [2m                [0m
[2;36m                    [0m         file extraction functionality. The vulnerability allows an attacker to craft        [2m                [0m
[2;36m                    [0m         malicious archive files that can extract contents outside of the intended           [2m                [0m
[2;36m                    [0m         extraction directory using path traversal sequences [1m([0me.g., `..[35m/../[0m`[1m)[0m. The issue was [2m                [0m
[2;36m                    [0m         discovered during fuzzing and manifests when processing embedded documents from     [2m                [0m
[2;36m                    [0m         package/archive files, potentially allowing arbitrary file writes to sensitive      [2m                [0m
[2;36m                    [0m         locations on the filesystem.                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Vulnerability Type                                                              [2m                [0m
[2;36m                    [0m         This is a **File Path Traversal** vulnerability [1m([0malso known as Directory Traversal  [2m                [0m
[2;36m                    [0m         or Path Traversal[1m)[0m, classified as a critical security issue. The vulnerability      [2m                [0m
[2;36m                    [0m         enables attackers to write files outside the intended directory boundary by         [2m                [0m
[2;36m                    [0m         manipulating file paths within archive entries.                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Issue Details                                                                   [2m                [0m
[2;36m                    [0m         The security exception is triggered when Tika attempts to extract an embedded file  [2m                [0m
[2;36m                    [0m         with a malicious path:                                                              [2m                [0m
[2;36m                    [0m         `[35m/tmp/expander-tmp13713179174467699886/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m`. This [2m                [0m
[2;36m                    [0m         path contains directory traversal sequences [1m([0m`..[35m/../[0m`[1m)[0m that would cause the         [2m                [0m
[2;36m                    [0m         extracted file to be written outside the intended output directory structure.       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The traversal sequence in this specific case would resolve to                       [2m                [0m
[2;36m                    [0m         `[35m/tmp/expander-tmp13713179174467699886/output/q/r/s/[0m[95mjazzer-traversal[0m`, effectively  [2m                [0m
[2;36m                    [0m         bypassing multiple directory levels. In more severe cases, such sequences could     [2m                [0m
[2;36m                    [0m         potentially write files to arbitrary locations on the filesystem.                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Stack Trace Analysis                                                            [2m                [0m
[2;36m                    [0m         The vulnerability is detected by Jazzer's security sanitizer                        [2m                [0m
[2;36m                    [0m         [1m([0m`FilePathTraversal.check`[1m)[0m before the malicious operation completes. The call      [2m                [0m
[2;36m                    [0m         stack reveals the following execution flow:                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **Entry Point**: `[1;35mTikaCLI.main[0m[1m([0m[1m)[0m` → `[1;35mTikaCLI.process[0m[1m([0m[1m)[0m` → Output type processing [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **Parser Chain**: `[1;35mAutoDetectParser.parse[0m[1m([0m[1m)[0m` → `[1;35mCompositeParser.parse[0m[1m([0m[1m)[0m` →       [2m                [0m
[2;36m                    [0m         `[1;35mPackageParser.parse[0m[1m([0m[1m)[0m`                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Extraction Logic**: `[1;35mPackageParser._parse[0m[1m([0m[1m)[0m` → `[1;35mPackageParser.parseEntries[0m[1m([0m[1m)[0m`  [2m                [0m
[2;36m                    [0m         → `[1;35mPackageParser.parseEntry[0m[1m([0m[1m)[0m`                                                      [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Vulnerable Operation**:                                                        [2m                [0m
[2;36m                    [0m         `TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0m[1m)[0m` - This is where the file    [2m                [0m
[2;36m                    [0m         output operation with the malicious path is initiated                               [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **Detection**: `[1;35mFilePathTraversal.processFileOutputStartHook[0m[1m([0m[1m)[0m` - Jazzer's       [2m                [0m
[2;36m                    [0m         sanitizer catches the traversal attempt                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Key Observations                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **Location of Vulnerability**: The issue originates in the                       [2m                [0m
[2;36m                    [0m         `[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0m[1m)[0m` method within TikaCLI, which is     [2m                [0m
[2;36m                    [0m         responsible for extracting embedded documents from package files without proper     [2m                [0m
[2;36m                    [0m         path sanitization.                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **Archive Processing**: The vulnerability is triggered during the parsing of     [2m                [0m
[2;36m                    [0m         package/archive formats [1m([0mhandled by `PackageParser`[1m)[0m, suggesting that malicious     [2m                [0m
[2;36m                    [0m         archive entries can specify arbitrary extraction paths.                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Temporary Directory Usage**: The system creates temporary directories [1m([0me.g.,   [2m                [0m
[2;36m                    [0m         `[35m/tmp/expander-tmp13713179174467699886/output/[0m`[1m)[0m for extraction, but the path       [2m                [0m
[2;36m                    [0m         validation occurs too late or is insufficient to prevent traversal attacks.         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Detection vs Prevention**: The issue was caught by Jazzer's runtime security   [2m                [0m
[2;36m                    [0m         sanitizer rather than being prevented by Tika's own validation logic, indicating a  [2m                [0m
[2;36m                    [0m         lack of proper input validation in the extraction code path.                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Areas for Investigation                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         To gain a holistic understanding of this vulnerability, the following components    [2m                [0m
[2;36m                    [0m         should be examined:                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **TikaCLI$FileEmbeddedDocumentExtractor** [1m([0mTikaCLI.jav[1;92ma:1111[0m[1m)[0m:                   [2m                [0m
[2;36m                    [0m            - How embedded document extraction paths are constructed                         [2m                [0m
[2;36m                    [0m            - Whether any path validation or sanitization is performed                       [2m                [0m
[2;36m                    [0m            - How file names from archive entries are handled                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **PackageParser** [1m([0morg.apache.tika.parser.pkg.PackageParser[1m)[0m:                    [2m                [0m
[2;36m                    [0m            - Methods: `[1;35mparseEntry[0m[1m([0m[1m)[0m`, `[1;35mparseEntries[0m[1m([0m[1m)[0m`, `[1;35m_parse[0m[1m([0m[1m)[0m`, and `[1;35mparse[0m[1m([0m[1m)[0m`           [2m                [0m
[2;36m                    [0m            - How archive entry names/paths are extracted and processed                      [2m                [0m
[2;36m                    [0m            - Whether the parser trusts the paths provided in archive entries without        [2m                [0m
[2;36m                    [0m         validation                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **File Output Mechanism**:                                                       [2m                [0m
[2;36m                    [0m            - Where and how output paths are constructed when extracting files               [2m                [0m
[2;36m                    [0m            - Whether there are any existing path validation utilities in the codebase       [2m                [0m
[2;36m                    [0m            - How temporary directories are created and managed                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Related Archive Parsers**:                                                     [2m                [0m
[2;36m                    [0m            - Other parsers that might handle archive formats [1m([0mZIP, TAR, 7Z, etc.[1m)[0m           [2m                [0m
[2;36m                    [0m            - Whether similar vulnerabilities exist in other extraction code paths           [2m                [0m
[2;36m                    [0m            - Common utilities or base classes used for file extraction across different     [2m                [0m
[2;36m                    [0m         parser implementations                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **Input Validation Layer**:                                                      [2m                [0m
[2;36m                    [0m            - Whether Tika has a centralized path validation mechanism                       [2m                [0m
[2;36m                    [0m            - If path sanitization is performed, at what layer it occurs                     [2m                [0m
[2;36m                    [0m            - Gap analysis between where validation should occur vs. where it currently      [2m                [0m
[2;36m                    [0m         occurs                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: [0m   [2m                [0m
[2;36m                    [0m         [39mFile path traversal: [0m                                                               [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp13713179174467699886/output/q/r/s/t/../../[0m[95mjazzer-traversal[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1;39m([0m[39mFilePathTraversal.j[0m [2m                [0m
[2;36m                    [0m         [39mav[0m[1;92ma:346[0m[1;39m)[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkFile[0m[1;39m([0m[39mFilePathTravers[0m [2m                [0m
[2;36m                    [0m         [39mal.jav[0m[1;92ma:304[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkObj[0m[1;39m([0m[39mFilePathTraversa[0m [2m                [0m
[2;36m                    [0m         [39ml.jav[0m[1;92ma:288[0m[1;39m)[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.processFileOutputStartHoo[0m [2m                [0m
[2;36m                    [0m         [1;35mk[0m[1;39m([0m[39mFilePathTraversal.jav[0m[1;92ma:256[0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.tika.cli.TikaCLI$[0m[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1;39m([0m[39mTikaCLI.jav[0m [2m                [0m
[2;36m                    [0m         [1;92ma:1111[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.tika.cli.TikaCLI$[0m[1;35mOutputType.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:1057[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:486[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:238[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:54[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: ea76e639355e804b[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:19[0m[39m-[0m[1;36m19[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:59[0m[39m-[0m[1;36m59[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1080[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:    private class FileEmbeddedDocumentExtractor implements [0m                    [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentExtractor [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:            File outputFile = null;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            File parent = [0m[1;35moutputFile.getParentFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mparent.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mparent.mkdirs[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"unable to create directory \""[0m[39m + [0m   [2m                [0m
[2;36m                    [0m         [39mparent + [0m[32m"\""[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:            [0m[1;35mSystem.out.println[0m[1;39m([0m[32m"Extracting '"[0m[39m + name + [0m[32m"' [0m[32m([0m[32m"[0m[39m + contentType + [0m  [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m to "[0m[39m + outputFile[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:            try [0m[1;39m([0m[39mFileOutputStream os = new [0m[1;35mFileOutputStream[0m[1;39m([0m[39moutputFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m     [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                if [0m[1;39m([0m[1;35membeddedStreamTranslator.shouldTranslate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                    try [0m[1;39m([0m[39mInputStream translated = [0m                             [2m                [0m
[2;36m                    [0m         [1;35membeddedStreamTranslator.translate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:                        [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtranslated, os[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:                    [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtis, os[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                [0m[35m/[0m[35m/[0m[39m being a CLI program messages should go to the stderr too[0m    [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                String msg = [0m[1;35mString.format[0m[1;39m([0m[39mLocale.ROOT, [0m[32m"Ignoring unexpected [0m  [2m                [0m
[2;36m                    [0m         [32mexception trying to save embedded file %s [0m[32m([0m[32m%s[0m[32m)[0m[32m"[0m[39m, name, [0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[39mmsg, e[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:20[0m[39m-[0m[1;36m76[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.AR;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.ARJ;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.CPIO;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.DUMP;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.JAR;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.SEVENZ;[0m                [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.TAR;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.ZIP;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.io.BufferedInputStream;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Date;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import java.util.concurrent.atomic.AtomicInteger;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import java.util.zip.ZipEntry;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.commons.compress.PasswordRequiredException;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.commons.compress.archivers.ArchiveEntry;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import org.apache.commons.compress.archivers.ArchiveException;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.apache.commons.compress.archivers.ArchiveInputStream;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import org.apache.commons.compress.archivers.ArchiveStreamFactory;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.commons.compress.archivers.StreamingNotSupportedException;[0m     [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.commons.compress.archivers.ar.ArArchiveInputStream;[0m            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream;[0m        [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import org.apache.commons.compress.archivers.dump.DumpArchiveInputStream;[0m        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import org.apache.commons.compress.archivers.jar.JarArchiveInputStream;[0m          [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import org.apache.commons.compress.archivers.sevenz.SevenZFile;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import org.apache.commons.compress.archivers.tar.TarArchiveInputStream;[0m          [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import org.apache.commons.compress.archivers.zip.UnsupportedZipFeatureException;[0m [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import [0m                                                                          [2m                [0m
[2;36m                    [0m         [39morg.apache.commons.compress.archivers.zip.UnsupportedZipFeatureException.Feature;[0m   [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import org.apache.commons.compress.archivers.zip.ZipArchiveEntry;[0m                [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import org.apache.commons.compress.archivers.zip.ZipArchiveInputStream;[0m          [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:import org.apache.commons.io.input.UnsynchronizedByteArrayInputStream;[0m           [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.xml.sax.helpers.AttributesImpl;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:import org.apache.tika.detect.EncodingDetector;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:import org.apache.tika.exception.EncryptedDocumentException;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentExtractor;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentUtil;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:import org.apache.tika.io.TemporaryResources;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:import org.apache.tika.parser.AbstractEncodingDetectorParser;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:import org.apache.tika.parser.PasswordProvider;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:import org.apache.tika.sax.XHTMLContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:450[0m[39m-[0m[1;36m490[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/RollbackSoftware.jav[0m[1;92ma:71[0m[39m-[0m[1;36m77[0m      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    private boolean [0m[1;35misSymlink[0m[1;39m([0m[39mFile f[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:        return !f[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:                [0m[1;35m.getAbsolutePath[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:                [0m[1;35m.equals[0m[1;39m([0m[1;35mf.getCanonicalPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:208[0m[39m-[0m[1;36m233[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:    protected static Metadata [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mString name, Date createAt, [0m  [2m                [0m
[2;36m                    [0m         [39mDate modifiedAt,[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                                                  Long size, [0m                   [2m                [0m
[2;36m                    [0m         [39mXHTMLContentHandler xhtml[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:        Metadata entrydata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:        if [0m[1;39m([0m[39mcreateAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.CREATED, createAt[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:        if [0m[1;39m([0m[39mmodifiedAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.MODIFIED, modifiedAt[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:        if [0m[1;39m([0m[39msize != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mMetadata.CONTENT_LENGTH, [0m[1;35mLong.toString[0m[1;39m([0m[39msize[0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:        if [0m[1;39m([0m[39mname != null && [0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:            name = [0m[1;35mname.replace[0m[1;39m([0m[32m"\\", "[0m[35m/[0m[39m"[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:            AttributesImpl attributes = new [0m[1;35mAttributesImpl[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"CDATA"[0m[39m, [0m[32m"embedded"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"CDATA"[0m[39m, name[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:            [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"div"[0m[39m, attributes[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:            [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"div"[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID, name[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:        return entrydata;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:121[0m[39m-[0m[1;36m127[0m                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:        @Override[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:        protected ContentHandler [0m[1;35mgetContentHandler[0m[1;39m([0m[39mOutputStream output, [0m        [2m                [0m
[2;36m                    [0m         [39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:            return new [0m[1;35mDefaultHandler[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:    [0m[1;39m}[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:    private File extractDir = new [0m[1;35mFile[0m[1;39m([0m[32m"."[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:    private ParseContext context;[0m                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:443[0m[39m-[0m[1;36m453[0m                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m443[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35marg.startsWith[0m[1;39m([0m[32m"--extract-[0m[32mdir[0m[32m="[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m444[0m[39m:            String dirPath = [0m[1;35marg.substring[0m[1;39m([0m[32m"--extract-[0m[32mdir[0m[32m="[0m[1;35m.length[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m445[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m the user accidentally doesn't include[0m                          [2m                [0m
[2;36m                    [0m         [1;36m446[0m[39m:            [0m[35m/[0m[35m/[0m[95ma[0m[39m directory, set the directory to the cwd[0m                         [2m                [0m
[2;36m                    [0m         [1;36m447[0m[39m:            if [0m[1;39m([0m[1;35mdirPath.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m448[0m[39m:                dirPath = [0m[32m"."[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m449[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            extractDir = new [0m[1;35mFile[0m[1;39m([0m[39mdirPath[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35marg.equals[0m[1;39m([0m[32m"-z"[0m[1;39m)[0m[39m || [0m[1;35marg.equals[0m[1;39m([0m[32m"--extract"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:            type = NO_OUT[0m[1;33mPUT[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:            [0m[1;35mcontext.set[0m[1;39m([0m[39mEmbeddedDocumentExtractor.class, new [0m                   [2m                [0m
[2;36m                    [0m         [1;35mFileEmbeddedDocumentExtractor[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/UnrarParser.jav[0m[1;92ma:138[0m[39m-[0m[1;36m153[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:    private FileProcessResult [0m[1;35munrar[0m[1;39m([0m[39mPath cwd, Path tmp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m could use the -l option to check for potentially bad file names[0m    [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:        [0m[35m/[0m[35m/[0m[95me.g.[0m[39m path traversals[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mcwd.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;35mpb.command[0m[1;39m([0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[32m"unrar"[0m[39m,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:                [0m[32m"x"[0m[39m,  [0m[35m/[0m[35m/[0m[95mextract[0m[39m with paths[0m[33m...[0m[39mhope that unrar protects against [0m  [2m                [0m
[2;36m                    [0m         [39mpath traversals[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:                [0m[32m"-kb"[0m[39m, [0m[35m/[0m[35m/[0m[39m keep broken files[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[32m"-p-"[0m[39m, [0m[35m/[0m[35m/[0m[39m we don't support passwords yet -- don't hang waiting [0m [2m                [0m
[2;36m                    [0m         [39mfor password on stdin[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:                [0m[1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mtmp.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:        [0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/io/FilenameUtils.jav[0m[1;92ma:78[0m[39m-[0m[1;36m112[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * This is a duplication of the algorithm and functionality[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * available in commons io FilenameUtils.  If Java's File were[0m               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * able handle Windows file paths correctly in linux,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * we wouldn't need this.[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * The goal of this is to get a filename from a path.[0m                        [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * The package parsers and some other embedded doc[0m                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * extractors could put anything into TikaCoreProperties.RESOURCE_NAME_KEY.[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * If a careless client used that filename as if it were a[0m                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     * filename and not a path when writing embedded files,[0m                      [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * bad things could happen.  Consider: [0m[32m"../../../my_ppt.ppt"[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     * Consider using this in combination with [0m[1;39m{[0m[39m@link #[0m[1;35mnormalize[0m[1;39m([0m[39mString[0m[1;39m)[0m[1;39m}[0m[39m.[0m       [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param path path to strip[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return empty string or a filename, never null[0m                            [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    public static String [0m[1;35mgetName[0m[1;39m([0m[39mfinal String path[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39mpath == null || [0m[1;35mpath.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        int unix = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        int windows = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[39m"\\"[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[95msome[0m[39m macintosh file names are stored with : as the delimiter[0m          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        [0m[35m/[0m[35m/[0m[95malso[0m[39m necessary to properly handle C:somefilename[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        int colon = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m":"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        String cand = [0m[1;35mpath.substring[0m[1;39m([0m[1;35mMath.max[0m[1;39m([0m[39mcolon, [0m[1;35mMath.max[0m[1;39m([0m[39munix, windows[0m[1;39m)[0m[1;39m)[0m[39m +[0m [2m                [0m
[2;36m                    [0m         [1;36m1[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[1;35mcand.equals[0m[1;39m([0m[32m".."[0m[1;39m)[0m[39m || [0m[1;35mcand.equals[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return cand;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.jav[0m[1;92ma:88[0m[39m-[0m[1;36m93[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                int prefix = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                if [0m[1;39m([0m[39mprefix > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                    name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefix[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.jav[0m[1;92ma:80[0m[39m-[0m[1;36m110[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:                name = [0m[32m"file_"[0m[39m + fileCount++;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:                [0m[35m/[0m[35m/[0m[95mmake[0m[39m sure to select only the file name [0m[1;39m([0m[39mnot any directory [0m     [2m                [0m
[2;36m                    [0m         [39mpaths[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                [0m[35m/[0m[35m/[0m[95mthat[0m[39m might be included in the name[0m[1;39m)[0m[39m and make sure[0m              [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                [0m[35m/[0m[35m/[0m[95mto[0m[39m normalize the name[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                int prefix = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                if [0m[1;39m([0m[39mprefix > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                    name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefix[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            [0m[35m/[0m[35m/[0m[95mnow[0m[39m try to figure out the right extension for the embedded file[0m    [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mstream, metadata[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:                    name += config[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                            [0m[1;35m.getMimeRepository[0m[1;39m([0m[1;39m)[0m                                [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:                            [0m[1;35m.forName[0m[1;39m([0m[1;35mcontentType.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:                            [0m[1;35m.getExtension[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mMimeTypeException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:                    [0m[1;35me.printStackTrace[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            Path outputFile = [0m[1;35moutputDir.resolve[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/test/java/org/apache/tika/cli/TikaCLITest.jav[0m[1;92ma:337[0m[39m-[0m[1;36m355[0m                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m337[0m[39m:    private void [0m[1;35mtestExtract[0m[1;39m([0m[39mString targetFile, String[0m[1;39m[[0m[1;39m][0m[39m [0m                       [2m                [0m
[2;36m                    [0m         [39mexpectedChildrenFileNames, int expectedLength[0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m338[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m params = [0m[1;39m{[0m[32m"--extract-[0m[32mdir[0m[32m="[0m[39m + [0m                                  [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[39mextractDir[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:                [0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:                [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m, [0m[32m"-z"[0m[39m, resourcePrefix + [0m[32m"/"[0m[39m + targetFile[0m[1;39m}[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:        [0m[1;35mTikaCLI.main[0m[1;39m([0m[39mparams[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m tempFileNames = extractDir[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:                [0m[1;35m.toFile[0m[1;39m([0m[1;39m)[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:                [0m[1;35m.list[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:        [0m[1;35massertNotNull[0m[1;39m([0m[39mtempFileNames[0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[39mexpectedLength, tempFileNames.length[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:        String allFiles = [0m[1;35mString.join[0m[1;39m([0m[32m" : "[0m[39m, tempFileNames[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m351[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m352[0m[39m:        for [0m[1;39m([0m[39mString expectedChildName : expectedChildrenFileNames[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m353[0m[39m:            [0m[1;35massertExtracted[0m[1;39m([0m[1;35mextractDir.resolve[0m[1;39m([0m[39mexpectedChildName[0m[1;39m)[0m[39m, allFiles[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m354[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m355[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1100[0m[39m-[0m[1;36m1120[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            File parent = [0m[1;35moutputFile.getParentFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mparent.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mparent.mkdirs[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"unable to create directory \""[0m[39m + [0m   [2m                [0m
[2;36m                    [0m         [39mparent + [0m[32m"\""[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:            [0m[1;35mSystem.out.println[0m[1;39m([0m[32m"Extracting '"[0m[39m + name + [0m[32m"' [0m[32m([0m[32m"[0m[39m + contentType + [0m  [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m to "[0m[39m + outputFile[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:            try [0m[1;39m([0m[39mFileOutputStream os = new [0m[1;35mFileOutputStream[0m[1;39m([0m[39moutputFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m     [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                if [0m[1;39m([0m[1;35membeddedStreamTranslator.shouldTranslate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                    try [0m[1;39m([0m[39mInputStream translated = [0m                             [2m                [0m
[2;36m                    [0m         [1;35membeddedStreamTranslator.translate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:                        [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtranslated, os[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:                    [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtis, os[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-server/tika-server-core/src/main/java/org/apache/tika/server/core/resource/Unp[0m [2m                [0m
[2;36m                    [0m         [39mackerResource.jav[0m[1;92ma:246[0m[39m-[0m[1;36m268[0m                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m246[0m[39m:        private String [0m[1;35mgetFinalName[0m[1;39m([0m[39mString name, Map<String, byte[0m[1;39m[[0m[1;39m][0m[39m> zout[0m[1;39m)[0m[39m [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m247[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m248[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m249[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m250[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m251[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m252[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m253[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m254[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m255[0m[39m:                normalizedName = [0m[1;35mcount.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m256[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:            if [0m[1;39m([0m[1;35mzout.containsKey[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:                return UUID[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + normalizedName;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:            return normalizedName;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1128[0m[39m-[0m[1;36m1169[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:                normalizedName = [0m[1;35mURLDecoder.decode[0m[1;39m([0m[39mnormalizedName, UTF_8[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalArgumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[32m"couldn't url decode name [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:59[0m[39m-[0m[1;36m60[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/io/FilenameUtils.jav[0m[1;92ma:78[0m[39m-[0m[1;36m112[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * This is a duplication of the algorithm and functionality[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * available in commons io FilenameUtils.  If Java's File were[0m               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * able handle Windows file paths correctly in linux,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * we wouldn't need this.[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * The goal of this is to get a filename from a path.[0m                        [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * The package parsers and some other embedded doc[0m                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * extractors could put anything into TikaCoreProperties.RESOURCE_NAME_KEY.[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * If a careless client used that filename as if it were a[0m                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     * filename and not a path when writing embedded files,[0m                      [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * bad things could happen.  Consider: [0m[32m"../../../my_ppt.ppt"[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     * Consider using this in combination with [0m[1;39m{[0m[39m@link #[0m[1;35mnormalize[0m[1;39m([0m[39mString[0m[1;39m)[0m[1;39m}[0m[39m.[0m       [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param path path to strip[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return empty string or a filename, never null[0m                            [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    public static String [0m[1;35mgetName[0m[1;39m([0m[39mfinal String path[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39mpath == null || [0m[1;35mpath.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        int unix = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        int windows = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[39m"\\"[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[95msome[0m[39m macintosh file names are stored with : as the delimiter[0m          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        [0m[35m/[0m[35m/[0m[95malso[0m[39m necessary to properly handle C:somefilename[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        int colon = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m":"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        String cand = [0m[1;35mpath.substring[0m[1;39m([0m[1;35mMath.max[0m[1;39m([0m[39mcolon, [0m[1;35mMath.max[0m[1;39m([0m[39munix, windows[0m[1;39m)[0m[1;39m)[0m[39m +[0m [2m                [0m
[2;36m                    [0m         [1;36m1[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[1;35mcand.equals[0m[1;39m([0m[32m".."[0m[1;39m)[0m[39m || [0m[1;35mcand.equals[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return cand;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.jav[0m[1;92ma:88[0m[39m-[0m[1;36m93[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                int prefix = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                if [0m[1;39m([0m[39mprefix > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                    name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefix[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:208[0m[39m-[0m[1;36m233[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:    protected static Metadata [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mString name, Date createAt, [0m  [2m                [0m
[2;36m                    [0m         [39mDate modifiedAt,[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                                                  Long size, [0m                   [2m                [0m
[2;36m                    [0m         [39mXHTMLContentHandler xhtml[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:        Metadata entrydata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:        if [0m[1;39m([0m[39mcreateAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.CREATED, createAt[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:        if [0m[1;39m([0m[39mmodifiedAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.MODIFIED, modifiedAt[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:        if [0m[1;39m([0m[39msize != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mMetadata.CONTENT_LENGTH, [0m[1;35mLong.toString[0m[1;39m([0m[39msize[0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:        if [0m[1;39m([0m[39mname != null && [0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:            name = [0m[1;35mname.replace[0m[1;39m([0m[32m"\\", "[0m[35m/[0m[39m"[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:            AttributesImpl attributes = new [0m[1;35mAttributesImpl[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"CDATA"[0m[39m, [0m[32m"embedded"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"CDATA"[0m[39m, name[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:            [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"div"[0m[39m, attributes[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:            [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"div"[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID, name[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:        return entrydata;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:450[0m[39m-[0m[1;36m481[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Analysis Summary[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mBased on the evaluation report and code snippets, I've identified a critical **File[0m [2m                [0m
[2;36m                    [0m         [39mPath Traversal vulnerability** in Apache Tika's [0m                                    [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mFileEmbeddedDocumentExtractor.getOutputFile[0m[1;39m([0m[1;39m)[0m[39m` method. The vulnerability allows [0m   [2m                [0m
[2;36m                    [0m         [39mmalicious archive entries to specify paths that escape the intended extraction [0m     [2m                [0m
[2;36m                    [0m         [39mdirectory.[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Root Cause[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe vulnerability exists in [0m                                                        [2m                [0m
[2;36m                    [0m         [39m`tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java` at lines [0m[1;36m1128[0m[39m-[0m[1;36m1169[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mspecifically in the `[0m[1;35mgetOutputFile[0m[1;39m([0m[1;39m)[0m[39m` method:[0m                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Line [0m[1;36m1141[0m[39m**: Uses Apache Commons IO's `[0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;39m)[0m[39m` which [0m       [2m                [0m
[2;36m                    [0m         [39mnormalizes paths but **preserves directory components**[0m                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Line [0m[1;36m1144[0m[39m**: Only falls back to Tika's `[0m[1;35mFilenameUtils.getName[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mwhich strips[0m [2m                [0m
[2;36m                    [0m         [39mdirectories[0m[1;39m)[0m[39m when [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m returns null[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Line [0m[1;36m1160[0m[39m**: Creates `new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m` without validating[0m [2m                [0m
[2;36m                    [0m         [39mthe canonical path stays within `extractDir`[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Lines [0m[1;36m1103[0m[39m-[0m[1;36m1107[0m[39m**: In `[0m[1;35mparseEmbedded[0m[1;39m([0m[1;39m)[0m[39m`, calls `[0m[1;35mmkdirs[0m[1;39m([0m[1;39m)[0m[39m` on potentially [0m      [2m                [0m
[2;36m                    [0m         [39mtraversed paths before validation[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Evidence from Codebase[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Tika's own FilenameUtils javadoc** [0m[1;39m([0m[39mlines [0m[1;36m78[0m[39m-[0m[1;36m92[0m[1;39m)[0m[39m explicitly warns: *[0m[32m"If a [0m     [2m                [0m
[2;36m                    [0m         [32mcareless client used that filename as if it were a filename and not a path when [0m    [2m                [0m
[2;36m                    [0m         [32mwriting embedded files, bad things could happen. Consider: '../../../my_ppt.ppt'"[0m[39m*[0m  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **ExtractEmbeddedFiles.java** [0m[1;39m([0m[39mline [0m[1;36m93[0m[1;39m)[0m[39m demonstrates the **correct pattern**:[0m    [2m                [0m
[2;36m                    [0m         [39m   ```java[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m   name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m   This applies `[0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m` FIRST to strip directories, then `[0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m` to [0m      [2m                [0m
[2;36m                    [0m         [39msanitize.[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **UnrarParser** comments [0m[1;39m([0m[39mlines [0m[1;36m142[0m[39m-[0m[1;36m143[0m[1;39m)[0m[39m show developer awareness: *[0m[32m"we could [0m   [2m                [0m
[2;36m                    [0m         [32muse the -l option to check for potentially bad file names e.g. path traversals"[0m[39m*[0m    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Critical Logic to Preserve[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Extension handling** [0m[1;39m([0m[39mlines [0m[1;36m1129[0m[39m-[0m[1;36m1132[0m[1;39m)[0m[39m: Adding extensions when missing[0m         [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Relationship ID prefixing** [0m[1;39m([0m[39mlines [0m[1;36m1134[0m[39m-[0m[1;36m1137[0m[1;39m)[0m[39m: Prepending relID to names[0m       [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Null character sanitization** [0m[1;39m([0m[39mline [0m[1;36m1140[0m[1;39m)[0m[39m: Replacing `\u0000` with spaces[0m      [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Prefix stripping** [0m[1;39m([0m[39mlines [0m[1;36m1151[0m[39m-[0m[1;36m1153[0m[1;39m)[0m[39m: Removing drive letters [0m[1;39m([0m[39mC:[0m[35m/[0m[39m, ~[0m[35m/[0m[39m, [0m[35m/[0m[1;39m)[0m      [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **URL decoding** [0m[1;39m([0m[39mlines [0m[1;36m1155[0m[39m-[0m[1;36m1159[0m[1;39m)[0m[39m: Decoding URL-encoded names[0m                   [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. **Duplicate handling** [0m[1;39m([0m[39mlines [0m[1;36m1162[0m[39m-[0m[1;36m1167[0m[1;39m)[0m[39m: Prepending UUID for existing files[0m     [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. **Fallback naming** [0m[1;39m([0m[39mline [0m[1;36m1148[0m[1;39m)[0m[39m: Using `[0m[32m"file"[0m[39m + count` when all else fails[0m      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Comprehensive Fix Strategy[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Primary Fix: Apply Tika's [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[1;39m)[0m[39m Before Normalization[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Location**: `tika-app/src/main/java/org/apache/tika/cli/TikaCLI.java`, method [0m    [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mgetOutputFile[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines [0m[1;36m1128[0m[39m-[0m[1;36m1169[0m[1;39m)[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Steps**:[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Import Tika's FilenameUtils** alongside Apache Commons IO's version:[0m           [2m                [0m
[2;36m                    [0m         [39m   - Add import after line [0m[1;36m59[0m[39m: `import org.apache.tika.io.FilenameUtils as [0m         [2m                [0m
[2;36m                    [0m         [39mTikaFilenameUtils;` [0m                                                                [2m                [0m
[2;36m                    [0m         [39m   - Or use fully qualified name to avoid confusion[0m                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Modify the path sanitization logic** [0m[1;39m([0m[39mreplace lines [0m[1;36m1138[0m[39m-[0m[1;36m1154[0m[1;39m)[0m[39m:[0m                [2m                [0m
[2;36m                    [0m         [39m   [0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m   Current flow:[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m   Line [0m[1;36m1140[0m[39m: [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m                                        [2m                [0m
[2;36m                    [0m         [39m   Line [0m[1;36m1141[0m[39m: [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m  [0m[35m/[0m[35m/[0m[39m Apache Commons IO - keeps [0m          [2m                [0m
[2;36m                    [0m         [39mdirectories[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m   Line [0m[1;36m1144[0m[39m: [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m as fallback  [0m[35m/[0m[35m/[0m[39m Tika version - strips [0m    [2m                [0m
[2;36m                    [0m         [39mdirectories[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m   Line [0m[1;36m1151[0m[39m-[0m[1;36m1153[0m[39m: Strip prefix[0m                                                     [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m   [0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m   **New flow**:[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m   Step [0m[1;36m1[0m[39m: Replace null characters [0m[1;39m([0m[39mpreserve line [0m[1;36m1140[0m[1;39m)[0m                             [2m                [0m
[2;36m                    [0m         [39m   Step [0m[1;36m2[0m[39m: Strip prefix FIRST [0m[1;39m([0m[39mmove lines [0m[1;36m1151[0m[39m-[0m[1;36m1153[0m[39m earlier[0m[1;39m)[0m                        [2m                [0m
[2;36m                    [0m         [39m   Step [0m[1;36m3[0m[39m: Apply Tika's [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m to strip ALL directory components[0m                 [2m                [0m
[2;36m                    [0m         [39m   Step [0m[1;36m4[0m[39m: Apply Apache Commons IO [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m to sanitize special characters[0m       [2m                [0m
[2;36m                    [0m         [39m   Step [0m[1;36m5[0m[39m: Validate result is not null/empty[0m                                        [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Add canonical path validation** after line [0m[1;36m1160[0m[39m:[0m                               [2m                [0m
[2;36m                    [0m         [39m   - After constructing `outputFile`, validate it stays within `extractDir`[0m         [2m                [0m
[2;36m                    [0m         [39m   - Use pattern from `RollbackSoftware.java` [0m[1;39m([0m[39mlines [0m[1;36m73[0m[39m-[0m[1;36m77[0m[1;39m)[0m[39m for canonical path [0m     [2m                [0m
[2;36m                    [0m         [39mcomparison[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m   - If validation fails, fall back to safe filename using just the basename[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Detailed implementation steps**:[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   a. **After line [0m[1;36m1140[0m[39m** [0m[1;39m([0m[39mnull character replacement[0m[1;39m)[0m[39m, insert prefix stripping:[0m    [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m      [0m[35m/[0m[35m/[0m[39m Strip any path prefix [0m[1;39m([0m[39mC:[0m[35m/[0m[39m, ~[0m[35m/[0m[39m, [0m[35m/[0m[1;39m)[0m[39m early to prevent issues[0m                 [2m                [0m
[2;36m                    [0m         [39m      int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [39m      if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [39m          name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   b. **Replace line [0m[1;36m1141[0m[39m** with Tika's [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m call:[0m                             [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m      [0m[35m/[0m[35m/[0m[39m Use Tika's [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m to strip all directory components first[0m               [2m                [0m
[2;36m                    [0m         [39m      [0m[35m/[0m[35m/[0m[39m This prevents path traversal by removing [0m[35m/[0m[39m, \, and : separators[0m            [2m                [0m
[2;36m                    [0m         [39m      String baseName = [0m[1;35morg.apache.tika.io.FilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   c. **Update lines [0m[1;36m1143[0m[39m-[0m[1;36m1149[0m[39m** to handle the stripped name:[0m                       [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m      [0m[35m/[0m[35m/[0m[39m If [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m returns empty [0m[1;39m([0m[39mfor paths like [0m[32m"."[0m[39m or [0m[32m".."[0m[1;39m)[0m[39m, use fallback[0m      [2m                [0m
[2;36m                    [0m         [39m      String normalizedName;[0m                                                        [2m                [0m
[2;36m                    [0m         [39m      if [0m[1;39m([0m[39mbaseName == null || [0m[1;35mbaseName.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [39m          normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                                  [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m          [0m[35m/[0m[35m/[0m[39m Now normalize the basename to handle special characters[0m                [2m                [0m
[2;36m                    [0m         [39m          [0m[35m/[0m[35m/[0m[39m Apache Commons IO [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m is safe here since directories are [0m      [2m                [0m
[2;36m                    [0m         [39malready stripped[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m          normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mbaseName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [39m          if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [39m              normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                              [2m                [0m
[2;36m                    [0m         [39m          [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   d. **Remove lines [0m[1;36m1151[0m[39m-[0m[1;36m1154[0m[39m** [0m[1;39m([0m[39mprefix stripping - already done earlier[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   e. **Keep URL decoding** [0m[1;39m([0m[39mlines [0m[1;36m1155[0m[39m-[0m[1;36m1159[0m[1;39m)[0m[39m but apply to normalizedName[0m           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m   f. **Add canonical path validation** after line [0m[1;36m1160[0m[39m:[0m                            [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m      File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [39m      [0m                                                                              [2m                [0m
[2;36m                    [0m         [39m      [0m[35m/[0m[35m/[0m[39m Validate the canonical path stays within extractDir[0m                        [2m                [0m
[2;36m                    [0m         [39m      try [0m[1;39m{[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m          String canonicalExtractDir = [0m[1;35mextractDir.getCanonicalPath[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m          String canonicalOutputPath = [0m[1;35moutputFile.getCanonicalPath[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m          [0m                                                                          [2m                [0m
[2;36m                    [0m         [39m          [0m[35m/[0m[35m/[0m[39m Check if output file is within the extraction directory[0m                [2m                [0m
[2;36m                    [0m         [39m          if [0m[1;39m([0m[39m![0m[1;35mcanonicalOutputPath.startsWith[0m[1;39m([0m[39mcanonicalExtractDir + File.separator[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m&&[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m              ![0m[1;35mcanonicalOutputPath.equals[0m[1;39m([0m[39mcanonicalExtractDir[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [39m              [0m[35m/[0m[35m/[0m[39m Path traversal detected - fall back to safe filename[0m               [2m                [0m
[2;36m                    [0m         [39m              [0m[1;35mLOG.warn[0m[1;39m([0m[32m"Path traversal attempt detected for file: [0m[32m{[0m[32m}[0m[32m"[0m[39m, name[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [39m              String safeName = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.io.FilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [39m              if [0m[1;39m([0m[39msafeName == null || [0m[1;35msafeName.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [39m                  safeName = [0m[32m"file"[0m[39m + count++ + ext;[0m                                [2m                [0m
[2;36m                    [0m         [39m              [0m[1;39m}[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m              outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, safeName[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [39m          [0m[1;39m}[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIOException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [39m          [0m[35m/[0m[35m/[0m[39m If canonical path resolution fails, use safe fallback[0m                  [2m                [0m
[2;36m                    [0m         [39m          [0m[1;35mLOG.warn[0m[1;39m([0m[32m"Failed to resolve canonical path for: [0m[32m{[0m[32m}[0m[32m"[0m[39m, normalizedName, e[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [39m          String safeName = [0m[32m"file"[0m[39m + count++ + ext;[0m                                 [2m                [0m
[2;36m                    [0m         [39m          outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, safeName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [39m      [0m[1;39m}[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m      ```[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why This Fix is Optimal[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Follows existing patterns**: Matches the secure implementation in [0m             [2m                [0m
[2;36m                    [0m         [39m`ExtractEmbeddedFiles.java` [0m[1;39m([0m[39mline [0m[1;36m93[0m[1;39m)[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Addresses root cause**: Strips directory components BEFORE path construction, [0m [2m                [0m
[2;36m                    [0m         [39mpreventing traversal at the source[0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Defense in depth**: [0m                                                           [2m                [0m
[2;36m                    [0m         [39m   - Primary defense: Strip directories with `[0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m`[0m                            [2m                [0m
[2;36m                    [0m         [39m   - Secondary defense: Canonical path validation catches any edge cases[0m            [2m                [0m
[2;36m                    [0m         [39m   - Tertiary defense: Safe fallback if validation fails[0m                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Preserves existing logic**:[0m                                                    [2m                [0m
[2;36m                    [0m         [39m   - Extension handling still works [0m[1;39m([0m[39mlines [0m[1;36m1129[0m[39m-[0m[1;36m1132[0m[1;39m)[0m                               [2m                [0m
[2;36m                    [0m         [39m   - Relationship ID prefixing preserved [0m[1;39m([0m[39mlines [0m[1;36m1134[0m[39m-[0m[1;36m1137[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [39m   - Duplicate handling unchanged [0m[1;39m([0m[39mlines [0m[1;36m1162[0m[39m-[0m[1;36m1167[0m[1;39m)[0m                                 [2m                [0m
[2;36m                    [0m         [39m   - All sanitization steps maintained[0m                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **Cross-platform safe**: Handles Unix [0m[1;39m([0m[39m`[0m[35m/[0m[39m`[0m[1;39m)[0m[39m, Windows [0m[1;39m([0m[39m`\`[0m[1;39m)[0m[39m, and Mac [0m[1;39m([0m[39m`:`[0m[1;39m)[0m[39m path [0m  [2m                [0m
[2;36m                    [0m         [39mseparators via Tika's [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. **Minimal code changes**: Modifies only the vulnerable method without touching:[0m  [2m                [0m
[2;36m                    [0m         [39m   - PackageParser [0m[1;39m([0m[39mnot the root cause - just passes data[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [39m   - Other parsers [0m[1;39m([0m[39mno shared utility to fix[0m[1;39m)[0m                                       [2m                [0m
[2;36m                    [0m         [39m   - Harness code [0m[1;39m([0m[39mtest code unaffected[0m[1;39m)[0m                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. **No functional regression**: [0m                                                   [2m                [0m
[2;36m                    [0m         [39m   - Valid filenames without paths work identically[0m                                 [2m                [0m
[2;36m                    [0m         [39m   - Only malicious paths are sanitized[0m                                             [2m                [0m
[2;36m                    [0m         [39m   - Existing tests continue to pass[0m                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Potential Side Effects and Mitigation[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Directory structure loss**: Archives with legitimate subdirectories will have [0m [2m                [0m
[2;36m                    [0m         [39mall files flattened to extractDir[0m                                                   [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: This is acceptable for security - the alternative is path [0m     [2m                [0m
[2;36m                    [0m         [39mtraversal[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m   - **Note**: The current code already creates directories [0m[1;39m([0m[39mline [0m[1;36m1105[0m[1;39m)[0m[39m but without[0m [2m                [0m
[2;36m                    [0m         [39mvalidation[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Filename collisions**: More files may have identical names after stripping [0m    [2m                [0m
[2;36m                    [0m         [39mpaths[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: Existing UUID prepending logic [0m[1;39m([0m[39mlines [0m[1;36m1162[0m[39m-[0m[1;36m1167[0m[1;39m)[0m[39m handles this[0m  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Information loss**: Directory context from archive structure is lost[0m           [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: The EMBEDDED_RELATIONSHIP_ID [0m[1;39m([0m[39mline [0m[1;36m1134[0m[1;39m)[0m[39m preserves some [0m       [2m                [0m
[2;36m                    [0m         [39mcontext[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m   - **Note**: Console output [0m[1;39m([0m[39mline [0m[1;36m1109[0m[1;39m)[0m[39m still shows original name for user [0m       [2m                [0m
[2;36m                    [0m         [39mvisibility[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Similar Patterns in Codebase[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis fix aligns with:[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **ExtractEmbeddedFiles.java** [0m[1;39m([0m[39mline [0m[1;36m93[0m[1;39m)[0m[39m: Same [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m + [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m pattern[0m    [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **RollbackSoftware.java** [0m[1;39m([0m[39mlines [0m[1;36m73[0m[39m-[0m[1;36m77[0m[1;39m)[0m[39m: Canonical path validation for symlinks[0m  [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **UnpackerResource.java** [0m[1;39m([0m[39mlines [0m[1;36m246[0m[39m-[0m[1;36m268[0m[1;39m)[0m[39m: Similar sanitization but for [0m         [2m                [0m
[2;36m                    [0m         [39min-memory storage[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix brings TikaCLI into alignment with the secure patterns already present [0m     [2m                [0m
[2;36m                    [0m         [39melsewhere in the codebase.[0m                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=720828;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=43700;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=496345;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=613273;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp0rm9tbm0[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-delta-05_vuln_2/[0m[95magent[0m [2m               [0m
[2;36m                    [0m         [95m-output-1768194984.5034902[0m                                                           [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-delta-05_vuln_2.toml [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/12/26 05:16:26][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/qqor/crete/.cache/environments/[0m[95mtika[0m           ]8;id=48047;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=284462;file:///home/qqor/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m[01/12/26 05:16:27][0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=761212;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=149348;file:///home/qqor/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=467000;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=381983;file:///home/qqor/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
