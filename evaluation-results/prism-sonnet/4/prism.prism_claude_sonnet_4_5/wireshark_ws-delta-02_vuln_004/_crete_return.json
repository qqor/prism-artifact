{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-delta-02_vuln_004",
  "source_directory": "/home/user/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 1.4993699999999999,
    "prompt_tokens": 434765,
    "completion_tokens": 13005
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-icmp.c\n+++ b/epan/dissectors/packet-icmp.c\n@@ -897,9 +897,8 @@\n \t\t\t\t     proto_item * tf_object)\n {\n \tproto_item *ti;\n-\tuint16_t obj_length;\n+\tuint16_t obj_length, obj_trunc_length;\n \tuint8_t c_type;\n-\tuint8_t ident_name[ICMP_MAX_IDENT_NAME_LENGTH];\n \tbool unknown_object;\n \tuint32_t afi;\n \tuint32_t addr_length;\n@@ -907,6 +906,7 @@\n \tunknown_object = false;\n \t/* Object length */\n \tobj_length = tvb_get_ntohs(tvb, offset);\n+\tobj_trunc_length = MIN(obj_length, tvb_reported_length_remaining(tvb, offset));\n \n \t/* C-Type */\n \tc_type = tvb_get_uint8(tvb, offset + 3);\n@@ -923,14 +923,9 @@\n \n \tswitch(c_type) {\n \t\tcase ICMP_EXT_ECHO_IDENT_NAME:\n-\t\t\t/* Identification Name must be printable*/\n-\t\t\ttvb_memcpy(tvb, ident_name, offset, obj_length - 4);\n-\n-\t\t\tfor (unsigned i = 0; i < obj_length - 4; i++)\n-\t\t\t\tif (!g_ascii_isprint(ident_name[i]))\n-\t\t\t\t\tbreak;\n-\n-\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_length - 4, ENC_ASCII);\n+\t\t\tif (obj_trunc_length > 4) {\n+\t\t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_name_string, tvb, offset, obj_trunc_length - 4, ENC_ASCII);\n+\t\t\t}\n \t\t\tbreak;\n \t\tcase ICMP_EXT_ECHO_IDENT_INDEX:\n \t\t\tproto_tree_add_item(ext_object_tree, hf_icmp_int_ident_index, tvb, offset, 4, ENC_NA);\n",
  "stdout": "",
  "stderr": ""
}