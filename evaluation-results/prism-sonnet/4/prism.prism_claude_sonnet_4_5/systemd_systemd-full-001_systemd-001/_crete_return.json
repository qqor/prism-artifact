{
  "project_name": "systemd",
  "vulnerability_identifier": "systemd_systemd-full-001_systemd-001",
  "source_directory": "/home/user/crete/.cache/official-afc-systemd",
  "llm_usage": {
    "total_cost": 2.0135970000000003,
    "prompt_tokens": 531244,
    "completion_tokens": 27991
  },
  "variant": "sound",
  "diff": "--- a/src/udev/udev-rules.c\n+++ b/src/udev/udev-rules.c\n@@ -1185,17 +1185,24 @@\n                  * so it could be safely interpreted as nulstr.\n                  */\n                 if (is_prefix_match){\n+                        /* Validate we have space for '*' + two NULs */\n+                        if ((size_t)((i + 1) - j) < 3)\n+                                return -EINVAL;\n                         j[0] = '*';\n                         j[1] = '\\0';\n                         j[2] = '\\0';\n                 } else {\n+                        /* Validate we have space for two NULs */\n+                        if ((size_t)((i + 1) - j) < 2)\n+                                return -EINVAL;\n                         j[0] = '\\0';\n                         j[1] = '\\0';\n                 }\n-                str = m;            \n+                str = m;\n         } else {\n                 _cleanup_free_ char *unescaped = NULL;\n                 ssize_t l;\n+                size_t available;\n \n                 /* find the end position of value */\n                 for (i = m + 1; *i != '\"'; i++) {\n@@ -1211,12 +1218,19 @@\n \n                 assert(l <= i - (m + 1));\n \n+                /* Calculate available buffer space from start to past closing quote */\n+                available = (i + 1) - str;\n+\n                 /*\n                 * The return value must be terminated by two subsequent NULs\n                 * so it could be safely interpreted as nulstr.\n                 */\n                 if (is_prefix_match){\n                         /* need more room to make rule glob match */\n+                        /* Validate we have space for unescaped content + '*' + two NULs */\n+                        /* Write range: [pos-1, pos+l+1] requires pos+l+2 total positions */\n+                        if ((size_t)(pos + l + 2) > available)\n+                                return -EINVAL;\n                         memcpy(str + pos - 1, unescaped, l + 1);\n                         str[pos + l - 1] = '*';\n                         str[pos + l] = '\\0';\n@@ -1224,6 +1238,10 @@\n                         m = str + pos - 1;\n \n                 } else {\n+                        /* Validate we have space for unescaped content + two NULs */\n+                        /* Write range: [pos, pos+l+1] requires pos+l+2 total positions */\n+                        if ((size_t)(pos + l + 2) > available)\n+                                return -EINVAL;\n                         memcpy(m, unescaped, l + 1);\n                         m[l] = '\\0';\n                         m[l + 1] = '\\0';\n",
  "stdout": "",
  "stderr": ""
}