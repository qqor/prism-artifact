{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-delta-01_vuln_9",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 2.958102,
    "prompt_tokens": 836429,
    "completion_tokens": 29921
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-html-module/src/main/java/org/apache/tika/parser/html/HtmlHandler.java\n@@ -195,6 +195,15 @@\n             return;\n         }\n \n+        // Security: Reject metadata keys that could be used to control system behavior\n+        String lcName = name.toLowerCase(Locale.US);\n+        if (lcName.contains(\"path\") || lcName.contains(\"command\") || \n+            lcName.contains(\"exec\") || lcName.contains(\"tool\") || \n+            lcName.contains(\"bin\") || lcName.endsWith(\"_config\") || \n+            lcName.endsWith(\"_dir\") || lcName.endsWith(\"_executable\")) {\n+            return;\n+        }\n+\n         if (name.equalsIgnoreCase(\"ICBM\")) {\n             Matcher m = ICBM.matcher(value);\n             if (m.matches()) {\n@@ -218,7 +227,6 @@\n             return;\n         }\n \n-        String lcName = name.toLowerCase(Locale.US);\n         if (META_HEADER_MAPPINGS.containsKey(lcName)) {\n             Property property = META_HEADER_MAPPINGS.get(lcName);\n             if (property.equals(TikaCoreProperties.TITLE) && isTitleSetToMetadata) {\n@@ -359,10 +367,6 @@\n             //swallow\n             return;\n         }\n-        int added = 0;\n-        if (metadata.get(\"html_meta:exiftool_path\") != null) {\n-            added = configureExifTool(metadata.get(\"html_meta:exiftool_path\"));\n-        }\n         //do anything with attrs?\n         Metadata m = new Metadata();\n         m.set(TikaCoreProperties.EMBEDDED_RESOURCE_TYPE,\n@@ -377,13 +381,23 @@\n                 embeddedDocumentExtractor.parseEmbedded(stream, xhtml, m, true);\n             } catch (IOException e) {\n                 EmbeddedDocumentUtil.recordEmbeddedStreamException(e, metadata);\n-            } finally {\n-                resetExifTool(added);\n             }\n         }\n     }\n \n     private int configureExifTool(String path) {\n+        if (path == null || path.trim().isEmpty()) {\n+            return 2;\n+        }\n+        \n+        if (!path.endsWith(\"exiftool\") && !path.endsWith(\"exiftool.exe\")) {\n+            return 2;\n+        }\n+        \n+        if (!ExternalParser.check(new String[]{path, \"--version\"})) {\n+            return 2;\n+        }\n+        \n         ExternalParser exifToolParser = getExistingExifToolParser();\n         int retVal = 0;\n         if (exifToolParser == null) {\n",
  "stdout": "",
  "stderr": ""
}