{
  "project_name": "wireshark",
  "vulnerability_identifier": "wireshark_ws-full-01_vuln_005",
  "source_directory": "/home/qqor/crete/.cache/official-afc-wireshark",
  "llm_usage": {
    "total_cost": 1.6380480000000004,
    "prompt_tokens": 471041,
    "completion_tokens": 14995
  },
  "variant": "sound",
  "diff": "--- a/epan/dissectors/packet-bat.c\n+++ b/epan/dissectors/packet-bat.c\n@@ -643,48 +643,33 @@\n \tstruct vis_packet_v23 *vis_packeth;\n \tuint32_t sender_ip;\n \tproto_tree *bat_vis_tree = NULL;\n-\tint vis_packeth_raw_data_size=0;\n-\tchar vis_packeth_raw_data[1024];\n-\tchar d_output_buffer[1024];\n \n \ttvbuff_t *next_tvb;\n-\tint length_remaining, i, offset;\n-\n-\td_output_buffer[0] = 0;\n+\tint length_remaining, i;\n+\tint offset = 0;\n \n \tvis_packeth = wmem_new(pinfo->pool, struct vis_packet_v23);\n \n \tsender_ip = tvb_get_ipv4(tvb, 0);\n \tset_address_tvb(&vis_packeth->sender_ip, AT_IPv4, 4, tvb, 0);\n-\toffset = 8;\n-\tvis_packeth->version = tvb_get_uint8(tvb, offset++);\n-\tvis_packeth->gw_class = tvb_get_uint8(tvb, offset++);\n-\tvis_packeth->tq_max = tvb_get_uint8(tvb, offset++);\n-\tvis_packeth_raw_data_size = tvb_get_uint32(tvb, offset++, 0);\n-\toffset += 4;\n-\tif ((unsigned long)vis_packeth_raw_data_size > sizeof(vis_packeth_raw_data))\n-\t\treturn;\n-\n-\tfor (i=0; i < vis_packeth_raw_data_size; i++) {\n-\t\tvis_packeth_raw_data[i] = tvb_get_uint8(tvb, offset);\n-\t\toffset++;\n-\t}\n+\tvis_packeth->version = tvb_get_uint8(tvb, 4);\n+\tvis_packeth->gw_class = tvb_get_uint8(tvb, 5);\n+\tvis_packeth->tq_max = tvb_get_uint8(tvb, 6);\n \n \t/* set protocol name */\n \tcol_set_str(pinfo->cinfo, COL_PROTOCOL, \"BAT_VIS\");\n \n \t/* Set info column */\n \tcol_add_fstr(pinfo->cinfo, COL_INFO, \"Src: %s\",\n-\t\t\taddress_with_resolution_to_str(pinfo->pool, &vis_packeth->sender_ip));\n+\t\t     address_with_resolution_to_str(pinfo->pool, &vis_packeth->sender_ip));\n \n \t/* Set tree info */\n \tif (tree) {\n \t\tproto_item *ti;\n \n \t\tti = proto_tree_add_protocol_format(tree, proto_bat_vis, tvb, 0, VIS_PACKET_V23_SIZE,\n-\t\t\t\t\t\t\t\t\"B.A.T.M.A.N. Vis, Src: %s\",\n-\t\t\t\t\t\t\t\taddress_with_resolution_to_str(pinfo->pool, &vis_packeth->sender_ip));\n-\t\tsnprintf(d_output_buffer, sizeof(d_output_buffer), \"B.A.T.M.A.N. Vis, raw_data %s\", vis_packeth_raw_data);\n+\t\t\t\t\t\t\t    \"B.A.T.M.A.N. Vis, Src: %s\",\n+\t\t\t\t\t\t\t    address_with_resolution_to_str(pinfo->pool, &vis_packeth->sender_ip));\n \t\tbat_vis_tree = proto_item_add_subtree(ti, ett_bat_vis);\n \n \t\t/* items */\n@@ -701,8 +686,8 @@\n \t\t/*offset += 1;*/\n \t}\n \n-\tif ((vis_packeth_raw_data_size > 4) && (strlen(vis_packeth_raw_data) > 4))\n-\t\tfprintf(stderr, d_output_buffer);\n+\t/* Calculate offset even when we got no tree */\n+\toffset = VIS_PACKET_V23_SIZE;\n \n \ttap_queue_packet(bat_tap, pinfo, vis_packeth);\n \n@@ -732,7 +717,6 @@\n \n \t\tcall_data_dissector(next_tvb, pinfo, tree);\n \t}\n-\n }\n \n static void dissect_vis_entry_v23(tvbuff_t *tvb, packet_info *pinfo _U_, proto_tree *tree)\n",
  "stdout": "",
  "stderr": ""
}