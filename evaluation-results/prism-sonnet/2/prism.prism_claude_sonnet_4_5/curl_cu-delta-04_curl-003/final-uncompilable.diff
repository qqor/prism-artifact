--- a/lib/doh.c
+++ b/lib/doh.c
@@ -1399,10 +1399,10 @@
   return CURLE_OK;
 }
 
-void Curl_doh_close(struct Curl_easy *data)
-{
-  struct doh_probes *doh = data->req.doh;
-  if(doh && data->multi) {
+static void Curl_doh_close_ex(struct doh_probes *doh, struct Curl_multi *multi,
+                               struct Curl_easy *data)
+{
+  if(doh && multi) {
     struct Curl_easy *probe_data;
     curl_off_t mid;
     size_t slot;
@@ -1412,30 +1412,39 @@
         continue;
       doh->probe[slot].easy_mid = -1;
       /* should have been called before data is removed from multi handle */
-      DEBUGASSERT(data->multi);
-      probe_data = data->multi ? Curl_multi_get_handle(data->multi, mid) :
-        NULL;
+      DEBUGASSERT(multi);
+      probe_data = Curl_multi_get_handle(multi, mid);
       if(!probe_data) {
-        DEBUGF(infof(data, "Curl_doh_close: xfer for mid=%"
-                     FMT_OFF_T " not found!",
-                     doh->probe[slot].easy_mid));
+        if(data) {
+          DEBUGF(infof(data, "Curl_doh_close: xfer for mid=%"
+                       FMT_OFF_T " not found!",
+                       mid));
+        }
         continue;
       }
       /* data->multi might already be reset at this time */
-      curl_multi_remove_handle(data->multi, probe_data);
+      curl_multi_remove_handle(multi, probe_data);
       Curl_close(&probe_data);
     }
   }
+}
+
+void Curl_doh_close(struct Curl_easy *data)
+{
+  struct doh_probes *doh = data->req.doh;
+  Curl_doh_close_ex(doh, data->multi, data);
 }
 
 void Curl_doh_cleanup(struct Curl_easy *data)
 {
   struct doh_probes *doh = data->req.doh;
   if(doh) {
-    Curl_doh_close(data);
+    /* NULL the pointer before cleanup to prevent reentrancy issues during
+     * Curl_close operations that might trigger callbacks accessing this pointer */
+    data->req.doh = NULL;
+    Curl_doh_close_ex(doh, data->multi, NULL);
     curl_slist_free_all(doh->req_hds);
-    data->req.doh->req_hds = NULL;
-    Curl_safefree(data->req.doh);
+    free(doh);
   }
 }
 
