{
  "project_name": "libavif",
  "vulnerability_identifier": "libavif_av-delta-02_avif-002",
  "source_directory": "/home/user/crete/.cache/official-afc-libavif",
  "llm_usage": {
    "total_cost": 2.07411,
    "prompt_tokens": 624865,
    "completion_tokens": 13301
  },
  "variant": "sound",
  "diff": "--- a/src/reformat.c\n+++ b/src/reformat.c\n@@ -771,14 +771,14 @@\n                     spill_Cb = AVIF_CLAMP(Cb - AVIF_CLAMP(Cb,minCb,maxCb),0.0f,1.0f);\n \n                     // now we have generated the spill, get it's neigbors\n-                    int adjCol = (i%2) ? -1 : 1;\n-                    int adjRow = (j%2) ? -1 : 1;\n-                    // check the bounds\n-                    if (i + adjCol >= image->width){\n-                        adjCol = 0;\n-                    }\n-                    if (j + adjRow >= image->height){\n-                        adjRow = 0;\n+                    int adjCol = 0;\n+                    int adjRow = 0;\n+                    // check the bounds - only set non-zero offsets if not at boundaries\n+                    if (i > 0 && i < image->width - 1) {\n+                        adjCol = (i % 2) ? -1 : 1;\n+                    }\n+                    if (j > 0 && j < image->height - 1) {\n+                        adjRow = (j % 2) ? -1 : 1;\n                     }\n                     float pSpillCb = spill_Cb/3;\n                     float pSpillCr = spill_Cr/3;\n@@ -796,16 +796,14 @@\n                     total_spill += fabs(spill_Cr);\n                     // if spill too high, dampen\n                     if ((image->height * image->width) >= 0x1000 && total_spill > ((image->height * image->width) * 3.8f)){\n-                        int a, b;\n-                        if (i % 2 == 0){\n-                            a = 1;\n-                        }else{\n-                            a = -1;\n-                        }\n-                        if (j % 2 == 0){\n-                            b = 1;\n-                        }else{\n-                            b = -1;\n+                        int a = 0;\n+                        int b = 0;\n+                        // Only compute non-zero offsets if we're not at boundaries\n+                        if (i > 0 && i < image->width - 1) {\n+                            a = (i % 2 == 0) ? 1 : -1;\n+                        }\n+                        if (j > 0 && j < image->height - 1) {\n+                            b = (j % 2 == 0) ? 1 : -1;\n                         }\n                         uspill_image[i][j] -= pSpillCb;\n                         vspill_image[i][j] -= pSpillCb;\n",
  "stdout": "",
  "stderr": ""
}