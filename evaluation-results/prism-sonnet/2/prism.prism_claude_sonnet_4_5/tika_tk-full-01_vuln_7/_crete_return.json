{
  "project_name": "tika",
  "vulnerability_identifier": "tika_tk-full-01_vuln_7",
  "source_directory": "/home/user/crete/.cache/official-afc-tika",
  "llm_usage": {
    "total_cost": 2.263713,
    "prompt_tokens": 661256,
    "completion_tokens": 18663
  },
  "variant": "sound",
  "diff": "--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVConfig.java\n@@ -41,6 +41,8 @@\n     private Map<String, Character> nameToDelimiterMap = NAME_TO_DELIMITER_MAP;\n     private Map<Character, String> delimiterToNameMap = DELIMITER_TO_NAME_MAP;\n \n+    private boolean fetchHyperlinks = false;\n+\n     public Map<String, Character> getNameToDelimiterMap() {\n         return nameToDelimiterMap;\n     }\n@@ -55,4 +57,12 @@\n         nameToDelimiterMap.entrySet()\n                           .forEach(e -> delimiterToNameMap.put(e.getValue(), e.getKey()));\n     }\n+\n+    public boolean isFetchHyperlinks() {\n+        return fetchHyperlinks;\n+    }\n+\n+    public void setFetchHyperlinks(boolean fetchHyperlinks) {\n+        this.fetchHyperlinks = fetchHyperlinks;\n+    }\n }\n\n--- a/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n+++ b/tika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-text-module/src/main/java/org/apache/tika/parser/csv/TextAndCSVParser.java\n@@ -258,7 +258,11 @@\n             xhtml.startElement(\"a\", \"href\", url);\n             xhtml.characters(name);\n             xhtml.endElement(\"a\");\n-            processURL(url, name, xhtml, metadata, context);\n+            \n+            TextAndCSVConfig textAndCSVConfig = context.get(TextAndCSVConfig.class, defaultTextAndCSVConfig);\n+            if (textAndCSVConfig.isFetchHyperlinks()) {\n+                processURL(url, name, xhtml, metadata, context);\n+            }\n         } else {\n             xhtml.characters(cellContent);\n         }\n@@ -427,4 +431,28 @@\n         defaultTextAndCSVConfig.setNameToDelimiterMap(m);\n     }\n \n+    /**\n+     * Controls whether the parser should fetch and parse external URLs found in HYPERLINK formulas.\n+     * \n+     * <p><b>Security Warning:</b> Enabling this feature may expose the application to Server Side \n+     * Request Forgery (SSRF) vulnerabilities when processing untrusted CSV files. Malicious CSV files \n+     * could trigger requests to internal services, cloud metadata endpoints, or external domains.</p>\n+     * \n+     * <p>When enabled, URLs found in Excel HYPERLINK formulas (e.g., =HYPERLINK(\"https://example.com\"))\n+     * will be automatically fetched and their content parsed as embedded documents.</p>\n+     * \n+     * <p>When disabled (default), only the hyperlink HTML anchor tag is created without fetching \n+     * the URL content.</p>\n+     * \n+     * @param fetchHyperlinks true to enable URL fetching (unsafe), false to disable (secure default)\n+     */\n+    @Field\n+    public void setFetchHyperlinks(boolean fetchHyperlinks) {\n+        defaultTextAndCSVConfig.setFetchHyperlinks(fetchHyperlinks);\n+    }\n+\n+    public boolean isFetchHyperlinks() {\n+        return defaultTextAndCSVConfig.isFetchHyperlinks();\n+    }\n+\n }\n",
  "stdout": "",
  "stderr": ""
}