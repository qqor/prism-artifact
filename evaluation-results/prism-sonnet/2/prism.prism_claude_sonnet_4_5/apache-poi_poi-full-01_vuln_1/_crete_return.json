{
  "project_name": "apache-poi",
  "vulnerability_identifier": "apache-poi_poi-full-01_vuln_1",
  "source_directory": "/home/user/crete/.cache/official-afc-poi",
  "llm_usage": {
    "total_cost": 1.320375,
    "prompt_tokens": 372870,
    "completion_tokens": 13451
  },
  "variant": "sound",
  "diff": "--- a/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n+++ b/poi-scratchpad/src/main/java/org/apache/poi/hmef/attribute/MAPIAttribute.java\n@@ -168,7 +168,7 @@\n                   if (mplen < 0) {\n                      throw new IOException(\"Did not expect negative value: \" + mplen);\n                   }\n-                  byte[] mpdata = new byte[mplen];\n+                  byte[] mpdata = IOUtils.safelyAllocate(mplen, MAX_RECORD_LENGTH);\n                   if (IOUtils.readFully(inp, mpdata) < 0) {\n                      throw new IOException(\"Not enough data to read \" + mplen + \" bytes for attribute name\");\n                   }\n\n--- a/poi/src/main/java/org/apache/poi/util/StringUtil.java\n+++ b/poi/src/main/java/org/apache/poi/util/StringUtil.java\n@@ -89,6 +89,9 @@\n         }\n         if ((len < 0) || (((string.length - offset) / 2) < len)) {\n             throw new IllegalArgumentException(\"Illegal length \" + len);\n+        }\n+        if (len > MAX_RECORD_LENGTH / 2) {\n+            throw new IllegalArgumentException(\"String length \" + len + \" exceeds maximum \" + (MAX_RECORD_LENGTH / 2));\n         }\n \n         return new String(string, offset, len * 2, UTF16LE);\n",
  "stdout": "",
  "stderr": ""
}