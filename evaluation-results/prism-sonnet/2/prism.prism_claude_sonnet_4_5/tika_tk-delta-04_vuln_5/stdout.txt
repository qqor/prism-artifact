[2;36m[01/08/26 14:01:36][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=521052;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=992024;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmph_h4__44[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-delta-04_vuln_5/[0m[95magent[0m [2m               [0m
[2;36m                    [0m         [95m-output-1767880896.1435835[0m                                                           [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-delta-04_vuln_5.toml [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=352982;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=643661;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:03:23][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m107.11[0m ]8;id=474132;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=437807;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=580032;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=455816;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=222630;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=728930;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=763853;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=501388;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m107[0m[1m)[0m                                                         [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=474759;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=35172;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:03:24][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.89[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=692849;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=272325;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 14:03:26][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=8580;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=989149;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=582169;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=814595;file:///home/user/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=10637;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=770527;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=539390;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=669734;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:03:27][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.32[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=446879;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=247872;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 14:03:28][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=185118;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=770997;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.91[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=706304;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=787243;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 14:03:40][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=606637;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=297543;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp1955178695099218025/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tra[0m [2m                [0m
[2;36m                    [0m         [95mversal[0m                                                                              [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp1955178695099218025/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tra[0m [2m                [0m
[2;36m                    [0m         [95mversal[0m                                                                              [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/08/26 14:04:05][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=861873;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=105774;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/08/26 14:09:48][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=231788;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=726290;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/08/26 14:10:24][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=315096;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=808979;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=444380;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=97883;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:10:25][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.96[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=832809;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=637620;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=30486;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=153188;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmp29hyew_l[0m                                                 ]8;id=582187;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=934652;file:///home/user/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/08/26 14:11:43][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m77.39[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=111224;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=851244;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=100276;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=843266;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:12:16][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m33.67[0m seconds;                ]8;id=266095;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=268325;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=618039;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=904426;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:12:28][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.35[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=129384;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=435782;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=108343;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=773643;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=725545;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=66376;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=551645;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=218135;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:12:29][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.91[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=276899;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=276825;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 14:12:30][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=761639;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=920957;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:12:31][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=636186;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=602295;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=898574;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=749233;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 14:12:32][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.93[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=434471;file:///home/user/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=425084;file:///home/user/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 14:12:33][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=919410;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=464975;file:///home/user/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         ---                                                                                 [2m                [0m
[2;36m                    [0m         a/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emit [2m                [0m
[2;36m                    [0m         ter/fs/FileSystemEmitter.java                                                       [2m                [0m
[2;36m                    [0m         +++                                                                                 [2m                [0m
[2;36m                    [0m         b/tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emit [2m                [0m
[2;36m                    [0m         ter/fs/FileSystemEmitter.java                                                       [2m                [0m
[2;36m                    [0m         @@ [1;36m-144[0m,[1;36m7[0m +[1;36m144[0m,[1;36m21[0m @@                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m              @Override                                                                      [2m                [0m
[2;36m                    [0m              public void [1;35memit[0m[1m([0mString path, InputStream inputStream, Metadata userMetadata,  [2m                [0m
[2;36m                    [0m         ParseContext parseContext[1m)[0m throws IOException, TikaEmitterException [1m{[0m               [2m                [0m
[2;36m                    [0m         +        if [1m([0m[1;35mpath.contains[0m[1m([0m[32m"\u0000"[0m[1m)[0m[1m)[0m [1m{[0m                                             [2m                [0m
[2;36m                    [0m         +            throw new [1;35mIllegalArgumentException[0m[1m([0m[32m"Path must not contain null bytes [0m  [2m                [0m
[2;36m                    [0m         [32m([0m[32m\\u0000[0m[32m)[0m[32m. "[0m +                                                                      [2m                [0m
[2;36m                    [0m         +                    [32m"Potential security issue detected in path: "[0m + path[1m)[0m;         [2m                [0m
[2;36m                    [0m         +        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m                  Path target = [1;35mbasePath.resolve[0m[1m([0mpath[1m)[0m;                                      [2m                [0m
[2;36m                    [0m         +                                                                                   [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m Validate that the resolved path stays within the base directory         [2m                [0m
[2;36m                    [0m         +        Path normalizedTarget = [1;35mtarget.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;               [2m                [0m
[2;36m                    [0m         +        Path normalizedBase = [1;35mbasePath.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;               [2m                [0m
[2;36m                    [0m         +        if [1m([0m![1;35mnormalizedTarget.startsWith[0m[1m([0mnormalizedBase[1m)[0m[1m)[0m [1m{[0m                        [2m                [0m
[2;36m                    [0m         +            throw new [1;35mIllegalArgumentException[0m[1m([0m                                    [2m                [0m
[2;36m                    [0m         +                    [32m"Emit path must resolve to be within the base output [0m          [2m                [0m
[2;36m                    [0m         [32mdirectory. "[0m +                                                                      [2m                [0m
[2;36m                    [0m         +                    [32m"Potential path traversal detected. Base: "[0m + basePath + [32m", [0m   [2m                [0m
[2;36m                    [0m         [32mPath: "[0m + path[1m)[0m;                                                                    [2m                [0m
[2;36m                    [0m         +        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                  if [1m([0m![1;35mFiles.isDirectory[0m[1m([0m[1;35mtarget.getParent[0m[1m([0m[1m)[0m[1m)[0m[1m)[0m [1m{[0m                              [2m                [0m
[2;36m                    [0m                      [1;35mFiles.createDirectories[0m[1m([0m[1;35mtarget.getParent[0m[1m([0m[1m)[0m[1m)[0m;                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical:    [2m                [0m
[2;36m                    [0m         File path traversal:                                                                [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp1955178695099218025/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tra[0m [2m                [0m
[2;36m                    [0m         [95mversal[0m                                                                              [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1m([0mFilePathTraversal.j [2m                [0m
[2;36m                    [0m         av[1;92ma:346[0m[1m)[0m                                                                            [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1m([0mFilePathTravers [2m                [0m
[2;36m                    [0m         al.jav[1;92ma:293[0m[1m)[0m                                                                        [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1m([0mFilePa [2m                [0m
[2;36m                    [0m         thTraversal.jav[1;92ma:211[0m[1m)[0m                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1m([0mFileSystemEmitter.jav[1;92ma:155[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1m([0mEmittingEm [2m                [0m
[2;36m                    [0m         beddedDocumentBytesHandler.jav[1;92ma:66[0m[1m)[0m                                                 [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1m)[0m                                                                               [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1m([0mRUnpackExtractor.jav[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1m([0mRUnpackExtractor.jav[1;92ma:91[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1m([0mRecursiveParserWrapper.jav[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1m)[0m                                                                                   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1m([0mPipesServer.jav[1;92ma:660[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1m([0mPipesServer.jav[1;92ma:546[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1m([0mPipesServer.jav[1;92ma:487[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1m([0mRecursivelyExtract.jav[1;92ma:96[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:234[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppRUnpackerFuzzer.jav[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: e329145bbb375a14                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A critical security vulnerability has been detected involving file path traversal   [2m                [0m
[2;36m                    [0m         during the processing of embedded documents in Apache Tika. The issue occurs when   [2m                [0m
[2;36m                    [0m         the FileSystemEmitter attempts to write extracted content to the filesystem,        [2m                [0m
[2;36m                    [0m         allowing traversal outside the intended output directory through maliciously        [2m                [0m
[2;36m                    [0m         crafted file paths containing directory traversal sequences [1m([0me.g., `..[35m/[0m`[1m)[0m.          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Vulnerability Type                                                              [2m                [0m
[2;36m                    [0m         This is a **File Path Traversal** vulnerability [1m([0malso known as Directory Traversal  [2m                [0m
[2;36m                    [0m         or Path Traversal[1m)[0m, classified as a critical security issue by the Jazzer fuzzer's  [2m                [0m
[2;36m                    [0m         security detection mechanism.                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Issue Details                                                                   [2m                [0m
[2;36m                    [0m         The exception `com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical` was    [2m                [0m
[2;36m                    [0m         triggered when processing a file with a path containing traversal sequences. The    [2m                [0m
[2;36m                    [0m         specific path that triggered the vulnerability is:                                  [2m                [0m
[2;36m                    [0m         ```                                                                                 [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp1955178695099218025/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tra[0m [2m                [0m
[2;36m                    [0m         [95mversal[0m                                                                              [2m                [0m
[2;36m                    [0m         ```                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         This path demonstrates the use of:                                                  [2m                [0m
[2;36m                    [0m         - Current directory reference [1m([0m`.[35m/[0m`[1m)[0m                                                [2m                [0m
[2;36m                    [0m         - Parent directory traversal sequences [1m([0m`..[35m/../../[0m`[1m)[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The sanitizer detected that the normalized path would escape the intended output    [2m                [0m
[2;36m                    [0m         directory and access `jazzer-traversal` at a higher directory level.                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Execution Flow                                                                  [2m                [0m
[2;36m                    [0m         The vulnerability manifests through the following execution path:                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **Entry Point**: The fuzzer initiates parsing through                            [2m                [0m
[2;36m                    [0m         `[1;35mTikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0m[1m)[0m`                                       [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **Parsing Chain**: The request flows through multiple parser layers:             [2m                [0m
[2;36m                    [0m            - `[1;35mRecursiveParserWrapper.parse[0m[1m([0m[1m)[0m`                                               [2m                [0m
[2;36m                    [0m            - `[1;35mAutoDetectParser.parse[0m[1m([0m[1m)[0m`                                                     [2m                [0m
[2;36m                    [0m            - `[1;35mCompositeParser.parse[0m[1m([0m[1m)[0m`                                                      [2m                [0m
[2;36m                    [0m            - `[1;35mPackageParser.parse[0m[1m([0m[1m)[0m` and related methods                                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Embedded Document Processing**:                                                [2m                [0m
[2;36m                    [0m            - `[1;35mRUnpackExtractor.parseEmbedded[0m[1m([0m[1m)[0m` processes embedded content                  [2m                [0m
[2;36m                    [0m            - `[1;35mRUnpackExtractor.parseWithBytes[0m[1m([0m[1m)[0m` and                                        [2m                [0m
[2;36m                    [0m         `[1;35mRUnpackExtractor.storeEmbeddedBytes[0m[1m([0m[1m)[0m` handle the embedded data                    [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Emission Point**: `[1;35mEmittingEmbeddedDocumentBytesHandler.add[0m[1m([0m[1m)[0m` passes the data [2m                [0m
[2;36m                    [0m         to the emitter                                                                      [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **Vulnerability Trigger**: `[1;35mFileSystemEmitter.emit[0m[1m([0m[1m)[0m` attempts to write to the   [2m                [0m
[2;36m                    [0m         filesystem                                                                          [2m                [0m
[2;36m                    [0m         [1;36m6[0m. **Detection**: `[1;35mFilePathTraversal.copyMismatchMvHook[0m[1m([0m[1m)[0m` and related methods      [2m                [0m
[2;36m                    [0m         detect the malicious path                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Key Observations                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **Detection Location**: The vulnerability was caught by Jazzer's                 [2m                [0m
[2;36m                    [0m         `FilePathTraversal` sanitizer at line [1;36m346[0m, specifically in the `[1;35mcheckPath[0m[1m([0m[1m)[0m` method [2m                [0m
[2;36m                    [0m         [1m([0mline [1;36m293[0m[1m)[0m and `[1;35mcopyMismatchMvHook[0m[1m([0m[1m)[0m` [1m([0mline [1;36m211[0m[1m)[0m.                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **Affected Component**: The `FileSystemEmitter` class [1m([0mline [1;36m155[0m[1m)[0m is the direct   [2m                [0m
[2;36m                    [0m         component attempting the unsafe file operation.                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Data Source**: The malicious path originates from processing embedded          [2m                [0m
[2;36m                    [0m         documents within an archive or package file, specifically through the RUnpack       [2m                [0m
[2;36m                    [0m         extractor mechanism.                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Parser Stack**: Multiple parser layers are involved, indicating that the       [2m                [0m
[2;36m                    [0m         vulnerability could potentially affect various file formats that support embedded   [2m                [0m
[2;36m                    [0m         content.                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Areas for Investigation                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         To obtain a holistic understanding of this vulnerability, the following codebase    [2m                [0m
[2;36m                    [0m         components should be examined:                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **FileSystemEmitter.java** [1m([0mline [1;36m155[0m[1m)[0m:                                           [2m                [0m
[2;36m                    [0m            - Investigate how output paths are constructed and validated                     [2m                [0m
[2;36m                    [0m            - Review the path handling logic before filesystem operations                    [2m                [0m
[2;36m                    [0m            - Examine if input paths are sanitized before use                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **RUnpackExtractor.java** [1m([0mlines [1;36m91[0m, [1;36m122[0m, [1;36m153[0m[1m)[0m:                                  [2m                [0m
[2;36m                    [0m            - Analyze how embedded file names/paths are extracted from RUnpack archives      [2m                [0m
[2;36m                    [0m            - Review the `[1;35mstoreEmbeddedBytes[0m[1m([0m[1m)[0m`, `[1;35mparseWithBytes[0m[1m([0m[1m)[0m`, and `[1;35mparseEmbedded[0m[1m([0m[1m)[0m`   [2m                [0m
[2;36m                    [0m         methods                                                                             [2m                [0m
[2;36m                    [0m            - Determine if extracted paths are used directly without validation              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **EmittingEmbeddedDocumentBytesHandler.java** [1m([0mline [1;36m66[0m[1m)[0m:                         [2m                [0m
[2;36m                    [0m            - Review how embedded document metadata [1m([0mincluding paths[1m)[0m is passed to emitters  [2m                [0m
[2;36m                    [0m            - Check if any path validation occurs at this layer                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **PackageParser.java** [1m([0mlines [1;36m336[0m, [1;36m386[0m, [1;36m481[0m[1m)[0m:                                    [2m                [0m
[2;36m                    [0m            - Examine how entry names are extracted from package/archive formats             [2m                [0m
[2;36m                    [0m            - Review the `[1;35mparseEntry[0m[1m([0m[1m)[0m` method to understand how individual entries are      [2m                [0m
[2;36m                    [0m         processed                                                                           [2m                [0m
[2;36m                    [0m            - Investigate if entry names from untrusted archives are sanitized               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **FilePathTraversal.java sanitizer**:                                            [2m                [0m
[2;36m                    [0m            - While this component successfully detected the issue, understanding its        [2m                [0m
[2;36m                    [0m         validation logic can help identify where validation should be added in the          [2m                [0m
[2;36m                    [0m         application code                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m. **General Path Handling**:                                                       [2m                [0m
[2;36m                    [0m            - Review all locations where external file/entry names are used to construct     [2m                [0m
[2;36m                    [0m         filesystem paths                                                                    [2m                [0m
[2;36m                    [0m            - Examine the overall architecture for handling embedded resources and their     [2m                [0m
[2;36m                    [0m         naming                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: [0m   [2m                [0m
[2;36m                    [0m         [39mFile path traversal: [0m                                                               [2m                [0m
[2;36m                    [0m         [35m/tmp/expander-tmp1955178695099218025/output/q/r/s/t/./input.bin/../../../[0m[95mjazzer-tra[0m [2m                [0m
[2;36m                    [0m         [95mversal[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.check[0m[1;39m([0m[39mFilePathTraversal.j[0m [2m                [0m
[2;36m                    [0m         [39mav[0m[1;92ma:346[0m[1;39m)[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.checkPath[0m[1;39m([0m[39mFilePathTravers[0m [2m                [0m
[2;36m                    [0m         [39mal.jav[0m[1;92ma:293[0m[1;39m)[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.FilePathTraversal.copyMismatchMvHook[0m[1;39m([0m[39mFilePa[0m [2m                [0m
[2;36m                    [0m         [39mthTraversal.jav[0m[1;92ma:211[0m[1;39m)[0m                                                               [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.emitter.fs.FileSystemEmitter.emit[0m[1;39m([0m[39mFileSystemEmitter.jav[0m[1;92ma:155[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.pipes.extractor.EmittingEmbeddedDocumentBytesHandler.add[0m[1;39m([0m[39mEmittingEm[0m [2m                [0m
[2;36m                    [0m         [39mbeddedDocumentBytesHandler.jav[0m[1;92ma:66[0m[1;39m)[0m                                                 [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.storeEmbeddedBytes[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:153[0m[1;39m)[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseWithBytes[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma:122[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.extractor.RUnpackExtractor.parseEmbedded[0m[1;39m([0m[39mRUnpackExtractor.jav[0m[1;92ma:91[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.RecursiveParserWrapper.parse[0m[1;39m([0m[39mRecursiveParserWrapper.jav[0m[1;92ma:168[0m [2m                [0m
[2;36m                    [0m         [1;39m)[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseRecursive[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:660[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseWithStream[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:546[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.pipes.PipesServer.parseFromTuple[0m[1;39m([0m[39mPipesServer.jav[0m[1;92ma:487[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.RecursivelyExtract.main[0m[1;39m([0m[39mRecursivelyExtract.jav[0m[1;92ma:96[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:234[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppRUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppRUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppRUnpackerFuzzer.jav[0m[1;92ma:5[0m [2m                [0m
[2;36m                    [0m         [1;92m4[0m[1;39m)[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: e329145bbb375a14[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:19[0m[39m-[0m[1;36m37[0m                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.Writer;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.FileAlreadyExistsException;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.pipes.emitter.AbstractEmitter;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.pipes.emitter.StreamEmitter;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.pipes.emitter.TikaEmitterException;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.serialization.JsonMetadataList;[0m                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:145[0m[39m-[0m[1;36m165[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString path, InputStream inputStream, Metadata [0m            [2m                [0m
[2;36m                    [0m         [39muserMetadata, ParseContext parseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mFiles.isDirectory[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            [0m[1;35mFiles.createDirectories[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        if [0m[1;39m([0m[39monExists == ON_EXISTS.REPLACE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target, [0m                                    [2m                [0m
[2;36m                    [0m         [39mStandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.EXCEPTION[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.SKIP[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mFiles.isRegularFile[0m[1;39m([0m[39mtarget[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:                    [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mFileAlreadyExistsException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:19[0m[39m-[0m[1;36m30[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.File;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.tika.io.FilenameUtils;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.pipes.extractor.EmbeddedDocumentBytesConfig;[0m              [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:36[0m[39m-[0m[1;36m72[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    public String [0m[1;35mgetEmitKey[0m[1;39m([0m[39mString containerEmitKey, int embeddedId,[0m            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:                             EmbeddedDocumentBytesConfig [0m                        [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:                             Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getPathStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m                [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:                EmbeddedDocumentBytesConfig.PATH_STRATEGY.EMBEDDED_PATH[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:            return [0m[1;35membeddedPath[0m[1;39m([0m[39mcontainerEmitKey, embeddedDocumentBytesConfig, [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        String embeddedIdString = [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m >[0m [2m                [0m
[2;36m                    [0m         [1;36m0[0m[39m ?[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:                [0m[1;35mStringUtils.leftPad[0m[1;39m([0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m,[0m                [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:                        [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m, [0m[32m"0"[0m[1;39m)[0m[39m :[0m     [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:                [0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[35m/[0m[35m/[0m[95mat[0m[39m this point the emit key has the full [0m[32m"file"[0m[39m part, now we[0m            [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[95madd[0m[39m the embedded id prefix, the embedded id string and then maybe[0m      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        [0m[35m/[0m[35m/[0m[95mthe[0m[39m file extension[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmbeddedIdPrefix[0m[1;39m([0m[1;39m)[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[39membeddedIdString[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getSuffixStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m              [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                EmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.EXISTING[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            String fName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:            String suffix = [0m[1;35mFilenameUtils.getSuffixFromPath[0m[1;39m([0m[39mfName[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            suffix = [0m[1;35msuffix.toLowerCase[0m[1;39m([0m[39mLocale.US[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        return [0m[1;35memitKey.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:440[0m[39m-[0m[1;36m516[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m440[0m[39m:    private void [0m[1;35mparseEntry[0m[1;39m([0m[39mArchiveInputStream archive, ArchiveEntry entry,[0m     [2m                [0m
[2;36m                    [0m         [1;36m441[0m[39m:                            EmbeddedDocumentExtractor extractor, Metadata [0m      [2m                [0m
[2;36m                    [0m         [39mparentMetadata,[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m442[0m[39m:                            XHTMLContentHandler xhtml[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [1;36m443[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m444[0m[39m:        String name = [0m[1;35mentry.getName[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m445[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m446[0m[39m:        [0m[35m/[0m[35m/[0m[95mTry[0m[39m to detect charset of archive entry in case of non-unicode [0m        [2m                [0m
[2;36m                    [0m         [39mfilename is used[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m447[0m[39m:        if [0m[1;39m([0m[39mdetectCharsetsInEntryNames && entry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m448[0m[39m:            [0m[35m/[0m[35m/[0m[39m Extend short entry name to improve accuracy of charset detection[0m [2m                [0m
[2;36m                    [0m         [1;36m449[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m entryName = [0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m491[0m[39m:                if [0m[1;39m([0m[39musesEncryption[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m492[0m[39m:                    [0m[1;35mEmbeddedDocumentUtil.recordEmbeddedStreamException[0m[1;39m([0m         [2m                [0m
[2;36m                    [0m         [1;36m493[0m[39m:                            new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[32m"stream [0m[32m([0m[32m"[0m[39m + name + [0m [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m is encrypted"[0m[1;39m)[0m[39m,[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m494[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m495[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m496[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m497[0m[39m:                [0m[35m/[0m[35m/[0m[39m do not write to the handler if[0m                               [2m                [0m
[2;36m                    [0m         [1;36m498[0m[39m:                [0m[35m/[0m[35m/[0m[39m UnsupportedZipFeatureException.Feature.DATA_DESCRIPTOR[0m       [2m                [0m
[2;36m                    [0m         [1;36m499[0m[39m:                [0m[35m/[0m[35m/[0m[39m is met, we will catch this exception and read the zip [0m       [2m                [0m
[2;36m                    [0m         [39marchive once again[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m500[0m[39m:                boolean usesDataDescriptor =[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m501[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesDataDescriptor[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m502[0m[39m:                if [0m[1;39m([0m[39musesDataDescriptor && [0m[1;35mzipArchiveEntry.getMethod[0m[1;39m([0m[1;39m)[0m[39m == [0m       [2m                [0m
[2;36m                    [0m         [39mZipEntry.STORED[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m503[0m[39m:                    throw new [0m[1;35mUnsupportedZipFeatureException[0m[1;39m([0m                   [2m                [0m
[2;36m                    [0m         [1;36m504[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [39mUnsupportedZipFeatureException.Feature.DATA_DESCRIPTOR,[0m                             [2m                [0m
[2;36m                    [0m         [1;36m505[0m[39m:                            zipArchiveEntry[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m506[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m507[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m508[0m[39m:                [0m[1;35mEmbeddedDocumentUtil.recordEmbeddedStreamException[0m[1;39m([0m             [2m                [0m
[2;36m                    [0m         [1;36m509[0m[39m:                        new [0m[1;35mTikaException[0m[1;39m([0m[32m"Can't read archive stream [0m[32m([0m[32m"[0m[39m + name [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m,[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m510[0m[39m:                        parentMetadata[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m511[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m512[0m[39m:            if [0m[1;39m([0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m513[0m[39m:                [0m[1;35mxhtml.element[0m[1;39m([0m[32m"p"[0m[39m, name[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m514[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m515[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m516[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:208[0m[39m-[0m[1;36m233[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:    protected static Metadata [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mString name, Date createAt, [0m  [2m                [0m
[2;36m                    [0m         [39mDate modifiedAt,[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                                                  Long size, [0m                   [2m                [0m
[2;36m                    [0m         [39mXHTMLContentHandler xhtml[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:        Metadata entrydata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:        if [0m[1;39m([0m[39mcreateAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.CREATED, createAt[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:        if [0m[1;39m([0m[39mmodifiedAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.MODIFIED, modifiedAt[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:        if [0m[1;39m([0m[39msize != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mMetadata.CONTENT_LENGTH, [0m[1;35mLong.toString[0m[1;39m([0m[39msize[0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:        if [0m[1;39m([0m[39mname != null && [0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:            name = [0m[1;35mname.replace[0m[1;39m([0m[32m"\\", "[0m[35m/[0m[39m"[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:            AttributesImpl attributes = new [0m[1;35mAttributesImpl[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"CDATA"[0m[39m, [0m[32m"embedded"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"CDATA"[0m[39m, name[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:            [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"div"[0m[39m, attributes[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:            [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"div"[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID, name[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:        return entrydata;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/io/FilenameUtils.jav[0m[1;92ma:26[0m[39m-[0m[1;36m133[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:public class FilenameUtils [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:     * Reserved characters[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:    public final static char[0m[1;39m[[0m[1;39m][0m[39m RESERVED_FILENAME_CHARACTERS =[0m                    [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:            [0m[1;39m{[0m[1;36m0x00[0m[39m, [0m[1;36m0x01[0m[39m, [0m[1;36m0x02[0m[39m, [0m[1;36m0x03[0m[39m, [0m[1;36m0x04[0m[39m, [0m[1;36m0x05[0m[39m, [0m[1;36m0x06[0m[39m, [0m[1;36m0x07[0m[39m, [0m[1;36m0x08[0m[39m, [0m[1;36m0x09[0m[39m, [0m[1;36m0x0A[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [1;36m0x0B[0m[39m, [0m[1;36m0x0C[0m[39m, [0m[1;36m0x0D[0m[39m,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:                    [0m[1;36m0x0E[0m[39m, [0m[1;36m0x0F[0m[39m, [0m[1;36m0x10[0m[39m, [0m[1;36m0x11[0m[39m, [0m[1;36m0x12[0m[39m, [0m[1;36m0x13[0m[39m, [0m[1;36m0x14[0m[39m, [0m[1;36m0x15[0m[39m, [0m[1;36m0x16[0m[39m, [0m[1;36m0x17[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m0x18[0m[39m, [0m[1;36m0x19[0m[39m, [0m[1;36m0x1A[0m[39m,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:                    [0m[1;36m0x1B[0m[39m, [0m[1;36m0x1C[0m[39m, [0m[1;36m0x1D[0m[39m, [0m[1;36m0x1E[0m[39m, [0m[1;36m0x1F[0m[39m, [0m[32m'?'[0m[39m, [0m[32m':'[0m[39m, [0m[32m'*'[0m[39m, [0m[32m'<'[0m[39m, [0m[32m'>'[0m[39m, [0m[32m'|'[0m[1;39m}[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:    private final static HashSet<Character> RESERVED = new HashSet<>[0m[1;39m([0m[1;36m38[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:    static [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:        for [0m[1;39m([0m[39mchar reservedFilenameCharacter : RESERVED_FILENAME_CHARACTERS[0m[1;39m)[0m[39m [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:            [0m[1;35mRESERVED.add[0m[1;39m([0m[39mreservedFilenameCharacter[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    private final static Pattern ASCII_NUMERIC = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\A\\.[0m[32m([0m[32m?i[0m[32m)[0m[32m[[0m[32ma-z0-9[0m[32m][0m[32m{[0m[32m1,5[0m[32m}[0m[32m\\Z"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * Scans the given file name for reserved characters on different OSs and[0m    [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     * file systems and returns a sanitized version of the name with the[0m         [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:     * reserved chars replaced by their hexadecimal value.[0m                       [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:     * For example <code>why?.zip<[0m[35m/[0m[95mcode[0m[39m> will be converted into [0m                 [2m                [0m
[2;36m                    [0m         [39m<code>why%3F.zip<[0m[35m/[0m[95mcode[0m[39m>[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:     * @param name the file name to be normalized - NOT NULL[0m                     [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:     * @return the normalized file name[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:     * @throws IllegalArgumentException if name is null[0m                          [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:    public static String [0m[1;35mnormalize[0m[1;39m([0m[39mfinal String name[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"name cannot be null"[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:        StringBuilder sb = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:        for [0m[1;39m([0m[39mchar c : [0m[1;35mname.toCharArray[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:            if [0m[1;39m([0m[1;35mRESERVED.contains[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:                [0m[1;35msb.append[0m[1;39m([0m[32m'%'[0m[1;39m)[0m[1;35m.append[0m[1;39m([0m[1;39m([0m[39mc < [0m[1;36m16[0m[1;39m)[0m[39m ? [0m[32m"0"[0m[39m : [0m[32m""[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:                        [0m                                                         [2m                [0m
[2;36m                    [0m         [1;35m.append[0m[1;39m([0m[1;35mInteger.toHexString[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;35m.toUpperCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:                [0m[1;35msb.append[0m[1;39m([0m[39mc[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        return [0m[1;35msb.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * This is a duplication of the algorithm and functionality[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * available in commons io FilenameUtils.  If Java's File were[0m               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * able handle Windows file paths correctly in linux,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * we wouldn't need this.[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * The goal of this is to get a filename from a path.[0m                        [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * The package parsers and some other embedded doc[0m                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * extractors could put anything into TikaCoreProperties.RESOURCE_NAME_KEY.[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * If a careless client used that filename as if it were a[0m                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     * filename and not a path when writing embedded files,[0m                      [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * bad things could happen.  Consider: [0m[32m"../../../my_ppt.ppt"[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     * Consider using this in combination with [0m[1;39m{[0m[39m@link #[0m[1;35mnormalize[0m[1;39m([0m[39mString[0m[1;39m)[0m[1;39m}[0m[39m.[0m       [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param path path to strip[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return empty string or a filename, never null[0m                            [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    public static String [0m[1;35mgetName[0m[1;39m([0m[39mfinal String path[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39mpath == null || [0m[1;35mpath.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        int unix = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        int windows = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[39m"\\"[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[95msome[0m[39m macintosh file names are stored with : as the delimiter[0m          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        [0m[35m/[0m[35m/[0m[95malso[0m[39m necessary to properly handle C:somefilename[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        int colon = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m":"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        String cand = [0m[1;35mpath.substring[0m[1;39m([0m[1;35mMath.max[0m[1;39m([0m[39mcolon, [0m[1;35mMath.max[0m[1;39m([0m[39munix, windows[0m[1;39m)[0m[1;39m)[0m[39m +[0m [2m                [0m
[2;36m                    [0m         [1;36m1[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[1;35mcand.equals[0m[1;39m([0m[32m".."[0m[1;39m)[0m[39m || [0m[1;35mcand.equals[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return cand;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * This includes the period, e.g. [0m[32m".pdf"[0m[39m.[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     * This requires that an extension contain only ascii alphanumerics[0m         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:     * and it requires that an extension length be [0m[1;36m5[0m[39m or less.[0m                   [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:     * @param path[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:     * @return the suffix or an empty string if one could not be found[0m          [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:    public static String [0m[1;35mgetSuffixFromPath[0m[1;39m([0m[39mString path[0m[1;39m)[0m[39m [0m[1;39m{[0m                       [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:        String n = [0m[1;35mgetName[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:        int i = [0m[1;35mn.lastIndexOf[0m[1;39m([0m[32m"."[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        [0m[35m/[0m[35m/[0m[95marbitrarily[0m[39m sets max extension length[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:        if [0m[1;39m([0m[39mi > [0m[1;36m-1[0m[39m && [0m[1;35mn.length[0m[1;39m([0m[1;39m)[0m[39m - i < [0m[1;36m6[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:            String suffix = [0m[1;35mn.substring[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            if [0m[1;39m([0m[1;35mASCII_NUMERIC.matcher[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[1;35m.matches[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:                return suffix;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:        return StringUtils.EMPTY;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:74[0m[39m-[0m[1;36m116[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    private String [0m[1;35membeddedPath[0m[1;39m([0m[39mString containerEmitKey,[0m                         [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:                                EmbeddedDocumentBytesConfig [0m                     [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:                                Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        String embeddedPath = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        String dirPath = [0m[1;35maddSubDirs[0m[1;39m([0m[39membeddedPath[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[39mdirPath[0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getSuffixStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:                EmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.EXISTING[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            String fName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:            String suffix = [0m[1;35mFilenameUtils.getSuffixFromPath[0m[1;39m([0m[39mfName[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            suffix = [0m[1;35msuffix.toLowerCase[0m[1;39m([0m[39mLocale.US[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        return [0m[1;35memitKey.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:    private String [0m[1;35maddSubDirs[0m[1;39m([0m[39mString embeddedPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        StringBuilder sb = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[35m/[0m[35m/[0m[95mfor[0m[39m safety[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        File cwd = new [0m[1;35mFile[0m[1;39m([0m[32m"."[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        File f = new [0m[1;35mFile[0m[1;39m([0m[39mcwd, embeddedPath[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        String relPath = [0m[1;35mcwd.toPath[0m[1;39m([0m[1;39m)[0m[1;35m.relativize[0m[1;39m([0m[1;35mf.toPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[1;35mrelPath.startsWith[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            relPath = [0m[1;35mrelPath.substring[0m[1;39m([0m[1;36m1[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        relPath = [0m[1;35mrelPath.replaceAll[0m[1;39m([0m[32m"\\.\\./"[0m[39m, [0m[32m"/"[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        relPath = [0m[1;35mrelPath.replaceAll[0m[1;39m([0m[32m"/+"[0m[39m, [0m[32m"/"[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m parts = [0m[1;35mrelPath.split[0m[1;39m([0m[32m"[0m[32m[[0m[32m/\\\\[0m[32m][0m[32m"[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < parts.length - [0m[1;36m1[0m[39m; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            [0m[35m/[0m[35m/[0m[95mconfirm[0m[39m there's a file name[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            if [0m[1;39m([0m[1;35mcontainsAlphaNumeric[0m[1;39m([0m[39mparts[0m[1;39m[[0m[39mi[0m[1;39m][0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                [0m[1;35msb.append[0m[1;39m([0m[39mparts[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m + [0m[32m"/attach/"[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:                [0m[1;35msb.append[0m[1;39m([0m[39mparts[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m + [0m[32m"/"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        [0m[1;35msb.append[0m[1;39m([0m[39mparts[0m[1;39m[[0m[39mparts.length - [0m[1;36m1[0m[1;39m][0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:        return [0m[1;35msb.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/java/org/apache/tika/io/FilenameUtilsTest.jav[0m[1;92ma:90[0m[39m-[0m[1;36m104[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    @Test[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    public void [0m[1;35mtestGetName[0m[1;39m([0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"quick.ppt"[0m[39m, [0m[32m"C:\\the\\quick.ppt"[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"quick.ppt"[0m[39m, [0m[32m"/the/quick.ppt"[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m""[0m[39m, [0m[32m"/the/quick/"[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m""[0m[39m, [0m[32m"~/the/quick////\\\\//"[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"~~quick"[0m[39m, [0m[32m"~~quick"[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"quick.ppt"[0m[39m, [0m[32m"quick.ppt"[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m""[0m[39m, [0m[32m"////"[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m""[0m[39m, [0m[32m"C:////"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m""[0m[39m, [0m[32m".."[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"quick"[0m[39m, [0m[32m"C:////../the/D:/quick"[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"file.ppt"[0m[39m, [0m[32m"path:to:file.ppt"[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        [0m[1;35mtestFilenameEquality[0m[1;39m([0m[32m"HW.txt"[0m[39m, [0m[32m"_1457338542/HW.txt"[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcher.jav[0m[1;92ma:74[0m[39m-[0m [2m                [0m
[2;36m                    [0m         [1;36m84[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:                    [0m[32m"a file name with this character in it."[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        Path p = null;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        if [0m[1;39m([0m[39mbasePath != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            p = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mfetchKey[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mp.toRealPath[0m[1;39m([0m[1;39m)[0m[1;35m.startsWith[0m[1;39m([0m[1;35mbasePath.toRealPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:                throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:                        [0m[32m"fetchKey must resolve to be a descendant of the [0m        [2m                [0m
[2;36m                    [0m         [32m'basePath'"[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            p = [0m[1;35mPaths.get[0m[1;39m([0m[39mfetchKey[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/AbstractEmbeddedDocumentBytesHand[0m [2m                [0m
[2;36m                    [0m         [39mler.jav[0m[1;92ma:36[0m[39m-[0m[1;36m72[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:    public String [0m[1;35mgetEmitKey[0m[1;39m([0m[39mString containerEmitKey, int embeddedId,[0m            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:                             EmbeddedDocumentBytesConfig [0m                        [2m                [0m
[2;36m                    [0m         [39membeddedDocumentBytesConfig,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:                             Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getPathStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m                [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:                EmbeddedDocumentBytesConfig.PATH_STRATEGY.EMBEDDED_PATH[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:            return [0m[1;35membeddedPath[0m[1;39m([0m[39mcontainerEmitKey, embeddedDocumentBytesConfig, [0m  [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        String embeddedIdString = [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m >[0m [2m                [0m
[2;36m                    [0m         [1;36m0[0m[39m ?[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:                [0m[1;35mStringUtils.leftPad[0m[1;39m([0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m,[0m                [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:                        [0m[1;35membeddedDocumentBytesConfig.getZeroPadName[0m[1;39m([0m[1;39m)[0m[39m, [0m[32m"0"[0m[1;39m)[0m[39m :[0m     [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:                [0m[1;35mInteger.toString[0m[1;39m([0m[39membeddedId[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        StringBuilder emitKey = new [0m[1;35mStringBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[32m"/"[0m[1;39m)[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mcontainerEmitKey[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmitKeyBase[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[35m/[0m[35m/[0m[95mat[0m[39m this point the emit key has the full [0m[32m"file"[0m[39m part, now we[0m            [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[95madd[0m[39m the embedded id prefix, the embedded id string and then maybe[0m      [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        [0m[35m/[0m[35m/[0m[95mthe[0m[39m file extension[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:        [0m[1;35memitKey.append[0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getEmbeddedIdPrefix[0m[1;39m([0m[1;39m)[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:                    [0m[1;35m.append[0m[1;39m([0m[39membeddedIdString[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:        if [0m[1;39m([0m[1;35membeddedDocumentBytesConfig.getSuffixStrategy[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m              [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:                EmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.EXISTING[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            String fName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:            String suffix = [0m[1;35mFilenameUtils.getSuffixFromPath[0m[1;39m([0m[39mfName[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            suffix = [0m[1;35msuffix.toLowerCase[0m[1;39m([0m[39mLocale.US[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            [0m[1;35memitKey.append[0m[1;39m([0m[39msuffix[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        return [0m[1;35memitKey.toString[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcher.jav[0m[1;92ma:19[0m[39m-[0m [2m                [0m
[2;36m                    [0m         [1;36m47[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.FileNotFoundException;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.attribute.BasicFileAttributes;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.attribute.FileTime;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Date;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.config.Initializable;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.config.InitializableProblemHandler;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.config.Param;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.metadata.FileSystem;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.tika.pipes.fetcher.AbstractFetcher;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.tika.pipes.fetcher.fs.config.FileSystemFetcherConfig;[0m          [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcher.jav[0m[1;92ma:64[0m[39m-[0m [2m                [0m
[2;36m                    [0m         [1;36m99[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    static boolean [0m[1;35misDescendant[0m[1;39m([0m[39mPath root, Path descendant[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        return [0m[1;35mdescendant.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m                           [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:                [0m[1;35m.startsWith[0m[1;39m([0m[1;35mroot.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public InputStream [0m[1;35mfetch[0m[1;39m([0m[39mString fetchKey, Metadata metadata, ParseContext [0m   [2m                [0m
[2;36m                    [0m         [39mparseContext[0m[1;39m)[0m[39m throws IOException, TikaException [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        if [0m[1;39m([0m[1;35mfetchKey.contains[0m[1;39m([0m[32m"\u0000"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Path must not contain 'u0000'. "[0m [2m                [0m
[2;36m                    [0m         [39m+[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                    [0m[32m"Please review the life decisions that led you to requesting[0m [2m                [0m
[2;36m                    [0m         [32m"[0m[39m +[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:                    [0m[32m"a file name with this character in it."[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        Path p = null;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        if [0m[1;39m([0m[39mbasePath != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            p = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mfetchKey[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mp.toRealPath[0m[1;39m([0m[1;39m)[0m[1;35m.startsWith[0m[1;39m([0m[1;35mbasePath.toRealPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:                throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:                        [0m[32m"fetchKey must resolve to be a descendant of the [0m        [2m                [0m
[2;36m                    [0m         [32m'basePath'"[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            p = [0m[1;35mPaths.get[0m[1;39m([0m[39mfetchKey[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.SOURCE_PATH, fetchKey[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;35mupdateFileSystemMetadata[0m[1;39m([0m[39mp, metadata[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mFiles.isRegularFile[0m[1;39m([0m[39mp[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:            if [0m[1;39m([0m[39mbasePath != null && ![0m[1;35mFiles.isDirectory[0m[1;39m([0m[39mbasePath[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                throw new [0m[1;35mIOException[0m[1;39m([0m[32m"BasePath is not a directory: "[0m[39m + [0m         [2m                [0m
[2;36m                    [0m         [39mbasePath[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:                throw new [0m[1;35mFileNotFoundException[0m[1;39m([0m[1;35mp.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        return [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mp, metadata[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/extractor/EmittingEmbeddedDocumentByt[0m [2m                [0m
[2;36m                    [0m         [39mesHandler.jav[0m[1;92ma:19[0m[39m-[0m[1;36m32[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.Closeable;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.tika.extractor.AbstractEmbeddedDocumentBytesHandler;[0m           [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.tika.pipes.FetchEmitTuple;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.tika.pipes.emitter.EmitKey;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.pipes.emitter.Emitter;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.pipes.emitter.EmitterManager;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.pipes.emitter.StreamEmitter;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.tika.pipes.emitter.TikaEmitterException;[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/extractor/EmittingEmbeddedDocumentByt[0m [2m                [0m
[2;36m                    [0m         [39mesHandler.jav[0m[1;92ma:60[0m[39m-[0m[1;36m70[0m                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    public void [0m[1;35madd[0m[1;39m([0m[39mint id, Metadata metadata, InputStream inputStream[0m[1;39m)[0m[39m throws [0m  [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[35m/[0m[35m/[0m[95mintentionally[0m[39m do not call super.add, because we want the ids list to [0m  [2m                [0m
[2;36m                    [0m         [39mbe empty[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        String emitKey = [0m[1;35mgetEmitKey[0m[1;39m([0m[1;35mcontainerEmitKey.getEmitKey[0m[1;39m([0m[1;39m)[0m[39m,[0m               [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:                id, embeddedDocumentBytesConfig, metadata[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:            [0m[1;35memitter.emit[0m[1;39m([0m[39memitKey, inputStream, METADATA, PARSE_CONTEXT[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mTikaEmitterException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            throw new [0m[1;35mIOException[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/UnrarParser.jav[0m[1;92ma:138[0m[39m-[0m[1;36m153[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:    private FileProcessResult [0m[1;35munrar[0m[1;39m([0m[39mPath cwd, Path tmp[0m[1;39m)[0m[39m throws IOException [0m[1;39m{[0m    [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m could use the -l option to check for potentially bad file names[0m    [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:        [0m[35m/[0m[35m/[0m[95me.g.[0m[39m path traversals[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mcwd.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;35mpb.command[0m[1;39m([0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[32m"unrar"[0m[39m,[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:                [0m[32m"x"[0m[39m,  [0m[35m/[0m[35m/[0m[95mextract[0m[39m with paths[0m[33m...[0m[39mhope that unrar protects against [0m  [2m                [0m
[2;36m                    [0m         [39mpath traversals[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:                [0m[32m"-kb"[0m[39m, [0m[35m/[0m[35m/[0m[39m keep broken files[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[32m"-p-"[0m[39m, [0m[35m/[0m[35m/[0m[39m we don't support passwords yet -- don't hang waiting [0m [2m                [0m
[2;36m                    [0m         [39mfor password on stdin[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:                [0m[1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mtmp.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:        [0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/RecursivelyExtract.jav[0m[1;92ma:77[0m[39m-[0m[1;36m87[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:                            [0m[1;35mStandardCharsets.UTF_8.name[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m,[0m                      [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:                    [0m[1;36m100000000[0m[39m, [0m[1;36m30000[0m[39m, [0m[1;36m30000[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            [0m[1;35mpipesServer.initializeResources[0m[1;39m([0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            EmbeddedDocumentBytesConfig embeddedBytes = new [0m                     [2m                [0m
[2;36m                    [0m         [1;35mEmbeddedDocumentBytesConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            [0m                                                                     [2m                [0m
[2;36m                    [0m         [1;35membeddedBytes.setPathStrategy[0m[1;39m([0m[39mEmbeddedDocumentBytesConfig.PATH_STRATEGY.EMBEDDED_PA[0m [2m                [0m
[2;36m                    [0m         [39mTH[0m[1;39m)[0m[39m;[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            [0m[1;35membeddedBytes.setEmitter[0m[1;39m([0m[32m"bytes"[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            [0m                                                                     [2m                [0m
[2;36m                    [0m         [1;35membeddedBytes.setSuffixStrategy[0m[1;39m([0m[39mEmbeddedDocumentBytesConfig.SUFFIX_STRATEGY.NONE[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            ParseContext parseContext = new [0m[1;35mParseContext[0m[1;39m([0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:            [0m[1;35mparseContext.set[0m[1;39m([0m[39mEmbeddedDocumentBytesConfig.class, embeddedBytes[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            FetchEmitTuple fetchEmitTuple = new [0m[1;35mFetchEmitTuple[0m[1;39m([0m[32m"id"[0m[39m,[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/extractor/EmbeddedDocumentBytesConfig[0m [2m                [0m
[2;36m                    [0m         [39m.jav[0m[1;92ma:47[0m[39m-[0m[1;36m58[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    public enum PATH_STRATEGY [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:        ID, EMBEDDED_PATH;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        public static PATH_STRATEGY [0m[1;35mparse[0m[1;39m([0m[39mString s[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:            if [0m[1;39m([0m[1;35ms.equalsIgnoreCase[0m[1;39m([0m[32m"id"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:                return ID;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35ms.equalsIgnoreCase[0m[1;39m([0m[32m"embedded_path"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                return EMBEDDED_PATH;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"can't parse "[0m[39m + s[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/extractor/EmbeddedDocumentBytesConfig[0m [2m                [0m
[2;36m                    [0m         [39m.jav[0m[1;92ma:66[0m[39m-[0m[1;36m77[0m                                                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    private PATH_STRATEGY pathStrategy = PATH_STRATEGY.ID;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    private String embeddedIdPrefix = [0m[32m"-"[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    private String emitter;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    private boolean includeOriginal = false;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    [0m[35m/[0m[35m/[0m[95mThis[0m[39m should be set per file. This allows a custom[0m                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    [0m[35m/[0m[35m/[0m[95memit[0m[39m key base that bypasses the algorithmic generation of the emitKey[0m      [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[35m/[0m[35m/[0m[95mfrom[0m[39m the primary json emitKey[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    private String emitKeyBase = [0m[32m""[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/emitter/StreamEmitter.jav[0m[1;92ma:19[0m[39m-[0m[1;36m28[0m      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:public interface StreamEmitter extends Emitter [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    void [0m[1;35memit[0m[1;39m([0m[39mString emitKey, InputStream inputStream, Metadata userMetadata, [0m   [2m                [0m
[2;36m                    [0m         [39mParseContext parseContext[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:            throws IOException, TikaEmitterException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/PipesServer.jav[0m[1;92ma:484[0m[39m-[0m[1;36m491[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:        Metadata metadata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        try [0m[1;39m([0m[39mInputStream stream = [0m[1;35mfetcher.fetch[0m[1;39m([0m[1;35mt.getFetchKey[0m[1;39m([0m[1;39m)[0m[1;35m.getFetchKey[0m[1;39m([0m[1;39m)[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [39mmetadata, [0m[1;35mt.getParseContext[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            return [0m[1;35mparseWithStream[0m[1;39m([0m[39mt, stream, metadata[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mSecurityException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:            [0m[1;35mLOG.error[0m[1;39m([0m[32m"security exception "[0m[39m + [0m[1;35mt.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:            throw e;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m491[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mTikaException | IOException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/PipesServer.jav[0m[1;92ma:624[0m[39m-[0m[1;36m631[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m624[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"sax problem:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m625[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEncryptedDocumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m626[0m[39m:            containerException = [0m[1;35mExceptionUtils.getStackTrace[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m627[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"encrypted document:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m628[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mSecurityException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m629[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"security exception:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m630[0m[39m:            throw e;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m631[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/PipesServer.jav[0m[1;92ma:661[0m[39m-[0m[1;36m670[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m661[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mSAXException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m662[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"sax problem:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m663[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEncryptedDocumentException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m664[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"encrypted document:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m665[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mSecurityException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m666[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"security exception:"[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m667[0m[39m:            throw e;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m668[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m669[0m[39m:            [0m[1;35mLOG.warn[0m[1;39m([0m[32m"parse exception: "[0m[39m + [0m[1;35mfetchEmitTuple.getId[0m[1;39m([0m[1;39m)[0m[39m, e[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m670[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcherTest.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:19[0m[39m-[0m[1;36m29[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static org.junit.jupiter.api.Assertions.assertFalse;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static org.junit.jupiter.api.Assertions.assertThrows;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static org.junit.jupiter.api.Assertions.assertTrue;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.InvalidPathException;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.junit.jupiter.api.Test;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.config.InitializableProblemHandler;[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcherTest.jav[0m[1;92ma[0m [2m                [0m
[2;36m                    [0m         [1;92m:34[0m[39m-[0m[1;36m46[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:    @Test[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:    public void [0m[1;35mtestDescendant[0m[1;39m([0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m                              [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:        Path root = [0m[1;35mPaths.get[0m[1;39m([0m[32m"/ab/cd/"[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:        Path descendant = [0m[1;35mroot.resolve[0m[1;39m([0m[32m"ef/gh/ij.pdf"[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:        [0m[1;35massertTrue[0m[1;39m([0m[1;35mFileSystemFetcher.isDescendant[0m[1;39m([0m[39mroot, descendant[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:        descendant = [0m[1;35mPaths.get[0m[1;39m([0m[32m"/cd/ef.pdf"[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:        [0m[1;35massertFalse[0m[1;39m([0m[1;35mFileSystemFetcher.isDescendant[0m[1;39m([0m[39mroot, descendant[0m[1;39m)[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:        descendant = [0m[1;35mroot.resolve[0m[1;39m([0m[32m"../../ij.pdf"[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        [0m[1;35massertFalse[0m[1;39m([0m[1;35mFileSystemFetcher.isDescendant[0m[1;39m([0m[39mroot, descendant[0m[1;39m)[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/RUnpackExtractor.jav[0m[1;92ma:112[0m[39m-[0m[1;36m124[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    private void [0m[1;35mparseWithBytes[0m[1;39m([0m[39mTikaInputStream stream, ContentHandler handler,[0m [2m                [0m
[2;36m                    [0m         [39mMetadata metadata[0m[1;39m)[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:            throws TikaException, IOException, SAXException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- improve the efficiency of this so that we're not[0m              [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:        [0m[35m/[0m[35m/[0m[95mliterally[0m[39m writing out a file per request[0m                              [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        Path p = [0m[1;35mstream.getPath[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:            [0m[35m/[0m[35m/[0m[95mwarp[0m[39m in CloseShieldInputStream to ensure that a misbehaving [0m      [2m                [0m
[2;36m                    [0m         [39mparser isn't closing[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:            [0m[35m/[0m[35m/[0m[95mthe[0m[39m stream and thereby deleting the temp file.[0m                    [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:            [0m[1;35mparse[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, handler, metadata[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:            [0m[1;35mstoreEmbeddedBytes[0m[1;39m([0m[39mp, metadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/extractor/RUnpackExtractor.jav[0m[1;92ma:133[0m[39m-[0m[1;36m170[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:    private void [0m[1;35mstoreEmbeddedBytes[0m[1;39m([0m[39mPath p, Metadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:        if [0m[1;39m([0m[39m! [0m[1;35membeddedBytesSelector.select[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:            if [0m[1;39m([0m[1;35mLOGGER.isDebugEnabled[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:                [0m[1;35mLOGGER.debug[0m[1;39m([0m[32m"skipping embedded bytes [0m[32m{[0m[32m}[0m[32m <-> [0m[32m{[0m[32m}[0m[32m"[0m[39m,[0m               [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:                        [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[39m,[0m                    [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RESOURCE_TYPE[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            return;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:        EmbeddedDocumentBytesHandler embeddedDocumentBytesHandler =[0m             [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:                [0m[1;35mcontext.get[0m[1;39m([0m[39mEmbeddedDocumentBytesHandler.class[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:        int id = [0m[1;35mmetadata.getInt[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_ID[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        try [0m[1;39m([0m[39mInputStream is = [0m[1;35mFiles.newInputStream[0m[1;39m([0m[39mp[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mbytesExtracted >= maxEmbeddedBytesForExtraction[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Bytes extracted [0m[32m([0m[32m"[0m[39m + bytesExtracted +[0m    [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:                        [0m[32m"[0m[32m)[0m[32m >= max allowed [0m[32m([0m[32m"[0m[39m + maxEmbeddedBytesForExtraction + [0m [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m"[0m[1;39m)[0m[39m;[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            long maxToRead = maxEmbeddedBytesForExtraction - bytesExtracted;[0m    [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:            try [0m[1;39m([0m[39mBoundedInputStream boundedIs = new [0m                            [2m                [0m
[2;36m                    [0m         [1;35mBoundedInputStream[0m[1;39m([0m[39mmaxToRead, is[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:                [0m[1;35membeddedDocumentBytesHandler.add[0m[1;39m([0m[39mid, metadata, boundedIs[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:                bytesExtracted += [0m[1;35mboundedIs.getPos[0m[1;39m([0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:                if [0m[1;39m([0m[1;35mboundedIs.hasHitBound[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"Bytes extracted [0m[32m([0m[32m"[0m[39m + bytesExtracted [0m [2m                [0m
[2;36m                    [0m         [39m+[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:                            [0m[32m"[0m[32m)[0m[32m >= max allowed [0m[32m([0m[32m"[0m[39m + [0m                             [2m                [0m
[2;36m                    [0m         [39mmaxEmbeddedBytesForExtraction + [0m[32m"[0m[32m)[0m[32m. Truncated "[0m[39m +[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:                            [0m[32m"bytes"[0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIOException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:            [0m[1;35mLOGGER.warn[0m[1;39m([0m[32m"problem writing out embedded bytes"[0m[39m, e[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:            [0m[35m/[0m[35m/[0m[95minfo[0m[39m in metadata doesn't actually make it back to the metadata [0m   [2m                [0m
[2;36m                    [0m         [39mlist[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:            [0m[35m/[0m[35m/[0m[95mbecause[0m[39m we're filtering and cloning the metadata at the end of [0m   [2m                [0m
[2;36m                    [0m         [39mthe parse[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:            [0m[35m/[0m[35m/[0m[95mwhich[0m[39m happens before we try to copy out the files.[0m                [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:            [0m[35m/[0m[35m/[0m[95mTODO[0m[39m fix this[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:            [0m[35m/[0m[35m/[0m[95mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_BYTES_EXCEPTION,[0m         [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:              [0m[35m/[0m[35m/[0m[39m      [0m[1;35mExceptionUtils.getStackTrace[0m[1;39m([0m[39me[0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/io/FilenameUtils.jav[0m[1;92ma:78[0m[39m-[0m[1;36m112[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * This is a duplication of the algorithm and functionality[0m                  [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * available in commons io FilenameUtils.  If Java's File were[0m               [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * able handle Windows file paths correctly in linux,[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     * we wouldn't need this.[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * The goal of this is to get a filename from a path.[0m                        [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * The package parsers and some other embedded doc[0m                           [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * extractors could put anything into TikaCoreProperties.RESOURCE_NAME_KEY.[0m  [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * If a careless client used that filename as if it were a[0m                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     * filename and not a path when writing embedded files,[0m                      [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:     * bad things could happen.  Consider: [0m[32m"../../../my_ppt.ppt"[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:     * Consider using this in combination with [0m[1;39m{[0m[39m@link #[0m[1;35mnormalize[0m[1;39m([0m[39mString[0m[1;39m)[0m[1;39m}[0m[39m.[0m       [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param path path to strip[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return empty string or a filename, never null[0m                            [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    public static String [0m[1;35mgetName[0m[1;39m([0m[39mfinal String path[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39mpath == null || [0m[1;35mpath.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        int unix = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m"/"[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        int windows = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[39m"\\"[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[35m/[0m[35m/[0m[95msome[0m[39m macintosh file names are stored with : as the delimiter[0m          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        [0m[35m/[0m[35m/[0m[95malso[0m[39m necessary to properly handle C:somefilename[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        int colon = [0m[1;35mpath.lastIndexOf[0m[1;39m([0m[32m":"[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        String cand = [0m[1;35mpath.substring[0m[1;39m([0m[1;35mMath.max[0m[1;39m([0m[39mcolon, [0m[1;35mMath.max[0m[1;39m([0m[39munix, windows[0m[1;39m)[0m[1;39m)[0m[39m +[0m [2m                [0m
[2;36m                    [0m         [1;36m1[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        if [0m[1;39m([0m[1;35mcand.equals[0m[1;39m([0m[32m".."[0m[1;39m)[0m[39m || [0m[1;35mcand.equals[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            return StringUtils.EMPTY;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        return cand;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:208[0m[39m-[0m[1;36m233[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:    protected static Metadata [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mString name, Date createAt, [0m  [2m                [0m
[2;36m                    [0m         [39mDate modifiedAt,[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:                                                  Long size, [0m                   [2m                [0m
[2;36m                    [0m         [39mXHTMLContentHandler xhtml[0m[1;39m)[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:        Metadata entrydata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:        if [0m[1;39m([0m[39mcreateAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.CREATED, createAt[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:        if [0m[1;39m([0m[39mmodifiedAt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.MODIFIED, modifiedAt[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:        if [0m[1;39m([0m[39msize != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mMetadata.CONTENT_LENGTH, [0m[1;35mLong.toString[0m[1;39m([0m[39msize[0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:        if [0m[1;39m([0m[39mname != null && [0m[1;35mname.length[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:            name = [0m[1;35mname.replace[0m[1;39m([0m[32m"\\", "[0m[35m/[0m[39m"[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, name[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:            AttributesImpl attributes = new [0m[1;35mAttributesImpl[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"class"[0m[39m, [0m[32m"CDATA"[0m[39m, [0m[32m"embedded"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:            [0m[1;35mattributes.addAttribute[0m[1;39m([0m[32m""[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"id"[0m[39m, [0m[32m"CDATA"[0m[39m, name[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:            [0m[1;35mxhtml.startElement[0m[1;39m([0m[32m"div"[0m[39m, attributes[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:            [0m[1;35mxhtml.endElement[0m[1;39m([0m[32m"div"[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:            [0m[1;35mentrydata.set[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID, name[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:        return entrydata;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:440[0m[39m-[0m[1;36m472[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m440[0m[39m:    private void [0m[1;35mparseEntry[0m[1;39m([0m[39mArchiveInputStream archive, ArchiveEntry entry,[0m     [2m                [0m
[2;36m                    [0m         [1;36m441[0m[39m:                            EmbeddedDocumentExtractor extractor, Metadata [0m      [2m                [0m
[2;36m                    [0m         [39mparentMetadata,[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m442[0m[39m:                            XHTMLContentHandler xhtml[0m[1;39m)[0m                          [2m                [0m
[2;36m                    [0m         [1;36m443[0m[39m:            throws SAXException, IOException, TikaException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m444[0m[39m:        String name = [0m[1;35mentry.getName[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m445[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m446[0m[39m:        [0m[35m/[0m[35m/[0m[95mTry[0m[39m to detect charset of archive entry in case of non-unicode [0m        [2m                [0m
[2;36m                    [0m         [39mfilename is used[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m447[0m[39m:        if [0m[1;39m([0m[39mdetectCharsetsInEntryNames && entry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m   [2m                [0m
[2;36m                    [0m         [1;36m448[0m[39m:            [0m[35m/[0m[35m/[0m[39m Extend short entry name to improve accuracy of charset detection[0m [2m                [0m
[2;36m                    [0m         [1;36m449[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m entryName = [0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m450[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m extendedEntryName = entryName;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m451[0m[39m:            if [0m[1;39m([0m[1;36m0[0m[39m < entryName.length && entryName.length < [0m                     [2m                [0m
[2;36m                    [0m         [39mMIN_BYTES_FOR_DETECTING_CHARSET[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m452[0m[39m:                int len = entryName.length * [0m[1;39m([0m[39mMIN_BYTES_FOR_DETECTING_CHARSET [0m[35m/[0m [2m                [0m
[2;36m                    [0m         [39mentryName.length[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m453[0m[39m:                extendedEntryName = new byte[0m[1;39m[[0m[39mlen[0m[1;39m][0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m454[0m[39m:                for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < len; i++[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m455[0m[39m:                    extendedEntryName[0m[1;39m[[0m[39mi[0m[1;39m][0m[39m = entryName[0m[1;39m[[0m[39mi % entryName.length[0m[1;39m][0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m456[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m457[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m458[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m459[0m[39m:            Charset candidate =[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/parser/RecursiveParserWrapper.jav[0m[1;92ma:198[0m[39m-[0m[1;36m205[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:            objectName = [0m[32m"embedded-"[0m[39m + [0m[1;35mcounter.incrementAndGet[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:        [0m[35m/[0m[35m/[0m[95mmake[0m[39m sure that there isn't any path info in the objectName[0m            [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:        [0m[35m/[0m[35m/[0m[95msome[0m[39m parsers can return paths, not just file names[0m                    [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:        objectName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mobjectName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:        return objectName;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/java/org/apache/tika/TikaTest.jav[0m[1;92ma:504[0m[39m-[0m[1;36m514[0m                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m504[0m[39m:                                                  ParseContext context[0m[1;39m)[0m[39m throws [0m [2m                [0m
[2;36m                    [0m         [39mException [0m[1;39m{[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m505[0m[39m:        RecursiveParserWrapper wrapper = new [0m                                   [2m                [0m
[2;36m                    [0m         [1;35mRecursiveParserWrapper[0m[1;39m([0m[39mparserToWrap[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m506[0m[39m:        RecursiveParserWrapperHandler handler =[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m507[0m[39m:                new [0m[1;35mRecursiveParserWrapperHandler[0m[1;39m([0m[39mnew [0m                          [2m                [0m
[2;36m                    [0m         [1;35mBasicContentHandlerFactory[0m[1;39m([0m[39mhandlerType, [0m[1;36m-1[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m508[0m[39m:        Metadata metadata = new [0m[1;35mMetadata[0m[1;39m([0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m509[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY, [0m                     [2m                [0m
[2;36m                    [0m         [1;35mFilenameUtils.getName[0m[1;39m([0m[39mfilePath[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m510[0m[39m:        try [0m[1;39m([0m[39mInputStream is = [0m[1;35mgetResourceAsStream[0m[1;39m([0m[32m"/test-documents/"[0m[39m + [0m         [2m                [0m
[2;36m                    [0m         [39mfilePath[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m511[0m[39m:            [0m[1;35mwrapper.parse[0m[1;39m([0m[39mis, handler, metadata, context[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m512[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m513[0m[39m:        return [0m[1;35mhandler.getMetadataList[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m514[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.jav[0m[1;92ma:80[0m[39m-[0m[1;36m98[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:                name = [0m[32m"file_"[0m[39m + fileCount++;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:                [0m[35m/[0m[35m/[0m[95mmake[0m[39m sure to select only the file name [0m[1;39m([0m[39mnot any directory [0m     [2m                [0m
[2;36m                    [0m         [39mpaths[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                [0m[35m/[0m[35m/[0m[95mthat[0m[39m might be included in the name[0m[1;39m)[0m[39m and make sure[0m              [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                [0m[35m/[0m[35m/[0m[95mto[0m[39m normalize the name[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                int prefix = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                if [0m[1;39m([0m[39mprefix > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                    name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefix[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            [0m[35m/[0m[35m/[0m[95mnow[0m[39m try to figure out the right extension for the embedded file[0m    [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mstream, metadata[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1145[0m[39m-[0m[1;36m1174[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1170[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1171[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1172[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1173[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1174[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/parser/microsoft/rtf/RTFParserTest.jav[0m[1;92ma:79[0m[39m-[0m[1;36m89[0m                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:            Pair p = [0m[1;35me.getValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            [0m[1;35massertNotNull[0m[1;39m([0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            [0m[35m/[0m[35m/[0m[95mnecessary[0m[39m to [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m because MSOffice extractor includes[0m         [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            [0m[35m/[0m[35m/[0m[95mdirectory[0m[39m: _1457338524/HW.txt[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:            [0m[1;35massertEquals[0m[1;39m([0m[39mp.fileName,[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:                    [0m                                                             [2m                [0m
[2;36m                    [0m         [1;35mFilenameUtils.getName[0m[1;39m([0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RESOURCE_PATH[0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:            [0m[1;35massertEquals[0m[1;39m([0m[39mp.mimeType, [0m[1;35mmetadata.get[0m[1;39m([0m[39mMetadata.CONTENT_TYPE[0m[1;39m)[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35massertEquals[0m[1;39m([0m[32m"C:\\Users\\tallison\\AppData\\Local\\Temp\\testJPEG_普林斯顿.jpg"[0m[39m,[0m    [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                [0m                                                                 [2m                [0m
[2;36m                    [0m         [1;35mmetadataList.get[0m[1;39m([0m[1;36m46[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[39mTikaCoreProperties.ORIGINAL_RESOURCE_NAME[0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-example/src/main/java/org/apache/tika/example/ExtractEmbeddedFiles.jav[0m[1;92ma:80[0m[39m-[0m[1;36m94[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:                name = [0m[32m"file_"[0m[39m + fileCount++;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:                [0m[35m/[0m[35m/[0m[95mmake[0m[39m sure to select only the file name [0m[1;39m([0m[39mnot any directory [0m     [2m                [0m
[2;36m                    [0m         [39mpaths[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                [0m[35m/[0m[35m/[0m[95mthat[0m[39m might be included in the name[0m[1;39m)[0m[39m and make sure[0m              [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                [0m[35m/[0m[35m/[0m[95mto[0m[39m normalize the name[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                int prefix = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                if [0m[1;39m([0m[39mprefix > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                    name = [0m[1;35mname.substring[0m[1;39m([0m[39mprefix[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:                name = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1145[0m[39m-[0m[1;36m1174[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1170[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1171[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1172[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1173[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1174[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitte[0m [2m                [0m
[2;36m                    [0m         [39mr/fs/FileSystemEmitter.jav[0m[1;92ma:145[0m[39m-[0m[1;36m165[0m                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:    public void [0m[1;35memit[0m[1;39m([0m[39mString path, InputStream inputStream, Metadata [0m            [2m                [0m
[2;36m                    [0m         [39muserMetadata, ParseContext parseContext[0m[1;39m)[0m[39m throws IOException, TikaEmitterException [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mFiles.isDirectory[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:            [0m[1;35mFiles.createDirectories[0m[1;39m([0m[1;35mtarget.getParent[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        if [0m[1;39m([0m[39monExists == ON_EXISTS.REPLACE[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target, [0m                                    [2m                [0m
[2;36m                    [0m         [39mStandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.EXCEPTION[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:        [0m[1;39m}[0m[39m else if [0m[1;39m([0m[39monExists == ON_EXISTS.SKIP[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mFiles.isRegularFile[0m[1;39m([0m[39mtarget[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:                    [0m[1;35mFiles.copy[0m[1;39m([0m[39minputStream, target[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mFileAlreadyExistsException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/pipes/fetcher/fs/FileSystemFetcher.jav[0m[1;92ma:64[0m[39m-[0m [2m                [0m
[2;36m                    [0m         [1;36m82[0m                                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    static boolean [0m[1;35misDescendant[0m[1;39m([0m[39mPath root, Path descendant[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        return [0m[1;35mdescendant.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m                           [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:                [0m[1;35m.startsWith[0m[1;39m([0m[1;35mroot.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public InputStream [0m[1;35mfetch[0m[1;39m([0m[39mString fetchKey, Metadata metadata, ParseContext [0m   [2m                [0m
[2;36m                    [0m         [39mparseContext[0m[1;39m)[0m[39m throws IOException, TikaException [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        if [0m[1;39m([0m[1;35mfetchKey.contains[0m[1;39m([0m[32m"\u0000"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:            throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[32m"Path must not contain 'u0000'. "[0m [2m                [0m
[2;36m                    [0m         [39m+[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                    [0m[32m"Please review the life decisions that led you to requesting[0m [2m                [0m
[2;36m                    [0m         [32m"[0m[39m +[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:                    [0m[32m"a file name with this character in it."[0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        Path p = null;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        if [0m[1;39m([0m[39mbasePath != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            p = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mfetchKey[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mp.toRealPath[0m[1;39m([0m[1;39m)[0m[1;35m.startsWith[0m[1;39m([0m[1;35mbasePath.toRealPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:                throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:                        [0m[32m"fetchKey must resolve to be a descendant of the [0m        [2m                [0m
[2;36m                    [0m         [32m'basePath'"[0m[1;39m)[0m[39m;[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Analysis of the Vulnerability[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe evaluation report describes a **critical path traversal vulnerability** in [0m     [2m                [0m
[2;36m                    [0m         [39mApache Tika's `FileSystemEmitter` class. The issue allows malicious archive entries[0m [2m                [0m
[2;36m                    [0m         [39mcontaining directory traversal sequences [0m[1;39m([0m[39me.g., `..[0m[35m/[0m[39m`[0m[1;39m)[0m[39m to escape the intended [0m      [2m                [0m
[2;36m                    [0m         [39moutput directory and write files to arbitrary locations on the filesystem.[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Root Cause[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAfter analyzing the code snippets, the root cause is clear:[0m                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Entry Point**: Archive entry names are extracted in [0m                           [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mPackageParser.parseEntry[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mline [0m[1;36m444[0m[1;39m)[0m[39m via `[0m[1;35mentry.getName[0m[1;39m([0m[1;39m)[0m[39m` - an untrusted input [0m [2m                [0m
[2;36m                    [0m         [39msource.[0m                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Insufficient Sanitization**: In `[0m[1;35mPackageParser.handleEntryMetadata[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mline [0m   [2m                [0m
[2;36m                    [0m         [1;36m222[0m[1;39m)[0m[39m, only backslash-to-slash normalization occurs: `name = [0m[1;35mname.replace[0m[1;39m([0m[32m"\\", [0m     [2m                [0m
[2;36m                    [0m         [32m"[0m[35m/[0m[39m"[0m[1;39m)[0m[39m`. This does NOT prevent directory traversal sequences like `..[0m[35m/[0m[39m`.[0m              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Metadata Propagation**: The unsanitized name is stored in [0m                     [2m                [0m
[2;36m                    [0m         [39m`TikaCoreProperties.RESOURCE_NAME_KEY` [0m[1;39m([0m[39mline [0m[1;36m223[0m[1;39m)[0m[39m and flows through:[0m                [2m                [0m
[2;36m                    [0m         [39m   - RUnpackExtractor → EmittingEmbeddedDocumentBytesHandler → [0m                     [2m                [0m
[2;36m                    [0m         [1;35mAbstractEmbeddedDocumentBytesHandler.getEmitKey[0m[1;39m([0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Vulnerability Trigger**: In `[0m[1;35mFileSystemEmitter.emit[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mline [0m[1;36m147[0m[1;39m)[0m[39m, the path is[0m [2m                [0m
[2;36m                    [0m         [39mresolved directly without validation:[0m                                               [2m                [0m
[2;36m                    [0m         [39m   ```java[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m   Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m   Then parent directories are created [0m[1;39m([0m[39mline [0m[1;36m150[0m[1;39m)[0m[39m and files are written [0m[1;39m([0m[39mlines [0m     [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m-[0m[1;36m155[0m[1;39m)[0m[39m **without verifying that `target` remains within `basePath`**.[0m             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Key Findings from Code Analysis[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Existing Security Pattern**: `[0m[1;35mFileSystemFetcher.fetch[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines [0m[1;36m78[0m[39m-[0m[1;36m82[0m[1;39m)[0m[39m already[0m [2m                [0m
[2;36m                    [0m         [39mimplements the correct validation pattern:[0m                                          [2m                [0m
[2;36m                    [0m         [39m   ```java[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m   if [0m[1;39m([0m[39m![0m[1;35mp.toRealPath[0m[1;39m([0m[1;39m)[0m[1;35m.startsWith[0m[1;39m([0m[1;35mbasePath.toRealPath[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [39m       throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[33m...[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [39m   [0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Utility Method Available**: `[0m[1;35mFileSystemFetcher.isDescendant[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines [0m[1;36m64[0m[39m-[0m[1;36m67[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39mprovides a helper method using `[0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m` instead of `[0m[1;35mtoRealPath[0m[1;39m([0m[1;39m)[0m[39m`, which is [0m   [2m                [0m
[2;36m                    [0m         [39msuitable for paths that don't exist yet.[0m                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Established Sanitization Patterns**: Multiple examples in the codebase show [0m   [2m                [0m
[2;36m                    [0m         [39mproper path sanitization:[0m                                                           [2m                [0m
[2;36m                    [0m         [39m   - `ExtractEmbeddedFiles.java` [0m[1;39m([0m[39mline [0m[1;36m93[0m[1;39m)[0m[39m: [0m                                        [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[1;39m)[0m[39m`[0m                              [2m                [0m
[2;36m                    [0m         [39m   - `TikaCLI.java` [0m[1;39m([0m[39mlines [0m[1;36m1151[0m[39m-[0m[1;36m1165[0m[1;39m)[0m[39m: Multi-layer sanitization with null byte [0m     [2m                [0m
[2;36m                    [0m         [39mremoval, [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m, and [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m                                                 [2m                [0m
[2;36m                    [0m         [39m   - `RecursiveParserWrapper.java` [0m[1;39m([0m[39mline [0m[1;36m203[0m[1;39m)[0m[39m: Explicit use of [0m                     [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mFilenameUtils.getName[0m[1;39m([0m[1;39m)[0m[39m` with security comment[0m                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Security Awareness**: Comments in `[0m[1;35mFilenameUtils.getName[0m[1;39m([0m[1;39m)[0m[39m` [0m[1;39m([0m[39mlines [0m[1;36m88[0m[39m-[0m[1;36m90[0m[1;39m)[0m[39m [0m     [2m                [0m
[2;36m                    [0m         [39mexplicitly warn about the exact vulnerability: *[0m[32m"Consider: '../../../my_ppt.ppt'"[0m[39m*[0m  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix must be applied to **`[0m[1;35mFileSystemEmitter.emit[0m[1;39m([0m[1;39m)[0m[39m` method** to validate paths [0m [2m                [0m
[2;36m                    [0m         [39mbefore any filesystem operations. I will use the same security pattern already [0m     [2m                [0m
[2;36m                    [0m         [39mimplemented in `FileSystemFetcher`.[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Implementation Steps[0m                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m1[0m[39m: Add Path Traversal Validation to [0m[1;35mFileSystemEmitter.emit[0m[1;39m([0m[1;39m)[0m[39m**[0m               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mModify [0m                                                                             [2m                [0m
[2;36m                    [0m         [39m`tika-pipes/tika-emitters/tika-emitter-fs/src/main/java/org/apache/tika/pipes/emitt[0m [2m                [0m
[2;36m                    [0m         [39mer/fs/FileSystemEmitter.java` at the `[0m[1;35memit[0m[1;39m([0m[1;39m)[0m[39m` method [0m[1;39m([0m[39mstarting at line [0m[1;36m146[0m[1;39m)[0m[39m:[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Add null byte check** [0m[1;39m([0m[39msimilar to FileSystemFetcher line [0m[1;36m71[0m[39m-[0m[1;36m75[0m[1;39m)[0m[39m:[0m               [2m                [0m
[2;36m                    [0m         [39m   - Check if the path parameter contains `\u0000` character[0m                        [2m                [0m
[2;36m                    [0m         [39m   - Throw `IllegalArgumentException` if found[0m                                      [2m                [0m
[2;36m                    [0m         [39m   - This prevents null byte injection attacks[0m                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Validate the resolved path** before any file operations:[0m                       [2m                [0m
[2;36m                    [0m         [39m   - After `Path target = [0m[1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;` [0m[1;39m([0m[39mline [0m[1;36m147[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m   - Add validation to ensure the normalized target path stays within the [0m          [2m                [0m
[2;36m                    [0m         [39mnormalized basePath[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m   - Use the `[0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m` approach [0m[1;39m([0m[39mnot `[0m[1;35mtoRealPath[0m[1;39m([0m[1;39m)[0m[39m`[0m[1;39m)[0m[39m since the file doesn't [0m    [2m                [0m
[2;36m                    [0m         [39mexist yet[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m   - Throw `IllegalArgumentException` with a clear security message if validation [0m  [2m                [0m
[2;36m                    [0m         [39mfails[0m                                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Implement the validation logic**:[0m                                              [2m                [0m
[2;36m                    [0m         [39m   ```java[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m   Path normalizedTarget = [0m[1;35mtarget.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [39m   Path normalizedBase = [0m[1;35mbasePath.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [39m   if [0m[1;39m([0m[39m![0m[1;35mnormalizedTarget.startsWith[0m[1;39m([0m[39mnormalizedBase[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                              [2m                [0m
[2;36m                    [0m         [39m       throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m                                          [2m                [0m
[2;36m                    [0m         [39m           [0m[32m"Emit path must resolve to be within the base output directory. "[0m[39m +[0m      [2m                [0m
[2;36m                    [0m         [39m           [0m[32m"Potential path traversal detected: "[0m[39m + path[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [39m   [0m[1;39m}[0m                                                                                [2m                [0m
[2;36m                    [0m         [39m   ```[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Placement**: Insert this validation immediately after line [0m[1;36m147[0m[39m [0m[1;39m([0m[39m`Path target =[0m [2m                [0m
[2;36m                    [0m         [1;35mbasePath.resolve[0m[1;39m([0m[39mpath[0m[1;39m)[0m[39m;`[0m[1;39m)[0m[39m and before line [0m[1;36m149[0m[39m [0m[1;39m([0m[39mdirectory creation check[0m[1;39m)[0m[39m.[0m           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Step [0m[1;36m2[0m[39m: Add Helper Method [0m[1;39m([0m[39mOptional but Recommended[0m[1;39m)[0m[39m**[0m                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mAdd a static helper method to FileSystemEmitter [0m[1;39m([0m[39msimilar to [0m                        [2m                [0m
[2;36m                    [0m         [1;35mFileSystemFetcher.isDescendant[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m:[0m                                                  [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mstatic boolean [0m[1;35misDescendant[0m[1;39m([0m[39mPath root, Path descendant[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [39m    return [0m[1;35mdescendant.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m            [0m[1;35m.startsWith[0m[1;39m([0m[1;35mroot.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;39m}[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThen use it in the validation:[0m                                                      [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [39mif [0m[1;39m([0m[39m![0m[1;35misDescendant[0m[1;39m([0m[39mbasePath, target[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [39m    throw new [0m[1;35mIllegalArgumentException[0m[1;39m([0m[33m...[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;39m}[0m                                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis improves code maintainability and makes the intent explicit.[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why This Approach is Optimal[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Proven Pattern**: Uses the exact same validation pattern already implemented [0m  [2m                [0m
[2;36m                    [0m         [39mand working in `FileSystemFetcher`, ensuring consistency across the codebase.[0m       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Defense at the Right Layer**: Fixes the vulnerability at the emission layer [0m   [2m                [0m
[2;36m                    [0m         [39mwhere filesystem operations occur, providing a security boundary regardless of [0m     [2m                [0m
[2;36m                    [0m         [39mupstream data sanitization.[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Minimal Impact**: [0m                                                             [2m                [0m
[2;36m                    [0m         [39m   - Does not modify the fuzzing harness or test code[0m                               [2m                [0m
[2;36m                    [0m         [39m   - Does not change the public API or method signatures[0m                            [2m                [0m
[2;36m                    [0m         [39m   - Does not affect the parsing logic or metadata flow[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Only adds validation before filesystem operations[0m                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Preserves Functionality**:[0m                                                     [2m                [0m
[2;36m                    [0m         [39m   - Legitimate paths within basePath continue to work normally[0m                     [2m                [0m
[2;36m                    [0m         [39m   - Directory structure from archives is preserved [0m[1;39m([0m[39mwhen using EMBEDDED_PATH [0m      [2m                [0m
[2;36m                    [0m         [39mstrategy[0m[1;39m)[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m   - All existing tests should pass for valid use cases[0m                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **No External Dependencies**: Uses only standard Java NIO Path APIs already [0m     [2m                [0m
[2;36m                    [0m         [39mimported in the class.[0m                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. **Clear Error Messages**: Throws descriptive exceptions that aid in debugging [0m   [2m                [0m
[2;36m                    [0m         [39mwhile preventing exploitation.[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Addresses the Evaluation Report[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Prevents Path Traversal**: The [0m[1;35mnormalize[0m[1;39m([0m[1;39m)[0m[39m + [0m[1;35mstartsWith[0m[1;39m([0m[1;39m)[0m[39m check ensures that [0m  [2m                [0m
[2;36m                    [0m         [39msequences like `..[0m[35m/[0m[39m`, `.[0m[35m/[0m[39m`, and encoded variations cannot escape basePath.[0m          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Null Byte Protection**: Prevents null byte injection attacks that could bypass[0m [2m                [0m
[2;36m                    [0m         [39mfilesystem security checks on some platforms.[0m                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Early Detection**: Validation occurs before any filesystem operations [0m         [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mdirectory creation or file writing[0m[1;39m)[0m[39m, preventing partial exploitation.[0m              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Security Exception Handling**: The `IllegalArgumentException` thrown will be [0m  [2m                [0m
[2;36m                    [0m         [39mcaught and handled by the existing SecurityException handling in `PipesServer` [0m     [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mlines [0m[1;36m488[0m[39m-[0m[1;36m490[0m[39m, [0m[1;36m628[0m[39m-[0m[1;36m630[0m[39m, [0m[1;36m665[0m[39m-[0m[1;36m667[0m[1;39m)[0m[39m.[0m                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Potential Side Effects and Mitigation[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Legitimate Use Cases Blocked**: Some edge cases with unusual but valid paths [0m  [2m                [0m
[2;36m                    [0m         [39mmight be rejected.[0m                                                                  [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: The validation only blocks paths that would escape basePath, [0m  [2m                [0m
[2;36m                    [0m         [39mwhich should never be legitimate for an emitter with a configured base directory.[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Error Messages in Logs**: Security exceptions will be logged when malicious [0m   [2m                [0m
[2;36m                    [0m         [39marchives are processed.[0m                                                             [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: This is desired behavior - it provides audit trails for [0m       [2m                [0m
[2;36m                    [0m         [39msecurity events.[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Performance Impact**: Minimal - only adds two path normalization operations [0m   [2m                [0m
[2;36m                    [0m         [39mand a string comparison per file emission.[0m                                          [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: Negligible compared to actual file I/O operations.[0m             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Justification for Not Modifying Other Components[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Why not fix in PackageParser?**[0m                                                   [2m                [0m
[2;36m                    [0m         [39m- While adding sanitization there would provide defense-in-depth, it would lose [0m    [2m                [0m
[2;36m                    [0m         [39mdirectory structure information that might be legitimate[0m                            [2m                [0m
[2;36m                    [0m         [39m- The PackageParser is used by many other components that might need the full path [0m [2m                [0m
[2;36m                    [0m         [39mfor metadata purposes[0m                                                               [2m                [0m
[2;36m                    [0m         [39m- The security boundary should be at the point of filesystem operations [0m            [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mFileSystemEmitter[0m[1;39m)[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Why not use [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[1;39m)[0m[39m?**[0m                                            [2m                [0m
[2;36m                    [0m         [39m- Using [0m[1;35mgetName[0m[1;39m([0m[1;39m)[0m[39m would strip ALL directory information, breaking the EMBEDDED_PATH[0m [2m                [0m
[2;36m                    [0m         [39mstrategy functionality[0m                                                              [2m                [0m
[2;36m                    [0m         [39m- The FileSystemEmitter should preserve directory structure for legitimate nested [0m  [2m                [0m
[2;36m                    [0m         [39marchives[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m- Path validation [0m[1;39m([0m[39mensuring paths stay within basePath[0m[1;39m)[0m[39m is more appropriate than [0m   [2m                [0m
[2;36m                    [0m         [39mflattening all paths[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Why not modify the harness code?**[0m                                                [2m                [0m
[2;36m                    [0m         [39m- The harness is not part of the production codebase and only serves to trigger the[0m [2m                [0m
[2;36m                    [0m         [39mvulnerability[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m- The fix must address the root cause in the production code[0m                        [2m                [0m
[2;36m                    [0m         [39m- Modifying test/fuzzing code doesn't fix the actual security vulnerability[0m         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Alignment with Existing Codebase Patterns[0m                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThis fix follows established patterns in the Tika codebase:[0m                         [2m                [0m
[2;36m                    [0m         [39m- `FileSystemFetcher` uses identical validation for input paths[0m                     [2m                [0m
[2;36m                    [0m         [39m- `ExtractEmbeddedFiles` example shows path sanitization best practices[0m             [2m                [0m
[2;36m                    [0m         [39m- `TikaCLI` demonstrates multi-layer defensive approaches[0m                           [2m                [0m
[2;36m                    [0m         [39m- Comments in `FilenameUtils` explicitly warn about this exact vulnerability[0m        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix brings `FileSystemEmitter` up to the same security standard as [0m             [2m                [0m
[2;36m                    [0m         [39m`FileSystemFetcher`, ensuring consistent protection across all filesystem [0m          [2m                [0m
[2;36m                    [0m         [39moperations in the Tika pipes framework.[0m                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=273276;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=873209;file:///home/user/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=695954;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=321198;file:///home/user/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmph_h4__44[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/user/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-delta-04_vuln_5/[0m[95magent[0m [2m               [0m
[2;36m                    [0m         [95m-output-1767881553.6172545[0m                                                           [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-delta-04_vuln_5.toml [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/user/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/08/26 14:12:35][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/user/crete/.cache/environments/[0m[95mtika[0m           ]8;id=160385;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=103344;file:///home/user/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m[01/08/26 14:12:36][0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=923863;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=410512;file:///home/user/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=17288;file:///home/user/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=971290;file:///home/user/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/user/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
