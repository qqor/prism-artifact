{
  "project_name": "freerdp",
  "vulnerability_identifier": "freerdp_fp-delta-02_vuln_002",
  "source_directory": "/home/user/crete/.cache/official-afc-freerdp",
  "llm_usage": {
    "total_cost": 2.091261,
    "prompt_tokens": 593237,
    "completion_tokens": 20770
  },
  "variant": "sound",
  "diff": "--- a/libfreerdp/crypto/x509_utils.c\n+++ b/libfreerdp/crypto/x509_utils.c\n@@ -433,13 +433,13 @@\n BOOL x509_validate_subject_aternative_names(const X509* cert) {\n     STACK_OF(GENERAL_NAME) *san_names = NULL;\n     int i, count;\n+    unsigned char *dns_name_utf8 = NULL;\n     char *dns_name = NULL;\n \tBOOL result = TRUE;\n \n-    // Get Subject Alternative Names (SAN)\n     san_names = X509_get_ext_d2i(cert, NID_subject_alt_name, NULL, NULL);\n     if (!san_names) {\n-        goto end;\n+        return TRUE;\n     }\n \n     count = sk_GENERAL_NAME_num(san_names);\n@@ -448,29 +448,43 @@\n         GENERAL_NAME *gen_name = sk_GENERAL_NAME_value(san_names, i);\n \n         if (gen_name->type == GEN_DNS) {\n-\t\t\t// Allocate string length + 1 for security\n-\t\t\tdns_name = malloc( strlen((char *)ASN1_STRING_get0_data(gen_name->d.dNSName)) + 1);\n-\n-\t\t\tif (dns_name == NULL)\n-\t\t\t\tgoto end;\n-\t\t\t\n-\t\t\tmemcpy(dns_name, (char *)ASN1_STRING_get0_data(gen_name->d.dNSName),  \n-\t\t\t\tASN1_STRING_length(gen_name->d.dNSName)) ;\n-\t\t\t\n+            int length = ASN1_STRING_to_UTF8(&dns_name_utf8, gen_name->d.dNSName);\n+            if (length < 0) {\n+                result = FALSE;\n+                goto end;\n+            }\n+\n+            dns_name = strndup((char*)dns_name_utf8, (size_t)length);\n+            OPENSSL_free(dns_name_utf8);\n+            dns_name_utf8 = NULL;\n+\n+            if (dns_name == NULL) {\n+                result = FALSE;\n+                goto end;\n+            }\n+\n             if (!verify_san(dns_name)) {\n-\t\t\t\tfree(dns_name);\n-\t\t\t\tresult = FALSE;\n-\t\t\t\tgoto end;\n-            } else {\n-\t\t\t\tfree(dns_name);\n+                free(dns_name);\n+                dns_name = NULL;\n+                result = FALSE;\n+                goto end;\n             }\n+\n+            free(dns_name);\n+            dns_name = NULL;\n         }\n     }\n \n end:\n+    if (dns_name_utf8) {\n+        OPENSSL_free(dns_name_utf8);\n+    }\n+    if (dns_name) {\n+        free(dns_name);\n+    }\n     sk_GENERAL_NAME_pop_free(san_names, GENERAL_NAME_free);\n \n-\treturn TRUE;\n+    return result;\n }\n \n char* x509_utils_get_email(const X509* x509)\n",
  "stdout": "",
  "stderr": ""
}