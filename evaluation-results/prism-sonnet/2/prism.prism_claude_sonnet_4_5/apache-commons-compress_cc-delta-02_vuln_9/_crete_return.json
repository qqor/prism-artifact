{
  "project_name": "apache-commons-compress",
  "vulnerability_identifier": "apache-commons-compress_cc-delta-02_vuln_9",
  "source_directory": "/home/user/crete/.cache/official-afc-commons-compress",
  "llm_usage": {
    "total_cost": 2.258595,
    "prompt_tokens": 662310,
    "completion_tokens": 18111
  },
  "variant": "sound",
  "diff": "--- a/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n+++ b/src/main/java/org/apache/commons/compress/compressors/lzw/LZWInputStream.java\n@@ -39,6 +39,8 @@\n public abstract class LZWInputStream extends CompressorInputStream implements InputStreamStatistics {\n     protected static final int DEFAULT_CODE_SIZE = 9;\n     protected static final int UNUSED_PREFIX = -1;\n+    private static final int MAX_ALLOWED_CODE_SIZE = 31;\n+    private static final int DEFAULT_MAX_CODE_SIZE = 20;\n \n     private final byte[] oneByte = new byte[1];\n \n@@ -178,6 +180,9 @@\n     protected void initializeTables(final int maxCodeSize) {\n         // maxCodeSize shifted cannot be less than 256, otherwise the loop in initializeTables() will throw an ArrayIndexOutOfBoundsException\n         // maxCodeSize cannot be smaller than getCodeSize(), otherwise addEntry() will throw an ArrayIndexOutOfBoundsException\n+        if (maxCodeSize > MAX_ALLOWED_CODE_SIZE) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" exceeds maximum allowed value of \" + MAX_ALLOWED_CODE_SIZE);\n+        }\n         if (1 << maxCodeSize < 256 || getCodeSize() > maxCodeSize) {\n             // TODO test against prefixes.length and characters.length?\n             throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" is out of bounds.\");\n@@ -205,6 +210,15 @@\n     protected void initializeTables(final int maxCodeSize, final int memoryLimiKiB) throws MemoryLimitException {\n         if (maxCodeSize <= 0) {\n             throw new IllegalArgumentException(\"maxCodeSize is \" + maxCodeSize + \", must be bigger than 0\");\n+        }\n+        \n+        if (maxCodeSize > MAX_ALLOWED_CODE_SIZE) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" exceeds maximum allowed value of \" + MAX_ALLOWED_CODE_SIZE);\n+        }\n+\n+        if (memoryLimiKiB == -1 && maxCodeSize > DEFAULT_MAX_CODE_SIZE) {\n+            throw new IllegalArgumentException(\"maxCodeSize \" + maxCodeSize + \" exceeds default maximum of \" + DEFAULT_MAX_CODE_SIZE + \n+                    \" when no memory limit is set. Use a constructor with an explicit memory limit to process files with larger code sizes.\");\n         }\n \n         if (memoryLimiKiB > -1) {\n",
  "stdout": "",
  "stderr": ""
}