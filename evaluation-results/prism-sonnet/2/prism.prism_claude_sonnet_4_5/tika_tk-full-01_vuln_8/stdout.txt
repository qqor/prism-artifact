[2;36m[01/08/26 15:56:06][0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=667830;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=570768;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp3ifd09z2[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-full-01_vuln_8/[0m[95magent-[0m [2m               [0m
[2;36m                    [0m         [95moutput-1767887766.1630466[0m                                                            [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-full-01_vuln_8.toml  [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Started[33m...[0m   ]8;id=842954;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=857300;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 15:57:44][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Building Cached for CLEAN environment[1m)[0m Took [1;36m98.41[0m  ]8;id=38412;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=174580;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         seconds; [33mexception[0m=[3;91mFalse[0m                                                      [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m     ]8;id=940198;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=990451;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                    [0m         Started[33m...[0m                                                                     [2m                     [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running tests for Cached for CLEAN environment[1m)[0m    ]8;id=691826;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=668065;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m                                            [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Setting timeouts                                                                       ]8;id=831614;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=689926;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#85\[2m85[0m]8;;\
[2;36m                    [0m           - build: [1;36m600[0m [1m([0moriginal: [1;36m98[0m[1m)[0m                                                          [2m             [0m
[2;36m                    [0m           - run tests: [1;36m600[0m [1m([0moriginal: [1;36m0[0m[1m)[0m                                                       [2m             [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=409163;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=725853;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 15:57:45][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.92[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=905366;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=157374;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 15:57:47][0m[2;36m [0m[34mINFO    [0m Successfully created Cached for CLEAN environment                                    ]8;id=251668;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=770063;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#256\[2m256[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Current environments: [1m[[0m[32m'CLEAN -> Cached'[0m[1m][0m                                            ]8;id=352349;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py\[2moss_fuzz.py[0m]8;;\[2m:[0m]8;id=926036;file:///home/qqor/crete/packages/crete/framework/environment_pool/services/oss_fuzz.py#265\[2m265[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.START -> TeamStatus.EVALUATE                    ]8;id=892188;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=634814;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m0[0m, patch status: PatchStatus.INITIALIZED[1m)[0m                                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=740565;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=229656;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 15:57:48][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.31[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=343763;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=97815;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 15:57:49][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=582908;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=551659;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 15:57:50][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.88[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=423108;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=398690;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 15:58:02][0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=60242;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=872189;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.VULNERABLE                                                              [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Analysis [33mReport[0m===                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/08/26 15:58:23][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=150747;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=260633;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/08/26 16:03:45][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=382338;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=139588;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m[01/08/26 16:04:28][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=44198;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=193102;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m1[0m, patch status: PatchStatus.VULNERABLE[1m)[0m                                   [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=582420;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=784863;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:04:29][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.97[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=603520;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=209124;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=172633;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=596406;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmpdr9tvzc8[0m                                                 ]8;id=578787;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=889530;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m                   [0m[2;36m [0m[33mWARNING [0m [35m/home/qqor/crete/.cache/official-afc-tika/tika-core/src/main/resources/META-INF/ser[0m ]8;id=486126;file:///home/qqor/crete/packages/crete/framework/environment/functions.py\[2mfunctions.py[0m]8;;\[2m:[0m]8;id=536491;file:///home/qqor/crete/packages/crete/framework/environment/functions.py#179\[2m179[0m]8;;\
[2;36m                    [0m         [35mvices/[0m[95morg.apache.tika.detect.Detector[0m is not a valid language file                  [2m                [0m
[2;36m                   [0m[2;36m [0m[1;31mERROR   [0m Failed to apply the patch                                                             ]8;id=958938;file:///home/qqor/crete/packages/crete/framework/evaluator/services/default/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=727781;file:///home/qqor/crete/packages/crete/framework/evaluator/services/default/__init__.py#46\[2m46[0m]8;;\
[2;36m                    [0m         [31mâ•­â”€[0m[31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31mâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[0m[31mâ”€â•®[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/evaluator/services/default/[0m[1m__init__.py[0m: [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m 43 in _evaluate_internal                                                          [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 40 [0m[2mâ”‚   â”‚   [0m                                                                    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 41 [0m[2mâ”‚   â”‚   [0m[94mwith[0m logging_performance(context, header=[33m"[0m[33mPatching[0m[33m"[0m):               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 42 [0m[2mâ”‚   â”‚   â”‚   [0m[94mtry[0m:                                                            [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m 43 [2mâ”‚   â”‚   â”‚   â”‚   [0menvironment.patch(context, diff)                            [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 44 [0m[2mâ”‚   â”‚   â”‚   [0m                                                                [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 45 [0m[2mâ”‚   â”‚   â”‚   [0m[94mexcept[0m ChallengeWrongPatchError [94mas[0m e:                           [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 46 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m[1;4mcontext[[0m[1;4;33m"[0m[1;4;33mlogger[0m[1;4;33m"[0m[1;4m].exception([0m[1;4;33m"[0m[1;4;33mFailed to apply the patch[0m[1;4;33m"[0m[1;4m)[0m    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/[0m[1mcached.py[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m :39 in patch                                                                      [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 36 [0m[2mâ”‚   â”‚   [0mpatch: Path | [96mbytes[0m,                                                [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 37 [0m[2mâ”‚   â”‚   [0menv: [96mdict[0m[[96mstr[0m, [96mstr[0m] = {},                                           [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 38 [0m[2mâ”‚   [0m) -> [96mtuple[0m[[96mstr[0m, [96mstr[0m]:                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m 39 [2mâ”‚   â”‚   [0m[94mreturn[0m [1;4;96mself[0m[1;4m.environment.patch(context, patch, [0m[1;4;96mself[0m[1;4m._add_cache_to_en[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 40 [0m[2mâ”‚   [0m                                                                        [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 41 [0m[2mâ”‚   [0m[94mdef[0m[90m [0m[92mcheck_build[0m([96mself[0m, context: EnvironmentContext) -> [96mtuple[0m[[96mstr[0m, [96mstr[0m]:  [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m 42 [0m[2mâ”‚   â”‚   [0m[94mreturn[0m [96mself[0m.environment.check_build(context)                        [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/[0m[1mdefault.p[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [1my[0m:163 in patch                                                                    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m160 [0m[2mâ”‚   â”‚   â”‚   â”‚   â”‚   [0mf.write(patch)                                          [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m161 [0m[2mâ”‚   â”‚   â”‚   â”‚   â”‚   [0mf.flush()                                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m162 [0m[2mâ”‚   â”‚   â”‚   â”‚   â”‚   [0m                                                        [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m163 [2mâ”‚   â”‚   â”‚   â”‚   â”‚   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._patch_internal(context, Path(f.name), env)[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m164 [0m[2mâ”‚   [0m                                                                        [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m165 [0m[2mâ”‚   [0m[94mdef[0m[90m [0m[92m_patch_internal[0m(                                                    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m166 [0m[2mâ”‚   â”‚   [0m[96mself[0m,                                                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/[0m[1mdefault.p[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [1my[0m:182 in _patch_internal                                                          [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m179 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m).language,                                                 [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m180 [0m[2mâ”‚   â”‚   â”‚   [0m)                                                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m181 [0m[2mâ”‚   â”‚   [0m[94mexcept[0m ChallengeWrongPatchError [94mas[0m e:                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m182 [2mâ”‚   â”‚   â”‚   [0m[1;4;94mraise[0m[1;4m e[0m                                                         [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m183 [0m[2mâ”‚   â”‚   [0m[94mexcept[0m [96mException[0m:                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m184 [0m[2mâ”‚   â”‚   â”‚   [0m_logger.warning(                                                [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m185 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m[33mf[0m[33m"[0m[33mUnknown error while checking valid diff. Ignoring: [0m[33m{[0mpatch [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/[0m[1mdefault.p[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [1my[0m:174 in _patch_internal                                                          [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m171 [0m[2mâ”‚   â”‚   [0m[2m# NOTE: This assumes that the environment is already restored[0m       [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m172 [0m[2mâ”‚   â”‚   [0m[94mtry[0m:                                                                [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m173 [0m[2mâ”‚   â”‚   â”‚   [0m_logger.info([33mf[0m[33m"[0m[33mChecking valid diff: [0m[33m{[0mpatch_file[33m}[0m[33m"[0m)              [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m174 [2mâ”‚   â”‚   â”‚   [0mcheck_valid_diff(                                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m175 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0mpatch_file.read_text(),                                     [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m176 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m[96mself[0m.pool.source_directory,                                 [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m177 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0mAIxCCChallengeProjectYaml.from_project_name(                [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [2m/home/qqor/crete/packages/crete/framework/environment/[0m[1mfunctions.py[0m:180 in         [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m check_valid_diff                                                                  [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m                                                                                   [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m177 [0m[2mâ”‚   â”‚   [0m                                                                    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m178 [0m[2mâ”‚   â”‚   [0m[94mif[0m [95mnot[0m is_valid_language:                                           [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m179 [0m[2mâ”‚   â”‚   â”‚   [0m_logger.warning([33mf[0m[33m"[0m[33m{[0mfile_path[33m}[0m[33m is not a valid language file[0m[33m"[0m)    [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m [31mâ± [0m180 [2mâ”‚   â”‚   â”‚   [0m[1;4;94mraise[0m[1;4m ChallengeWrongPatchError([0m                                 [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m181 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m[1;4mstdout=[0m[1;4;33mb[0m[1;4;33m"[0m[1;4;33m"[0m[1;4m,[0m                                                 [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m182 [0m[2mâ”‚   â”‚   â”‚   â”‚   [0m[1;4mstderr=[0m[1;4;33mf[0m[1;4;33m"[0m[1;4;33mPermission denied: [0m[1;4;33m'[0m[1;4;33m{[0m[1;4mfile_path[0m[1;4;33m}[0m[1;4;33m'[0m[1;4;33m cannot be modifie[0m [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m       [1;4;33mis not a valid language file[0m[1;4;33m"[0m[1;4m.encode(),[0m                                     [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ”‚[0m   [2m183 [0m[2mâ”‚   â”‚   â”‚   [0m[1;4m)[0m                                                               [31mâ”‚[0m [2m              [0m
[2;36m                    [0m         [31mâ•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯[0m [2m              [0m
[2;36m                    [0m         [1;91mChallengeWrongPatchError: [0mWrong patch:                                                [2m              [0m
[2;36m                    [0m         - Stdout:                                                                             [2m              [0m
[2;36m                    [0m                                                                                               [2m              [0m
[2;36m                    [0m         - Stderr:                                                                             [2m              [0m
[2;36m                    [0m         Permission denied:                                                                    [2m              [0m
[2;36m                    [0m         [32m'/home/qqor/crete/.cache/official-afc-tika/tika-core/src/main/resources/META-INF/serv[0m [2m              [0m
[2;36m                    [0m         [32mices/org.apache.tika.detect.Detector'[0m cannot be modified because it is not a valid    [2m              [0m
[2;36m                    [0m         language file                                                                         [2m              [0m
[2;36m                    [0m                                                                                               [2m              [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m0.16[0m seconds; [33mexception[0m=[3;91mFalse[0m       ]8;id=423231;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=341398;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=365967;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=122551;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:04:30][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.94[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=296601;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=404126;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 16:04:31][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=954482;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=61752;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:04:32][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.90[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=202390;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=918145;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=79050;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=541862;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.WRONG                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         +++ b/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         @@ [1;36m-80[0m,[1;36m34[0m +[1;36m80[0m,[1;36m10[0m @@                                                                 [2m                [0m
[2;36m                    [0m                  if [1m([0m! isShell[1m)[0m [1m{[0m                                                           [2m                [0m
[2;36m                    [0m                      return MediaType.OCTET_STREAM;                                         [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        String fileName = [1;35mmetadata.get[0m[1m([0mTikaCoreProperties.RESOURCE_NAME_KEY[1m)[0m;      [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mStringUtils.isBlank[0m[1m([0mfileName[1m)[0m[1m)[0m [1m{[0m                                       [2m                [0m
[2;36m                    [0m         -            return [1;35misShell[0m[1m([0misShell[1m)[0m;                                               [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        [35m/[0m[35m/[0m[95mnow[0m test for no-arg shell script                                         [2m                [0m
[2;36m                    [0m         -        TikaInputStream tis =                                                      [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1m([0m[1;35mCloseShieldInputStream.wrap[0m[1m([0minput[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mFilenameUtils.getName[0m[1m([0mfileName[1m)[0m;                                [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m, [32m""[0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"\\.\\."[0m, [32m""[0m[1m)[0m;                              [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m > MAX_LENGTH[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -            fileName = [1;35mfileName.substring[0m[1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m - MAX_LENGTH[1m)[0m;         [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        Path cwd = [1;35mPaths.get[0m[1m([0m[32m"."[0m[1m)[0m[1;35m.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        Path tmpDir = [1;35mFiles.createTempDirectory[0m[1m([0mcwd, [32m"tika-shell-detect-"[0m[1m)[0m;        [2m                [0m
[2;36m                    [0m         -        Path tmpFile = [1;35mtmpDir.resolve[0m[1m([0mfileName[1m)[0m;                                   [2m                [0m
[2;36m                    [0m         -        [1;35mFiles.copy[0m[1m([0m[1;35mtis.getPath[0m[1m([0m[1m)[0m, tmpFile, StandardCopyOption.REPLACE_EXISTING[1m)[0m;   [2m                [0m
[2;36m                    [0m         -        ProcessBuilder pb = new [1;35mProcessBuilder[0m[1m([0mfileName[1m)[0m;                          [2m                [0m
[2;36m                    [0m         -        [1;35mpb.directory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                                             [2m                [0m
[2;36m                    [0m         -        try [1m{[0m                                                                      [2m                [0m
[2;36m                    [0m         -            FileProcessResult result = [1;35mProcessUtils.execute[0m[1m([0mpb, [1;36m20000[0m, [1;36m100000[0m,     [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1m)[0m;                                                                            [2m                [0m
[2;36m                    [0m         -            if [1m([0m[1;35mresult.getExitValue[0m[1m([0m[1m)[0m == [1;36m0[0m[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -                [1;35mmetadata.set[0m[1m([0mSHELL_NO_ARGS, true[1m)[0m;                                 [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -        [1m}[0m finally [1m{[0m                                                                [2m                [0m
[2;36m                    [0m         -            [1;35mFileUtils.deleteDirectory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        return SHELL_SCRIPT;                                                       [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m Security fix: removed execution of shell scripts during detection       [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m to prevent OS command injection vulnerability.                          [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m Shell scripts are still detected by filename and shebang analysis.      [2m                [0m
[2;36m                    [0m         +        return [1;35misShell[0m[1m([0misShell[1m)[0m;                                                   [2m                [0m
[2;36m                    [0m              [1m}[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m              private MediaType [1;35misShell[0m[1m([0mboolean isShell[1m)[0m [1m{[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ---                                                                                 [2m                [0m
[2;36m                    [0m         a/tika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector    [2m                [0m
[2;36m                    [0m         +++                                                                                 [2m                [0m
[2;36m                    [0m         b/tika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector    [2m                [0m
[2;36m                    [0m         @@ [1;36m-13[0m,[1;36m4[0m +[1;36m13[0m,[1;36m5[0m @@                                                                   [2m                [0m
[2;36m                    [0m          #  See the License for the specific language governing permissions and             [2m                [0m
[2;36m                    [0m          #  limitations under the License.                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -org.apache.tika.detect.ShellCodeDetector                                           [2m                [0m
[2;36m                    [0m         +# org.apache.tika.detect.ShellCodeDetector - Disabled due to security              [2m                [0m
[2;36m                    [0m         vulnerability [1m([0mOS Command Injection[1m)[0m                                                [2m                [0m
[2;36m                    [0m         +# The detector can still be manually configured if needed, but is no longer loaded [2m                [0m
[2;36m                    [0m         by default                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m         Permission denied:                                                                  [2m                [0m
[2;36m                    [0m         [32m'/home/qqor/crete/.cache/official-afc-tika/tika-core/src/main/resources/META-INF/se[0m [2m                [0m
[2;36m                    [0m         [32mrvices/org.apache.tika.detect.Detector'[0m cannot be modified because it is not a      [2m                [0m
[2;36m                    [0m         valid language file                                                                 [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         A critical security vulnerability [1m([0mOS Command Injection[1m)[0m has been detected in       [2m                [0m
[2;36m                    [0m         Apache Tika's code execution path. The vulnerability is triggered when processing   [2m                [0m
[2;36m                    [0m         embedded documents within package files, specifically through the ShellCodeDetector [2m                [0m
[2;36m                    [0m         component, which attempts to execute OS commands with potentially                   [2m                [0m
[2;36m                    [0m         attacker-controlled data. This vulnerability is classified as a                     [2m                [0m
[2;36m                    [0m         FuzzerSecurityIssueCritical issue and could lead to remote code execution.          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The issue manifests as an OS Command Injection vulnerability detected during        [2m                [0m
[2;36m                    [0m         fuzzing operations. The security exception indicates that the application is        [2m                [0m
[2;36m                    [0m         executing OS commands with attacker-controlled data, which presents a critical      [2m                [0m
[2;36m                    [0m         security risk that could enable remote code execution attacks.                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Vulnerability Type                                                              [2m                [0m
[2;36m                    [0m         The vulnerability is identified as **OS Command Injection** - a critical security   [2m                [0m
[2;36m                    [0m         flaw where an attacker can inject malicious commands into system-level operations.  [2m                [0m
[2;36m                    [0m         This type of vulnerability occurs when user-controlled or untrusted data is passed  [2m                [0m
[2;36m                    [0m         directly to system command execution functions without proper sanitization or       [2m                [0m
[2;36m                    [0m         validation.                                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Execution Path Analysis                                                         [2m                [0m
[2;36m                    [0m         The stack trace reveals the following execution flow:                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. The entry point is through Apache Tika's CLI component [1m([0m`TikaCLI.main`[1m)[0m          [2m                [0m
[2;36m                    [0m         [1;36m2[0m. The process flow continues through document parsing [1m([0m`AutoDetectParser.parse` â†’  [2m                [0m
[2;36m                    [0m         `CompositeParser.parse` â†’ `PackageParser.parse`[1m)[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m. During package parsing, entries are processed [1m([0m`PackageParser._parse` â†’          [2m                [0m
[2;36m                    [0m         `parseEntries` â†’ `parseEntry`[1m)[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m4[0m. Embedded documents are extracted and parsed                                      [2m                [0m
[2;36m                    [0m         [1m([0m`FileEmbeddedDocumentExtractor.parseEmbedded`[1m)[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m5[0m. Content type detection is performed using composite detectors                    [2m                [0m
[2;36m                    [0m         [1m([0m`CompositeDetector.detect`[1m)[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m6[0m. The vulnerability is triggered in `ShellCodeDetector.detect` at line [1;36m103[0m         [2m                [0m
[2;36m                    [0m         [1;36m7[0m. This component invokes `ProcessUtils.execute` at line [1;36m94[0m                         [2m                [0m
[2;36m                    [0m         [1;36m8[0m. The actual OS command execution occurs through `ProcessBuilder.start`            [2m                [0m
[2;36m                    [0m         [1;36m9[0m. The Jazzer sanitizer hook [1m([0m`OsCommandInjection.processImplStartHook`[1m)[0m detects    [2m                [0m
[2;36m                    [0m         the security issue at line [1;36m63[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Key Observations                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **Vulnerable Component**: The `ShellCodeDetector` class appears to be the        [2m                [0m
[2;36m                    [0m         immediate source of the vulnerable code execution, specifically at line [1;36m103[0m where   [2m                [0m
[2;36m                    [0m         it triggers OS command execution.                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **Command Execution Mechanism**: The `ProcessUtils.execute` method [1m([0mline [1;36m94[0m[1m)[0m     [2m                [0m
[2;36m                    [0m         serves as the utility function that wraps the actual `ProcessBuilder.start` call,   [2m                [0m
[2;36m                    [0m         suggesting this is a deliberate command execution feature rather than an accidental [2m                [0m
[2;36m                    [0m         injection point.                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Context of Execution**: The vulnerability occurs during content type detection [2m                [0m
[2;36m                    [0m         of embedded documents within package files, indicating that maliciously crafted     [2m                [0m
[2;36m                    [0m         archive files could potentially exploit this vulnerability.                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Detection Method**: The issue was identified by Jazzer's security sanitizers   [2m                [0m
[2;36m                    [0m         during fuzzing, specifically by the OS Command Injection hook, which monitors for   [2m                [0m
[2;36m                    [0m         potentially dangerous command executions.                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Areas Requiring Investigation                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         To gain a comprehensive understanding of this vulnerability, the following          [2m                [0m
[2;36m                    [0m         components should be thoroughly examined:                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **ShellCodeDetector.java**: Examine the implementation at line [1;36m103[0m to understand [2m                [0m
[2;36m                    [0m         what commands are being executed and how input data influences command              [2m                [0m
[2;36m                    [0m         construction.                                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **ProcessUtils.java**: Review the `execute` method at line [1;36m94[0m to understand the  [2m                [0m
[2;36m                    [0m         command execution wrapper and what validation or sanitization [1m([0mif any[1m)[0m is performed [2m                [0m
[2;36m                    [0m         before execution.                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **PackageParser.java**: Investigate how embedded documents are extracted and     [2m                [0m
[2;36m                    [0m         processed, particularly focusing on how file names, paths, or content from          [2m                [0m
[2;36m                    [0m         untrusted archive files might flow into the detection process.                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **CompositeDetector.java**: Understand the detector chain and whether there are  [2m                [0m
[2;36m                    [0m         configuration options to disable or restrict potentially dangerous detectors like   [2m                [0m
[2;36m                    [0m         ShellCodeDetector.                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **TikaCLI.java**: Review the CLI configuration options and how user inputs or    [2m                [0m
[2;36m                    [0m         file contents can influence the parsing and detection pipeline.                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m. **Input Vector Analysis**: Examine how fuzzer-generated inputs [1m([0mspecifically     [2m                [0m
[2;36m                    [0m         crafted package files[1m)[0m can control or influence the command execution path to       [2m                [0m
[2;36m                    [0m         understand the full scope of potential exploitation scenarios.                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS[0m [2m                [0m
[2;36m                    [0m         [39mCommand Injection[0m                                                                   [2m                [0m
[2;36m                    [0m         [39mExecuting OS commands with attacker-controlled data can lead to remote code [0m        [2m                [0m
[2;36m                    [0m         [39mexecution.[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1;39m([0m[39mOsC[0m [2m                [0m
[2;36m                    [0m         [39mommandInjection.jav[0m[1;92ma:63[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1110[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1073[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1;39m([0m[39mProcessUtils.jav[0m[1;92ma:94[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1;39m([0m[39mShellCodeDetector.jav[0m[1;92ma:103[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1;39m([0m[39mCompositeDetector.jav[0m[1;92ma:84[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.tika.cli.TikaCLI$[0m[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1;39m([0m[39mTikaCLI.jav[0m [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.tika.cli.TikaCLI$[0m[1;35mOutputType.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:1056[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:485[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:237[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:54[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: d7514645016ef7a8[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:1[0m[39m-[0m[1;36m41[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.detect;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.EOFException;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.commons.io.FileUtils;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:46[0m[39m-[0m[1;36m119[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/utils/ProcessUtils.jav[0m[1;92ma:1[0m[39m-[0m[1;36m27[0m                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.utils;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.concurrent.ConcurrentHashMap;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.concurrent.TimeUnit;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:public class ProcessUtils [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/utils/ProcessUtils.jav[0m[1;92ma:87[0m[39m-[0m[1;36m153[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    public static FileProcessResult [0m[1;35mexecute[0m[1;39m([0m[39mProcessBuilder pb,[0m                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                            long timeoutMillis,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                                            int maxStdoutBuffer, int [0m            [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:            throws IOException [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        Process p = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        String id = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            p = [0m[1;35mpb.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:            id = [0m[1;35mregister[0m[1;39m([0m[39mp[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            long elapsed = [0m[1;36m-1[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            long start = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:            StreamGobbler outGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getInputStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdoutBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            StreamGobbler errGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getErrorStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            Thread outThread = new [0m[1;35mThread[0m[1;39m([0m[39moutGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:            [0m[1;35moutThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Thread errThread = new [0m[1;35mThread[0m[1;39m([0m[39merrGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35merrThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            int exitValue = [0m[1;36m-1[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            boolean complete = false;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                complete = [0m[1;35mp.waitFor[0m[1;39m([0m[39mtimeoutMillis, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:                elapsed = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m - start;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:                if [0m[1;39m([0m[39mcomplete[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:                    exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:                    [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:                    boolean completed = [0m[1;35mp.waitFor[0m[1;39m([0m[1;36m500[0m[39m, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                    if [0m[1;39m([0m[39mcompleted[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:                        try [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                            exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalThreadStateException e[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:                            [0m[35m/[0m[35m/[0m[95mnot[0m[39m finished![0m                                     [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mInterruptedException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:                exitValue = [0m[1;36m-1000[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:            [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:                [0m[1;35moutThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:                [0m[1;35merrThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:            FileProcessResult result = new [0m[1;35mFileProcessResult[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:            result.processTimeMillis = elapsed;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            result.stderrLength = [0m[1;35merrGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            result.stdoutLength = [0m[1;35moutGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            result.isTimeout = ! complete;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            result.exitValue = exitValue;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            result.stdout = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35moutGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            result.stderr = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35merrGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:            result.stdoutTruncated = [0m[1;35moutGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            result.stderrTruncated = [0m[1;35merrGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:            return result;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mp != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            if [0m[1;39m([0m[39mid != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[1;35mrelease[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/CompositeDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m31[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.util.Collection;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.mime.MediaTypeRegistry;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/CompositeDetector.jav[0m[1;92ma:36[0m[39m-[0m[1;36m135[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:public class CompositeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    private static final long serialVersionUID = 5980683158436430252L;[0m           [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    private final MediaTypeRegistry registry;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private final List<Detector> detectors;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:                             Collection<Class<? extends Detector>> [0m              [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:        if [0m[1;39m([0m[39mexcludeDetectors == null || [0m[1;35mexcludeDetectors.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:            this.detectors = detectors;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            this.detectors = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            for [0m[1;39m([0m[39mDetector d : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35misExcluded[0m[1;39m([0m[39mexcludeDetectors, [0m[1;35md.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:                    [0m[1;35mthis.detectors.add[0m[1;39m([0m[39md[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        this.registry = registry;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mregistry, detectors, null[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mList<Detector> detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mnew [0m[1;35mMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, detectors[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mDetector[0m[33m...[0m[39m detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mArrays.asList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        MediaType override = [0m[1;35mdetectOverrides[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        if [0m[1;39m([0m[39moverride != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:            return override;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        MediaType type = MediaType.OCTET_STREAM;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m have to iterate through all detectors because the override detector[0m [2m                [0m
[2;36m                    [0m         [39mmay[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[35m/[0m[35m/[0m[95mbe[0m[39m within a CompositeDetector[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        for [0m[1;39m([0m[39mDetector detector : [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            MediaType detected = [0m[1;35mdetector.detect[0m[1;39m([0m[39minput, metadata[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            if [0m[1;39m([0m[1;35mregistry.isSpecializationOf[0m[1;39m([0m[39mdetected, type[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                type = detected;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        return type;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param metadata[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return mediaType if a parseable mediatype was sent in via user or parser[0m [2m                [0m
[2;36m                    [0m         [39moverrides[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    private static MediaType [0m[1;35mdetectOverrides[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        String override = [0m                                                       [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_USER_OVERRIDE[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        override = [0m                                                             [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_PARSER_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:        return null;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * Returns the component detectors.[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:    public List<Detector> [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:        return [0m[1;35mCollections.unmodifiableList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:    private boolean [0m[1;35misExcluded[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m           [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                               Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:        return [0m[1;35mexcludeDetectors.contains[0m[1;39m([0m[39md[0m[1;39m)[0m[39m || [0m[1;35massignableFrom[0m[1;39m([0m[39mexcludeDetectors,[0m [2m                [0m
[2;36m                    [0m         [39md[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:    private boolean [0m[1;35massignableFrom[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m       [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                                   Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:        for [0m[1;39m([0m[39mClass<? extends Detector> e : excludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            if [0m[1;39m([0m[1;35me.isAssignableFrom[0m[1;39m([0m[39md[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:                return true;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        return false;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/DefaultDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m26[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.util.Collection;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import javax.imageio.spi.ServiceRegistry;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.apache.tika.config.ServiceLoader;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import org.apache.tika.mime.MimeTypes;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.tika.utils.ServiceLoaderUtils;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/DefaultDetector.jav[0m[1;92ma:40[0m[39m-[0m[1;36m127[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:public class DefaultDetector extends CompositeDetector [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private static final long serialVersionUID = -8170114575326908027L;[0m          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    private transient final ServiceLoader loader;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader,[0m                [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:                           Collection<Class<? extends Detector>> [0m                [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        [0m[1;35msuper[0m[1;39m([0m[1;35mtypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mtypes, loader, [0m  [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        this.loader = loader;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, loader, Collections.EMPTY_SET[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[39mloader[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[39m, loader[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * Finds all statically loadable detectors and sort the list by name,[0m        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     * rather than discovery order. Detectors are used in the given order,[0m       [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     * so put the Tika parsers last so that non-Tika [0m[1;39m([0m[39muser supplied[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * parsers can take precedence.[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * If an [0m[1;39m{[0m[39m@link OverrideDetector[0m[1;39m}[0m[39m is loaded, it takes precedence over[0m        [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * all other detectors.[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * @param loader service loader[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * @return ordered list of statically loadable detectors[0m                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    private static List<Detector> [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mMimeTypes types, [0m          [2m                [0m
[2;36m                    [0m         [39mServiceLoader loader,[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                                                      Collection<Class<? extends[0m [2m                [0m
[2;36m                    [0m         [39mDetector>>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                                              excludeDetectors[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        List<Detector> detectors =[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                [0m[1;35mloader.loadStaticServiceProviders[0m[1;39m([0m[39mDetector.class, [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;35mServiceLoaderUtils.sortLoadedClasses[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        [0m[35m/[0m[35m/[0m[95mlook[0m[39m for the override index and put that first[0m                         [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        int overrideIndex = [0m[1;36m-1[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        int i = [0m[1;36m0[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        for [0m[1;39m([0m[39mDetector detector : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            if [0m[1;39m([0m[39mdetector instanceof OverrideDetector[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                overrideIndex = i;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:                break;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            i++;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        if [0m[1;39m([0m[39moverrideIndex > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Detector detector = [0m[1;35mdetectors.remove[0m[1;39m([0m[39moverrideIndex[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35mdetectors.add[0m[1;39m([0m[1;36m0[0m[39m, detector[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[35m/[0m[35m/[0m[39m Finally the Tika MimeTypes as a fallback[0m                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        [0m[1;35mdetectors.add[0m[1;39m([0m[39mtypes[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        return detectors;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    public List<Detector> [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39mloader != null && [0m[1;35mloader.isDynamic[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            List<Detector> detectors = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mloader.loadDynamicServiceProviders[0m[1;39m([0m[39mDetector.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:            if [0m[1;39m([0m[1;35mdetectors.size[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                [0m[1;35mdetectors.addAll[0m[1;39m([0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                return detectors;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                return [0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:            return [0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector:[0m[1;36m1[0m[39m-[0m[1;36m16[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:#  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:#  contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:#  this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:#  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:#  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:#  the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:#       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:#  Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:#  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:#  See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:#  limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:org.apache.tika.detect.ShellCodeDetector[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:19[0m[39m-[0m[1;36m109[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.File;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.FileInputStream;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.FileOutputStream;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.io.OutputStream;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.io.OutputStreamWriter;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.io.PrintStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.io.PrintWriter;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.io.Serializable;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.io.UnsupportedEncodingException;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.io.Writer;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.lang.reflect.Field;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.net.URI;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import java.util.Comparator;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import java.util.Map.Entry;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import java.util.TreeSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import javax.xml.transform.OutputKeys;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import javax.xml.transform.TransformerConfigurationException;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import javax.xml.transform.sax.SAXTransformerFactory;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import javax.xml.transform.sax.TransformerHandler;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import javax.xml.transform.stream.StreamResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:import org.apache.logging.log4j.Level;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:import org.xml.sax.helpers.DefaultHandler;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:import org.apache.tika.Tika;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:import org.apache.tika.async.cli.TikaAsyncCLI;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:import org.apache.tika.config.TikaConfig;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:import org.apache.tika.config.TikaConfigSerializer;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:import org.apache.tika.detect.CompositeDetector;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:import org.apache.tika.detect.Detector;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:import org.apache.tika.extractor.DefaultEmbeddedStreamTranslator;[0m                [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentExtractor;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:import org.apache.tika.extractor.EmbeddedStreamTranslator;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:import org.apache.tika.fork.ForkParser;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:import org.apache.tika.gui.TikaGUI;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:import org.apache.tika.language.detect.LanguageHandler;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:import org.apache.tika.mime.MediaTypeRegistry;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:import org.apache.tika.mime.MimeType;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:import org.apache.tika.mime.MimeTypeException;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:import org.apache.tika.mime.MimeTypes;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:import org.apache.tika.parser.AutoDetectParser;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:import org.apache.tika.parser.CompositeParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:import org.apache.tika.parser.DigestingParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:import org.apache.tika.parser.NetworkParser;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:import org.apache.tika.parser.Parser;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:import org.apache.tika.parser.ParserDecorator;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:import org.apache.tika.parser.PasswordProvider;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:import org.apache.tika.parser.RecursiveParserWrapper;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:import org.apache.tika.parser.digestutils.CommonsDigester;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:import org.apache.tika.parser.pdf.PDFParserConfig;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:import org.apache.tika.sax.BasicContentHandlerFactory;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:import org.apache.tika.sax.BodyContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:import org.apache.tika.sax.ContentHandlerFactory;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:import org.apache.tika.sax.ExpandedTitleContentHandler;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:import org.apache.tika.sax.RecursiveParserWrapperHandler;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:import org.apache.tika.sax.WriteOutContentHandler;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:import org.apache.tika.sax.boilerpipe.BoilerpipeContentHandler;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:import org.apache.tika.serialization.JsonMetadata;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:import org.apache.tika.serialization.JsonMetadataList;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:import org.apache.tika.xmp.XMPMetadata;[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1079[0m[39m-[0m[1;36m1182[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1079[0m[39m:    private class FileEmbeddedDocumentExtractor implements [0m                    [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentExtractor [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:            File outputFile = null;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:            File parent = [0m[1;35moutputFile.getParentFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mparent.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mparent.mkdirs[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"unable to create directory \""[0m[39m + [0m   [2m                [0m
[2;36m                    [0m         [39mparent + [0m[32m"\""[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:            [0m[1;35mSystem.out.println[0m[1;39m([0m[32m"Extracting '"[0m[39m + name + [0m[32m"' [0m[32m([0m[32m"[0m[39m + contentType + [0m  [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m to "[0m[39m + outputFile[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:            try [0m[1;39m([0m[39mFileOutputStream os = new [0m[1;35mFileOutputStream[0m[1;39m([0m[39moutputFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m     [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:                if [0m[1;39m([0m[1;35membeddedStreamTranslator.shouldTranslate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                    try [0m[1;39m([0m[39mInputStream translated = [0m                             [2m                [0m
[2;36m                    [0m         [1;35membeddedStreamTranslator.translate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                        [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtranslated, os[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:                    [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtis, os[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                [0m[35m/[0m[35m/[0m[39m being a CLI program messages should go to the stderr too[0m    [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                String msg = [0m[1;35mString.format[0m[1;39m([0m[39mLocale.ROOT, [0m[32m"Ignoring unexpected [0m  [2m                [0m
[2;36m                    [0m         [32mexception trying to save embedded file %s [0m[32m([0m[32m%s[0m[32m)[0m[32m"[0m[39m, name, [0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[39mmsg, e[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:        private String [0m[1;35mgetExtension[0m[1;39m([0m[39mMediaType contentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:                String ext = config[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:                        [0m[1;35m.getMimeRepository[0m[1;39m([0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:                        [0m[1;35m.forName[0m[1;39m([0m[1;35mcontentType.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1170[0m[39m:                        [0m[1;35m.getExtension[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1171[0m[39m:                if [0m[1;39m([0m[39mext == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1172[0m[39m:                    return [0m[32m".bin"[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1173[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1174[0m[39m:                    return ext;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1175[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1176[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mMimeTypeException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m1177[0m[39m:                [0m[1;35me.printStackTrace[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1178[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1179[0m[39m:            return [0m[32m".bin"[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m1180[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1181[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1182[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/FileCommandDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m40[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.file.StandardCopyOption.REPLACE_EXISTING;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.io.BoundedInputStream;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.io.TemporaryResources;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.tika.metadata.ExternalProcess;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.parser.external.ExternalParser;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/FileCommandDetector.jav[0m[1;92ma:57[0m[39m-[0m[1;36m183[0m      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:public class FileCommandDetector implements Detector [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:    [0m[35m/[0m[35m/[0m[95mTODO[0m[39m: file has some diff mimes names for some very common mimes[0m            [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[35m/[0m[35m/[0m[95mshould[0m[39m we map file mimes to Tika mimes, e.g. text/xml -> application/xml??[0m [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public static Property FILE_MIME = [0m[1;35mProperty.externalText[0m[1;39m([0m[32m"file:mime"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    private static final Logger LOGGER = [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mLoggerFactory.getLogger[0m[1;39m([0m[39mFileCommandDetector.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    private static final long DEFAULT_TIMEOUT_MS = [0m[1;36m6000[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:    private static final String DEFAULT_FILE_COMMAND_PATH = [0m[32m"file"[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    private static boolean HAS_WARNED = false;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    private Boolean hasFileCommand = null;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    private String fileCommandPath = DEFAULT_FILE_COMMAND_PATH;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    private int maxBytes = 1_000_000;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    private long timeoutMs = DEFAULT_TIMEOUT_MS;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    private boolean useMime = false;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public static boolean [0m[1;35mcheckHasFile[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        return [0m[1;35mcheckHasFile[0m[1;39m([0m[39mDEFAULT_FILE_COMMAND_PATH[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static boolean [0m[1;35mcheckHasFile[0m[1;39m([0m[39mString fileCommandPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m commandline = new String[0m[1;39m[[0m[1;39m][0m[1;39m{[0m[39mfileCommandPath, [0m[32m"-v"[0m[1;39m}[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        return [0m[1;35mExternalParser.check[0m[1;39m([0m[39mcommandline[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * @param input    document input stream, or <code>null<[0m[35m/[0m[95mcode[0m[39m>[0m               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * @param metadata input metadata for the document[0m                           [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * @return mime as identified by the file command or [0m                        [2m                [0m
[2;36m                    [0m         [39mapplication/octet-stream otherwise[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * @throws IOException[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        if [0m[1;39m([0m[39mhasFileCommand == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:            hasFileCommand = [0m[1;35mcheckHasFile[0m[1;39m([0m[39mthis.fileCommandPath[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        if [0m[1;39m([0m[39m!hasFileCommand[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            if [0m[1;39m([0m[39m!HAS_WARNED[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:                [0m[1;35mLOGGER.warn[0m[1;39m([0m[32m"'file' command isn't working: '"[0m[39m + fileCommandPath [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m"'"[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                HAS_WARNED = true;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        TikaInputStream tis = [0m[1;35mTikaInputStream.cast[0m[1;39m([0m[39minput[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        if [0m[1;39m([0m[39mtis != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            [0m[35m/[0m[35m/[0m[95mspool[0m[39m the full file to disk, if called with a TikaInputStream[0m     [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[35m/[0m[35m/[0m[95mand[0m[39m there is no underlying file[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            return [0m[1;35mdetectOnPath[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, metadata[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;35minput.mark[0m[1;39m([0m[39mmaxBytes[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        try [0m[1;39m([0m[39mTemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            Path tmpFile = [0m[1;35mtmp.createTempFile[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39mnew [0m[1;35mBoundedInputStream[0m[1;39m([0m[39mmaxBytes, input[0m[1;39m)[0m[39m, tmpFile, [0m       [2m                [0m
[2;36m                    [0m         [39mREPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:            return [0m[1;35mdetectOnPath[0m[1;39m([0m[39mtmpFile, metadata[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    private MediaType [0m[1;35mdetectOnPath[0m[1;39m([0m[39mPath path, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m args =[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                new String[0m[1;39m[[0m[1;39m][0m[1;39m{[0m[1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[39mfileCommandPath[0m[1;39m)[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [32m"-b"[0m[39m, [0m[32m"--mime-type"[0m[39m,[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mpath.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m}[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        ProcessBuilder builder = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39margs[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:        FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mbuilder, timeoutMs, [0m    [2m                [0m
[2;36m                    [0m         [1;36m10000[0m[39m, [0m[1;36m10000[0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:        if [0m[1;39m([0m[1;35mresult.isTimeout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.IS_TIMEOUT, true[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.EXIT_VALUE, [0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:        String mimeString = [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mFILE_MIME, mimeString[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:        if [0m[1;39m([0m[39museMime[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            if [0m[1;39m([0m[39mmt == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:                return MediaType.OCTET_STREAM;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:    public void [0m[1;35msetFilePath[0m[1;39m([0m[39mString fileCommandPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m opens up a potential command vulnerability.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:        [0m[35m/[0m[35m/[0m[95mDon[0m[39m't ever let an untrusted user set this.[0m                            [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        this.fileCommandPath = fileCommandPath;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:        [0m[1;35mcheckHasFile[0m[1;39m([0m[39mthis.fileCommandPath[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:    public void [0m[1;35msetUseMime[0m[1;39m([0m[39mboolean useMime[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:        this.useMime = useMime;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:    public boolean [0m[1;35misUseMime[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:        return useMime;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:     * If this is not called on a TikaInputStream, this detector[0m                [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:     * will spool up to this many bytes to a file to be detected[0m                [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:     * by the [0m[32m'file'[0m[39m command.[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:     * @param maxBytes[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:    public void [0m[1;35msetMaxBytes[0m[1;39m([0m[39mint maxBytes[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:        this.maxBytes = maxBytes;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:    public void [0m[1;35msetTimeoutMs[0m[1;39m([0m[39mlong timeoutMs[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:        this.timeoutMs = timeoutMs;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/parser/external2/ExternalParser.jav[0m[1;92ma:19[0m[39m-[0m[1;36m56[0m  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.util.regex.Matcher;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.config.Field;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.config.Initializable;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.config.InitializableProblemHandler;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.config.Param;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import org.apache.tika.config.TikaTaskTimeout;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.tika.io.TemporaryResources;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import org.apache.tika.metadata.ExternalProcess;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import org.apache.tika.parser.EmptyParser;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import org.apache.tika.parser.Parser;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import org.apache.tika.sax.BodyContentHandler;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import org.apache.tika.sax.XHTMLContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/parser/external2/ExternalParser.jav[0m[1;92ma:66[0m[39m-[0m[1;36m303[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:public class ExternalParser implements Parser, Initializable [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    public static final long DEFAULT_TIMEOUT_MS = [0m[1;36m60000[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public static final String IN[0m[1;33mPUT[0m[39m_FILE_TOKEN = [0m[32m"$[0m[32m{[0m[32mIN[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    public static final String OUT[0m[1;33mPUT[0m[39m_FILE_TOKEN = [0m[32m"$[0m[32m{[0m[32mOUT[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    private static Pattern IN[0m[1;33mPUT[0m[39m_TOKEN_MATCHER = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\$\\[0m[32m{[0m[32mIN[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:    private static Pattern OUT[0m[1;33mPUT[0m[39m_TOKEN_MATCHER = [0m                               [2m                [0m
[2;36m                    [0m         [1;35mPattern.compile[0m[1;39m([0m[32m"\\$\\[0m[32m{[0m[32mOUT[0m[1;33mPUT[0m[32m_FILE[0m[32m}[0m[32m"[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:    private static final Logger LOG = [0m                                           [2m                [0m
[2;36m                    [0m         [1;35mLoggerFactory.getLogger[0m[1;39m([0m[39mExternalParser.class[0m[1;39m)[0m[39m;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    private Set<MediaType> supportedTypes = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:    private List<String> commandLine = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:    private Parser outputParser = EmptyParser.INSTANCE;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:    private boolean returnStdout = false;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    private boolean returnStderr = true;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:    private long timeoutMs = DEFAULT_TIMEOUT_MS;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    private int maxStdErr = [0m[1;36m10000[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:    private int maxStdOut = [0m[1;36m10000[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:    public Set<MediaType> [0m[1;35mgetSupportedTypes[0m[1;39m([0m[39mParseContext context[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        return supportedTypes;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:    public void [0m[1;35mparse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m may remain null, depending on whether the external parser writes[0m [2m                [0m
[2;36m                    [0m         [39mto a file[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        Path outFile = null;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        try [0m[1;39m([0m[39mTemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mstream, tmp, metadata[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            Path p = [0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            List<String> thisCommandLine = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:            Matcher inputMatcher = [0m[1;35mIN[0m[1;33mPUT[0m[1;35m_TOKEN_MATCHER.matcher[0m[1;39m([0m[32m""[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            Matcher outputMatcher = [0m[1;35mOUT[0m[1;33mPUT[0m[1;35m_TOKEN_MATCHER.matcher[0m[1;39m([0m[32m""[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            boolean outputFileInCommandline = false;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            for [0m[1;39m([0m[39mString c : commandLine[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:                if [0m[1;39m([0m[1;35minputMatcher.reset[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;35m.find[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:                    String updated = [0m[1;35mc.replace[0m[1;39m([0m[39mIN[0m[1;33mPUT[0m[39m_FILE_TOKEN,[0m                [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mp.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mupdated[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                [0m[1;39m}[0m[39m else if [0m[1;39m([0m[1;35moutputMatcher.reset[0m[1;39m([0m[39mc[0m[1;39m)[0m[1;35m.find[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                    outFile = [0m[1;35mFiles.createTempFile[0m[1;39m([0m[32m"tika-external2-"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:                    String updated = [0m[1;35mc.replace[0m[1;39m([0m[39mOUT[0m[1;33mPUT[0m[39m_FILE_TOKEN,[0m               [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35moutFile.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mupdated[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                    outputFileInCommandline = true;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:                    [0m[1;35mthisCommandLine.add[0m[1;39m([0m[39mc[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            FileProcessResult result = null;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            long localTimeoutMillis = [0m[1;35mTikaTaskTimeout.getTimeoutMillis[0m[1;39m([0m[39mcontext,[0m [2m                [0m
[2;36m                    [0m         [39mtimeoutMs[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            if [0m[1;39m([0m[39moutputFileInCommandline[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:                result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mnew [0m                              [2m                [0m
[2;36m                    [0m         [1;35mProcessBuilder[0m[1;39m([0m[39mthisCommandLine[0m[1;39m)[0m[39m,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:                        localTimeoutMillis, maxStdOut, maxStdErr[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:                outFile = [0m[1;35mFiles.createTempFile[0m[1;39m([0m[32m"tika-external2-"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:                result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mnew [0m                              [2m                [0m
[2;36m                    [0m         [1;35mProcessBuilder[0m[1;39m([0m[39mthisCommandLine[0m[1;39m)[0m[39m,[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:                        localTimeoutMillis, outFile, maxStdErr[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.IS_TIMEOUT, [0m[1;35mresult.isTimeout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.EXIT_VALUE, [0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT_LENGTH, [0m                       [2m                [0m
[2;36m                    [0m         [1;35mresult.getStdoutLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT_IS_TRUNCATED,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:                    [0m[1;35mresult.isStdoutTruncated[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR_LENGTH, [0m                       [2m                [0m
[2;36m                    [0m         [1;35mresult.getStderrLength[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR_IS_TRUNCATED,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:                    [0m[1;35mresult.isStderrTruncated[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mreturnStdout[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_OUT, [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            if [0m[1;39m([0m[39mreturnStderr[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.STD_ERR, [0m[1;35mresult.getStderr[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:            XHTMLContentHandler xhtml = new [0m[1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, [0m       [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:            [0m[1;35mxhtml.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:            [0m[1;35mhandleOutput[0m[1;39m([0m[39mresult, outFile, xhtml, metadata, context[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:            [0m[1;35mxhtml.endDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:            if [0m[1;39m([0m[39moutFile != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:                [0m[1;35mFiles.delete[0m[1;39m([0m[39moutFile[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:    private void [0m[1;35mhandleOutput[0m[1;39m([0m[39mFileProcessResult result, Path outFile,[0m           [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:                              XHTMLContentHandler xhtml, Metadata metadata,[0m     [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:                              ParseContext parseContext[0m[1;39m)[0m[39m throws SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException,[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:            IOException [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:        if [0m[1;39m([0m[39moutputParser == EmptyParser.INSTANCE[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:            if [0m[1;39m([0m[39moutFile != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:                try [0m[1;39m([0m[39mBufferedReader reader = [0m[1;35mFiles.newBufferedReader[0m[1;39m([0m[39moutFile[0m[1;39m)[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:                    String line = [0m[1;35mreader.readLine[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:                    while [0m[1;39m([0m[39mline != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:                        [0m[35m/[0m[35m/[0m[95mdo[0m[39m we want to wrap this in <p><[0m[35m/[0m[95mp[0m[39m> elements?[0m          [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:                        [0m[1;35mxhtml.characters[0m[1;39m([0m[39mline[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:                        [0m[1;35mxhtml.newline[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:                        line = [0m[1;35mreader.readLine[0m[1;39m([0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:                [0m[35m/[0m[35m/[0m[95mread[0m[39m this in line by line and wrap <p><[0m[35m/[0m[95mp[0m[39m> elements?[0m          [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:                [0m[1;35mxhtml.characters[0m[1;39m([0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:            if [0m[1;39m([0m[39moutFile != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m184[0m[39m:                try [0m[1;39m([0m[39mInputStream is = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39moutFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m           [2m                [0m
[2;36m                    [0m         [1;36m185[0m[39m:                    [0m[1;35moutputParser.parse[0m[1;39m([0m[39mis, new [0m[1;35mBodyContentHandler[0m[1;39m([0m[39mxhtml[0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mmetadata, parseContext[0m[1;39m)[0m[39m;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m186[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m187[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m188[0m[39m:                try [0m[1;39m([0m[39mInputStream is = [0m[1;35mTikaInputStream.get[0m[1;39m([0m                      [2m                [0m
[2;36m                    [0m         [1;36m189[0m[39m:                        [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[1;35m.getBytes[0m[1;39m([0m[39mStandardCharsets.UTF_8[0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m190[0m[39m:                    [0m[1;35moutputParser.parse[0m[1;39m([0m[39mis, new [0m[1;35mBodyContentHandler[0m[1;39m([0m[39mxhtml[0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mmetadata, parseContext[0m[1;39m)[0m[39m;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m191[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m192[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m193[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m194[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m195[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m196[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m197[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m198[0m[39m:     * This is set during initialization from a tika-config.[0m                    [2m                [0m
[2;36m                    [0m         [1;36m199[0m[39m:     * Any calls after initialization will result in a [0m[1;39m{[0m[39m@link [0m                  [2m                [0m
[2;36m                    [0m         [39mIllegalStateException[0m[1;39m}[0m[39m.[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m200[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m201[0m[39m:     * @param supportedTypes[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m202[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m203[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m204[0m[39m:    public void [0m[1;35msetSupportedTypes[0m[1;39m([0m[39mList<String> supportedTypes[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m205[0m[39m:        if [0m[1;39m([0m[1;35mthis.supportedTypes.size[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m206[0m[39m:            throw new [0m[1;35mIllegalStateException[0m[1;39m([0m[32m"can't set supportedTypes after [0m    [2m                [0m
[2;36m                    [0m         [32minitialization"[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m207[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m208[0m[39m:        for [0m[1;39m([0m[39mString s : supportedTypes[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m209[0m[39m:            [0m[1;35mthis.supportedTypes.add[0m[1;39m([0m[1;35mMediaType.parse[0m[1;39m([0m[39ms[0m[1;39m)[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m210[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m211[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m212[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m213[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m214[0m[39m:    public void [0m[1;35msetTimeoutMs[0m[1;39m([0m[39mlong timeoutMs[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m215[0m[39m:        this.timeoutMs = timeoutMs;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m216[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m217[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m218[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m219[0m[39m:    public void [0m[1;35msetMaxStdErr[0m[1;39m([0m[39mint maxStdErr[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m220[0m[39m:        this.maxStdErr = maxStdErr;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m221[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m222[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m223[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m224[0m[39m:    public void [0m[1;35msetMaxStdOut[0m[1;39m([0m[39mint maxStdOut[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m225[0m[39m:        this.maxStdOut = maxStdOut;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m226[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m227[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m228[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m229[0m[39m:     * Use this to specify the full commandLine.  The commandline must[0m          [2m                [0m
[2;36m                    [0m         [1;36m230[0m[39m:     * include at least [0m[1;39m{[0m[39m@link ExternalParser#IN[0m[1;33mPUT[0m[39m_FILE_TOKEN[0m[1;39m}[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m231[0m[39m:     * If the external process writes to an output file, specify[0m                [2m                [0m
[2;36m                    [0m         [1;36m232[0m[39m:     * [0m[1;39m{[0m[39m@link ExternalParser#OUT[0m[1;33mPUT[0m[39m_FILE_TOKEN[0m[1;39m}[0m[39m.[0m                                [2m                [0m
[2;36m                    [0m         [1;36m233[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m234[0m[39m:     * @param commandLine[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m235[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m236[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m237[0m[39m:    public void [0m[1;35msetCommandLine[0m[1;39m([0m[39mList<String> commandLine[0m[1;39m)[0m[39m [0m[1;39m{[0m                      [2m                [0m
[2;36m                    [0m         [1;36m238[0m[39m:        this.commandLine = commandLine;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m239[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m240[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m241[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m242[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m243[0m[39m:     * If set to true, this will return the stdout in the metadata[0m              [2m                [0m
[2;36m                    [0m         [1;36m244[0m[39m:     * via [0m[1;39m{[0m[39m@link org.apache.tika.metadata.ExternalProcess#STD_OUT[0m[1;39m}[0m[39m.[0m            [2m                [0m
[2;36m                    [0m         [1;36m245[0m[39m:     * Default is <code>false<[0m[35m/[0m[95mcode[0m[39m> because this should normally[0m               [2m                [0m
[2;36m                    [0m         [1;36m246[0m[39m:     * be handled by the outputParser[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m247[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m248[0m[39m:     * @param returnStdout[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m249[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m250[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m251[0m[39m:    public void [0m[1;35msetReturnStdout[0m[1;39m([0m[39mboolean returnStdout[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m252[0m[39m:        this.returnStdout = returnStdout;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m253[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m254[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m255[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m256[0m[39m:     * If set to true, this will return the stderr in the metadata[0m              [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:     * via [0m[1;39m{[0m[39m@link org.apache.tika.metadata.ExternalProcess#STD_ERR[0m[1;39m}[0m[39m.[0m            [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:     * Default is <code>true<[0m[35m/[0m[95mcode[0m[39m>[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:     * @param returnStderr[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:    public void [0m[1;35msetReturnStderr[0m[1;39m([0m[39mboolean returnStderr[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:        this.returnStderr = returnStderr;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:     * This parser is called on the output of the process.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:     * If the process writes to an output file, specified by[0m                    [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:     * [0m[1;39m{[0m[39m@link ExternalParser#OUT[0m[1;33mPUT[0m[39m_FILE_TOKEN[0m[1;39m}[0m[39m, this parser will parse that [0m   [2m                [0m
[2;36m                    [0m         [39mfile,[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:     * otherwise it will parse the UTF-[0m[1;36m8[0m[39m encoded bytes from the process' [0m       [2m                [0m
[2;36m                    [0m         [39mSTD_OUT.[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:     * @param parser[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:    public void [0m[1;35msetOutputParser[0m[1;39m([0m[39mParser parser[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:        this.outputParser = parser;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:    public Parser [0m[1;35mgetOutputParser[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:        return outputParser;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:    public void [0m[1;35minitialize[0m[1;39m([0m[39mMap<String, Param> params[0m[1;39m)[0m[39m throws [0m                   [2m                [0m
[2;36m                    [0m         [39mTikaConfigException [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:        [0m[35m/[0m[35m/[0m[95mno-op[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:    public void [0m[1;35mcheckInitialization[0m[1;39m([0m[39mInitializableProblemHandler problemHandler[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:            throws TikaConfigException [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:        if [0m[1;39m([0m[1;35msupportedTypes.size[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:            throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[32m"supportedTypes size must be > 0"[0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:        if [0m[1;39m([0m[1;35mcommandLine.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:            throw new [0m[1;35mTikaConfigException[0m[1;39m([0m[32m"commandLine is empty?!"[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m296[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m297[0m[39m:        if [0m[1;39m([0m[39moutputParser == EmptyParser.INSTANCE[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m298[0m[39m:            [0m[1;35mLOG.debug[0m[1;39m([0m[32m"no parser selected for the output; contents will be "[0m[39m +[0m  [2m                [0m
[2;36m                    [0m         [1;36m299[0m[39m:                    [0m[32m"written to the content handler"[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m300[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:1[0m[39m-[0m[1;36m50[0m               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.parser.pkg;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.AR;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.ARJ;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.CPIO;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.DUMP;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.JAR;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.SEVENZ;[0m                [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.TAR;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import static org.apache.tika.detect.zip.PackageConstants.ZIP;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.io.BufferedInputStream;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.nio.charset.Charset;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Date;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import java.util.concurrent.atomic.AtomicInteger;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import java.util.zip.ZipEntry;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.commons.compress.PasswordRequiredException;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.commons.compress.archivers.ArchiveEntry;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import org.apache.commons.compress.archivers.ArchiveException;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import org.apache.commons.compress.archivers.ArchiveInputStream;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import org.apache.commons.compress.archivers.ArchiveStreamFactory;[0m               [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import org.apache.commons.compress.archivers.StreamingNotSupportedException;[0m     [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import org.apache.commons.compress.archivers.ar.ArArchiveInputStream;[0m            [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream;[0m        [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import org.apache.commons.compress.archivers.dump.DumpArchiveInputStream;[0m        [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import org.apache.commons.compress.archivers.jar.JarArchiveInputStream;[0m          [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import org.apache.commons.compress.archivers.sevenz.SevenZFile;[0m                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:460[0m[39m-[0m[1;36m490[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/resources/org/apache/tika/config/FileCommandDetector.xml:[0m[1;36m1[0m[39m-[0m[1;36m26[0m    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:<?xml [0m[33mversion[0m[39m=[0m[32m"1[0m[32m.0"[0m[39m [0m[33mencoding[0m[39m=[0m[32m"UTF[0m[32m-8"[0m[39m?>[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:<!--[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m              [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:  contributor license agreements.  See the NOTICE file distributed with[0m           [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:  this work for additional information regarding copyright ownership.[0m             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m         [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m            [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:  the License.  You may obtain a copy of the License at[0m                           [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:  [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:  Unless required by applicable law or agreed to in writing, software[0m            [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m              [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m       [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:  See the License for the specific language governing permissions and[0m            [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:  limitations under the License.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:-->[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:<properties>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:    <detectors [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:        <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.FileCommandDetector"[0m[39m>[0m            [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:            <params>[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:                <param [0m[33mname[0m[39m=[0m[32m"useMime"[0m[39m [0m[33mtype[0m[39m=[0m[32m"bool"[0m[39m>true<[0m[35m/[0m[95mparam[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:            <[0m[35m/[0m[95mparams[0m[39m>[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:        <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:    <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:<[0m[35m/[0m[95mproperties[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:250[0m[39m-[0m[1;36m350[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m250[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m251[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m252[0m[39m:        [0m[35m/[0m[35m/[0m[39m Ensure that the stream supports the mark feature[0m                     [2m                [0m
[2;36m                    [0m         [1;36m253[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mstream.markSupported[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m254[0m[39m:            stream = new [0m[1;35mBufferedInputStream[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m255[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m256[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:        TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:            [0m[1;35m_parse[0m[1;39m([0m[39mstream, handler, metadata, context, tmp[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:            [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:    private void [0m[1;35m_parse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m   [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:                ParseContext context, TemporaryResources tmp[0m[1;39m)[0m                   [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:            throws TikaException, IOException, SAXException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:        ArchiveInputStream ais = null;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:        String encoding = null;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:            ArchiveStreamFactory factory =[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:                    [0m[1;35mcontext.get[0m[1;39m([0m[39mArchiveStreamFactory.class, new [0m                [2m                [0m
[2;36m                    [0m         [1;35mArchiveStreamFactory[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:            encoding = [0m[1;35mfactory.getEntryEncoding[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:            [0m[35m/[0m[35m/[0m[39m At the end we want to close the archive stream to release[0m        [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:            [0m[35m/[0m[35m/[0m[39m any associated resources, but the underlying document stream[0m     [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:            [0m[35m/[0m[35m/[0m[39m should not be closed[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:            [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- we've probably already detected the stream by here. We [0m   [2m                [0m
[2;36m                    [0m         [39mshould[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:            [0m[35m/[0m[35m/[0m[95mrely[0m[39m on that detection and not re-detect.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:            encoding = [0m[1;35mfactory.getEntryEncoding[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:                [0m[35m/[0m[35m/[0m[39m At the end we want to close the archive stream to release[0m    [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:                [0m[35m/[0m[35m/[0m[39m any associated resources, but the underlying document stream[0m [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:                [0m[35m/[0m[35m/[0m[39m should not be closed[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:            ais = [0m                                                              [2m                [0m
[2;36m                    [0m         [1;35mfactory.createArchiveInputStream[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mStreamingNotSupportedException sne[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:            [0m[35m/[0m[35m/[0m[39m Most archive formats work on streams, but a few need files[0m       [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:            if [0m[1;39m([0m[1;35msne.getFormat[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mArchiveStreamFactory.SEVEN_Z[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:                [0m[35m/[0m[35m/[0m[39m Rework as a file, and wrap[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:                [0m[1;35mstream.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:                TikaInputStream tstream = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mstream, tmp, [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:                [0m[35m/[0m[35m/[0m[39m Seven Zip suports passwords, was one given?[0m                  [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:                String password = null;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:                PasswordProvider provider = [0m                                    [2m                [0m
[2;36m                    [0m         [1;35mcontext.get[0m[1;39m([0m[39mPasswordProvider.class[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:                if [0m[1;39m([0m[39mprovider != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m296[0m[39m:                    password = [0m[1;35mprovider.getPassword[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m297[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m298[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m299[0m[39m:                SevenZFile sevenz;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m300[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:                    SevenZFile.Builder builder = new [0m                           [2m                [0m
[2;36m                    [0m         [1;35mSevenZFile.Builder[0m[1;39m([0m[1;39m)[0m[1;35m.setFile[0m[1;39m([0m[1;35mtstream.getFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:                    if [0m[1;39m([0m[39mpassword == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:                        sevenz = [0m[1;35mbuilder.get[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:                    [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:                        sevenz = [0m                                               [2m                [0m
[2;36m                    [0m         [1;35mbuilder.setPassword[0m[1;39m([0m[1;35mpassword.toCharArray[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mPasswordRequiredException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:                    throw new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m311[0m[39m:                [0m[35m/[0m[35m/[0m[39m Pending a fix for COMPRESS-[0m[1;36m269[0m[39m [0m[35m/[0m[39m TIKA-[0m[1;36m1525[0m[39m, this bit is a [0m   [2m                [0m
[2;36m                    [0m         [39mlittle nasty[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m312[0m[39m:                ais = new [0m[1;35mSevenZWrapper[0m[1;39m([0m[39msevenz[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m313[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m314[0m[39m:                [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m315[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"Unknown non-streaming format "[0m[39m + [0m      [2m                [0m
[2;36m                    [0m         [1;35msne.getFormat[0m[1;39m([0m[1;39m)[0m[39m, sne[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m316[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m317[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mArchiveException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m318[0m[39m:            tmp [0m[1;35m.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m319[0m[39m:            throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"Unable to unpack document stream"[0m[39m, e[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m320[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m321[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m322[0m[39m:        [0m[1;35mupdateMediaType[0m[1;39m([0m[39mais, metadata[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m323[0m[39m:        [0m[35m/[0m[35m/[0m[39m Use the delegate parser to parse the contained document[0m              [2m                [0m
[2;36m                    [0m         [1;36m324[0m[39m:        EmbeddedDocumentExtractor extractor =[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m325[0m[39m:                [0m[1;35mEmbeddedDocumentUtil.getEmbeddedDocumentExtractor[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m326[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m327[0m[39m:        XHTMLContentHandler xhtml = new [0m[1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, metadata[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m328[0m[39m:        [0m[1;35mxhtml.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m329[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m330[0m[39m:        [0m[35m/[0m[35m/[0m[39m mark before we start parsing entries for potential reset[0m             [2m                [0m
[2;36m                    [0m         [1;36m331[0m[39m:        [0m[1;35mstream.mark[0m[1;39m([0m[39mMARK_LIMIT[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m332[0m[39m:        [0m[35m/[0m[35m/[0m[95mneeded[0m[39m for mutable int by ref, not for thread safety.[0m                 [2m                [0m
[2;36m                    [0m         [1;36m333[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m keeps track of how many entries were processed.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m334[0m[39m:        AtomicInteger entryCnt = new [0m[1;35mAtomicInteger[0m[1;39m([0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m335[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m336[0m[39m:            [0m[1;35mparseEntries[0m[1;39m([0m[39mais, metadata, extractor, xhtml, false, entryCnt[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m337[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mUnsupportedZipFeatureException zfe[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m338[0m[39m:            [0m[35m/[0m[35m/[0m[39m If this is a zip archive which requires a data descriptor, parse[0m [2m                [0m
[2;36m                    [0m         [39mit again[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:            if [0m[1;39m([0m[1;35mzfe.getFeature[0m[1;39m([0m[1;39m)[0m[39m == Feature.DATA_DESCRIPTOR[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:                [0m[35m/[0m[35m/[0m[39m Close archive input stream and create a new one that could [0m  [2m                [0m
[2;36m                    [0m         [39mhandle data descriptor[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:                [0m[1;35mais.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:                [0m[35m/[0m[35m/[0m[39m An exception would be thrown if MARK_LIMIT is not big enough[0m [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:                [0m[1;35mstream.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:                ais = new [0m                                                      [2m                [0m
[2;36m                    [0m         [1;35mZipArchiveInputStream[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, encoding, true,[0m          [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:                        true[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:                [0m[1;35mparseEntries[0m[1;39m([0m[39mais, metadata, extractor, xhtml, true, entryCnt[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:            [0m[1;35mais.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:            [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/ServiceLoader.jav[0m[1;92ma:1[0m[39m-[0m[1;36m100[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.config;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Collection;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.util.Enumeration;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.utils.ServiceLoaderUtils;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m: * Internal utility class that Tika uses to look up service providers.[0m           [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m: * @since Apache Tika [0m[1;36m0.9[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:public class ServiceLoader [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:     * The dynamic set of services available in an OSGi environment.[0m             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:     * Managed by the [0m[1;39m{[0m[39m@link TikaActivator[0m[1;39m}[0m[39m class and used as an additional[0m      [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:     * source of service instances in the [0m[1;39m{[0m[39m@link #[0m[1;35mloadServiceProviders[0m[1;39m([0m[39mClass[0m[1;39m)[0m[1;39m}[0m   [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:     * method.[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    private static final Map<Object, RankedService> SERVICES = new HashMap<>[0m[1;39m([0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    private static final Pattern COMMENT = [0m[1;35mPattern.compile[0m[1;39m([0m[32m"#.*"[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:    private static final Pattern WHITESPACE = [0m[1;35mPattern.compile[0m[1;39m([0m[32m"\\s+"[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:     * The default context class loader to use for all threads, or[0m               [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:     * <code>null<[0m[35m/[0m[95mcode[0m[39m> to automatically select the context class loader.[0m       [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    private static volatile ClassLoader CONTEXT_CLASS_LOADER = null;[0m             [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:    private final ClassLoader loader;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    private final LoadErrorHandler handler;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    private final InitializableProblemHandler initializableProblemHandler;[0m       [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    private final boolean dynamic;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mServiceLoader[0m[1;39m([0m[39mClassLoader loader, LoadErrorHandler handler,[0m           [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:                         InitializableProblemHandler [0m                            [2m                [0m
[2;36m                    [0m         [39minitializableProblemHandler, boolean dynamic[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:        this.loader = loader;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:        this.handler = handler;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        this.initializableProblemHandler = initializableProblemHandler;[0m          [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        this.dynamic = dynamic;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public [0m[1;35mServiceLoader[0m[1;39m([0m[39mClassLoader loader, LoadErrorHandler handler, boolean [0m  [2m                [0m
[2;36m                    [0m         [39mdynamic[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mloader, handler, InitializableProblemHandler.WARN, dynamic[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:    public [0m[1;35mServiceLoader[0m[1;39m([0m[39mClassLoader loader, LoadErrorHandler handler[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mloader, handler, false[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:    public [0m[1;35mServiceLoader[0m[1;39m([0m[39mClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mloader,[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:                [0m[1;35mBoolean.getBoolean[0m[1;39m([0m[32m"org.apache.tika.service.error.warn"[0m[1;39m)[0m[39m ? [0m      [2m                [0m
[2;36m                    [0m         [39mLoadErrorHandler.WARN :[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:                        LoadErrorHandler.IGNORE[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:    public [0m[1;35mServiceLoader[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mgetContextClassLoader[0m[1;39m([0m[1;39m)[0m[39m,[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                [0m[1;35mBoolean.getBoolean[0m[1;39m([0m[32m"org.apache.tika.service.error.warn"[0m[1;39m)[0m[39m ? [0m      [2m                [0m
[2;36m                    [0m         [39mLoadErrorHandler.WARN :[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:                        LoadErrorHandler.IGNORE, true[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * Returns the context class loader of the current thread. If such[0m           [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     * a class loader is not available, then the loader of this class or[0m         [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:     * finally the system class loader is returned.[0m                              [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:     * @return context class loader, or <code>null<[0m[35m/[0m[95mcode[0m[39m> if no loader[0m           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:     * is available[0m                                                             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/ServiceLoader.jav[0m[1;92ma:19[0m[39m-[0m[1;36m38[0m             [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.util.ArrayList;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Collection;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.util.Collections;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.util.Enumeration;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.util.regex.Pattern;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.exception.TikaConfigException;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.utils.ServiceLoaderUtils;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/ServiceLoader.jav[0m[1;92ma:339[0m[39m-[0m[1;36m376[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:    @[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unchecked"[0m[1;39m)[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:    public <T> List<T> [0m[1;35mloadStaticServiceProviders[0m[1;39m([0m[39mClass<T> iface,[0m               [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:                                                  Collection<Class<? extends [0m   [2m                [0m
[2;36m                    [0m         [39mT>> excludes[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:        List<T> providers = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:        if [0m[1;39m([0m[39mloader != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:            List<String> names = [0m[1;35midentifyStaticServiceProviders[0m[1;39m([0m[39miface[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:            for [0m[1;39m([0m[39mString name : names[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:                    Class<?> klass = [0m[1;35mloader.loadClass[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:                    if [0m[1;39m([0m[1;35miface.isAssignableFrom[0m[1;39m([0m[39mklass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:                        boolean shouldExclude = false;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m351[0m[39m:                        for [0m[1;39m([0m[39mClass<? extends T> ex : excludes[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m352[0m[39m:                            if [0m[1;39m([0m[1;35mex.isAssignableFrom[0m[1;39m([0m[39mklass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m353[0m[39m:                                shouldExclude = true;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m354[0m[39m:                                break;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m355[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m356[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m357[0m[39m:                        if [0m[1;39m([0m[39m!shouldExclude[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m358[0m[39m:                            T instance = [0m[1;35mServiceLoaderUtils.newInstance[0m[1;39m([0m[39mklass, [0m [2m                [0m
[2;36m                    [0m         [39mthis[0m[1;39m)[0m[39m;[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m359[0m[39m:                            if [0m[1;39m([0m[39minstance instanceof Initializable[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m360[0m[39m:                                [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m [0m                               [2m                [0m
[2;36m                    [0m         [39minstance[0m[1;39m)[0m[1;35m.initialize[0m[1;39m([0m[39mCollections.EMPTY_MAP[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m361[0m[39m:                                [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m instance[0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m         [1;36m362[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.checkInitialization[0m[1;39m([0m[39minitializableProblemHandler[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m363[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m364[0m[39m:                            [0m[1;35mproviders.add[0m[1;39m([0m[39minstance[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m365[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m366[0m[39m:                    [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m367[0m[39m:                        throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                          [2m                [0m
[2;36m                    [0m         [1;36m368[0m[39m:                                [0m[32m"Class "[0m[39m + name + [0m[32m" is not of type: "[0m[39m + iface[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m369[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m370[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mThrowable t[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m371[0m[39m:                    [0m[1;35mhandler.handleLoadError[0m[1;39m([0m[39mname, t[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m372[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m373[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m374[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m375[0m[39m:        return providers;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m376[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mCHANGES.txt:[0m[1;36m1588[0m[39m-[0m[1;36m1797[0m                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1588[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1589[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1590[0m[39m:Release [0m[1;36m1.10[0m[39m - [0m[1;36m8[0m[39m/[0m[1;36m1[0m[39m/[0m[1;36m2015[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m1591[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1592[0m[39m:  * Tika Config XML can now be used to create composite detectors,[0m             [2m                [0m
[2;36m                    [0m         [1;36m1593[0m[39m:    and exclude detectors that DefaultDetector would otherwise[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1594[0m[39m:    have used. This brings support in-line with Parsers. [0m[1;39m([0m[39mTIKA-[0m[1;36m1702[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [1;36m1595[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1596[0m[39m:  * Reverted to legacy sort order of parsers that was [0m                         [2m                [0m
[2;36m                    [0m         [1;36m1597[0m[39m:    mistakenly reversed in Tika [0m[1;36m1.9[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1689[0m[1;39m)[0m[39m.[0m                               [2m                [0m
[2;36m                    [0m         [1;36m1598[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1599[0m[39m:  * Upgrade to POI [0m[1;36m3.13[0m[39m-beta1 [0m[1;39m([0m[39mTIKA-[0m[1;36m1667[0m[1;39m)[0m[39m.[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1600[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1601[0m[39m:  * Upgrade to PDFBox [0m[1;36m1.8[0m[39m.[0m[1;36m10[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1588[0m[1;39m)[0m[39m.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1602[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1603[0m[39m:  * MimeTypes now tries to find a registered type with and [0m                    [2m                [0m
[2;36m                    [0m         [1;36m1604[0m[39m:    without parameters [0m[1;39m([0m[39mTIKA-[0m[1;36m1692[0m[1;39m)[0m[39m.[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1605[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1606[0m[39m:  * Added more robust error handling for encoding detection[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1607[0m[39m:    of .MSG files [0m[1;39m([0m[39mTIKA-[0m[1;36m1238[0m[1;39m)[0m[39m.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1608[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1609[0m[39m:  * Fixed bug in Tika's use of the Jackcess parser that [0m                       [2m                [0m
[2;36m                    [0m         [1;36m1610[0m[39m:    prevented reading of v97 Access files [0m[1;39m([0m[39mTIKA-[0m[1;36m1681[0m[1;39m)[0m[39m.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1611[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1612[0m[39m:  * Upgrade xerial.org's sqlite-jdbc to [0m[1;92m3.8.10.1[0m[39m. NOTE: [0m                       [2m                [0m
[2;36m                    [0m         [1;36m1613[0m[39m:    as of Tika [0m[1;36m1.9[0m[39m, this jar is [0m[32m"provided."[0m[39m Make sure [0m                         [2m                [0m
[2;36m                    [0m         [1;36m1614[0m[39m:    to upgrade your provided jar! [0m[1;39m([0m[39mTIKA-[0m[1;36m1687[0m[1;39m)[0m[39m.[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1615[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1616[0m[39m:  * Add header/footer extraction to xls [0m[1;39m([0m[39mvia Aeham Abushwashi[0m[1;39m)[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1617[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1400[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1618[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1619[0m[39m:  * Drop the source file name from the embedded file path in[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1620[0m[39m:    RecursiveParserWrapper's [0m[32m"X-TIKA:embedded_resource_path"[0m[39m [0m                  [2m                [0m
[2;36m                    [0m         [1;36m1621[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1673[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1622[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1623[0m[39m:  * Upgraded to Java [0m[1;36m7[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1536[0m[1;39m)[0m[39m.[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1624[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1625[0m[39m:  * Non-standards compliant emails are now correctly detected[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1626[0m[39m:    as message/rfc822 [0m[1;39m([0m[39mTIKA-[0m[1;36m1602[0m[1;39m)[0m[39m.[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1627[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1628[0m[39m:  * Added parser for MS Access files via Jackcess. Many thanks [0m                [2m                [0m
[2;36m                    [0m         [1;36m1629[0m[39m:    to Health Market Science, Brian O'Neill and James Ahlborn [0m                 [2m                [0m
[2;36m                    [0m         [1;36m1630[0m[39m:    for relicensing Jackcess to Apache v2! [0m[1;39m([0m[39mTIKA-[0m[1;36m1601[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1631[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1632[0m[39m:  * GDALParser now correctly sets [0m[32m"nitf"[0m[39m as a supported [0m                       [2m                [0m
[2;36m                    [0m         [1;36m1633[0m[39m:    MediaType [0m[1;39m([0m[39mTIKA-[0m[1;36m1664[0m[1;39m)[0m[39m.[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m1634[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1635[0m[39m:  * Added DigestingParser to calculate digest hashes [0m                          [2m                [0m
[2;36m                    [0m         [1;36m1636[0m[39m:    and record them in metadata. Integrated with[0m                               [2m                [0m
[2;36m                    [0m         [1;36m1637[0m[39m:    tika-app and tika-server [0m[1;39m([0m[39mTIKA-[0m[1;36m1663[0m[1;39m)[0m[39m.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1638[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1639[0m[39m:  * Fixed ZipContainerDetector to detect all IPA files[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1640[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1659[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1641[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1642[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1643[0m[39m:Release [0m[1;36m1.9[0m[39m - [0m[1;36m6[0m[39m/[0m[1;36m6[0m[39m/[0m[1;36m2015[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1644[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1645[0m[39m:  * The ability to use the cTAKES clinical text[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1646[0m[39m:    knowledge extraction system for biomedical data is [0m                        [2m                [0m
[2;36m                    [0m         [1;36m1647[0m[39m:    now included as a Tika parser [0m[1;39m([0m[39mTIKA-[0m[1;36m1645[0m[39m, TIKA-[0m[1;36m1642[0m[1;39m)[0m[39m.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1648[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1649[0m[39m:  * Tika-server allows a user to specify the Tika config[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1650[0m[39m:    from the command line [0m[1;39m([0m[39mTIKA-[0m[1;36m1652[0m[39m, TIKA-[0m[1;36m1426[0m[1;39m)[0m[39m.[0m                              [2m                [0m
[2;36m                    [0m         [1;36m1651[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1652[0m[39m:  * Matlab file detection has been improved [0m[1;39m([0m[39mTIKA-[0m[1;36m1634[0m[1;39m)[0m[39m.[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1653[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1654[0m[39m:  * The EXIFTool was added as an External parser[0m                               [2m                [0m
[2;36m                    [0m         [1;36m1655[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1639[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1656[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1657[0m[39m:  * If FFMPEG is installed and on the PATH, it is a [0m                           [2m                [0m
[2;36m                    [0m         [1;36m1658[0m[39m:    usable Parser in Tika now [0m[1;39m([0m[39mTIKA-[0m[1;36m1510[0m[1;39m)[0m[39m.[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1659[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1660[0m[39m:  * Fixes have been applied to the ExternalParser to make[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1661[0m[39m:    it functional [0m[1;39m([0m[39mTIKA-[0m[1;36m1638[0m[1;39m)[0m[39m.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1662[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1663[0m[39m:  * Tika service loading can now be more verbose with the [0m                     [2m                [0m
[2;36m                    [0m         [1;36m1664[0m[39m:    org.apache.tika.service.error.warn system property [0m[1;39m([0m[39mTIKA-[0m[1;36m1636[0m[1;39m)[0m[39m.[0m            [2m                [0m
[2;36m                    [0m         [1;36m1665[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1666[0m[39m:  * Tika Server now allows for metadata extraction from remote[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1667[0m[39m:    URLs and in addition it outputs the detected language as a[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1668[0m[39m:    metadata field [0m[1;39m([0m[39mTIKA-[0m[1;36m1625[0m[1;39m)[0m[39m.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1669[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1670[0m[39m:  * OUT[0m[1;33mPUT[0m[39m_FILE_TOKEN not being replaced in ExternalParser [0m                    [2m                [0m
[2;36m                    [0m         [1;36m1671[0m[39m:    contributed by Pascal Essiembre [0m[1;39m([0m[39mTIKA-[0m[1;36m1620[0m[1;39m)[0m[39m.[0m                               [2m                [0m
[2;36m                    [0m         [1;36m1672[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1673[0m[39m:  * Tika REST server now supports language identification[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1674[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1622[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1675[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1676[0m[39m:  * All of the example code from the Tika in Action book has [0m                  [2m                [0m
[2;36m                    [0m         [1;36m1677[0m[39m:    been donated to Tika and added to tika-examples [0m[1;39m([0m[39mTIKA-[0m[1;36m1562[0m[1;39m)[0m[39m.[0m               [2m                [0m
[2;36m                    [0m         [1;36m1678[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1679[0m[39m:  * Tika server now logs errors determining ContentDisposition[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1680[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1621[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1681[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1682[0m[39m:  * An algorithm for using Byte Histogram frequencies to construct[0m             [2m                [0m
[2;36m                    [0m         [1;36m1683[0m[39m:    a Neural Network and to perform MIME detection was added[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1684[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1582[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1685[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1686[0m[39m:  * A Bayesian algorithm for MIME detection by probabilistic[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1687[0m[39m:    means was added [0m[1;39m([0m[39mTIKA-[0m[1;36m1517[0m[1;39m)[0m[39m.[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m1688[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1689[0m[39m:  * Tika now incorporates the Apache Spatial Information[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1690[0m[39m:    System capability of parsing Geographic ISO [0m[1;36m19139[0m[39m [0m                         [2m                [0m
[2;36m                    [0m         [1;36m1691[0m[39m:    files [0m[1;39m([0m[39mTIKA-[0m[1;36m443[0m[1;39m)[0m[39m. It can also detect those files as[0m                        [2m                [0m
[2;36m                    [0m         [1;36m1692[0m[39m:    well.[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1693[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1694[0m[39m:  * Update the MimeTypes code to support inheritance[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1695[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1535[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1696[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1697[0m[39m:  * Provide ability to parse and identify Global Change [0m                       [2m                [0m
[2;36m                    [0m         [1;36m1698[0m[39m:    Master Directory Interchange Format [0m[1;39m([0m[39mGCMD DIF[0m[1;39m)[0m[39m [0m                            [2m                [0m
[2;36m                    [0m         [1;36m1699[0m[39m:    scientific data files [0m[1;39m([0m[39mTIKA-[0m[1;36m1532[0m[1;39m)[0m[39m.[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1700[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1701[0m[39m:  * Improvements to detect CBOR files by extension [0m[1;39m([0m[39mTIKA-[0m[1;36m1610[0m[1;39m)[0m[39m.[0m                [2m                [0m
[2;36m                    [0m         [1;36m1702[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1703[0m[39m:  * Change xerial.org's sqlite-jdbc jar to [0m[32m"provided"[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1511[0m[1;39m)[0m[39m.[0m             [2m                [0m
[2;36m                    [0m         [1;36m1704[0m[39m:    Users will now need to add sqlite-jdbc to their classpath for[0m              [2m                [0m
[2;36m                    [0m         [1;36m1705[0m[39m:    the Sqlite3Parser to work.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1706[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1707[0m[39m:  * ExternalParser.check now catches [0m[1;39m([0m[39msuppresses[0m[1;39m)[0m[39m SecurityException[0m            [2m                [0m
[2;36m                    [0m         [1;36m1708[0m[39m:    and returns false, so it's OK to run Tika with a security policy[0m           [2m                [0m
[2;36m                    [0m         [1;36m1709[0m[39m:    that does not allow execution of external processes [0m[1;39m([0m[39mTIKA-[0m[1;36m1628[0m[1;39m)[0m[39m.[0m           [2m                [0m
[2;36m                    [0m         [1;36m1710[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1711[0m[39m:Release [0m[1;36m1.8[0m[39m - [0m[1;36m4[0m[39m/[0m[1;36m13[0m[39m/[0m[1;36m2015[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m1712[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1713[0m[39m:  * Fix null pointer when processing ODT footer styles [0m[1;39m([0m[39mTIKA-[0m[1;36m1600[0m[1;39m)[0m[39m.[0m            [2m                [0m
[2;36m                    [0m         [1;36m1714[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1715[0m[39m:  * Upgrade to com.drewnoakes' metadata-extractor to [0m[1;36m2.0[0m[39m and[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1716[0m[39m:    add parser for webp metadata [0m[1;39m([0m[39mTIKA-[0m[1;36m1594[0m[1;39m)[0m[39m.[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m1717[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1718[0m[39m:  * Duration extracted from MP3s with no ID3 tags [0m[1;39m([0m[39mTIKA-[0m[1;36m1589[0m[1;39m)[0m[39m.[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1719[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1720[0m[39m:  * Upgraded to PDFBox [0m[1;36m1.8[0m[39m.[0m[1;36m9[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1575[0m[1;39m)[0m[39m.[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1721[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1722[0m[39m:  * Tika now supports the IsaTab data standard for bioinformatics[0m              [2m                [0m
[2;36m                    [0m         [1;36m1723[0m[39m:    both in terms of MIME identification and in terms of parsing[0m               [2m                [0m
[2;36m                    [0m         [1;36m1724[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1580[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1725[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1726[0m[39m:  * Tika server can now enable CORS requests with the command line[0m             [2m                [0m
[2;36m                    [0m         [1;36m1727[0m[39m:    [0m[32m"--cors"[0m[39m or [0m[32m"-C"[0m[39m option [0m[1;39m([0m[39mTIKA-[0m[1;36m1586[0m[1;39m)[0m[39m.[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1728[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1729[0m[39m:  * Update jhighlight dependency to avoid using LGPL license. Thank[0m            [2m                [0m
[2;36m                    [0m         [1;36m1730[0m[39m:    @kkrugler for his great contribution [0m[1;39m([0m[39mTIKA-[0m[1;36m1581[0m[1;39m)[0m[39m.[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1731[0m[39m:  [0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1732[0m[39m:  * Updated HDF and NetCDF parsers to output file version in [0m                  [2m                [0m
[2;36m                    [0m         [1;36m1733[0m[39m:    metadata [0m[1;39m([0m[39mTIKA-[0m[1;36m1578[0m[39m and TIKA-[0m[1;36m1579[0m[1;39m)[0m[39m.[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1734[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1735[0m[39m:  * Upgraded to POI [0m[1;36m3.12[0m[39m-beta1 [0m[1;39m([0m[39mTIKA-[0m[1;36m1531[0m[1;39m)[0m[39m.[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m1736[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1737[0m[39m:  * Added tika-batch module for directory to directory batch[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1738[0m[39m:    processing.  This is a new, experimental capability, and the API will [0m     [2m                [0m
[2;36m                    [0m         [1;36m1739[0m[39m:    likely change in future releases [0m[1;39m([0m[39mTIKA-[0m[1;36m1330[0m[1;39m)[0m[39m.[0m                              [2m                [0m
[2;36m                    [0m         [1;36m1740[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1741[0m[39m:  * [0m[1;35mTranslator.translate[0m[1;39m([0m[1;39m)[0m[39m Exceptions are now restricted to[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1742[0m[39m:    TikaException and IOException [0m[1;39m([0m[39mTIKA-[0m[1;36m1416[0m[1;39m)[0m[39m.[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1743[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1744[0m[39m:  * Tika now supports MIME detection for Microsoft Extended [0m                   [2m                [0m
[2;36m                    [0m         [1;36m1745[0m[39m:    Makefiles [0m[1;39m([0m[39mEMF[0m[1;39m)[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1554[0m[1;39m)[0m[39m.[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m1746[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1747[0m[39m:  * Tika has improved delineation in XML and HTML MIME detection[0m               [2m                [0m
[2;36m                    [0m         [1;36m1748[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1365[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1749[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1750[0m[39m:  * Upgraded the Drew Noakes metadata-extractor to version [0m[1;36m2.7[0m[39m.[0m[1;36m2[0m               [2m                [0m
[2;36m                    [0m         [1;36m1751[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1576[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1752[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1753[0m[39m:  * Added basic style support for ODF documents, contributed by[0m                [2m                [0m
[2;36m                    [0m         [1;36m1754[0m[39m:    Axel DÃ¶rfler [0m[1;39m([0m[39mTIKA-[0m[1;36m1063[0m[1;39m)[0m[39m.[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1755[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1756[0m[39m:  * Move Tika server resources and writers to separate[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1757[0m[39m:    org.apache.tika.server.resource and writer packages [0m[1;39m([0m[39mTIKA-[0m[1;36m1564[0m[1;39m)[0m[39m.[0m           [2m                [0m
[2;36m                    [0m         [1;36m1758[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1759[0m[39m:  * Upgrade UCAR dependencies to [0m[1;36m4.5[0m[39m.[0m[1;36m5[0m[39m [0m[1;39m([0m[39mTIKA-[0m[1;36m1571[0m[1;39m)[0m[39m.[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1760[0m[39m:  [0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1761[0m[39m:  * Fix Paths in Tika server welcome page [0m[1;39m([0m[39mTIKA-[0m[1;36m1567[0m[1;39m)[0m[39m.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1762[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1763[0m[39m:  * Fixed infinite recursion while parsing some PDFs [0m[1;39m([0m[39mTIKA-[0m[1;36m1038[0m[1;39m)[0m[39m.[0m              [2m                [0m
[2;36m                    [0m         [1;36m1764[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1765[0m[39m:  * XHTMLContentHandler now properly passes along body attributes,[0m             [2m                [0m
[2;36m                    [0m         [1;36m1766[0m[39m:    contributed by Markus Jelsma [0m[1;39m([0m[39mTIKA-[0m[1;36m995[0m[1;39m)[0m[39m.[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m1767[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1768[0m[39m:  * TikaCLI option --compare-file-magic to report mime types known to[0m          [2m                [0m
[2;36m                    [0m         [1;36m1769[0m[39m:    the [0m[1;35mfile[0m[1;39m([0m[1;36m1[0m[1;39m)[0m[39m tool but not known [0m[35m/[0m[39m fully known to Tika.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m1770[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1771[0m[39m:  * MediaTypeRegistry support for returning known child types.[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1772[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1773[0m[39m:  * Support for excluding certain Parsers from being[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1774[0m[39m:    used by DefaultParser via the Tika Config file, using the new[0m              [2m                [0m
[2;36m                    [0m         [1;36m1775[0m[39m:    parser-exclude tag [0m[1;39m([0m[39mTIKA-[0m[1;36m1558[0m[1;39m)[0m[39m.[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1776[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1777[0m[39m:  * Detect Global Change Master Directory [0m[1;39m([0m[39mGCMD[0m[1;39m)[0m[39m Directory[0m                     [2m                [0m
[2;36m                    [0m         [1;36m1778[0m[39m:    Interchange Format [0m[1;39m([0m[39mDIF[0m[1;39m)[0m[39m files [0m[1;39m([0m[39mTIKA-[0m[1;36m1561[0m[1;39m)[0m[39m.[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1779[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1780[0m[39m:  * Tika's JAX-RS server can now return stacktraces for[0m                        [2m                [0m
[2;36m                    [0m         [1;36m1781[0m[39m:    parse exceptions [0m[1;39m([0m[39mTIKA-[0m[1;36m1323[0m[1;39m)[0m[39m.[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1782[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1783[0m[39m:  * Added MockParser for testing handling of exceptions, errors[0m                [2m                [0m
[2;36m                    [0m         [1;36m1784[0m[39m:    and hangs in code that uses parsers [0m[1;39m([0m[39mTIKA-[0m[1;36m1553[0m[1;39m)[0m[39m.[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1785[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1786[0m[39m:  * The ForkParser service removed from Activator. Rollback of [0m[1;39m([0m[39mTIKA-[0m[1;36m1354[0m[1;39m)[0m[39m.[0m    [2m                [0m
[2;36m                    [0m         [1;36m1787[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1788[0m[39m:  * Increased the speed of language identification by [0m                         [2m                [0m
[2;36m                    [0m         [1;36m1789[0m[39m:    a factor of two -- contributed by Toke Eskildsen [0m[1;39m([0m[39mTIKA-[0m[1;36m1549[0m[1;39m)[0m[39m.[0m              [2m                [0m
[2;36m                    [0m         [1;36m1790[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1791[0m[39m:  * Added parser for Sqlite3 db files. Some users will need to [0m                [2m                [0m
[2;36m                    [0m         [1;36m1792[0m[39m:    exclude the dependency on xerial.org's sqlite-jdbc because[0m                 [2m                [0m
[2;36m                    [0m         [1;36m1793[0m[39m:    it contains native libs [0m[1;39m([0m[39mTIKA-[0m[1;36m1511[0m[1;39m)[0m[39m.[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1794[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1795[0m[39m:  * Use [0m[1;33mPOST[0m[39m instead of [0m[1;33mPUT[0m[39m for tika-server form methods[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1796[0m[39m:    [0m[1;39m([0m[39mTIKA-[0m[1;36m1547[0m[1;39m)[0m[39m.[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m1797[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m19[0m[39m-[0m[1;36m30[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/config/TikaDetectorConfigTest.jav[0m[1;92ma:19[0m[39m-[0m[1;36m34[0m                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static org.junit.jupiter.api.Assertions.assertEquals;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import static org.junit.jupiter.api.Assertions.assertNotNull;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import static org.junit.jupiter.api.Assertions.assertTrue;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import static org.junit.jupiter.api.Assertions.fail;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import org.junit.jupiter.api.Test;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import org.apache.tika.detect.CompositeDetector;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import org.apache.tika.detect.DefaultDetector;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import org.apache.tika.detect.Detector;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.tika.detect.EmptyDetector;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.tika.detect.microsoft.POIFSContainerDetector;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.tika.detect.zip.DefaultZipContainerDetector;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.parser.microsoft.pst.OutlookPSTParser;[0m                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/config/TikaDetectorConfigTest.jav[0m[1;92ma:41[0m[39m-[0m[1;36m72[0m                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class TikaDetectorConfigTest extends AbstractTikaConfigTest [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    @Test[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public void [0m[1;35mtestDetectorExcludeFromDefault[0m[1;39m([0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        TikaConfig config = [0m[1;35mgetConfig[0m[1;39m([0m[32m"TIKA-1702-detector-exclude.xml"[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:        [0m[1;35massertNotNull[0m[1;39m([0m[1;35mconfig.getParser[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:        [0m[1;35massertNotNull[0m[1;39m([0m[1;35mconfig.getDetector[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:        CompositeDetector detector = [0m[1;39m([0m[39mCompositeDetector[0m[1;39m)[0m[39m [0m[1;35mconfig.getDetector[0m[1;39m([0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        [0m[35m/[0m[35m/[0m[39m Should be wrapping two detectors[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[1;36m2[0m[39m, [0m[1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.size[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        [0m[35m/[0m[35m/[0m[39m First should be DefaultDetector, second Empty, that order[0m             [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[39mDefaultDetector.class, [0m                                     [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[1;35m.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[39mEmptyDetector.class, [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m1[0m[1;39m)[0m[1;35m.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[39m Get the DefaultDetector from the config[0m                               [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        DefaultDetector confDetector = [0m[1;39m([0m[39mDefaultDetector[0m[1;39m)[0m[39m [0m                        [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[35m/[0m[35m/[0m[39m Get a fresh [0m[32m"default"[0m[39m DefaultParser[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        DefaultDetector normDetector = new [0m                                      [2m                [0m
[2;36m                    [0m         [1;35mDefaultDetector[0m[1;39m([0m[1;35mconfig.getMimeRepository[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:        [0m[35m/[0m[35m/[0m[39m The default one will offer the Zip and POIFS detectors[0m                [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35massertDetectors[0m[1;39m([0m[39mnormDetector, true, true[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[35m/[0m[35m/[0m[39m The one from the config won't, as we excluded those[0m                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35massertDetectors[0m[1;39m([0m[39mconfDetector, false, false[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector:[0m[1;36m1[0m[39m-[0m[1;36m16[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:#  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:#  contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:#  this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:#  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:#  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:#  the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:#       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:#  Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:#  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:#  See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:#  limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:org.apache.tika.detect.ShellCodeDetector[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:83[0m[39m-[0m[1;36m110[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m1[0m[39m-[0m[1;36m31[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:<?xml [0m[33mversion[0m[39m=[0m[32m"1[0m[32m.0"[0m[39m [0m[33mencoding[0m[39m=[0m[32m"UTF[0m[32m-8"[0m[39m?>[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:<!--[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m              [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:  contributor license agreements.  See the NOTICE file distributed with[0m           [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:  this work for additional information regarding copyright ownership.[0m             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m         [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m            [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:  the License.  You may obtain a copy of the License at[0m                           [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:  [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:  Unless required by applicable law or agreed to in writing, software[0m            [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m              [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m       [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:  See the License for the specific language governing permissions and[0m            [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:  limitations under the License.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:-->[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:<properties>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:<[0m[35m/[0m[95mproperties[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:46[0m[39m-[0m[1;36m52[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:87[0m[39m-[0m[1;36m110[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/FileCommandDetector.jav[0m[1;92ma:119[0m[39m-[0m[1;36m148[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    private MediaType [0m[1;35mdetectOnPath[0m[1;39m([0m[39mPath path, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m args =[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                new String[0m[1;39m[[0m[1;39m][0m[1;39m{[0m[1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[39mfileCommandPath[0m[1;39m)[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [32m"-b"[0m[39m, [0m[32m"--mime-type"[0m[39m,[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mpath.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m}[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        ProcessBuilder builder = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39margs[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:        FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mbuilder, timeoutMs, [0m    [2m                [0m
[2;36m                    [0m         [1;36m10000[0m[39m, [0m[1;36m10000[0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:        if [0m[1;39m([0m[1;35mresult.isTimeout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.IS_TIMEOUT, true[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.EXIT_VALUE, [0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:        String mimeString = [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mFILE_MIME, mimeString[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:        if [0m[1;39m([0m[39museMime[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            if [0m[1;39m([0m[39mmt == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:                return MediaType.OCTET_STREAM;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Analysis[0m                                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Core Issue[0m                                                                      [2m                [0m
[2;36m                    [0m         [39mThe vulnerability exists in `[0m[1;35mShellCodeDetector.detect[0m[1;39m([0m[1;39m)[0m[39m` which attempts to [0m         [2m                [0m
[2;36m                    [0m         [39mdetermine if a shell script is a [0m[32m"no-arg shell script"[0m[39m by **executing the script [0m   [2m                [0m
[2;36m                    [0m         [39mdirectly** [0m[1;39m([0m[39mlines [0m[1;36m100[0m[39m-[0m[1;36m103[0m[39m in ShellCodeDetector.java[0m[1;39m)[0m[39m. This is triggered when [0m       [2m                [0m
[2;36m                    [0m         [39mprocessing embedded documents in package files through the detection chain:[0m         [2m                [0m
[2;36m                    [0m         [39m- Package file â†’ PackageParser â†’ FileEmbeddedDocumentExtractor â†’ CompositeDetector [0m [2m                [0m
[2;36m                    [0m         [39mâ†’ ShellCodeDetector â†’ arbitrary code execution[0m                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Root Cause[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Design Flaw**: ShellCodeDetector executes user-controlled shell scripts to [0m    [2m                [0m
[2;36m                    [0m         [39mtest if they run without arguments, treating untrusted input as executable code [0m    [2m                [0m
[2;36m                    [0m         [39mrather than data[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Default Inclusion**: ShellCodeDetector is registered as a service provider and[0m [2m                [0m
[2;36m                    [0m         [39mloaded by default in all Tika installations[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Insufficient Protection**: While filename sanitization exists [0m[1;39m([0m[39mlines [0m[1;36m90[0m[39m-[0m[1;36m91[0m[1;39m)[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [39mthe actual malicious payload resides in the script content itself, which is [0m        [2m                [0m
[2;36m                    [0m         [39munchanged and executed[0m                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Critical Logic to Preserve[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. The ability to detect shell scripts by file extension and shebang [0m[1;39m([0m[39mlines [0m[1;36m54[0m[39m-[0m[1;36m82[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. The overall detector chain mechanism [0m[1;39m([0m[39mCompositeDetector, DefaultDetector[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. The exclusion mechanism for detectors [0m[1;39m([0m[39malready exists since TIKA-[0m[1;36m1702[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Other safe detectors like FileCommandDetector that use external tools properly[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Primary Fix: Disable Dangerous Execution in ShellCodeDetector[0m                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Target File**: [0m                                                                   [2m                [0m
[2;36m                    [0m         [39m`tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java`[0m             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Approach**: Remove the dangerous code execution functionality while preserving [0m   [2m                [0m
[2;36m                    [0m         [39mthe safe detection capabilities.[0m                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Implementation Steps**:[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Preserve Safe Detection Logic** [0m[1;39m([0m[39mlines [0m[1;36m54[0m[39m-[0m[1;36m82[0m[1;39m)[0m[39m:[0m                                 [2m                [0m
[2;36m                    [0m         [39m   - Keep the file extension check for .sh and .bash files[0m                          [2m                [0m
[2;36m                    [0m         [39m   - Keep the shebang detection [0m[1;39m([0m[39m#![0m[35m/[0m[39m prefix check[0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m   - These checks are safe as they only read file metadata and content without [0m     [2m                [0m
[2;36m                    [0m         [39mexecution[0m                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Remove Dangerous Execution Block** [0m[1;39m([0m[39mlines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[1;39m)[0m[39m:[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Delete the entire [0m[32m"test for no-arg shell script"[0m[39m section that:[0m                 [2m                [0m
[2;36m                    [0m         [39m     - Creates temporary files with shell scripts[0m                                   [2m                [0m
[2;36m                    [0m         [39m     - Executes them via ProcessBuilder[0m                                             [2m                [0m
[2;36m                    [0m         [39m     - Sets the SHELL_NO_ARGS metadata property[0m                                     [2m                [0m
[2;36m                    [0m         [39m   [0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Modify the [0m[1;35mdetect[0m[1;39m([0m[1;39m)[0m[39m Method**:[0m                                                  [2m                [0m
[2;36m                    [0m         [39m   - After the safe detection logic at line [0m[1;36m82[0m[39m, directly return `[0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m` [0m [2m                [0m
[2;36m                    [0m         [39minstead of proceeding to execution[0m                                                  [2m                [0m
[2;36m                    [0m         [39m   - Remove lines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[39m entirely[0m                                                   [2m                [0m
[2;36m                    [0m         [39m   - The method should return SHELL_SCRIPT or OCTET_STREAM based only on [0m           [2m                [0m
[2;36m                    [0m         [39mfilename/shebang analysis[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Preserve the Property Definition**:[0m                                            [2m                [0m
[2;36m                    [0m         [39m   - Keep the `SHELL_NO_ARGS` property definition [0m[1;39m([0m[39mline [0m[1;36m48[0m[1;39m)[0m[39m for backward [0m           [2m                [0m
[2;36m                    [0m         [39mcompatibility[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m   - It simply won't be set anymore, which is acceptable since it was optional [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Secondary Fix: Remove Service Provider Registration[0m                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Target File**: [0m                                                                   [2m                [0m
[2;36m                    [0m         [39m`tika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector`[0m    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Approach**: Comment out or remove ShellCodeDetector from automatic loading.[0m       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Implementation Steps**:[0m                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Remove from Service Provider List**:[0m                                           [2m                [0m
[2;36m                    [0m         [39m   - Delete or comment out line [0m[1;36m16[0m[39m: `org.apache.tika.detect.ShellCodeDetector`[0m      [2m                [0m
[2;36m                    [0m         [39m   - This prevents automatic loading by DefaultDetector[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Users who explicitly need shell script detection can still configure it [0m       [2m                [0m
[2;36m                    [0m         [39mmanually via TikaConfig[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative**: If maintaining backward compatibility for users who might depend [0m  [2m                [0m
[2;36m                    [0m         [39mon ShellCodeDetector being available:[0m                                               [2m                [0m
[2;36m                    [0m         [39m- Keep the service provider registration[0m                                            [2m                [0m
[2;36m                    [0m         [39m- But ensure the dangerous execution code is removed from the class itself [0m[1;39m([0m[39mprimary[0m [2m                [0m
[2;36m                    [0m         [39mfix[0m[1;39m)[0m                                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Justification[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why This Is Optimal[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Security First**: Completely eliminates the OS command injection vulnerability[0m [2m                [0m
[2;36m                    [0m         [39mby removing the execution path[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Minimal Breaking Changes**: [0m                                                   [2m                [0m
[2;36m                    [0m         [39m   - Preserves safe shell script detection by filename and shebang[0m                  [2m                [0m
[2;36m                    [0m         [39m   - Other detectors and parsers remain unaffected[0m                                  [2m                [0m
[2;36m                    [0m         [39m   - The detection chain mechanism continues to work[0m                                [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Backward Compatibility**: [0m                                                     [2m                [0m
[2;36m                    [0m         [39m   - ShellCodeDetector still detects shell scripts [0m[1;39m([0m[39mreturns SHELL_SCRIPT media [0m     [2m                [0m
[2;36m                    [0m         [39mtype[0m[1;39m)[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m   - Only the SHELL_NO_ARGS metadata property is no longer set[0m                      [2m                [0m
[2;36m                    [0m         [39m   - This property was optional metadata that few applications likely depend on[0m     [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **No External Dependencies**: Fix is contained within the ShellCodeDetector [0m     [2m                [0m
[2;36m                    [0m         [39mclass itself[0m                                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Preserves Existing Logic[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Detection Chain**: CompositeDetector, DefaultDetector, and all other detectors[0m [2m                [0m
[2;36m                    [0m         [39mcontinue to function normally[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Package Processing**: PackageParser and embedded document extraction remain [0m   [2m                [0m
[2;36m                    [0m         [39munchanged[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Other External Tools**: Safe external command patterns [0m[1;39m([0m[39mFileCommandDetector, [0m  [2m                [0m
[2;36m                    [0m         [39mExternalParser[0m[1;39m)[0m[39m are unaffected[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Configuration Mechanism**: The exclude detector functionality remains [0m         [2m                [0m
[2;36m                    [0m         [39mavailable for other use cases[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Addresses the Evaluation Report[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Eliminates Vulnerability**: No shell scripts are executed, preventing OS [0m      [2m                [0m
[2;36m                    [0m         [39mcommand injection[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Fixes Stack Trace**: The execution path through ShellCodeDetector.detect:[0m[1;36m103[0m[39m â†’[0m [2m                [0m
[2;36m                    [0m         [39mProcessUtils.execut[0m[1;92me:94[0m[39m â†’ ProcessBuilder.start is removed[0m                           [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Addresses Root Cause**: The fundamental design flaw of executing untrusted [0m    [2m                [0m
[2;36m                    [0m         [39mscripts is corrected[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **Maintains Functionality**: Shell scripts can still be detected and processed [0m  [2m                [0m
[2;36m                    [0m         [39mby parsers, just not executed during detection[0m                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Potential Side Effects and Mitigation[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **SHELL_NO_ARGS Property Lost**:[0m                                                 [2m                [0m
[2;36m                    [0m         [39m   - **Impact**: Applications relying on this metadata will no longer receive it[0m    [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: This is an acceptable trade-off for security; the property was[0m [2m                [0m
[2;36m                    [0m         [39moptional and rarely used[0m                                                            [2m                [0m
[2;36m                    [0m         [39m   - **Alternative**: Document that users needing this functionality must implement[0m [2m                [0m
[2;36m                    [0m         [39mcustom, sandboxed detection[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Test Failures**:[0m                                                               [2m                [0m
[2;36m                    [0m         [39m   - **Impact**: Tests specifically checking SHELL_NO_ARGS behavior will fail[0m       [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: Update or remove tests that verify the execution behavior[0m      [2m                [0m
[2;36m                    [0m         [39m   - **Preserve**: Tests that verify shell script detection by filename/shebang [0m    [2m                [0m
[2;36m                    [0m         [39mshould still pass[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Existing Deployments**:[0m                                                        [2m                [0m
[2;36m                    [0m         [39m   - **Impact**: Users who configured exclusions for ShellCodeDetector will have [0m   [2m                [0m
[2;36m                    [0m         [39mredundant config[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m   - **Mitigation**: No action needed; the exclusion config is harmless[0m             [2m                [0m
[2;36m                    [0m         [39m   - **Communication**: Release notes should document the security fix and behavior[0m [2m                [0m
[2;36m                    [0m         [39mchange[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Similar Solutions in Codebase[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **FileCommandDetector Pattern** [0m[1;39m([0m[39mlines [0m[1;36m119[0m[39m-[0m[1;36m148[0m[1;39m)[0m[39m: Demonstrates the correct way to[0m [2m                [0m
[2;36m                    [0m         [39muse external commands - execute a trusted tool on user data, not execute user data [0m [2m                [0m
[2;36m                    [0m         [39mitself[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **ExternalParser Pattern** [0m[1;39m([0m[39mlines [0m[1;36m66[0m[39m-[0m[1;36m303[0m[1;39m)[0m[39m: Shows configuration-based external [0m   [2m                [0m
[2;36m                    [0m         [39mcommand execution with proper input/output handling and escaping[0m                    [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Detector Exclusion Mechanism** [0m[1;39m([0m[39mTIKA-[0m[1;36m1702[0m[1;39m)[0m[39m: Already-existing infrastructure [0m   [2m                [0m
[2;36m                    [0m         [39mallows users to disable problematic detectors[0m                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Implementation Notes[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix should be applied to the initial codebase without modifications to:[0m         [2m                [0m
[2;36m                    [0m         [39m- Test harness code[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m- Fuzzing infrastructure  [0m                                                          [2m                [0m
[2;36m                    [0m         [39m- External libraries[0m                                                                [2m                [0m
[2;36m                    [0m         [39m- Other detectors or parsers[0m                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe modified ShellCodeDetector should maintain the same method signature for [0m       [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m` to preserve API compatibility, but [0m  [2m                [0m
[2;36m                    [0m         [39mthe implementation should stop at line [0m[1;36m82[0m[39m and return the result without executing [0m  [2m                [0m
[2;36m                    [0m         [39mscripts.[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m[01/08/26 16:05:00][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.ANALYZE                  ]8;id=776086;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=402571;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.WRONG[1m)[0m                                        [2m               [0m
[2;36m[01/08/26 16:08:56][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.ANALYZE -> TeamStatus.[1;33mPATCH[0m                     ]8;id=515247;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=98320;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.WRONG[1m)[0m                                        [2m               [0m
[2;36m[01/08/26 16:09:53][0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.[1;33mPATCH[0m -> TeamStatus.EVALUATE                    ]8;id=623028;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=258156;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m2[0m, patch status: PatchStatus.WRONG[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=395736;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=630049;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:09:54][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m1.00[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=619150;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=487780;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 16:09:55][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Started[33m...[0m                                ]8;id=893917;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=159622;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Checking valid diff: [35m/tmp/[0m[95mtmp7gd4mvf3[0m                                                 ]8;id=702379;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py\[2mdefault.py[0m]8;;\[2m:[0m]8;id=921850;file:///home/qqor/crete/packages/crete/framework/environment/services/oss_fuzz/default.py#173\[2m173[0m]8;;\
[2;36m[01/08/26 16:11:08][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Patching[1m)[0m Took [1;36m72.82[0m seconds; [33mexception[0m=[3;91mFalse[0m      ]8;id=622117;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=689751;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Started[33m...[0m                          ]8;id=334987;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=540560;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:11:42][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Checking build[1m)[0m Took [1;36m34.10[0m seconds;                ]8;id=679802;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=840648;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                    [0m         [33mexception[0m=[3;91mFalse[0m                                                               [2m                      [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Started[33m...[0m                             ]8;id=12892;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=931303;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:11:53][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Running PoV[1m)[0m Took [1;36m11.55[0m seconds; [33mexception[0m=[3;91mFalse[0m   ]8;id=722331;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=721483;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Started[33m...[0m                                 ]8;id=334582;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=298320;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Testing[1m)[0m Took [1;36m0.00[0m seconds; [33mexception[0m=[3;91mFalse[0m        ]8;id=764044;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=587346;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=494673;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=327094;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:11:54][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.86[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=114316;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=629364;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 16:11:55][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=180756;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=303766;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:11:56][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.94[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=825544;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=236377;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m[01/08/26 16:11:57][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Started[33m...[0m                           ]8;id=298390;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=578140;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#9\[2m9[0m]8;;\
[2;36m[01/08/26 16:11:58][0m[2;36m [0m[34mINFO    [0m [1m[[0mlogging_performance[1m][0m[1m([0mtika Setting owner[1m)[0m Took [1;36m0.89[0m seconds; [33mexception[0m=[3;91mFalse[0m  ]8;id=62701;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py\[2mcontext_managers.py[0m]8;;\[2m:[0m]8;id=141659;file:///home/qqor/crete/packages/crete/commons/logging/context_managers.py#23\[2m23[0m]8;;\
[2;36m                   [0m[2;36m [0m[34mINFO    [0m ===Evaluator [33mResult[0m===                                                              ]8;id=980936;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py\[2mevaluator.py[0m]8;;\[2m:[0m]8;id=231571;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/teams/evaluation/evaluator.py#204\[2m204[0m]8;;\
[2;36m                    [0m         PatchStatus.SOUND                                                                   [2m                [0m
[2;36m                    [0m         ===Evaluator [33mDiff[0m===                                                                [2m                [0m
[2;36m                    [0m         --- a/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         +++ b/tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java         [2m                [0m
[2;36m                    [0m         @@ [1;36m-20[0m,[1;36m28[0m +[1;36m20[0m,[1;36m19[0m @@                                                                 [2m                [0m
[2;36m                    [0m          import java.io.IOException;                                                        [2m                [0m
[2;36m                    [0m          import java.io.InputStream;                                                        [2m                [0m
[2;36m                    [0m          import java.nio.charset.StandardCharsets;                                          [2m                [0m
[2;36m                    [0m         -import java.nio.file.Files;                                                        [2m                [0m
[2;36m                    [0m         -import java.nio.file.Path;                                                         [2m                [0m
[2;36m                    [0m         -import java.nio.file.Paths;                                                        [2m                [0m
[2;36m                    [0m         -import java.nio.file.StandardCopyOption;                                           [2m                [0m
[2;36m                    [0m          import java.util.Locale;                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.FileUtils;                                            [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.FilenameUtils;                                        [2m                [0m
[2;36m                    [0m          import org.apache.commons.io.IOUtils;                                              [2m                [0m
[2;36m                    [0m         -import org.apache.commons.io.input.CloseShieldInputStream;                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         -import org.apache.tika.io.TikaInputStream;                                         [2m                [0m
[2;36m                    [0m          import org.apache.tika.metadata.Metadata;                                          [2m                [0m
[2;36m                    [0m          import org.apache.tika.metadata.Property;                                          [2m                [0m
[2;36m                    [0m          import org.apache.tika.metadata.TikaCoreProperties;                                [2m                [0m
[2;36m                    [0m          import org.apache.tika.mime.MediaType;                                             [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.FileProcessResult;                                    [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.ProcessUtils;                                         [2m                [0m
[2;36m                    [0m         -import org.apache.tika.utils.StringUtils;                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m          [35m/[0m**                                                                                [2m                [0m
[2;36m                    [0m         - * Simple detector to determine if a shell script is no-arg shell script.          [2m                [0m
[2;36m                    [0m         + * Simple detector to identify shell scripts by filename extension and shebang     [2m                [0m
[2;36m                    [0m         pattern.                                                                            [2m                [0m
[2;36m                    [0m         + * Note: As of this version, shell script execution during detection has been      [2m                [0m
[2;36m                    [0m         removed                                                                             [2m                [0m
[2;36m                    [0m         + * to prevent OS command injection vulnerabilities.                                [2m                [0m
[2;36m                    [0m           *[35m/[0m                                                                                [2m                [0m
[2;36m                    [0m          public class ShellCodeDetector implements Detector [1m{[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         @@ [1;36m-80[0m,[1;36m34[0m +[1;36m71[0m,[1;36m14[0m @@                                                                 [2m                [0m
[2;36m                    [0m                  if [1m([0m! isShell[1m)[0m [1m{[0m                                                           [2m                [0m
[2;36m                    [0m                      return MediaType.OCTET_STREAM;                                         [2m                [0m
[2;36m                    [0m                  [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        String fileName = [1;35mmetadata.get[0m[1m([0mTikaCoreProperties.RESOURCE_NAME_KEY[1m)[0m;      [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mStringUtils.isBlank[0m[1m([0mfileName[1m)[0m[1m)[0m [1m{[0m                                       [2m                [0m
[2;36m                    [0m         -            return [1;35misShell[0m[1m([0misShell[1m)[0m;                                               [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        [35m/[0m[35m/[0m[95mnow[0m test for no-arg shell script                                         [2m                [0m
[2;36m                    [0m         -        TikaInputStream tis =                                                      [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1m([0m[1;35mCloseShieldInputStream.wrap[0m[1m([0minput[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mFilenameUtils.getName[0m[1m([0mfileName[1m)[0m;                                [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m, [32m""[0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        fileName = [1;35mfileName.replaceAll[0m[1m([0m[32m"\\.\\."[0m, [32m""[0m[1m)[0m;                              [2m                [0m
[2;36m                    [0m         -                                                                                   [2m                [0m
[2;36m                    [0m         -        if [1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m > MAX_LENGTH[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -            fileName = [1;35mfileName.substring[0m[1m([0m[1;35mfileName.length[0m[1m([0m[1m)[0m - MAX_LENGTH[1m)[0m;         [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        Path cwd = [1;35mPaths.get[0m[1m([0m[32m"."[0m[1m)[0m[1;35m.toAbsolutePath[0m[1m([0m[1m)[0m[1;35m.normalize[0m[1m([0m[1m)[0m;                    [2m                [0m
[2;36m                    [0m         -        Path tmpDir = [1;35mFiles.createTempDirectory[0m[1m([0mcwd, [32m"tika-shell-detect-"[0m[1m)[0m;        [2m                [0m
[2;36m                    [0m         -        Path tmpFile = [1;35mtmpDir.resolve[0m[1m([0mfileName[1m)[0m;                                   [2m                [0m
[2;36m                    [0m         -        [1;35mFiles.copy[0m[1m([0m[1;35mtis.getPath[0m[1m([0m[1m)[0m, tmpFile, StandardCopyOption.REPLACE_EXISTING[1m)[0m;   [2m                [0m
[2;36m                    [0m         -        ProcessBuilder pb = new [1;35mProcessBuilder[0m[1m([0mfileName[1m)[0m;                          [2m                [0m
[2;36m                    [0m         -        [1;35mpb.directory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                                             [2m                [0m
[2;36m                    [0m         -        try [1m{[0m                                                                      [2m                [0m
[2;36m                    [0m         -            FileProcessResult result = [1;35mProcessUtils.execute[0m[1m([0mpb, [1;36m20000[0m, [1;36m100000[0m,     [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1m)[0m;                                                                            [2m                [0m
[2;36m                    [0m         -            if [1m([0m[1;35mresult.getExitValue[0m[1m([0m[1m)[0m == [1;36m0[0m[1m)[0m [1m{[0m                                      [2m                [0m
[2;36m                    [0m         -                [1;35mmetadata.set[0m[1m([0mSHELL_NO_ARGS, true[1m)[0m;                                 [2m                [0m
[2;36m                    [0m         -            [1m}[0m                                                                      [2m                [0m
[2;36m                    [0m         -        [1m}[0m finally [1m{[0m                                                                [2m                [0m
[2;36m                    [0m         -            [1;35mFileUtils.deleteDirectory[0m[1m([0m[1;35mtmpDir.toFile[0m[1m([0m[1m)[0m[1m)[0m;                            [2m                [0m
[2;36m                    [0m         -        [1m}[0m                                                                          [2m                [0m
[2;36m                    [0m         -        return SHELL_SCRIPT;                                                       [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m Security fix: Shell script execution during detection has been removed  [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m to prevent OS command injection vulnerability.                          [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m Shell scripts are still correctly detected by:                          [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m [1;36m1[0m. File extension analysis [1m([0m.sh, .bash[1m)[0m                                 [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m [1;36m2[0m. Shebang pattern detection [1m([0m#![35m/bin/[0m[95msh[0m, #![35m/bin/[0m[95mbash[0m, etc.[1m)[0m             [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m The SHELL_NO_ARGS metadata is no longer set as it required executing    [2m                [0m
[2;36m                    [0m         +        [35m/[0m[35m/[0m untrusted code.                                                         [2m                [0m
[2;36m                    [0m         +        return [1;35misShell[0m[1m([0misShell[1m)[0m;                                                   [2m                [0m
[2;36m                    [0m              [1m}[0m                                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m              private MediaType [1;35misShell[0m[1m([0mboolean isShell[1m)[0m [1m{[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===Patch [33mResult[0m===                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ===[33mIssue[0m===                                                                         [2m                [0m
[2;36m                    [0m         == Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS [2m                [0m
[2;36m                    [0m         Command Injection                                                                   [2m                [0m
[2;36m                    [0m         Executing OS commands with attacker-controlled data can lead to remote code         [2m                [0m
[2;36m                    [0m         execution.                                                                          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1m([0mOsC [2m                [0m
[2;36m                    [0m         ommandInjection.jav[1;92ma:63[0m[1m)[0m                                                            [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1110[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at java.base/[1;35mjava.lang.ProcessBuilder.start[0m[1m([0mProcessBuilder.jav[1;92ma:1073[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1m([0mProcessUtils.jav[1;92ma:94[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1m([0mShellCodeDetector.jav[1;92ma:103[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1m([0mCompositeDetector.jav[1;92ma:84[0m[1m)[0m          [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         org.apache.tika.cli.TikaCLI$[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1m([0mTikaCLI.jav [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1m)[0m                                                                             [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1m([0mPackageParser.jav[1;92ma:481[0m[1m)[0m         [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1m([0mPackageParser.jav[1;92ma:386[0m[1m)[0m       [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1m([0mPackageParser.jav[1;92ma:336[0m[1m)[0m  [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1m([0mPackageParser.jav[1;92ma:259[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.CompositeParser.parse[0m[1m([0mCompositeParser.jav[1;92ma:298[0m[1m)[0m   [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1m([0mAutoDetectParser.jav[1;92ma:204[0m[1m)[0m [2m                [0m
[2;36m                    [0m                 at org.apache.tika.cli.TikaCLI$[1;35mOutputType.process[0m[1m([0mTikaCLI.jav[1;92ma:1056[0m[1m)[0m        [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.process[0m[1m([0mTikaCLI.jav[1;92ma:485[0m[1m)[0m                    [2m                [0m
[2;36m                    [0m                 at [1;35morg.apache.tika.cli.TikaCLI.main[0m[1m([0mTikaCLI.jav[1;92ma:237[0m[1m)[0m                       [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:74[0m[1m)[0m           [2m                [0m
[2;36m                    [0m                 at                                                                          [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1m([0mTikaAppUnpackerFuzzer.jav[1;92ma:54[0m[1m)[0m [2m                [0m
[2;36m                    [0m         DEDUP_TOKEN: d7514645016ef7a8                                                       [2m                [0m
[2;36m                    [0m         == libFuzzer crashing input ==                                                      [2m                [0m
[2;36m                    [0m         ===Evaluation [33mReport[0m===                                                             [2m                [0m
[2;36m                    [0m         # Evaluation Report                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Summary                                                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The initial issue identified an OS Command Injection vulnerability                  [2m                [0m
[2;36m                    [0m         [1m([0mcom.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical[1m)[0m in Apache Tika's     [2m                [0m
[2;36m                    [0m         ShellCodeDetector class. The vulnerability occurs when the detector attempts to     [2m                [0m
[2;36m                    [0m         execute shell scripts with attacker-controlled data during the media type detection [2m                [0m
[2;36m                    [0m         process. A patch was attempted that removes the vulnerable code execution logic     [2m                [0m
[2;36m                    [0m         from ShellCodeDetector.java and attempts to disable the detector by default in the  [2m                [0m
[2;36m                    [0m         service configuration file. However, the patch application partially failed because [2m                [0m
[2;36m                    [0m         the META-INF/services configuration file could not be modified due to a permissions [2m                [0m
[2;36m                    [0m         error, though the Java source code changes appear to have been applied              [2m                [0m
[2;36m                    [0m         successfully.                                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Description                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Initial Issue                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The vulnerability manifests during the parsing of embedded documents within package [2m                [0m
[2;36m                    [0m         files. The stack trace shows:                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. The entry point is through TikaAppUnpackerFuzzer, which calls [1;35mTikaCLI.main[0m[1m([0m[1m)[0m to  [2m                [0m
[2;36m                    [0m         process input                                                                       [2m                [0m
[2;36m                    [0m         [1;36m2[0m. The AutoDetectParser processes the input, delegating to CompositeParser          [2m                [0m
[2;36m                    [0m         [1;36m3[0m. During PackageParser processing of embedded entries, the                         [2m                [0m
[2;36m                    [0m         FileEmbeddedDocumentExtractor attempts to parse each embedded document              [2m                [0m
[2;36m                    [0m         [1;36m4[0m. The CompositeDetector invokes [1;35mShellCodeDetector.detect[0m[1m([0m[1m)[0m on line [1;36m84[0m              [2m                [0m
[2;36m                    [0m         [1;36m5[0m. [1;35mShellCodeDetector.detect[0m[1m([0m[1m)[0m calls [1;35mProcessUtils.execute[0m[1m([0m[1m)[0m on line [1;36m103[0m              [2m                [0m
[2;36m                    [0m         [1;36m6[0m. This triggers [1;35mProcessBuilder.start[0m[1m([0m[1m)[0m which executes an OS command                [2m                [0m
[2;36m                    [0m         [1;36m7[0m. The security sanitizer [1m([0mOsCommandInjection.processImplStartHook[1m)[0m detects         [2m                [0m
[2;36m                    [0m         attacker-controlled data being used in OS command execution and raises a            [2m                [0m
[2;36m                    [0m         FuzzerSecurityIssueCritical exception                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The vulnerability is categorized as critical because executing OS commands with     [2m                [0m
[2;36m                    [0m         attacker-controlled data can lead to remote code execution.                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Patch Attempt                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The patch consists of two modifications:                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         **[1;36m1[0m. ShellCodeDetector.java modification:**                                         [2m                [0m
[2;36m                    [0m         - Lines [1;36m83[0m-[1;36m110[0m of the original code are replaced with a simplified implementation   [2m                [0m
[2;36m                    [0m         - The removed code performed the following operations:                              [2m                [0m
[2;36m                    [0m           - Retrieved the filename from metadata [1m([0mTikaCoreProperties.RESOURCE_NAME_KEY[1m)[0m     [2m                [0m
[2;36m                    [0m           - Sanitized the filename by removing non-alphanumeric characters [1m([0mexcept hyphens, [2m                [0m
[2;36m                    [0m         underscores, and dots[1m)[0m                                                              [2m                [0m
[2;36m                    [0m           - Truncated long filenames to MAX_LENGTH characters                               [2m                [0m
[2;36m                    [0m           - Created a temporary directory using [1;35mFiles.createTempDirectory[0m[1m([0m[1m)[0m                 [2m                [0m
[2;36m                    [0m           - Copied the input stream content to a temporary file in that directory           [2m                [0m
[2;36m                    [0m           - Created a ProcessBuilder to execute the filename as a command                   [2m                [0m
[2;36m                    [0m           - Executed the process with a [1;36m20[0m-second timeout using [1;35mProcessUtils.execute[0m[1m([0m[1m)[0m      [2m                [0m
[2;36m                    [0m           - Set SHELL_NO_ARGS metadata if the process exited successfully                   [2m                [0m
[2;36m                    [0m           - Cleaned up the temporary directory                                              [2m                [0m
[2;36m                    [0m           - Returned SHELL_SCRIPT MediaType                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         - The new implementation:                                                           [2m                [0m
[2;36m                    [0m           - Immediately returns [1;35misShell[0m[1m([0misShell[1m)[0m after determining the file is a shell      [2m                [0m
[2;36m                    [0m         script                                                                              [2m                [0m
[2;36m                    [0m           - Adds a comment explaining that shell script execution during detection has been [2m                [0m
[2;36m                    [0m         removed for security reasons                                                        [2m                [0m
[2;36m                    [0m           - Notes that shell scripts are still detected by filename and shebang analysis    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         **[1;36m2[0m. META-INF/services/org.apache.tika.detect.Detector modification:**              [2m                [0m
[2;36m                    [0m         - Attempts to comment out the line [32m"org.apache.tika.detect.ShellCodeDetector"[0m       [2m                [0m
[2;36m                    [0m         - Adds explanatory comments indicating the detector is disabled due to OS Command   [2m                [0m
[2;36m                    [0m         Injection vulnerability                                                             [2m                [0m
[2;36m                    [0m         - Notes that the detector can still be manually configured if needed                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Patch Application Result                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         The patch application resulted in a mixed outcome:                                  [2m                [0m
[2;36m                    [0m         - The Java source file modification [1m([0mShellCodeDetector.java[1m)[0m appears to have been   [2m                [0m
[2;36m                    [0m         processed                                                                           [2m                [0m
[2;36m                    [0m         - The service configuration file modification failed with: [32m"Permission denied: [0m     [2m                [0m
[2;36m                    [0m         [32m'/home/qqor/crete/.cache/official-afc-tika/tika-core/src/main/resources/META-INF/se[0m [2m                [0m
[2;36m                    [0m         [32mrvices/org.apache.tika.detect.Detector' cannot be modified because it is not a [0m     [2m                [0m
[2;36m                    [0m         [32mvalid language file"[0m                                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         This error suggests that the patching system has restrictions on which files can be [2m                [0m
[2;36m                    [0m         modified, specifically preventing modifications to non-source code files such as    [2m                [0m
[2;36m                    [0m         service descriptor files.                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ### Areas for Further Investigation                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         To obtain a holistic view of this security issue, the following areas should be     [2m                [0m
[2;36m                    [0m         investigated:                                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m. **[1;35mProcessUtils.execute[0m[1m([0m[1m)[0m implementation** - Understanding the complete           [2m                [0m
[2;36m                    [0m         implementation of this utility method and whether it has any built-in sanitization  [2m                [0m
[2;36m                    [0m         or validation mechanisms                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m. **ShellCodeDetector usage patterns** - Identifying all code paths that invoke    [2m                [0m
[2;36m                    [0m         ShellCodeDetector and whether there are configuration options to disable it         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m. **Alternative detection mechanisms** - Examining whether the filename and        [2m                [0m
[2;36m                    [0m         shebang-based detection [1m([0mmentioned in the patch comment[1m)[0m is sufficient for the use  [2m                [0m
[2;36m                    [0m         cases that previously relied on actual script execution                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m. **Service loader configuration** - Understanding how Tika's detector service     [2m                [0m
[2;36m                    [0m         loading mechanism works and whether the ShellCodeDetector can be effectively        [2m                [0m
[2;36m                    [0m         disabled through other configuration means if the service file cannot be modified   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m. **Impact assessment** - Determining which Tika features and parsing workflows    [2m                [0m
[2;36m                    [0m         depend on ShellCodeDetector functionality and what functionality would be lost by   [2m                [0m
[2;36m                    [0m         removing script execution                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m. **Input validation in PackageParser** - Reviewing how PackageParser and          [2m                [0m
[2;36m                    [0m         FileEmbeddedDocumentExtractor handle embedded content and whether additional        [2m                [0m
[2;36m                    [0m         validation should be implemented at earlier stages                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m7[0m. **TikaCLI security configuration** - Examining whether TikaCLI has security      [2m                [0m
[2;36m                    [0m         configuration options that could prevent execution of potentially dangerous         [2m                [0m
[2;36m                    [0m         detectors                                                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m8[0m. **Testing coverage** - Identifying existing tests that may break due to the      [2m                [0m
[2;36m                    [0m         removal of shell script execution functionality                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         ## Initial Issue Log                                                                [2m                [0m
[2;36m                    [0m         Here is the initial issue log of the codebase:                                      [2m                [0m
[2;36m                    [0m         [1m<[0m[1;95missue[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m== Java Exception: com.code_intelligence.jazzer.api.FuzzerSecurityIssueCritical: OS[0m [2m                [0m
[2;36m                    [0m         [39mCommand Injection[0m                                                                   [2m                [0m
[2;36m                    [0m         [39mExecuting OS commands with attacker-controlled data can lead to remote code [0m        [2m                [0m
[2;36m                    [0m         [39mexecution.[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.code_intelligence.jazzer.sanitizers.OsCommandInjection.processImplStartHook[0m[1;39m([0m[39mOsC[0m [2m                [0m
[2;36m                    [0m         [39mommandInjection.jav[0m[1;92ma:63[0m[1;39m)[0m                                                            [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1110[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat java.base/[0m[1;35mjava.lang.ProcessBuilder.start[0m[1;39m([0m[39mProcessBuilder.jav[0m[1;92ma:1073[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.utils.ProcessUtils.execute[0m[1;39m([0m[39mProcessUtils.jav[0m[1;92ma:94[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.ShellCodeDetector.detect[0m[1;39m([0m[39mShellCodeDetector.jav[0m[1;92ma:103[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.detect.CompositeDetector.detect[0m[1;39m([0m[39mCompositeDetector.jav[0m[1;92ma:84[0m[1;39m)[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [39morg.apache.tika.cli.TikaCLI$[0m[1;35mFileEmbeddedDocumentExtractor.parseEmbedded[0m[1;39m([0m[39mTikaCLI.jav[0m [2m                [0m
[2;36m                    [0m         [1;92ma:1092[0m[1;39m)[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntry[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:481[0m[1;39m)[0m         [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35morg.apache.tika.parser.pkg.PackageParser.parseEntries[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:386[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser._parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:336[0m[1;39m)[0m  [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.pkg.PackageParser.parse[0m[1;39m([0m[39mPackageParser.jav[0m[1;92ma:259[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.CompositeParser.parse[0m[1;39m([0m[39mCompositeParser.jav[0m[1;92ma:298[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.parser.AutoDetectParser.parse[0m[1;39m([0m[39mAutoDetectParser.jav[0m[1;92ma:204[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat org.apache.tika.cli.TikaCLI$[0m[1;35mOutputType.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:1056[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.process[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:485[0m[1;39m)[0m                    [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m[1;35morg.apache.tika.cli.TikaCLI.main[0m[1;39m([0m[39mTikaCLI.jav[0m[1;92ma:237[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.parseOne[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:74[0m[1;39m)[0m           [2m                [0m
[2;36m                    [0m         [39m        [0m[39mat [0m                                                                         [2m                [0m
[2;36m                    [0m         [1;35mcom.example.TikaAppUnpackerFuzzer.fuzzerTestOneInput[0m[1;39m([0m[39mTikaAppUnpackerFuzzer.jav[0m[1;92ma:54[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [39mDEDUP_TOKEN: d7514645016ef7a8[0m                                                       [2m                [0m
[2;36m                    [0m         [39m== libFuzzer crashing input ==[0m                                                      [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95missue[0m[39m>[0m                                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Additional Issue Log[0m                                                             [2m                [0m
[2;36m                    [0m         [39mHere is the additional issue log after the last patch attempt:[0m                      [2m                [0m
[2;36m                    [0m         [39m<additional_issue>[0m                                                                  [2m                [0m
[2;36m                    [0m         [39mPermission denied: [0m                                                                 [2m                [0m
[2;36m                    [0m         [32m'/home/qqor/crete/.cache/official-afc-tika/tika-core/src/main/resources/META-INF/se[0m [2m                [0m
[2;36m                    [0m         [32mrvices/org.apache.tika.detect.Detector'[0m[39m cannot be modified because it is not a [0m     [2m                [0m
[2;36m                    [0m         [39mvalid language file[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95madditional_issue[0m[39m>[0m                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Notes[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m- All patch attempts are applied to the initial codebase. Reapply the the previous [0m [2m                [0m
[2;36m                    [0m         [39mpatches if needed.[0m                                                                  [2m                [0m
[2;36m                    [0m         [39m- If multiple different issues are present, all the issues must be resolved in a [0m   [2m                [0m
[2;36m                    [0m         [39msingle patch attempt.[0m                                                               [2m                [0m
[2;36m                    [0m         [39m- Try different approaches to resolve the issues.[0m                                   [2m                [0m
[2;36m                    [0m         [39m===Analysis [0m[33mReport[0m[39m===[0m                                                               [2m                [0m
[2;36m                    [0m         [39m# Analysis Report[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Relevant Code Snippets[0m                                                           [2m                [0m
[2;36m                    [0m         [39m<code_snippets>[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:1[0m[39m-[0m[1;36m41[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:[0m[35m/[0m[39m*[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m: * Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m: * contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m: * this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m: * The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m: * [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m: * the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m: *[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m: *     [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m: *[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m: * Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m: * distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m: * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m: * See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m: * limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:package org.apache.tika.detect;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.EOFException;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.commons.io.FileUtils;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:46[0m[39m-[0m[1;36m119[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/META-INF/services/org.apache.tika.detect.Detector:[0m[1;36m1[0m[39m-[0m[1;36m16[0m [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:#  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:#  contributor license agreements.  See the NOTICE file distributed with[0m          [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:#  this work for additional information regarding copyright ownership.[0m            [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:#  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m        [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:#  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m           [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:#  the License.  You may obtain a copy of the License at[0m                          [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:#       [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:#[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:#  Unless required by applicable law or agreed to in writing, software[0m           [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:#  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m             [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m      [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:#  See the License for the specific language governing permissions and[0m           [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:#  limitations under the License.[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:org.apache.tika.detect.ShellCodeDetector[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/CompositeDetector.jav[0m[1;92ma:36[0m[39m-[0m[1;36m135[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:public class CompositeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:    private static final long serialVersionUID = 5980683158436430252L;[0m           [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    private final MediaTypeRegistry registry;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private final List<Detector> detectors;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:                             Collection<Class<? extends Detector>> [0m              [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:        if [0m[1;39m([0m[39mexcludeDetectors == null || [0m[1;35mexcludeDetectors.isEmpty[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:            this.detectors = detectors;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:            this.detectors = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:            for [0m[1;39m([0m[39mDetector d : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35misExcluded[0m[1;39m([0m[39mexcludeDetectors, [0m[1;35md.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:                    [0m[1;35mthis.detectors.add[0m[1;39m([0m[39md[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:                [0m[1;39m}[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        this.registry = registry;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mMediaTypeRegistry registry, List<Detector> [0m         [2m                [0m
[2;36m                    [0m         [39mdetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mregistry, detectors, null[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mList<Detector> detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mnew [0m[1;35mMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, detectors[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mCompositeDetector[0m[1;39m([0m[39mDetector[0m[33m...[0m[39m detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                            [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mArrays.asList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        MediaType override = [0m[1;35mdetectOverrides[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:        if [0m[1;39m([0m[39moverride != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:            return override;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        MediaType type = MediaType.OCTET_STREAM;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        [0m[35m/[0m[35m/[0m[95mwe[0m[39m have to iterate through all detectors because the override detector[0m [2m                [0m
[2;36m                    [0m         [39mmay[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[35m/[0m[35m/[0m[95mbe[0m[39m within a CompositeDetector[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        for [0m[1;39m([0m[39mDetector detector : [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                               [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:            MediaType detected = [0m[1;35mdetector.detect[0m[1;39m([0m[39minput, metadata[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            if [0m[1;39m([0m[1;35mregistry.isSpecializationOf[0m[1;39m([0m[39mdetected, type[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:                type = detected;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        return type;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:     * @param metadata[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:     * @return mediaType if a parseable mediatype was sent in via user or parser[0m [2m                [0m
[2;36m                    [0m         [39moverrides[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:    private static MediaType [0m[1;35mdetectOverrides[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        String override = [0m                                                       [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_USER_OVERRIDE[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:        override = [0m                                                             [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.CONTENT_TYPE_PARSER_OVERRIDE[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39moverride[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39moverride[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            if [0m[1;39m([0m[39mmt != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:        return null;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:     * Returns the component detectors.[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:    public List<Detector> [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:        return [0m[1;35mCollections.unmodifiableList[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:    private boolean [0m[1;35misExcluded[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m           [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                               Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:        return [0m[1;35mexcludeDetectors.contains[0m[1;39m([0m[39md[0m[1;39m)[0m[39m || [0m[1;35massignableFrom[0m[1;39m([0m[39mexcludeDetectors,[0m [2m                [0m
[2;36m                    [0m         [39md[0m[1;39m)[0m[39m;[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:    private boolean [0m[1;35massignableFrom[0m[1;39m([0m[39mCollection<Class<? extends Detector>> [0m       [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                                   Class<? extends Detector> d[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:        for [0m[1;39m([0m[39mClass<? extends Detector> e : excludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:            if [0m[1;39m([0m[1;35me.isAssignableFrom[0m[1;39m([0m[39md[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:                return true;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        return false;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/DefaultDetector.jav[0m[1;92ma:40[0m[39m-[0m[1;36m127[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:public class DefaultDetector extends CompositeDetector [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:     * Serial version UID[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:    private static final long serialVersionUID = -8170114575326908027L;[0m          [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:    private transient final ServiceLoader loader;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader,[0m                [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:                           Collection<Class<? extends Detector>> [0m                [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        [0m[1;35msuper[0m[1;39m([0m[1;35mtypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mtypes, loader, [0m  [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        this.loader = loader;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ServiceLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, loader, Collections.EMPTY_SET[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types, ClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[39mloader[0m[1;39m)[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mClassLoader loader[0m[1;39m)[0m[39m [0m[1;39m{[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[39m, loader[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[39mMimeTypes types[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[39mtypes, new [0m[1;35mServiceLoader[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    public [0m[1;35mDefaultDetector[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35mthis[0m[1;39m([0m[1;35mMimeTypes.getDefaultMimeTypes[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:     * Finds all statically loadable detectors and sort the list by name,[0m        [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:     * rather than discovery order. Detectors are used in the given order,[0m       [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:     * so put the Tika parsers last so that non-Tika [0m[1;39m([0m[39muser supplied[0m[1;39m)[0m             [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:     * parsers can take precedence.[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:     * <p>[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:     * If an [0m[1;39m{[0m[39m@link OverrideDetector[0m[1;39m}[0m[39m is loaded, it takes precedence over[0m        [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:     * all other detectors.[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:     *[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:     * @param loader service loader[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:     * @return ordered list of statically loadable detectors[0m                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:    private static List<Detector> [0m[1;35mgetDefaultDetectors[0m[1;39m([0m[39mMimeTypes types, [0m          [2m                [0m
[2;36m                    [0m         [39mServiceLoader loader,[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:                                                      Collection<Class<? extends[0m [2m                [0m
[2;36m                    [0m         [39mDetector>>[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                                              excludeDetectors[0m[1;39m)[0m[39m [0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        List<Detector> detectors =[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:                [0m[1;35mloader.loadStaticServiceProviders[0m[1;39m([0m[39mDetector.class, [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        [0m[1;35mServiceLoaderUtils.sortLoadedClasses[0m[1;39m([0m[39mdetectors[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        [0m[35m/[0m[35m/[0m[95mlook[0m[39m for the override index and put that first[0m                         [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        int overrideIndex = [0m[1;36m-1[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        int i = [0m[1;36m0[0m[39m;[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        for [0m[1;39m([0m[39mDetector detector : detectors[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            if [0m[1;39m([0m[39mdetector instanceof OverrideDetector[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                overrideIndex = i;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:                break;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            i++;[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        if [0m[1;39m([0m[39moverrideIndex > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Detector detector = [0m[1;35mdetectors.remove[0m[1;39m([0m[39moverrideIndex[0m[1;39m)[0m[39m;[0m                [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35mdetectors.add[0m[1;39m([0m[1;36m0[0m[39m, detector[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[35m/[0m[35m/[0m[39m Finally the Tika MimeTypes as a fallback[0m                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:        [0m[1;35mdetectors.add[0m[1;39m([0m[39mtypes[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        return detectors;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:    @Override[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    public List<Detector> [0m[1;35mgetDetectors[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39mloader != null && [0m[1;35mloader.isDynamic[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            List<Detector> detectors = [0m                                         [2m                [0m
[2;36m                    [0m         [1;35mloader.loadDynamicServiceProviders[0m[1;39m([0m[39mDetector.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:            if [0m[1;39m([0m[1;35mdetectors.size[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                [0m[1;35mdetectors.addAll[0m[1;39m([0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                return detectors;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                return [0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:            return [0m[1;35msuper.getDetectors[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m1[0m[39m-[0m[1;36m31[0m                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m:<?xml [0m[33mversion[0m[39m=[0m[32m"1[0m[32m.0"[0m[39m [0m[33mencoding[0m[39m=[0m[32m"UTF[0m[32m-8"[0m[39m?>[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m:<!--[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m:  Licensed to the Apache Software Foundation [0m[1;39m([0m[39mASF[0m[1;39m)[0m[39m under one or more[0m              [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m:  contributor license agreements.  See the NOTICE file distributed with[0m           [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m:  this work for additional information regarding copyright ownership.[0m             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m:  The ASF licenses this file to You under the Apache License, Version [0m[1;36m2.0[0m         [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m:  [0m[1;39m([0m[39mthe [0m[32m"License"[0m[1;39m)[0m[39m; you may not use this file except in compliance with[0m            [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m:  the License.  You may obtain a copy of the License at[0m                           [2m                [0m
[2;36m                    [0m         [1;36m9[0m[39m:[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m10[0m[39m:  [0m[4;94mhttp://www.apache.org/licenses/LICENSE-2.0[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m11[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m12[0m[39m:  Unless required by applicable law or agreed to in writing, software[0m            [2m                [0m
[2;36m                    [0m         [1;36m13[0m[39m:  distributed under the License is distributed on an [0m[32m"AS IS"[0m[39m BASIS,[0m              [2m                [0m
[2;36m                    [0m         [1;36m14[0m[39m:  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[0m       [2m                [0m
[2;36m                    [0m         [1;36m15[0m[39m:  See the License for the specific language governing permissions and[0m            [2m                [0m
[2;36m                    [0m         [1;36m16[0m[39m:  limitations under the License.[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m17[0m[39m:-->[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m18[0m[39m:<properties>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:<[0m[35m/[0m[95mproperties[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/java/org/[0m [2m                [0m
[2;36m                    [0m         [39mapache/tika/config/TikaDetectorConfigTest.jav[0m[1;92ma:41[0m[39m-[0m[1;36m72[0m                                [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:public class TikaDetectorConfigTest extends AbstractTikaConfigTest [0m[1;39m{[0m             [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:    @Test[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:    public void [0m[1;35mtestDetectorExcludeFromDefault[0m[1;39m([0m[1;39m)[0m[39m throws Exception [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:        TikaConfig config = [0m[1;35mgetConfig[0m[1;39m([0m[32m"TIKA-1702-detector-exclude.xml"[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:        [0m[1;35massertNotNull[0m[1;39m([0m[1;35mconfig.getParser[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:        [0m[1;35massertNotNull[0m[1;39m([0m[1;35mconfig.getDetector[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:        CompositeDetector detector = [0m[1;39m([0m[39mCompositeDetector[0m[1;39m)[0m[39m [0m[1;35mconfig.getDetector[0m[1;39m([0m[1;39m)[0m[39m;[0m   [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:        [0m[35m/[0m[35m/[0m[39m Should be wrapping two detectors[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[1;36m2[0m[39m, [0m[1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.size[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:        [0m[35m/[0m[35m/[0m[39m First should be DefaultDetector, second Empty, that order[0m             [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[39mDefaultDetector.class, [0m                                     [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[1;35m.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[39mEmptyDetector.class, [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m1[0m[1;39m)[0m[1;35m.getClass[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:        [0m[35m/[0m[35m/[0m[39m Get the DefaultDetector from the config[0m                               [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:        DefaultDetector confDetector = [0m[1;39m([0m[39mDefaultDetector[0m[1;39m)[0m[39m [0m                        [2m                [0m
[2;36m                    [0m         [1;35mdetector.getDetectors[0m[1;39m([0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;36m0[0m[1;39m)[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[35m/[0m[35m/[0m[39m Get a fresh [0m[32m"default"[0m[39m DefaultParser[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        DefaultDetector normDetector = new [0m                                      [2m                [0m
[2;36m                    [0m         [1;35mDefaultDetector[0m[1;39m([0m[1;35mconfig.getMimeRepository[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:        [0m[35m/[0m[35m/[0m[39m The default one will offer the Zip and POIFS detectors[0m                [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        [0m[1;35massertDetectors[0m[1;39m([0m[39mnormDetector, true, true[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:        [0m[35m/[0m[35m/[0m[39m The one from the config won't, as we excluded those[0m                   [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:        [0m[1;35massertDetectors[0m[1;39m([0m[39mconfDetector, false, false[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:1105[0m[39m-[0m[1;36m1136[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:        Detector [0m[1;35mcreateComposite[0m[1;39m([0m[39mClass<? extends Detector> detectorClass,[0m      [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:                                 List<Detector> childDetectors,[0m                [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:                                 Set<Class<? extends Detector>> [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors,[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:                                 Map<String, Param> params, MimeTypes [0m         [2m                [0m
[2;36m                    [0m         [39mmimeTypes,[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                                 ServiceLoader loader[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                throws InvocationTargetException, IllegalAccessException, [0m     [2m                [0m
[2;36m                    [0m         [39mInstantiationException [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:            Detector detector = null;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:            Constructor<? extends Detector> c;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:            MediaTypeRegistry registry = [0m[1;35mmimeTypes.getMediaTypeRegistry[0m[1;39m([0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:            [0m[35m/[0m[35m/[0m[39m Try the possible default and composite detector constructors[0m    [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                    c = detectorClass[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                            [0m[1;35m.getConstructor[0m[1;39m([0m[39mMimeTypes.class, [0m                  [2m                [0m
[2;36m                    [0m         [39mServiceLoader.class, Collection.class[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mmimeTypes, loader, [0m               [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:            if [0m[1;39m([0m[39mdetector == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:                try [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:                    c = detectorClass[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:                            [0m[1;35m.getConstructor[0m[1;39m([0m[39mMediaTypeRegistry.class, [0m          [2m                [0m
[2;36m                    [0m         [39mList.class, Collection.class[0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:                    detector = [0m[1;35mc.newInstance[0m[1;39m([0m[39mregistry, childDetectors, [0m        [2m                [0m
[2;36m                    [0m         [39mexcludeDetectors[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mNoSuchMethodException me[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:                    [0m[35m/[0m[35m/[0m[95mswallow[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/ServiceLoader.jav[0m[1;92ma:339[0m[39m-[0m[1;36m376[0m           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:    @[0m[1;35mSuppressWarnings[0m[1;39m([0m[32m"unchecked"[0m[1;39m)[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:    public <T> List<T> [0m[1;35mloadStaticServiceProviders[0m[1;39m([0m[39mClass<T> iface,[0m               [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:                                                  Collection<Class<? extends [0m   [2m                [0m
[2;36m                    [0m         [39mT>> excludes[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:        List<T> providers = new ArrayList<>[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:        if [0m[1;39m([0m[39mloader != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:            List<String> names = [0m[1;35midentifyStaticServiceProviders[0m[1;39m([0m[39miface[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:            for [0m[1;39m([0m[39mString name : names[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:                    Class<?> klass = [0m[1;35mloader.loadClass[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:                    if [0m[1;39m([0m[1;35miface.isAssignableFrom[0m[1;39m([0m[39mklass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                        [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:                        boolean shouldExclude = false;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m351[0m[39m:                        for [0m[1;39m([0m[39mClass<? extends T> ex : excludes[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m352[0m[39m:                            if [0m[1;39m([0m[1;35mex.isAssignableFrom[0m[1;39m([0m[39mklass[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m353[0m[39m:                                shouldExclude = true;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m354[0m[39m:                                break;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m355[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m356[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m357[0m[39m:                        if [0m[1;39m([0m[39m!shouldExclude[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m358[0m[39m:                            T instance = [0m[1;35mServiceLoaderUtils.newInstance[0m[1;39m([0m[39mklass, [0m [2m                [0m
[2;36m                    [0m         [39mthis[0m[1;39m)[0m[39m;[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m359[0m[39m:                            if [0m[1;39m([0m[39minstance instanceof Initializable[0m[1;39m)[0m[39m [0m[1;39m{[0m            [2m                [0m
[2;36m                    [0m         [1;36m360[0m[39m:                                [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m [0m                               [2m                [0m
[2;36m                    [0m         [39minstance[0m[1;39m)[0m[1;35m.initialize[0m[1;39m([0m[39mCollections.EMPTY_MAP[0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m361[0m[39m:                                [0m[1;39m([0m[1;39m([0m[39mInitializable[0m[1;39m)[0m[39m instance[0m[1;39m)[0m                      [2m                [0m
[2;36m                    [0m         [1;36m362[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.checkInitialization[0m[1;39m([0m[39minitializableProblemHandler[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m363[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m364[0m[39m:                            [0m[1;35mproviders.add[0m[1;39m([0m[39minstance[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m365[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m366[0m[39m:                    [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m367[0m[39m:                        throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                          [2m                [0m
[2;36m                    [0m         [1;36m368[0m[39m:                                [0m[32m"Class "[0m[39m + name + [0m[32m" is not of type: "[0m[39m + iface[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m369[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m370[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mThrowable t[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m371[0m[39m:                    [0m[1;35mhandler.handleLoadError[0m[1;39m([0m[39mname, t[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m372[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m373[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m374[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m375[0m[39m:        return providers;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m376[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:19[0m[39m-[0m[1;36m109[0m                      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import static java.nio.charset.StandardCharsets.UTF_8;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.BufferedReader;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.io.File;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.io.FileInputStream;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.io.FileOutputStream;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.io.InputStreamReader;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:import java.io.OutputStream;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import java.io.OutputStreamWriter;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import java.io.PrintStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import java.io.PrintWriter;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import java.io.Serializable;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:import java.io.UnsupportedEncodingException;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import java.io.Writer;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import java.lang.reflect.Field;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import java.net.URI;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import java.net.URL;[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import java.util.Arrays;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m42[0m[39m:import java.util.Comparator;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:import java.util.HashMap;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m:import java.util.HashSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m:import java.util.List;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:import java.util.Map;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:import java.util.Map.Entry;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:import java.util.Set;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:import java.util.TreeSet;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:import java.util.UUID;[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:import javax.xml.transform.OutputKeys;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m53[0m[39m:import javax.xml.transform.TransformerConfigurationException;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:import javax.xml.transform.sax.SAXTransformerFactory;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:import javax.xml.transform.sax.TransformerHandler;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:import javax.xml.transform.stream.StreamResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:import org.apache.logging.log4j.Level;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:import org.slf4j.Logger;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:import org.slf4j.LoggerFactory;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:import org.xml.sax.ContentHandler;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:import org.xml.sax.SAXException;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:import org.xml.sax.helpers.DefaultHandler;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:import org.apache.tika.Tika;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:import org.apache.tika.async.cli.TikaAsyncCLI;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:import org.apache.tika.config.TikaConfig;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:import org.apache.tika.config.TikaConfigSerializer;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:import org.apache.tika.detect.CompositeDetector;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:import org.apache.tika.detect.Detector;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:import org.apache.tika.exception.TikaException;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:import org.apache.tika.extractor.DefaultEmbeddedStreamTranslator;[0m                [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:import org.apache.tika.extractor.EmbeddedDocumentExtractor;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:import org.apache.tika.extractor.EmbeddedStreamTranslator;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:import org.apache.tika.fork.ForkParser;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:import org.apache.tika.gui.TikaGUI;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:import org.apache.tika.language.detect.LanguageHandler;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:import org.apache.tika.mime.MediaTypeRegistry;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:import org.apache.tika.mime.MimeType;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:import org.apache.tika.mime.MimeTypeException;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:import org.apache.tika.mime.MimeTypes;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:import org.apache.tika.parser.AutoDetectParser;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:import org.apache.tika.parser.CompositeParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:import org.apache.tika.parser.DigestingParser;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:import org.apache.tika.parser.NetworkParser;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:import org.apache.tika.parser.ParseContext;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:import org.apache.tika.parser.Parser;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:import org.apache.tika.parser.ParserDecorator;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:import org.apache.tika.parser.PasswordProvider;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:import org.apache.tika.parser.RecursiveParserWrapper;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:import org.apache.tika.parser.digestutils.CommonsDigester;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:import org.apache.tika.parser.pdf.PDFParserConfig;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:import org.apache.tika.sax.BasicContentHandlerFactory;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:import org.apache.tika.sax.BodyContentHandler;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:import org.apache.tika.sax.ContentHandlerFactory;[0m                               [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:import org.apache.tika.sax.ExpandedTitleContentHandler;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:import org.apache.tika.sax.RecursiveParserWrapperHandler;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:import org.apache.tika.sax.WriteOutContentHandler;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:import org.apache.tika.sax.boilerpipe.BoilerpipeContentHandler;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:import org.apache.tika.serialization.JsonMetadata;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:import org.apache.tika.serialization.JsonMetadataList;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:import org.apache.tika.xmp.XMPMetadata;[0m                                         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-app/src/main/java/org/apache/tika/cli/TikaCLI.jav[0m[1;92ma:1079[0m[39m-[0m[1;36m1182[0m                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m1079[0m[39m:    private class FileEmbeddedDocumentExtractor implements [0m                    [2m                [0m
[2;36m                    [0m         [39mEmbeddedDocumentExtractor [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m1080[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1081[0m[39m:        private final TikaConfig config = [0m[1;35mTikaConfig.getDefaultConfig[0m[1;39m([0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1082[0m[39m:        private final EmbeddedStreamTranslator embeddedStreamTranslator = new [0m [2m                [0m
[2;36m                    [0m         [1;35mDefaultEmbeddedStreamTranslator[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m1083[0m[39m:        private int count = [0m[1;36m0[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1084[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1085[0m[39m:        public boolean [0m[1;35mshouldParseEmbedded[0m[1;39m([0m[39mMetadata metadata[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m1086[0m[39m:            return true;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1087[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1088[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1089[0m[39m:        @Override[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1090[0m[39m:        public void [0m[1;35mparseEmbedded[0m[1;39m([0m[39mTikaInputStream tis, ContentHandler [0m         [2m                [0m
[2;36m                    [0m         [39mcontentHandler, Metadata metadata, boolean outputHtml[0m[1;39m)[0m[39m throws SAXException, [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m1091[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1092[0m[39m:            MediaType contentType = [0m[1;35mdetector.detect[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1093[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1094[0m[39m:            String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1095[0m[39m:            File outputFile = null;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1096[0m[39m:            if [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1097[0m[39m:                name = [0m[32m"file"[0m[39m + count++;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1098[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1099[0m[39m:            outputFile = [0m[1;35mgetOutputFile[0m[1;39m([0m[39mname, metadata, contentType[0m[1;39m)[0m[39m;[0m           [2m                [0m
[2;36m                    [0m         [1;36m1100[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1101[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1102[0m[39m:            File parent = [0m[1;35moutputFile.getParentFile[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1103[0m[39m:            if [0m[1;39m([0m[39m![0m[1;35mparent.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1104[0m[39m:                if [0m[1;39m([0m[39m![0m[1;35mparent.mkdirs[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m1105[0m[39m:                    throw new [0m[1;35mIOException[0m[1;39m([0m[32m"unable to create directory \""[0m[39m + [0m   [2m                [0m
[2;36m                    [0m         [39mparent + [0m[32m"\""[0m[1;39m)[0m[39m;[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m1106[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1107[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1108[0m[39m:            [0m[1;35mSystem.out.println[0m[1;39m([0m[32m"Extracting '"[0m[39m + name + [0m[32m"' [0m[32m([0m[32m"[0m[39m + contentType + [0m  [2m                [0m
[2;36m                    [0m         [32m"[0m[32m)[0m[32m to "[0m[39m + outputFile[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1109[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1110[0m[39m:            try [0m[1;39m([0m[39mFileOutputStream os = new [0m[1;35mFileOutputStream[0m[1;39m([0m[39moutputFile[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m     [2m                [0m
[2;36m                    [0m         [1;36m1111[0m[39m:                if [0m[1;39m([0m[1;35membeddedStreamTranslator.shouldTranslate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m [2m                [0m
[2;36m                    [0m         [1;36m1112[0m[39m:                    try [0m[1;39m([0m[39mInputStream translated = [0m                             [2m                [0m
[2;36m                    [0m         [1;35membeddedStreamTranslator.translate[0m[1;39m([0m[39mtis, metadata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m1113[0m[39m:                        [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtranslated, os[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1114[0m[39m:                    [0m[1;39m}[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m1115[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1116[0m[39m:                    [0m[1;35mIOUtils.copy[0m[1;39m([0m[39mtis, os[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1117[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1118[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1119[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1120[0m[39m:                [0m[35m/[0m[35m/[0m[39m being a CLI program messages should go to the stderr too[0m    [2m                [0m
[2;36m                    [0m         [1;36m1121[0m[39m:                [0m[35m/[0m[35m/[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m1122[0m[39m:                String msg = [0m[1;35mString.format[0m[1;39m([0m[39mLocale.ROOT, [0m[32m"Ignoring unexpected [0m  [2m                [0m
[2;36m                    [0m         [32mexception trying to save embedded file %s [0m[32m([0m[32m%s[0m[32m)[0m[32m"[0m[39m, name, [0m[1;35me.getMessage[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1123[0m[39m:                [0m[1;35mLOG.warn[0m[1;39m([0m[39mmsg, e[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m1124[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1125[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1126[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1127[0m[39m:        private File [0m[1;35mgetOutputFile[0m[1;39m([0m[39mString name, Metadata metadata, MediaType [0m  [2m                [0m
[2;36m                    [0m         [39mcontentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1128[0m[39m:            String ext = [0m[1;35mgetExtension[0m[1;39m([0m[39mcontentType[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m1129[0m[39m:            if [0m[1;39m([0m[1;35mname.indexOf[0m[1;39m([0m[32m'.'[0m[1;39m)[0m[39m == [0m[1;36m-1[0m[39m && contentType != null[0m[1;39m)[0m[39m [0m[1;39m{[0m              [2m                [0m
[2;36m                    [0m         [1;36m1130[0m[39m:                name += ext;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m1131[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1132[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1133[0m[39m:            String relID = [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.EMBEDDED_RELATIONSHIP_ID[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m1134[0m[39m:            if [0m[1;39m([0m[39mrelID != null && ![0m[1;35mname.startsWith[0m[1;39m([0m[39mrelID[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m1135[0m[39m:                name = relID + [0m[32m"_"[0m[39m + name;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1136[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1137[0m[39m:            [0m[35m/[0m[35m/[0m[95mdefensively[0m[39m do this so that we don't get an exception[0m            [2m                [0m
[2;36m                    [0m         [1;36m1138[0m[39m:            [0m[35m/[0m[35m/[0m[95mfrom[0m[39m FilenameUtils.normalize[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m1139[0m[39m:            name = [0m[1;35mname.replaceAll[0m[1;39m([0m[32m"\u0000"[0m[39m, [0m[32m" "[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1140[0m[39m:            String normalizedName = [0m[1;35mFilenameUtils.normalize[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m1141[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1142[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1143[0m[39m:                normalizedName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mname[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m1144[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1145[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1146[0m[39m:            if [0m[1;39m([0m[39mnormalizedName == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m1147[0m[39m:                normalizedName = [0m[32m"file"[0m[39m + count++ + ext;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1148[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1149[0m[39m:            [0m[35m/[0m[35m/[0m[95mstrip[0m[39m off initial C:[0m[35m/[0m[39m or ~[0m[35m/[0m[39m or [0m[35m/[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m1150[0m[39m:            int prefixLength = [0m[1;35mFilenameUtils.getPrefixLength[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m1151[0m[39m:            if [0m[1;39m([0m[39mprefixLength > [0m[1;36m-1[0m[1;39m)[0m[39m [0m[1;39m{[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1152[0m[39m:                normalizedName = [0m[1;35mnormalizedName.substring[0m[1;39m([0m[39mprefixLength[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1153[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1154[0m[39m:            File outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, normalizedName[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m1155[0m[39m:            [0m[35m/[0m[35m/[0m[95mif[0m[39m file already exists, prepend uuid[0m                             [2m                [0m
[2;36m                    [0m         [1;36m1156[0m[39m:            if [0m[1;39m([0m[1;35moutputFile.exists[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m1157[0m[39m:                String fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mnormalizedName[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m1158[0m[39m:                outputFile = new [0m[1;35mFile[0m[1;39m([0m[39mextractDir, UUID[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1159[0m[39m:                        [0m[1;35m.randomUUID[0m[1;39m([0m[1;39m)[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m1160[0m[39m:                        [0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[39m + [0m[32m"-"[0m[39m + fileName[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m1161[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1162[0m[39m:            return outputFile;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m1163[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1164[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1165[0m[39m:        private String [0m[1;35mgetExtension[0m[1;39m([0m[39mMediaType contentType[0m[1;39m)[0m[39m [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m1166[0m[39m:            try [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1167[0m[39m:                String ext = config[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m1168[0m[39m:                        [0m[1;35m.getMimeRepository[0m[1;39m([0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m1169[0m[39m:                        [0m[1;35m.forName[0m[1;39m([0m[1;35mcontentType.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m1170[0m[39m:                        [0m[1;35m.getExtension[0m[1;39m([0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m1171[0m[39m:                if [0m[1;39m([0m[39mext == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1172[0m[39m:                    return [0m[32m".bin"[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m1173[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1174[0m[39m:                    return ext;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m1175[0m[39m:                [0m[1;39m}[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m1176[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mMimeTypeException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m1177[0m[39m:                [0m[1;35me.printStackTrace[0m[1;39m([0m[1;39m)[0m[39m;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m1178[0m[39m:            [0m[1;39m}[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m1179[0m[39m:            return [0m[32m".bin"[0m[39m;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m1180[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m1181[0m[39m:        [0m[1;39m}[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m1182[0m[39m:    [0m[1;39m}[0m                                                                          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:767[0m[39m-[0m[1;36m788[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m767[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the list of children to exclude[0m                      [2m                [0m
[2;36m                    [0m         [1;36m768[0m[39m:                    Set<Class<? extends T>> excludeChildren = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m769[0m[39m:                    NodeList excludeChildNodes =[0m                                [2m                [0m
[2;36m                    [0m         [1;36m770[0m[39m:                            [0m[1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m  [2m                [0m
[2;36m                    [0m         [32m"-exclude"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m771[0m[39m:                    if [0m[1;39m([0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m772[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m773[0m[39m:                            Element excl = [0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mexcludeChildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m774[0m[39m:                            String exclName = [0m[1;35mexcl.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m775[0m[39m:                            try [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m776[0m[39m:                                excludeChildren[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m777[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.add[0m[1;39m([0m[1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, exclName[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m778[0m[39m:                            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mClassNotFoundException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m779[0m[39m:                                [0m[35m/[0m[35m/[0m[95mTIKA-3268[0m[39m -- This should stop the world.[0m      [2m                [0m
[2;36m                    [0m         [1;36m780[0m[39m:                                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                  [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:                                        [0m[32m"Class not found in -exclude list: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mexclName[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Create the Composite[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:                    loaded = [0m[1;35mcreateComposite[0m[1;39m([0m[39mloadedClass, children, [0m            [2m                [0m
[2;36m                    [0m         [39mexcludeChildren, params,[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:                            mimeTypes, loader[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/FileCommandDetector.jav[0m[1;92ma:57[0m[39m-[0m[1;36m183[0m      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:public class FileCommandDetector implements Detector [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:    [0m[35m/[0m[35m/[0m[95mTODO[0m[39m: file has some diff mimes names for some very common mimes[0m            [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:    [0m[35m/[0m[35m/[0m[95mshould[0m[39m we map file mimes to Tika mimes, e.g. text/xml -> application/xml??[0m [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:    public static Property FILE_MIME = [0m[1;35mProperty.externalText[0m[1;39m([0m[32m"file:mime"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:    private static final Logger LOGGER = [0m                                        [2m                [0m
[2;36m                    [0m         [1;35mLoggerFactory.getLogger[0m[1;39m([0m[39mFileCommandDetector.class[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:    private static final long DEFAULT_TIMEOUT_MS = [0m[1;36m6000[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:    private static final String DEFAULT_FILE_COMMAND_PATH = [0m[32m"file"[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:    private static boolean HAS_WARNED = false;[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:    private Boolean hasFileCommand = null;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:    private String fileCommandPath = DEFAULT_FILE_COMMAND_PATH;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:    private int maxBytes = 1_000_000;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:    private long timeoutMs = DEFAULT_TIMEOUT_MS;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:    private boolean useMime = false;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:    public static boolean [0m[1;35mcheckHasFile[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        return [0m[1;35mcheckHasFile[0m[1;39m([0m[39mDEFAULT_FILE_COMMAND_PATH[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:    public static boolean [0m[1;35mcheckHasFile[0m[1;39m([0m[39mString fileCommandPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                 [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m commandline = new String[0m[1;39m[[0m[1;39m][0m[1;39m{[0m[39mfileCommandPath, [0m[32m"-v"[0m[1;39m}[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:        return [0m[1;35mExternalParser.check[0m[1;39m([0m[39mcommandline[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:    [0m[1;39m}[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:    [0m[35m/[0m[39m**[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:     * @param input    document input stream, or <code>null<[0m[35m/[0m[95mcode[0m[39m>[0m               [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:     * @param metadata input metadata for the document[0m                           [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:     * @return mime as identified by the file command or [0m                        [2m                [0m
[2;36m                    [0m         [39mapplication/octet-stream otherwise[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:     * @throws IOException[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:     *[0m[35m/[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:    @Override[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        if [0m[1;39m([0m[39mhasFileCommand == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:            hasFileCommand = [0m[1;35mcheckHasFile[0m[1;39m([0m[39mthis.fileCommandPath[0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        if [0m[1;39m([0m[39m!hasFileCommand[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            if [0m[1;39m([0m[39m!HAS_WARNED[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:                [0m[1;35mLOGGER.warn[0m[1;39m([0m[32m"'file' command isn't working: '"[0m[39m + fileCommandPath [0m [2m                [0m
[2;36m                    [0m         [39m+ [0m[32m"'"[0m[1;39m)[0m[39m;[0m                                                                             [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:                HAS_WARNED = true;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        TikaInputStream tis = [0m[1;35mTikaInputStream.cast[0m[1;39m([0m[39minput[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:        if [0m[1;39m([0m[39mtis != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            [0m[35m/[0m[35m/[0m[95mspool[0m[39m the full file to disk, if called with a TikaInputStream[0m     [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[35m/[0m[35m/[0m[95mand[0m[39m there is no underlying file[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            return [0m[1;35mdetectOnPath[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, metadata[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;35minput.mark[0m[1;39m([0m[39mmaxBytes[0m[1;39m)[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        try [0m[1;39m([0m[39mTemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:            Path tmpFile = [0m[1;35mtmp.createTempFile[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                        [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:            [0m[1;35mFiles.copy[0m[1;39m([0m[39mnew [0m[1;35mBoundedInputStream[0m[1;39m([0m[39mmaxBytes, input[0m[1;39m)[0m[39m, tmpFile, [0m       [2m                [0m
[2;36m                    [0m         [39mREPLACE_EXISTING[0m[1;39m)[0m[39m;[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:            return [0m[1;35mdetectOnPath[0m[1;39m([0m[39mtmpFile, metadata[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:    private MediaType [0m[1;35mdetectOnPath[0m[1;39m([0m[39mPath path, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:        String[0m[1;39m[[0m[1;39m][0m[39m args =[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                new String[0m[1;39m[[0m[1;39m][0m[1;39m{[0m[1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[39mfileCommandPath[0m[1;39m)[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [32m"-b"[0m[39m, [0m[32m"--mime-type"[0m[39m,[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m                                                        [2m                [0m
[2;36m                    [0m         [1;35mProcessUtils.escapeCommandLine[0m[1;39m([0m[1;35mpath.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.toString[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;39m}[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:        ProcessBuilder builder = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39margs[0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:        FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mbuilder, timeoutMs, [0m    [2m                [0m
[2;36m                    [0m         [1;36m10000[0m[39m, [0m[1;36m10000[0m[1;39m)[0m[39m;[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:        if [0m[1;39m([0m[1;35mresult.isTimeout[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.IS_TIMEOUT, true[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:        if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m != [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:            [0m[1;35mmetadata.set[0m[1;39m([0m[39mExternalProcess.EXIT_VALUE, [0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:        String mimeString = [0m[1;35mresult.getStdout[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            return MediaType.OCTET_STREAM;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:        [0m[1;35mmetadata.set[0m[1;39m([0m[39mFILE_MIME, mimeString[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:        if [0m[1;39m([0m[39museMime[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            MediaType mt = [0m[1;35mMediaType.parse[0m[1;39m([0m[39mmimeString[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            if [0m[1;39m([0m[39mmt == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:                return MediaType.OCTET_STREAM;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:                return mt;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:    public void [0m[1;35msetFilePath[0m[1;39m([0m[39mString fileCommandPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m opens up a potential command vulnerability.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:        [0m[35m/[0m[35m/[0m[95mDon[0m[39m't ever let an untrusted user set this.[0m                            [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        this.fileCommandPath = fileCommandPath;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:        [0m[1;35mcheckHasFile[0m[1;39m([0m[39mthis.fileCommandPath[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m157[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m158[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m159[0m[39m:    public void [0m[1;35msetUseMime[0m[1;39m([0m[39mboolean useMime[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m160[0m[39m:        this.useMime = useMime;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m161[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m162[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m163[0m[39m:    public boolean [0m[1;35misUseMime[0m[1;39m([0m[1;39m)[0m[39m [0m[1;39m{[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m164[0m[39m:        return useMime;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m165[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m166[0m[39m:    [0m[35m/[0m[39m**[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m167[0m[39m:     * If this is not called on a TikaInputStream, this detector[0m                [2m                [0m
[2;36m                    [0m         [1;36m168[0m[39m:     * will spool up to this many bytes to a file to be detected[0m                [2m                [0m
[2;36m                    [0m         [1;36m169[0m[39m:     * by the [0m[32m'file'[0m[39m command.[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m170[0m[39m:     *[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m171[0m[39m:     * @param maxBytes[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m172[0m[39m:     *[0m[35m/[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m173[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m174[0m[39m:    public void [0m[1;35msetMaxBytes[0m[1;39m([0m[39mint maxBytes[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m175[0m[39m:        this.maxBytes = maxBytes;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m176[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m177[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m178[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m179[0m[39m:    public void [0m[1;35msetTimeoutMs[0m[1;39m([0m[39mlong timeoutMs[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m180[0m[39m:        this.timeoutMs = timeoutMs;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m181[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m182[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m183[0m[39m:[0m[1;39m}[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:87[0m[39m-[0m[1;36m110[0m        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:        TikaInputStream tis = [0m                                                   [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m      [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                         [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:        return SHELL_SCRIPT;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/utils/ProcessUtils.jav[0m[1;92ma:87[0m[39m-[0m[1;36m153[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m87[0m[39m:    public static FileProcessResult [0m[1;35mexecute[0m[1;39m([0m[39mProcessBuilder pb,[0m                   [2m                [0m
[2;36m                    [0m         [1;36m88[0m[39m:                                            long timeoutMillis,[0m                  [2m                [0m
[2;36m                    [0m         [1;36m89[0m[39m:                                            int maxStdoutBuffer, int [0m            [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m90[0m[39m:            throws IOException [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m91[0m[39m:        Process p = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m92[0m[39m:        String id = null;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m93[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m94[0m[39m:            p = [0m[1;35mpb.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m95[0m[39m:            id = [0m[1;35mregister[0m[1;39m([0m[39mp[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m96[0m[39m:            long elapsed = [0m[1;36m-1[0m[39m;[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m97[0m[39m:            long start = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [1;36m98[0m[39m:            StreamGobbler outGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getInputStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdoutBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m99[0m[39m:            StreamGobbler errGobbler = new [0m[1;35mStreamGobbler[0m[1;39m([0m[1;35mp.getErrorStream[0m[1;39m([0m[1;39m)[0m[39m, [0m    [2m                [0m
[2;36m                    [0m         [39mmaxStdErrBuffer[0m[1;39m)[0m[39m;[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:            Thread outThread = new [0m[1;35mThread[0m[1;39m([0m[39moutGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:            [0m[1;35moutThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m104[0m[39m:            Thread errThread = new [0m[1;35mThread[0m[1;39m([0m[39merrGobbler[0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m105[0m[39m:            [0m[1;35merrThread.start[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m106[0m[39m:            int exitValue = [0m[1;36m-1[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m107[0m[39m:            boolean complete = false;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m108[0m[39m:            try [0m[1;39m{[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m109[0m[39m:                complete = [0m[1;35mp.waitFor[0m[1;39m([0m[39mtimeoutMillis, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m110[0m[39m:                elapsed = [0m[1;35mSystem.currentTimeMillis[0m[1;39m([0m[1;39m)[0m[39m - start;[0m                   [2m                [0m
[2;36m                    [0m         [1;36m111[0m[39m:                if [0m[1;39m([0m[39mcomplete[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m112[0m[39m:                    exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:                [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:                    [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:                    [0m[1;35moutThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:                    [0m[1;35merrThread.join[0m[1;39m([0m[1;36m1000[0m[1;39m)[0m[39m;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m119[0m[39m:                    boolean completed = [0m[1;35mp.waitFor[0m[1;39m([0m[1;36m500[0m[39m, TimeUnit.MILLISECONDS[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m120[0m[39m:                    if [0m[1;39m([0m[39mcompleted[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m121[0m[39m:                        try [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m122[0m[39m:                            exitValue = [0m[1;35mp.exitValue[0m[1;39m([0m[1;39m)[0m[39m;[0m                          [2m                [0m
[2;36m                    [0m         [1;36m123[0m[39m:                        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mIllegalThreadStateException e[0m[1;39m)[0m[39m [0m[1;39m{[0m               [2m                [0m
[2;36m                    [0m         [1;36m124[0m[39m:                            [0m[35m/[0m[35m/[0m[95mnot[0m[39m finished![0m                                     [2m                [0m
[2;36m                    [0m         [1;36m125[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m126[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m127[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m128[0m[39m:            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mInterruptedException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m129[0m[39m:                exitValue = [0m[1;36m-1000[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m130[0m[39m:            [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m131[0m[39m:                [0m[1;35moutThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m132[0m[39m:                [0m[1;35merrThread.interrupt[0m[1;39m([0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m133[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m134[0m[39m:            FileProcessResult result = new [0m[1;35mFileProcessResult[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m135[0m[39m:            result.processTimeMillis = elapsed;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m136[0m[39m:            result.stderrLength = [0m[1;35merrGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m137[0m[39m:            result.stdoutLength = [0m[1;35moutGobbler.getStreamLength[0m[1;39m([0m[1;39m)[0m[39m;[0m                 [2m                [0m
[2;36m                    [0m         [1;36m138[0m[39m:            result.isTimeout = ! complete;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m139[0m[39m:            result.exitValue = exitValue;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m140[0m[39m:            result.stdout = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35moutGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m141[0m[39m:            result.stderr = [0m[1;35mStringUtils.joinWith[0m[1;39m([0m[32m"\n"[0m[39m, [0m[1;35merrGobbler.getLines[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m142[0m[39m:            result.stdoutTruncated = [0m[1;35moutGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m143[0m[39m:            result.stderrTruncated = [0m[1;35merrGobbler.getIsTruncated[0m[1;39m([0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m144[0m[39m:            return result;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m145[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m146[0m[39m:            if [0m[1;39m([0m[39mp != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m147[0m[39m:                [0m[1;35mp.destroyForcibly[0m[1;39m([0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m148[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m149[0m[39m:            if [0m[1;39m([0m[39mid != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:                [0m[1;35mrelease[0m[1;39m([0m[39mid[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:43[0m[39m-[0m[1;36m52[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m: * Simple detector to determine if a shell script is no-arg shell script.[0m        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:250[0m[39m-[0m[1;36m350[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m250[0m[39m:                      ParseContext context[0m[1;39m)[0m[39m throws IOException, SAXException, [0m  [2m                [0m
[2;36m                    [0m         [39mTikaException [0m[1;39m{[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m251[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m252[0m[39m:        [0m[35m/[0m[35m/[0m[39m Ensure that the stream supports the mark feature[0m                     [2m                [0m
[2;36m                    [0m         [1;36m253[0m[39m:        if [0m[1;39m([0m[39m![0m[1;35mstream.markSupported[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m254[0m[39m:            stream = new [0m[1;35mBufferedInputStream[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m255[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m256[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m257[0m[39m:        TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m                      [2m                [0m
[2;36m                    [0m         [1;36m258[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m259[0m[39m:            [0m[1;35m_parse[0m[1;39m([0m[39mstream, handler, metadata, context, tmp[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m260[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m261[0m[39m:            [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m262[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m263[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m264[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m265[0m[39m:    private void [0m[1;35m_parse[0m[1;39m([0m[39mInputStream stream, ContentHandler handler, Metadata [0m   [2m                [0m
[2;36m                    [0m         [39mmetadata,[0m                                                                           [2m                [0m
[2;36m                    [0m         [1;36m266[0m[39m:                ParseContext context, TemporaryResources tmp[0m[1;39m)[0m                   [2m                [0m
[2;36m                    [0m         [1;36m267[0m[39m:            throws TikaException, IOException, SAXException [0m[1;39m{[0m                   [2m                [0m
[2;36m                    [0m         [1;36m268[0m[39m:        ArchiveInputStream ais = null;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m269[0m[39m:        String encoding = null;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m270[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m271[0m[39m:            ArchiveStreamFactory factory =[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m272[0m[39m:                    [0m[1;35mcontext.get[0m[1;39m([0m[39mArchiveStreamFactory.class, new [0m                [2m                [0m
[2;36m                    [0m         [1;35mArchiveStreamFactory[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m273[0m[39m:            encoding = [0m[1;35mfactory.getEntryEncoding[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m274[0m[39m:            [0m[35m/[0m[35m/[0m[39m At the end we want to close the archive stream to release[0m        [2m                [0m
[2;36m                    [0m         [1;36m275[0m[39m:            [0m[35m/[0m[35m/[0m[39m any associated resources, but the underlying document stream[0m     [2m                [0m
[2;36m                    [0m         [1;36m276[0m[39m:            [0m[35m/[0m[35m/[0m[39m should not be closed[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m277[0m[39m:            [0m[35m/[0m[35m/[0m[95mTODO[0m[39m -- we've probably already detected the stream by here. We [0m   [2m                [0m
[2;36m                    [0m         [39mshould[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m278[0m[39m:            [0m[35m/[0m[35m/[0m[95mrely[0m[39m on that detection and not re-detect.[0m                         [2m                [0m
[2;36m                    [0m         [1;36m279[0m[39m:            encoding = [0m[1;35mfactory.getEntryEncoding[0m[1;39m([0m[1;39m)[0m[39m;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m280[0m[39m:                [0m[35m/[0m[35m/[0m[39m At the end we want to close the archive stream to release[0m    [2m                [0m
[2;36m                    [0m         [1;36m281[0m[39m:                [0m[35m/[0m[35m/[0m[39m any associated resources, but the underlying document stream[0m [2m                [0m
[2;36m                    [0m         [1;36m282[0m[39m:                [0m[35m/[0m[35m/[0m[39m should not be closed[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m283[0m[39m:            ais = [0m                                                              [2m                [0m
[2;36m                    [0m         [1;35mfactory.createArchiveInputStream[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m284[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m285[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mStreamingNotSupportedException sne[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m286[0m[39m:            [0m[35m/[0m[35m/[0m[39m Most archive formats work on streams, but a few need files[0m       [2m                [0m
[2;36m                    [0m         [1;36m287[0m[39m:            if [0m[1;39m([0m[1;35msne.getFormat[0m[1;39m([0m[1;39m)[0m[1;35m.equals[0m[1;39m([0m[39mArchiveStreamFactory.SEVEN_Z[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m         [2m                [0m
[2;36m                    [0m         [1;36m288[0m[39m:                [0m[35m/[0m[35m/[0m[39m Rework as a file, and wrap[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m289[0m[39m:                [0m[1;35mstream.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m290[0m[39m:                TikaInputStream tstream = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39mstream, tmp, [0m     [2m                [0m
[2;36m                    [0m         [39mmetadata[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m291[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m292[0m[39m:                [0m[35m/[0m[35m/[0m[39m Seven Zip suports passwords, was one given?[0m                  [2m                [0m
[2;36m                    [0m         [1;36m293[0m[39m:                String password = null;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m294[0m[39m:                PasswordProvider provider = [0m                                    [2m                [0m
[2;36m                    [0m         [1;35mcontext.get[0m[1;39m([0m[39mPasswordProvider.class[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m295[0m[39m:                if [0m[1;39m([0m[39mprovider != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m296[0m[39m:                    password = [0m[1;35mprovider.getPassword[0m[1;39m([0m[39mmetadata[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m297[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m298[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m299[0m[39m:                SevenZFile sevenz;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m300[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m301[0m[39m:                    SevenZFile.Builder builder = new [0m                           [2m                [0m
[2;36m                    [0m         [1;35mSevenZFile.Builder[0m[1;39m([0m[1;39m)[0m[1;35m.setFile[0m[1;39m([0m[1;35mtstream.getFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m302[0m[39m:                    if [0m[1;39m([0m[39mpassword == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m303[0m[39m:                        sevenz = [0m[1;35mbuilder.get[0m[1;39m([0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m304[0m[39m:                    [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m305[0m[39m:                        sevenz = [0m                                               [2m                [0m
[2;36m                    [0m         [1;35mbuilder.setPassword[0m[1;39m([0m[1;35mpassword.toCharArray[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m306[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m307[0m[39m:                [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mPasswordRequiredException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                         [2m                [0m
[2;36m                    [0m         [1;36m308[0m[39m:                    throw new [0m[1;35mEncryptedDocumentException[0m[1;39m([0m[39me[0m[1;39m)[0m[39m;[0m                    [2m                [0m
[2;36m                    [0m         [1;36m309[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m310[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m311[0m[39m:                [0m[35m/[0m[35m/[0m[39m Pending a fix for COMPRESS-[0m[1;36m269[0m[39m [0m[35m/[0m[39m TIKA-[0m[1;36m1525[0m[39m, this bit is a [0m   [2m                [0m
[2;36m                    [0m         [39mlittle nasty[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m312[0m[39m:                ais = new [0m[1;35mSevenZWrapper[0m[1;39m([0m[39msevenz[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m313[0m[39m:            [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m314[0m[39m:                [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m315[0m[39m:                throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"Unknown non-streaming format "[0m[39m + [0m      [2m                [0m
[2;36m                    [0m         [1;35msne.getFormat[0m[1;39m([0m[1;39m)[0m[39m, sne[0m[1;39m)[0m[39m;[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m316[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m317[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mArchiveException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m318[0m[39m:            tmp [0m[1;35m.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m319[0m[39m:            throw new [0m[1;35mTikaException[0m[1;39m([0m[32m"Unable to unpack document stream"[0m[39m, e[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m320[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m321[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m322[0m[39m:        [0m[1;35mupdateMediaType[0m[1;39m([0m[39mais, metadata[0m[1;39m)[0m[39m;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m323[0m[39m:        [0m[35m/[0m[35m/[0m[39m Use the delegate parser to parse the contained document[0m              [2m                [0m
[2;36m                    [0m         [1;36m324[0m[39m:        EmbeddedDocumentExtractor extractor =[0m                                   [2m                [0m
[2;36m                    [0m         [1;36m325[0m[39m:                [0m[1;35mEmbeddedDocumentUtil.getEmbeddedDocumentExtractor[0m[1;39m([0m[39mcontext[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m326[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m327[0m[39m:        XHTMLContentHandler xhtml = new [0m[1;35mXHTMLContentHandler[0m[1;39m([0m[39mhandler, metadata[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m328[0m[39m:        [0m[1;35mxhtml.startDocument[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m329[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m330[0m[39m:        [0m[35m/[0m[35m/[0m[39m mark before we start parsing entries for potential reset[0m             [2m                [0m
[2;36m                    [0m         [1;36m331[0m[39m:        [0m[1;35mstream.mark[0m[1;39m([0m[39mMARK_LIMIT[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m332[0m[39m:        [0m[35m/[0m[35m/[0m[95mneeded[0m[39m for mutable int by ref, not for thread safety.[0m                 [2m                [0m
[2;36m                    [0m         [1;36m333[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m keeps track of how many entries were processed.[0m                  [2m                [0m
[2;36m                    [0m         [1;36m334[0m[39m:        AtomicInteger entryCnt = new [0m[1;35mAtomicInteger[0m[1;39m([0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m335[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m336[0m[39m:            [0m[1;35mparseEntries[0m[1;39m([0m[39mais, metadata, extractor, xhtml, false, entryCnt[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m337[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mUnsupportedZipFeatureException zfe[0m[1;39m)[0m[39m [0m[1;39m{[0m                          [2m                [0m
[2;36m                    [0m         [1;36m338[0m[39m:            [0m[35m/[0m[35m/[0m[39m If this is a zip archive which requires a data descriptor, parse[0m [2m                [0m
[2;36m                    [0m         [39mit again[0m                                                                            [2m                [0m
[2;36m                    [0m         [1;36m339[0m[39m:            if [0m[1;39m([0m[1;35mzfe.getFeature[0m[1;39m([0m[1;39m)[0m[39m == Feature.DATA_DESCRIPTOR[0m[1;39m)[0m[39m [0m[1;39m{[0m                  [2m                [0m
[2;36m                    [0m         [1;36m340[0m[39m:                [0m[35m/[0m[35m/[0m[39m Close archive input stream and create a new one that could [0m  [2m                [0m
[2;36m                    [0m         [39mhandle data descriptor[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m341[0m[39m:                [0m[1;35mais.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [1;36m342[0m[39m:                [0m[35m/[0m[35m/[0m[39m An exception would be thrown if MARK_LIMIT is not big enough[0m [2m                [0m
[2;36m                    [0m         [1;36m343[0m[39m:                [0m[1;35mstream.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m344[0m[39m:                ais = new [0m                                                      [2m                [0m
[2;36m                    [0m         [1;35mZipArchiveInputStream[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39mstream[0m[1;39m)[0m[39m, encoding, true,[0m          [2m                [0m
[2;36m                    [0m         [1;36m345[0m[39m:                        true[0m[1;39m)[0m[39m;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m346[0m[39m:                [0m[1;35mparseEntries[0m[1;39m([0m[39mais, metadata, extractor, xhtml, true, entryCnt[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m347[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m348[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                             [2m                [0m
[2;36m                    [0m         [1;36m349[0m[39m:            [0m[1;35mais.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [1;36m350[0m[39m:            [0m[1;35mtmp.close[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-modules/tika-parser-pkg-mo[0m [2m                [0m
[2;36m                    [0m         [39mdule/src/main/java/org/apache/tika/parser/pkg/PackageParser.jav[0m[1;92ma:460[0m[39m-[0m[1;36m490[0m            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m460[0m[39m:                    [0m[1;35mgetEncodingDetector[0m[1;39m([0m[1;39m)[0m[1;35m.detect[0m[1;39m([0m                               [2m                [0m
[2;36m                    [0m         [1;36m461[0m[39m:                            [0m                                                    [2m                [0m
[2;36m                    [0m         [1;35mUnsynchronizedByteArrayInputStream.builder[0m[1;39m([0m[1;39m)[0m[1;35m.setByteArray[0m[1;39m([0m[39mextendedEntryName[0m[1;39m)[0m[1;35m.get[0m[1;39m([0m[1;39m)[0m[39m,[0m [2m                [0m
[2;36m                    [0m         [1;36m462[0m[39m:                            parentMetadata[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m463[0m[39m:            if [0m[1;39m([0m[39mcandidate != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m464[0m[39m:                name = new [0m[1;35mString[0m[1;39m([0m[1;39m([0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry[0m[1;39m)[0m[1;35m.getRawName[0m[1;39m([0m[1;39m)[0m[39m, [0m      [2m                [0m
[2;36m                    [0m         [39mcandidate[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m465[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m466[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m467[0m[39m:        [0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m468[0m[39m:        if [0m[1;39m([0m[1;35marchive.canReadEntryData[0m[1;39m([0m[39mentry[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m469[0m[39m:            [0m[35m/[0m[35m/[0m[39m Fetch the metadata on the entry contained in the archive[0m         [2m                [0m
[2;36m                    [0m         [1;36m470[0m[39m:            Metadata entrydata =[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m471[0m[39m:                    [0m[1;35mhandleEntryMetadata[0m[1;39m([0m[39mname, null, [0m                            [2m                [0m
[2;36m                    [0m         [1;35mentry.getLastModifiedDate[0m[1;39m([0m[1;39m)[0m[39m, [0m[1;35mentry.getSize[0m[1;39m([0m[1;39m)[0m[39m,[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m472[0m[39m:                            xhtml[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m473[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m474[0m[39m:            [0m[35m/[0m[35m/[0m[39m Recurse into the entry if desired[0m                                [2m                [0m
[2;36m                    [0m         [1;36m475[0m[39m:            if [0m[1;39m([0m[1;35mextractor.shouldParseEmbedded[0m[1;39m([0m[39mentrydata[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                     [2m                [0m
[2;36m                    [0m         [1;36m476[0m[39m:                [0m[35m/[0m[35m/[0m[39m For detectors to work, we need a mark/reset supporting[0m       [2m                [0m
[2;36m                    [0m         [1;36m477[0m[39m:                [0m[35m/[0m[35m/[0m[39m InputStream, which ArchiveInputStream isn't, so wrap[0m         [2m                [0m
[2;36m                    [0m         [1;36m478[0m[39m:                TemporaryResources tmp = new [0m[1;35mTemporaryResources[0m[1;39m([0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m479[0m[39m:                try [0m[1;39m{[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m480[0m[39m:                    TikaInputStream tis = [0m[1;35mTikaInputStream.get[0m[1;39m([0m[39marchive, tmp, [0m    [2m                [0m
[2;36m                    [0m         [39mentrydata[0m[1;39m)[0m[39m;[0m                                                                         [2m                [0m
[2;36m                    [0m         [1;36m481[0m[39m:                    [0m[1;35mextractor.parseEmbedded[0m[1;39m([0m[39mtis, xhtml, entrydata, true[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m482[0m[39m:                [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m483[0m[39m:                    [0m[1;35mtmp.dispose[0m[1;39m([0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [1;36m484[0m[39m:                [0m[1;39m}[0m                                                               [2m                [0m
[2;36m                    [0m         [1;36m485[0m[39m:            [0m[1;39m}[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m486[0m[39m:        [0m[1;39m}[0m[39m else [0m[1;39m{[0m                                                                [2m                [0m
[2;36m                    [0m         [1;36m487[0m[39m:            name = [0m[1;39m([0m[39mname == null[0m[1;39m)[0m[39m ? [0m[32m""[0m[39m : name;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m488[0m[39m:            if [0m[1;39m([0m[39mentry instanceof ZipArchiveEntry[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m489[0m[39m:                ZipArchiveEntry zipArchiveEntry = [0m[1;39m([0m[39mZipArchiveEntry[0m[1;39m)[0m[39m entry;[0m      [2m                [0m
[2;36m                    [0m         [1;36m490[0m[39m:                boolean usesEncryption = [0m                                       [2m                [0m
[2;36m                    [0m         [1;35mzipArchiveEntry.getGeneralPurposeBit[0m[1;39m([0m[1;39m)[0m[1;35m.usesEncryption[0m[1;39m([0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:54[0m[39m-[0m[1;36m86[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:113[0m[39m-[0m[1;36m118[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m41[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.EOFException;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.commons.io.FileUtils;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/resources/org/apache/tika/mime/tika-mimetypes.xml:[0m[1;36m5088[0m[39m-[0m[1;36m5095[0m      [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m5088[0m[39m:  <mime-type [0m[33mtype[0m[39m=[0m[32m"application[0m[32m/x-sh"[0m[39m>[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m5089[0m[39m:    <_comment>UNIX/LINUX Shell Script<[0m[35m/[0m[95m_comment[0m[39m>[0m                               [2m                [0m
[2;36m                    [0m         [1;36m5090[0m[39m:    <sub-class-of [0m[33mtype[0m[39m=[0m[32m"text[0m[32m/plain"[0m[35m/[0m[39m>[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m5091[0m[39m:  <[0m[35m/[0m[95mmime-type[0m[39m>[0m                                                                 [2m                [0m
[2;36m                    [0m         [1;36m5092[0m[39m:[0m                                                                               [2m                [0m
[2;36m                    [0m         [1;36m5093[0m[39m:  <mime-type [0m[33mtype[0m[39m=[0m[32m"application[0m[32m/x-shar"[0m[39m>[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m5094[0m[39m:    <glob [0m[33mpattern[0m[39m=[0m[32m"*.shar"[0m[35m/[0m[39m>[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m5095[0m[39m:  <[0m[35m/[0m[95mmime-type[0m[39m>[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/test/java/org/apache/tika/TikaDetectionTest.jav[0m[1;92ma:625[0m[39m-[0m[1;36m637[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m625[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-pkcs12"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.pfx"[0m[1;39m)[0m[1;39m)[0m[39m;[0m             [2m                [0m
[2;36m                    [0m         [1;36m626[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-pkcs7-certificates"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.p7b"[0m[1;39m)[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m627[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-pkcs7-certificates"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.spc"[0m[1;39m)[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m628[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-pkcs7-certreqresp"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.p7r"[0m[1;39m)[0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m629[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-rar-compressed"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.rar"[0m[1;39m)[0m[1;39m)[0m[39m;[0m     [2m                [0m
[2;36m                    [0m         [1;36m630[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-sh"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.sh"[0m[1;39m)[0m[1;39m)[0m[39m;[0m                  [2m                [0m
[2;36m                    [0m         [1;36m631[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-shar"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.shar"[0m[1;39m)[0m[1;39m)[0m[39m;[0m              [2m                [0m
[2;36m                    [0m         [1;36m632[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-shockwave-flash"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.swf"[0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m633[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-silverlight-app"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.xap"[0m[1;39m)[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m634[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-stuffit"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.sit"[0m[1;39m)[0m[1;39m)[0m[39m;[0m            [2m                [0m
[2;36m                    [0m         [1;36m635[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-stuffitx"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.sitx"[0m[1;39m)[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [1;36m636[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-sv4cpio"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.sv4cpio"[0m[1;39m)[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m637[0m[39m:        [0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-sv4crc"[0m[39m, [0m[1;35mtika.detect[0m[1;39m([0m[32m"x.sv4crc"[0m[1;39m)[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:43[0m[39m-[0m[1;36m52[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m43[0m[39m:[0m[35m/[0m[39m**[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m44[0m[39m: * Simple detector to determine if a shell script is no-arg shell script.[0m        [2m                [0m
[2;36m                    [0m         [1;36m45[0m[39m: *[0m[35m/[0m                                                                              [2m                [0m
[2;36m                    [0m         [1;36m46[0m[39m:public class ShellCodeDetector implements Detector [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m47[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m48[0m[39m:    public static final Property SHELL_NO_ARGS = [0m                                [2m                [0m
[2;36m                    [0m         [1;35mProperty.externalBoolean[0m[1;39m([0m[32m"sh:no_args"[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m49[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m50[0m[39m:    private static final int MAX_LENGTH = [0m[1;36m64[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m51[0m[39m:    private static final MediaType SHELL_SCRIPT = [0m[1;35mMediaType.application[0m[1;39m([0m[32m"x-sh"[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m52[0m[39m:    private static final int SNIFF_LENGTH = [0m[1;36m4[0m[39m;[0m                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:54[0m[39m-[0m[1;36m86[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m54[0m[39m:    public MediaType [0m[1;35mdetect[0m[1;39m([0m[39mInputStream input, Metadata metadata[0m[1;39m)[0m[39m throws [0m        [2m                [0m
[2;36m                    [0m         [39mIOException [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m55[0m[39m:        boolean isShell = false;[0m                                                 [2m                [0m
[2;36m                    [0m         [1;36m56[0m[39m:        String name = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m        [2m                [0m
[2;36m                    [0m         [1;36m57[0m[39m:        if [0m[1;39m([0m[39mname != null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m58[0m[39m:            name = [0m[1;35mname.toLowerCase[0m[1;39m([0m[39mLocale.ROOT[0m[1;39m)[0m[39m;[0m                                [2m                [0m
[2;36m                    [0m         [1;36m59[0m[39m:            if [0m[1;39m([0m[1;35mname.endsWith[0m[1;39m([0m[32m".sh"[0m[1;39m)[0m[39m || [0m[1;35mname.endsWith[0m[1;39m([0m[32m".bash"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m60[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m61[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m62[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m63[0m[39m:        if [0m[1;39m([0m[39minput == null[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m64[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m65[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m66[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m67[0m[39m:        try [0m[1;39m{[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m68[0m[39m:            [0m[1;35minput.mark[0m[1;39m([0m[39mSNIFF_LENGTH[0m[1;39m)[0m[39m;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m69[0m[39m:            byte[0m[1;39m[[0m[1;39m][0m[39m bytes = [0m[1;35mIOUtils.readFully[0m[1;39m([0m[39minput, SNIFF_LENGTH[0m[1;39m)[0m[39m;[0m               [2m                [0m
[2;36m                    [0m         [1;36m70[0m[39m:            String firstBytes = new [0m[1;35mString[0m[1;39m([0m[39mbytes, StandardCharsets.UTF_8[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m71[0m[39m:            if [0m[1;39m([0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!/"[0m[1;39m)[0m[39m || [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\\ "[0m[1;39m)[0m[39m [0m  [2m                [0m
[2;36m                    [0m         [39m||[0m                                                                                  [2m                [0m
[2;36m                    [0m         [1;36m72[0m[39m:                    [0m[1;35mfirstBytes.startsWith[0m[1;39m([0m[32m"#!\t"[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                             [2m                [0m
[2;36m                    [0m         [1;36m73[0m[39m:                isShell = true;[0m                                                  [2m                [0m
[2;36m                    [0m         [1;36m74[0m[39m:            [0m[1;39m}[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m75[0m[39m:        [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mEOFException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m76[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39mfalse[0m[1;39m)[0m[39m;[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m77[0m[39m:        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                              [2m                [0m
[2;36m                    [0m         [1;36m78[0m[39m:            [0m[1;35minput.reset[0m[1;39m([0m[1;39m)[0m[39m;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m79[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m80[0m[39m:        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m81[0m[39m:            return MediaType.OCTET_STREAM;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m82[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m83[0m[39m:        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [1;36m84[0m[39m:        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m85[0m[39m:            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                             [2m                [0m
[2;36m                    [0m         [1;36m86[0m[39m:        [0m[1;39m}[0m                                                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:113[0m[39m-[0m[1;36m118[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m113[0m[39m:    private MediaType [0m[1;35misShell[0m[1;39m([0m[39mboolean isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                [2m                [0m
[2;36m                    [0m         [1;36m114[0m[39m:        if [0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                          [2m                [0m
[2;36m                    [0m         [1;36m115[0m[39m:            return SHELL_SCRIPT;[0m                                                [2m                [0m
[2;36m                    [0m         [1;36m116[0m[39m:        [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [1;36m117[0m[39m:        return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m118[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/FileCommandDetector.jav[0m[1;92ma:150[0m[39m-[0m[1;36m156[0m     [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m150[0m[39m:    @Field[0m                                                                      [2m                [0m
[2;36m                    [0m         [1;36m151[0m[39m:    public void [0m[1;35msetFilePath[0m[1;39m([0m[39mString fileCommandPath[0m[1;39m)[0m[39m [0m[1;39m{[0m                           [2m                [0m
[2;36m                    [0m         [1;36m152[0m[39m:        [0m[35m/[0m[35m/[0m[95mthis[0m[39m opens up a potential command vulnerability.[0m                      [2m                [0m
[2;36m                    [0m         [1;36m153[0m[39m:        [0m[35m/[0m[35m/[0m[95mDon[0m[39m't ever let an untrusted user set this.[0m                            [2m                [0m
[2;36m                    [0m         [1;36m154[0m[39m:        this.fileCommandPath = fileCommandPath;[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m155[0m[39m:        [0m[1;35mcheckHasFile[0m[1;39m([0m[39mthis.fileCommandPath[0m[1;39m)[0m[39m;[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m156[0m[39m:    [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:100[0m[39m-[0m[1;36m103[0m       [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m100[0m[39m:        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m101[0m[39m:        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m102[0m[39m:        try [0m[1;39m{[0m                                                                   [2m                [0m
[2;36m                    [0m         [1;36m103[0m[39m:            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/config/TikaConfig.jav[0m[1;92ma:767[0m[39m-[0m[1;36m788[0m              [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m767[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Get the list of children to exclude[0m                      [2m                [0m
[2;36m                    [0m         [1;36m768[0m[39m:                    Set<Class<? extends T>> excludeChildren = new HashSet<>[0m[1;39m([0m[1;39m)[0m[39m;[0m  [2m                [0m
[2;36m                    [0m         [1;36m769[0m[39m:                    NodeList excludeChildNodes =[0m                                [2m                [0m
[2;36m                    [0m         [1;36m770[0m[39m:                            [0m[1;35melement.getElementsByTagName[0m[1;39m([0m[1;35mgetLoaderTagName[0m[1;39m([0m[1;39m)[0m[39m + [0m  [2m                [0m
[2;36m                    [0m         [32m"-exclude"[0m[1;39m)[0m[39m;[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m771[0m[39m:                    if [0m[1;39m([0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m > [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                    [2m                [0m
[2;36m                    [0m         [1;36m772[0m[39m:                        for [0m[1;39m([0m[39mint i = [0m[1;36m0[0m[39m; i < [0m[1;35mexcludeChildNodes.getLength[0m[1;39m([0m[1;39m)[0m[39m; i++[0m[1;39m)[0m [2m                [0m
[2;36m                    [0m         [1;39m{[0m                                                                                   [2m                [0m
[2;36m                    [0m         [1;36m773[0m[39m:                            Element excl = [0m[1;39m([0m[39mElement[0m[1;39m)[0m[39m [0m[1;35mexcludeChildNodes.item[0m[1;39m([0m[39mi[0m[1;39m)[0m[39m;[0m [2m                [0m
[2;36m                    [0m         [1;36m774[0m[39m:                            String exclName = [0m[1;35mexcl.getAttribute[0m[1;39m([0m[32m"class"[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [1;36m775[0m[39m:                            try [0m[1;39m{[0m                                               [2m                [0m
[2;36m                    [0m         [1;36m776[0m[39m:                                excludeChildren[0m                                 [2m                [0m
[2;36m                    [0m         [1;36m777[0m[39m:                                        [0m                                        [2m                [0m
[2;36m                    [0m         [1;35m.add[0m[1;39m([0m[1;35mloader.getServiceClass[0m[1;39m([0m[1;35mgetLoaderClass[0m[1;39m([0m[1;39m)[0m[39m, exclName[0m[1;39m)[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [1;36m778[0m[39m:                            [0m[1;39m}[0m[39m catch [0m[1;39m([0m[39mClassNotFoundException e[0m[1;39m)[0m[39m [0m[1;39m{[0m                [2m                [0m
[2;36m                    [0m         [1;36m779[0m[39m:                                [0m[35m/[0m[35m/[0m[95mTIKA-3268[0m[39m -- This should stop the world.[0m      [2m                [0m
[2;36m                    [0m         [1;36m780[0m[39m:                                throw new [0m[1;35mTikaConfigException[0m[1;39m([0m                  [2m                [0m
[2;36m                    [0m         [1;36m781[0m[39m:                                        [0m[32m"Class not found in -exclude list: "[0m[39m + [0m [2m                [0m
[2;36m                    [0m         [39mexclName[0m[1;39m)[0m[39m;[0m                                                                          [2m                [0m
[2;36m                    [0m         [1;36m782[0m[39m:                            [0m[1;39m}[0m                                                   [2m                [0m
[2;36m                    [0m         [1;36m783[0m[39m:                        [0m[1;39m}[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m784[0m[39m:                    [0m[1;39m}[0m                                                           [2m                [0m
[2;36m                    [0m         [1;36m785[0m[39m:[0m                                                                                [2m                [0m
[2;36m                    [0m         [1;36m786[0m[39m:                    [0m[35m/[0m[35m/[0m[39m Create the Composite[0m                                     [2m                [0m
[2;36m                    [0m         [1;36m787[0m[39m:                    loaded = [0m[1;35mcreateComposite[0m[1;39m([0m[39mloadedClass, children, [0m            [2m                [0m
[2;36m                    [0m         [39mexcludeChildren, params,[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m788[0m[39m:                            mimeTypes, loader[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-parsers/tika-parsers-standard/tika-parsers-standard-package/src/test/resources[0m [2m                [0m
[2;36m                    [0m         [39m/org/apache/tika/config/TIKA-[0m[1;36m1702[0m[39m-detector-exclude.xml:[0m[1;36m19[0m[39m-[0m[1;36m30[0m                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:  <!-- Explicitly request default parsers -->[0m                                    [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:  <parsers/>[0m                                                                     [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:  <detectors>[0m                                                                    [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:    <!-- All detectors except built-in container ones -->[0m                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.DefaultDetector"[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.zip.DefaultZipContainerDetector"[0m[35m/[0m[39m>[0m                    [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:      <detector-exclude [0m                                                         [2m                [0m
[2;36m                    [0m         [33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.microsoft.POIFSContainerDetector"[0m[35m/[0m[39m>[0m                   [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:    <!-- One other detector, to check ordering -->[0m                               [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:    <detector [0m[33mclass[0m[39m=[0m[32m"org[0m[32m.apache.tika.detect.EmptyDetector"[0m[39m>[0m                      [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:    <[0m[35m/[0m[95mdetector[0m[39m>[0m                                                                  [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:  <[0m[35m/[0m[95mdetectors[0m[39m>[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<code>[0m                                                                              [2m                [0m
[2;36m                    [0m         [39mtika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.jav[0m[1;92ma:19[0m[39m-[0m[1;36m41[0m         [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m19[0m[39m:import java.io.EOFException;[0m                                                     [2m                [0m
[2;36m                    [0m         [1;36m20[0m[39m:import java.io.IOException;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m21[0m[39m:import java.io.InputStream;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m22[0m[39m:import java.nio.charset.StandardCharsets;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m23[0m[39m:import java.nio.file.Files;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m24[0m[39m:import java.nio.file.Path;[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m25[0m[39m:import java.nio.file.Paths;[0m                                                      [2m                [0m
[2;36m                    [0m         [1;36m26[0m[39m:import java.nio.file.StandardCopyOption;[0m                                         [2m                [0m
[2;36m                    [0m         [1;36m27[0m[39m:import java.util.Locale;[0m                                                         [2m                [0m
[2;36m                    [0m         [1;36m28[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m29[0m[39m:import org.apache.commons.io.FileUtils;[0m                                          [2m                [0m
[2;36m                    [0m         [1;36m30[0m[39m:import org.apache.commons.io.FilenameUtils;[0m                                      [2m                [0m
[2;36m                    [0m         [1;36m31[0m[39m:import org.apache.commons.io.IOUtils;[0m                                            [2m                [0m
[2;36m                    [0m         [1;36m32[0m[39m:import org.apache.commons.io.input.CloseShieldInputStream;[0m                       [2m                [0m
[2;36m                    [0m         [1;36m33[0m[39m:[0m                                                                                 [2m                [0m
[2;36m                    [0m         [1;36m34[0m[39m:import org.apache.tika.io.TikaInputStream;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m35[0m[39m:import org.apache.tika.metadata.Metadata;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m36[0m[39m:import org.apache.tika.metadata.Property;[0m                                        [2m                [0m
[2;36m                    [0m         [1;36m37[0m[39m:import org.apache.tika.metadata.TikaCoreProperties;[0m                              [2m                [0m
[2;36m                    [0m         [1;36m38[0m[39m:import org.apache.tika.mime.MediaType;[0m                                           [2m                [0m
[2;36m                    [0m         [1;36m39[0m[39m:import org.apache.tika.utils.FileProcessResult;[0m                                  [2m                [0m
[2;36m                    [0m         [1;36m40[0m[39m:import org.apache.tika.utils.ProcessUtils;[0m                                       [2m                [0m
[2;36m                    [0m         [1;36m41[0m[39m:import org.apache.tika.utils.StringUtils;[0m                                        [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode[0m[39m>[0m                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mcode_snippets[0m[39m>[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Fix Strategy[0m                                                                     [2m                [0m
[2;36m                    [0m         [39m<fix_strategy>[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Analysis of the Issue[0m                                                            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe evaluation report confirms that the previous patch attempt correctly identified[0m [2m                [0m
[2;36m                    [0m         [39mand modified the vulnerable code in `ShellCodeDetector.java` [0m[1;39m([0m[39mlines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[1;39m)[0m[39m, but [0m   [2m                [0m
[2;36m                    [0m         [39mfailed to modify the META-INF/services configuration file due to permission [0m        [2m                [0m
[2;36m                    [0m         [39mrestrictions. The core issue remains: **OS Command Injection vulnerability caused [0m  [2m                [0m
[2;36m                    [0m         [39mby executing untrusted filenames as shell commands**.[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Root Cause[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35mShellCodeDetector.detect[0m[1;39m([0m[1;39m)[0m[39m` executes embedded file names as shell commands to [0m     [2m                [0m
[2;36m                    [0m         [39mdetermine if they are [0m[32m"no-arg shell scripts"[0m[39m. Even with filename sanitization, [0m     [2m                [0m
[2;36m                    [0m         [39mattackers can embed files with names like [0m[32m"ls"[0m[39m, [0m[32m"env"[0m[39m, [0m[32m"whoami"[0m[39m - valid command [0m    [2m                [0m
[2;36m                    [0m         [39mnames that pass sanitization but execute arbitrary commands.[0m                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Previous Patch Assessment[0m                                                       [2m                [0m
[2;36m                    [0m         [39mThe previous patch correctly:[0m                                                       [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Removed the vulnerable code execution logic [0m[1;39m([0m[39mlines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[1;39m)[0m                       [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Replaced it with a direct return statement after safe detection[0m                  [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Added explanatory comments about the security fix[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe META-INF/services modification failure is **not critical** because:[0m             [2m                [0m
[2;36m                    [0m         [39m- The vulnerable code is removed from the detector implementation itself[0m            [2m                [0m
[2;36m                    [0m         [39m- Even if `ShellCodeDetector` is loaded, it will no longer execute commands[0m         [2m                [0m
[2;36m                    [0m         [39m- The service file modification was defensive [0m[1;39m([0m[39mdisabling loading[0m[1;39m)[0m[39m, not the actual [0m  [2m                [0m
[2;36m                    [0m         [39mfix[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Comprehensive Fix Strategy[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m1[0m[39m. Apply the Core Source Code Fix[0m                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**File: `tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java`**[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Modifications Required:**[0m                                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39ma[0m[1;39m)[0m[39m **Remove vulnerable code execution [0m[1;39m([0m[39mlines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[1;39m)[0m[39m:**[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Delete the entire block that retrieves filename, creates temp files, and [0m      [2m                [0m
[2;36m                    [0m         [39mexecutes commands[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m   - This includes: TikaInputStream usage, filename sanitization, temp directory [0m   [2m                [0m
[2;36m                    [0m         [39mcreation, ProcessBuilder execution, and cleanup[0m                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mb[0m[1;39m)[0m[39m **Simplify the detection logic:**[0m                                                [2m                [0m
[2;36m                    [0m         [39m   - After determining `isShell` is true [0m[1;39m([0m[39mline [0m[1;36m80[0m[39m-[0m[1;36m82[0m[1;39m)[0m[39m, immediately return [0m          [2m                [0m
[2;36m                    [0m         [39m`[0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m`[0m                                                                  [2m                [0m
[2;36m                    [0m         [39m   - This preserves safe detection via filename extensions [0m[1;39m([0m[39m.sh, .bash[0m[1;39m)[0m[39m and shebang[0m [2m                [0m
[2;36m                    [0m         [39mpatterns [0m[1;39m([0m[39m#![0m[35m/[0m[1;39m)[0m                                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mc[0m[1;39m)[0m[39m **Clean up unused imports:**[0m                                                     [2m                [0m
[2;36m                    [0m         [39m   Remove the following imports that become unused after removing execution code:[0m   [2m                [0m
[2;36m                    [0m         [39m   - `java.nio.file.Files`[0m                                                          [2m                [0m
[2;36m                    [0m         [39m   - `java.nio.file.Path` [0m[1;39m([0m[39mif not used elsewhere[0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [39m   - `java.nio.file.Paths`[0m                                                          [2m                [0m
[2;36m                    [0m         [39m   - `java.nio.file.StandardCopyOption`[0m                                             [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.commons.io.FileUtils`[0m                                              [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.commons.io.FilenameUtils`[0m                                          [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.commons.io.input.CloseShieldInputStream`[0m                           [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.tika.io.TikaInputStream`[0m                                           [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.tika.utils.FileProcessResult`[0m                                      [2m                [0m
[2;36m                    [0m         [39m   - `org.apache.tika.utils.ProcessUtils`[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39md[0m[1;39m)[0m[39m **Update class javadoc:**[0m                                                        [2m                [0m
[2;36m                    [0m         [39m   Change line [0m[1;36m44[0m[39m from [0m[32m"Simple detector to determine if a shell script is no-arg [0m   [2m                [0m
[2;36m                    [0m         [32mshell script"[0m[39m to something like [0m[32m"Simple detector to identify shell scripts by [0m      [2m                [0m
[2;36m                    [0m         [32mfilename extension and shebang pattern"[0m                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39me[0m[1;39m)[0m[39m **Retain critical components:**[0m                                                  [2m                [0m
[2;36m                    [0m         [39m   - Keep `SHELL_NO_ARGS` property constant [0m[1;39m([0m[39mline [0m[1;36m48[0m[1;39m)[0m[39m for backward compatibility, [0m  [2m                [0m
[2;36m                    [0m         [39meven though it won't be set[0m                                                         [2m                [0m
[2;36m                    [0m         [39m   - Keep `MAX_LENGTH` constant [0m[1;39m([0m[39mline [0m[1;36m50[0m[1;39m)[0m[39m - can be removed but not harmful to keep[0m  [2m                [0m
[2;36m                    [0m         [39m   - Keep `SHELL_SCRIPT` MediaType constant [0m[1;39m([0m[39mline [0m[1;36m51[0m[1;39m)[0m                               [2m                [0m
[2;36m                    [0m         [39m   - Keep `SNIFF_LENGTH` constant [0m[1;39m([0m[39mline [0m[1;36m52[0m[1;39m)[0m                                         [2m                [0m
[2;36m                    [0m         [39m   - Keep the `[0m[1;35misShell[0m[1;39m([0m[1;39m)[0m[39m` helper method [0m[1;39m([0m[39mlines [0m[1;36m113[0m[39m-[0m[1;36m118[0m[1;39m)[0m                             [2m                [0m
[2;36m                    [0m         [39m   - Keep all safe detection logic [0m[1;39m([0m[39mlines [0m[1;36m54[0m[39m-[0m[1;36m82[0m[1;39m)[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Exact code change for lines [0m[1;36m80[0m[39m-[0m[1;36m110[0m[39m:**[0m                                             [2m                [0m
[2;36m                    [0m         [39m```java[0m                                                                             [2m                [0m
[2;36m                    [0m         [35m/[0m[35m/[0m[39m Before [0m[1;39m([0m[39mlines [0m[1;36m80[0m[39m-[0m[1;36m110[0m[1;39m)[0m[39m:[0m                                                           [2m                [0m
[2;36m                    [0m         [39m        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [39m            return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m        String fileName = [0m[1;35mmetadata.get[0m[1;39m([0m[39mTikaCoreProperties.RESOURCE_NAME_KEY[0m[1;39m)[0m[39m;[0m       [2m                [0m
[2;36m                    [0m         [39m        if [0m[1;39m([0m[1;35mStringUtils.isBlank[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[1;39m)[0m[39m [0m[1;39m{[0m                                        [2m                [0m
[2;36m                    [0m         [39m            return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                                [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[95mnow[0m[39m test for no-arg shell script[0m                                          [2m                [0m
[2;36m                    [0m         [39m        TikaInputStream tis = [0m                                                      [2m                [0m
[2;36m                    [0m         [1;35mTikaInputStream.get[0m[1;39m([0m[1;35mCloseShieldInputStream.wrap[0m[1;39m([0m[39minput[0m[1;39m)[0m[1;39m)[0m[39m;[0m                            [2m                [0m
[2;36m                    [0m         [39m        fileName = [0m[1;35mFilenameUtils.getName[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                 [2m                [0m
[2;36m                    [0m         [39m        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"[0m[32m[[0m[32m^-_0-9A-Za-z.[0m[32m][0m[32m+"[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [39m        fileName = [0m[1;35mfileName.replaceAll[0m[1;39m([0m[32m"\\.\\."[0m[39m, [0m[32m""[0m[1;39m)[0m[39m;[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m        if [0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m > MAX_LENGTH[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [39m            fileName = [0m[1;35mfileName.substring[0m[1;39m([0m[1;35mfileName.length[0m[1;39m([0m[1;39m)[0m[39m - MAX_LENGTH[0m[1;39m)[0m[39m;[0m          [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m        Path cwd = [0m[1;35mPaths.get[0m[1;39m([0m[32m"."[0m[1;39m)[0m[1;35m.toAbsolutePath[0m[1;39m([0m[1;39m)[0m[1;35m.normalize[0m[1;39m([0m[1;39m)[0m[39m;[0m                     [2m                [0m
[2;36m                    [0m         [39m        Path tmpDir = [0m[1;35mFiles.createTempDirectory[0m[1;39m([0m[39mcwd, [0m[32m"tika-shell-detect-"[0m[1;39m)[0m[39m;[0m         [2m                [0m
[2;36m                    [0m         [39m        Path tmpFile = [0m[1;35mtmpDir.resolve[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                                    [2m                [0m
[2;36m                    [0m         [39m        [0m[1;35mFiles.copy[0m[1;39m([0m[1;35mtis.getPath[0m[1;39m([0m[1;39m)[0m[39m, tmpFile, StandardCopyOption.REPLACE_EXISTING[0m[1;39m)[0m[39m;[0m    [2m                [0m
[2;36m                    [0m         [39m        ProcessBuilder pb = new [0m[1;35mProcessBuilder[0m[1;39m([0m[39mfileName[0m[1;39m)[0m[39m;[0m                           [2m                [0m
[2;36m                    [0m         [39m        [0m[1;35mpb.directory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                                              [2m                [0m
[2;36m                    [0m         [39m        try [0m[1;39m{[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m            FileProcessResult result = [0m[1;35mProcessUtils.execute[0m[1;39m([0m[39mpb, [0m[1;36m20000[0m[39m, [0m[1;36m100000[0m[39m, [0m     [2m                [0m
[2;36m                    [0m         [1;36m100000[0m[1;39m)[0m[39m;[0m                                                                            [2m                [0m
[2;36m                    [0m         [39m            if [0m[1;39m([0m[1;35mresult.getExitValue[0m[1;39m([0m[1;39m)[0m[39m == [0m[1;36m0[0m[1;39m)[0m[39m [0m[1;39m{[0m                                       [2m                [0m
[2;36m                    [0m         [39m                [0m[1;35mmetadata.set[0m[1;39m([0m[39mSHELL_NO_ARGS, true[0m[1;39m)[0m[39m;[0m                                  [2m                [0m
[2;36m                    [0m         [39m            [0m[1;39m}[0m                                                                       [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m[39m finally [0m[1;39m{[0m                                                                 [2m                [0m
[2;36m                    [0m         [39m            [0m[1;35mFileUtils.deleteDirectory[0m[1;39m([0m[1;35mtmpDir.toFile[0m[1;39m([0m[1;39m)[0m[1;39m)[0m[39m;[0m                             [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m        return SHELL_SCRIPT;[0m                                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [35m/[0m[35m/[0m[39m After [0m[1;39m([0m[39msimplified[0m[1;39m)[0m[39m:[0m                                                              [2m                [0m
[2;36m                    [0m         [39m        if [0m[1;39m([0m[39m! isShell[0m[1;39m)[0m[39m [0m[1;39m{[0m                                                            [2m                [0m
[2;36m                    [0m         [39m            return MediaType.OCTET_STREAM;[0m                                          [2m                [0m
[2;36m                    [0m         [39m        [0m[1;39m}[0m                                                                           [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m Security fix: Shell script execution during detection has been removed[0m   [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m to prevent OS command injection vulnerability [0m[1;39m([0m[39mCVE-TBD[0m[1;39m)[0m[39m.[0m                 [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m Shell scripts are still correctly detected by:[0m                           [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m [0m[1;36m1[0m[39m. File extension analysis [0m[1;39m([0m[39m.sh, .bash[0m[1;39m)[0m                                  [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m [0m[1;36m2[0m[39m. Shebang pattern detection [0m[1;39m([0m[39m#![0m[35m/bin/[0m[95msh[0m[39m, #![0m[35m/bin/[0m[95mbash[0m[39m, etc.[0m[1;39m)[0m              [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m The SHELL_NO_ARGS metadata is no longer set as it required executing[0m     [2m                [0m
[2;36m                    [0m         [39m        [0m[35m/[0m[35m/[0m[39m untrusted code.[0m                                                          [2m                [0m
[2;36m                    [0m         [39m        return [0m[1;35misShell[0m[1;39m([0m[39misShell[0m[1;39m)[0m[39m;[0m                                                    [2m                [0m
[2;36m                    [0m         [39m```[0m                                                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m2[0m[39m. Do NOT Modify META-INF/services File[0m                                         [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Reasoning:**[0m                                                                      [2m                [0m
[2;36m                    [0m         [39m- The patching system restricts modifications to non-source files[0m                   [2m                [0m
[2;36m                    [0m         [39m- The vulnerability is eliminated by fixing the detector implementation itself[0m      [2m                [0m
[2;36m                    [0m         [39m- Attempting to modify the service file again will result in the same permission [0m   [2m                [0m
[2;36m                    [0m         [39merror[0m                                                                               [2m                [0m
[2;36m                    [0m         [39m- Even if `ShellCodeDetector` is loaded, it will no longer execute commands with [0m   [2m                [0m
[2;36m                    [0m         [39mthe source fix applied[0m                                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m3[0m[39m. Preserve Existing Functionality[0m                                              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**What remains functional:**[0m                                                        [2m                [0m
[2;36m                    [0m         [39m- Shell script detection by filename extension [0m[1;39m([0m[39m.sh, .bash[0m[1;39m)[0m                         [2m                [0m
[2;36m                    [0m         [39m- Shell script detection by shebang pattern [0m[1;39m([0m[39m#![0m[35m/[0m[1;39m)[0m                                   [2m                [0m
[2;36m                    [0m         [39m- Correct MediaType return value [0m[1;39m([0m[39mapplication/x-sh[0m[1;39m)[0m                                 [2m                [0m
[2;36m                    [0m         [39m- Integration with Tika's detector pipeline[0m                                         [2m                [0m
[2;36m                    [0m         [39m- All existing tests for basic shell script detection[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**What is removed:**[0m                                                                [2m                [0m
[2;36m                    [0m         [39m- Execution of shell scripts during detection[0m                                       [2m                [0m
[2;36m                    [0m         [39m- SHELL_NO_ARGS metadata enrichment[0m                                                 [2m                [0m
[2;36m                    [0m         [39m- Any functionality depending on actually running scripts[0m                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### [0m[1;36m4[0m[39m. Testing Considerations[0m                                                       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Tests that should still pass:**[0m                                                   [2m                [0m
[2;36m                    [0m         [39m- `[0m[1;35mTikaDetectionTest.testDetection[0m[1;39m([0m[1;39m)[0m[39m` line [0m[1;36m630[0m[39m: `[0m[1;35massertEquals[0m[1;39m([0m[32m"application/x-sh"[0m[39m, [0m  [2m                [0m
[2;36m                    [0m         [1;35mtika.detect[0m[1;39m([0m[32m"x.sh"[0m[1;39m)[0m[1;39m)[0m[39m`[0m                                                               [2m                [0m
[2;36m                    [0m         [39m- Any tests checking MediaType detection for .sh files[0m                              [2m                [0m
[2;36m                    [0m         [39m- Any tests checking shebang-based detection[0m                                        [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Tests that might need updates [0m[1;39m([0m[39mif they exist[0m[1;39m)[0m[39m:**[0m                                  [2m                [0m
[2;36m                    [0m         [39m- Tests that verify SHELL_NO_ARGS metadata is set[0m                                   [2m                [0m
[2;36m                    [0m         [39m- Tests that depend on script execution behavior[0m                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mHowever, based on the codebase analysis, no test modifications should be necessary [0m [2m                [0m
[2;36m                    [0m         [39mas the patch preserves core detection functionality.[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Justification[0m                                                                    [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Why This is the Optimal Approach[0m                                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Eliminates the vulnerability at the source:** Removes the ProcessBuilder [0m      [2m                [0m
[2;36m                    [0m         [39mexecution code that triggers the OS Command Injection[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Preserves core functionality:** Shell scripts are still correctly detected [0m    [2m                [0m
[2;36m                    [0m         [39mthrough safe methods [0m[1;39m([0m[39mfilename and content analysis[0m[1;39m)[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Backward compatible:** The detector still returns the correct MediaType [0m       [2m                [0m
[2;36m                    [0m         [1;39m([0m[39mapplication/x-sh[0m[1;39m)[0m[39m, maintains the same public API, and keeps the SHELL_NO_ARGS [0m     [2m                [0m
[2;36m                    [0m         [39mproperty constant[0m                                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **No configuration required:** Works with default Tika configurations, TikaCLI, [0m [2m                [0m
[2;36m                    [0m         [39mand the fuzzer without requiring custom config files[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. **Avoids permission issues:** Only modifies Java source code, not [0m               [2m                [0m
[2;36m                    [0m         [39mMETA-INF/services or other resource files[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. **Follows security best practices:** Never executes untrusted content during [0m    [2m                [0m
[2;36m                    [0m         [39mdetection phase[0m                                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Preserves Existing Logic[0m                                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m- **Detection accuracy maintained:** Filename extension and shebang detection are [0m  [2m                [0m
[2;36m                    [0m         [39mindustry-standard methods for identifying shell scripts[0m                             [2m                [0m
[2;36m                    [0m         [39m- **MediaType consistency:** Returns the same MediaType [0m[1;39m([0m[39mapplication/x-sh[0m[1;39m)[0m[39m as [0m      [2m                [0m
[2;36m                    [0m         [39mbefore[0m                                                                              [2m                [0m
[2;36m                    [0m         [39m- **Integration intact:** Implements the same `Detector` interface, works with [0m     [2m                [0m
[2;36m                    [0m         [39m`CompositeDetector` and `DefaultDetector`[0m                                           [2m                [0m
[2;36m                    [0m         [39m- **Metadata compatibility:** The SHELL_NO_ARGS property constant remains defined [0m  [2m                [0m
[2;36m                    [0m         [39mfor any code that references it[0m                                                     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### How It Addresses the Evaluation Report Issues[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. **Initial issue [0m[1;39m([0m[39mOS Command Injection[0m[1;39m)[0m[39m:** Completely eliminated by removing [0m     [2m                [0m
[2;36m                    [0m         [39mProcessBuilder execution[0m                                                            [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. **Patch application failure:** Avoided by not attempting META-INF/services [0m      [2m                [0m
[2;36m                    [0m         [39mmodification[0m                                                                        [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. **Fuzzer security exception:** Will no longer occur as no commands are executed[0m  [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. **PackageParser flow:** Safe detection still works when processing embedded [0m     [2m                [0m
[2;36m                    [0m         [39mfiles[0m                                                                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Potential Side Effects and Mitigation[0m                                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Side Effect [0m[1;36m1[0m[39m: SHELL_NO_ARGS metadata no longer set**[0m                             [2m                [0m
[2;36m                    [0m         [39m- **Impact:** Code that depends on this metadata will no longer receive it[0m          [2m                [0m
[2;36m                    [0m         [39m- **Mitigation:** This is acceptable because:[0m                                       [2m                [0m
[2;36m                    [0m         [39m  - The metadata enrichment required executing untrusted code [0m[1;39m([0m[39msecurity risk[0m[1;39m)[0m       [2m                [0m
[2;36m                    [0m         [39m  - It's an optional enhancement, not core functionality[0m                            [2m                [0m
[2;36m                    [0m         [39m  - The property constant remains defined for backward compatibility[0m                [2m                [0m
[2;36m                    [0m         [39m  - Documentation can note this security-motivated change[0m                           [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Side Effect [0m[1;36m2[0m[39m: Detection of [0m[32m"no-arg shell scripts"[0m[39m lost**[0m                         [2m                [0m
[2;36m                    [0m         [39m- **Impact:** Cannot distinguish scripts that run without arguments from those that[0m [2m                [0m
[2;36m                    [0m         [39mrequire arguments[0m                                                                   [2m                [0m
[2;36m                    [0m         [39m- **Mitigation:** This is acceptable because:[0m                                       [2m                [0m
[2;36m                    [0m         [39m  - The distinction requires executing the script [0m[1;39m([0m[39mfundamentally unsafe[0m[1;39m)[0m            [2m                [0m
[2;36m                    [0m         [39m  - Basic shell script detection [0m[1;39m([0m[39mthe primary use case[0m[1;39m)[0m[39m is preserved[0m                [2m                [0m
[2;36m                    [0m         [39m  - Users who need this can implement custom detectors with proper sandboxing[0m       [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Side Effect [0m[1;36m3[0m[39m: Unused imports remain [0m[1;39m([0m[39mif not cleaned[0m[1;39m)[0m[39m**[0m                           [2m                [0m
[2;36m                    [0m         [39m- **Impact:** Minor code quality issue[0m                                              [2m                [0m
[2;36m                    [0m         [39m- **Mitigation:** Remove all unused imports as specified in the fix[0m                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Similar Solutions in Codebase[0m                                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix follows patterns seen in `FileCommandDetector`:[0m                             [2m                [0m
[2;36m                    [0m         [39m- Uses safe external process execution [0m[1;39m([0m[39mtrusted tool with escaped arguments[0m[1;39m)[0m        [2m                [0m
[2;36m                    [0m         [39m- Has explicit security warnings about command execution[0m                            [2m                [0m
[2;36m                    [0m         [39m- Provides configuration options but defaults to safe behavior[0m                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39mThe fix aligns with Tika's security model where:[0m                                    [2m                [0m
[2;36m                    [0m         [39m- Detectors should not execute untrusted code[0m                                       [2m                [0m
[2;36m                    [0m         [39m- Detection should be based on file content analysis, not execution[0m                 [2m                [0m
[2;36m                    [0m         [39m- Security takes precedence over feature richness[0m                                   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m### Comparison with Alternative Approaches[0m                                          [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m1[0m[39m: Sandboxing script execution**[0m                                      [2m                [0m
[2;36m                    [0m         [39m- **Rejected because:** Would require complex OS-level sandboxing, container [0m       [2m                [0m
[2;36m                    [0m         [39mintegration, or JVM security managers; adds significant complexity and attack [0m      [2m                [0m
[2;36m                    [0m         [39msurface[0m                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m2[0m[39m: XML configuration to exclude detector**[0m                            [2m                [0m
[2;36m                    [0m         [39m- **Rejected because:** Requires users to provide custom configs; doesn't fix the [0m  [2m                [0m
[2;36m                    [0m         [39munderlying vulnerability; fuzzer uses default config[0m                                [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m3[0m[39m: Command whitelist/blacklist**[0m                                      [2m                [0m
[2;36m                    [0m         [39m- **Rejected because:** Cannot reliably prevent all malicious commands; attackers [0m  [2m                [0m
[2;36m                    [0m         [39mcan use legitimate commands maliciously [0m[1;39m([0m[39me.g., [0m[32m"env"[0m[39m leaks environment variables[0m[1;39m)[0m   [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m**Alternative [0m[1;36m4[0m[39m: Removing ShellCodeDetector entirely**[0m                              [2m                [0m
[2;36m                    [0m         [39m- **Rejected because:** Breaks legitimate use cases for shell script detection; [0m    [2m                [0m
[2;36m                    [0m         [39mmore disruptive than necessary[0m                                                      [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m## Implementation Steps[0m                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m1[0m[39m. Open `tika-core/src/main/java/org/apache/tika/detect/ShellCodeDetector.java`[0m     [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m2[0m[39m. Replace lines [0m[1;36m83[0m[39m-[0m[1;36m110[0m[39m with the simplified return statement and security comment [0m  [2m                [0m
[2;36m                    [0m         [39mas specified above[0m                                                                  [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m3[0m[39m. Remove unused imports from lines [0m[1;36m19[0m[39m-[0m[1;36m41[0m[39m as listed[0m                                 [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m4[0m[39m. Update class javadoc on line [0m[1;36m44[0m[39m if desired [0m[1;39m([0m[39moptional but recommended[0m[1;39m)[0m            [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m5[0m[39m. Verify the `[0m[1;35misShell[0m[1;39m([0m[1;39m)[0m[39m` helper method [0m[1;39m([0m[39mlines [0m[1;36m113[0m[39m-[0m[1;36m118[0m[1;39m)[0m[39m remains intact[0m              [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m6[0m[39m. Keep all constants [0m[1;39m([0m[39mSHELL_NO_ARGS, MAX_LENGTH, SHELL_SCRIPT, SNIFF_LENGTH[0m[1;39m)[0m[39m [0m      [2m                [0m
[2;36m                    [0m         [39mdefined[0m                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m7[0m[39m. Do NOT attempt to modify any META-INF/services files[0m                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [1;36m8[0m[39m. Build and test to ensure:[0m                                                        [2m                [0m
[2;36m                    [0m         [39m   - Compilation succeeds[0m                                                           [2m                [0m
[2;36m                    [0m         [39m   - Shell script detection still works for .sh files[0m                               [2m                [0m
[2;36m                    [0m         [39m   - Shebang detection still works[0m                                                  [2m                [0m
[2;36m                    [0m         [39m   - No security exceptions are thrown during fuzzing[0m                               [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m                                                                                             [2m                [0m
[2;36m                    [0m         [39m<[0m[35m/[0m[95mfix_strategy[0m[1m>[0m                                                                     [2m                [0m
[2;36m                    [0m         ===Evaluation [33mEnd[0m===                                                                [2m                [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Prism Supervisor Routing: TeamStatus.EVALUATE -> TeamStatus.END                      ]8;id=485605;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=258528;file:///home/qqor/crete/packages/crete/framework/agent/services/prism/__init__.py#160\[2m160[0m]8;;\
[2;36m                    [0m         [1m([0mn evals: [1;36m3[0m, patch status: PatchStatus.SOUND[1m)[0m                                        [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Building environment                                                                 ]8;id=976948;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py\[2m__init__.py[0m]8;;\[2m:[0m]8;id=40772;file:///home/qqor/crete/packages/crete/framework/context_builder/services/aixcc/__init__.py#132\[2m132[0m]8;;\
[2;36m                    [0m         - Cache directory: [35m/tmp/[0m[95mtmp3ifd09z2[0m                                                  [2m               [0m
[2;36m                    [0m         - Max timeout: [1;36m1800[0m                                                                  [2m               [0m
[2;36m                    [0m         - Output directory:                                                                  [2m               [0m
[2;36m                    [0m         [35m/home/qqor/crete/reports/prism.prism_claude_sonnet_4_5/tika_tk-full-01_vuln_8/[0m[95magent-[0m [2m               [0m
[2;36m                    [0m         [95moutput-1767888718.845419[0m                                                             [2m               [0m
[2;36m                    [0m         - Detection toml file: scripts/benchmark/afc-delta-full/tika_tk-full-01_vuln_8.toml  [2m               [0m
[2;36m                    [0m         - Challenge project directory: [35m/home/qqor/crete/.cache/[0m[95mofficial-afc-tika[0m             [2m               [0m
[2;36m                    [0m                                                                                              [2m               [0m
[2;36m[01/08/26 16:12:00][0m[2;36m [0m[34mINFO    [0m Deleting environments directory: [35m/home/qqor/crete/.cache/environments/[0m[95mtika[0m           ]8;id=204976;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=331521;file:///home/qqor/crete/scripts/benchmark/__main__.py#300\[2m300[0m]8;;\
[2;36m[01/08/26 16:12:01][0m[2;36m [0m[34mINFO    [0m Deleted work directory:                                                              ]8;id=13769;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=162825;file:///home/qqor/crete/scripts/benchmark/__main__.py#314\[2m314[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/work/[0m[95mtika[0m                  [2m               [0m
[2;36m                   [0m[2;36m [0m[34mINFO    [0m Deleted out directory:                                                               ]8;id=393553;file:///home/qqor/crete/scripts/benchmark/__main__.py\[2m__main__.py[0m]8;;\[2m:[0m]8;id=700114;file:///home/qqor/crete/scripts/benchmark/__main__.py#321\[2m321[0m]8;;\
[2;36m                    [0m         [35m/home/qqor/crete/packages/python_oss_fuzz/.oss_fuzz/build/out/[0m[95mtika[0m                   [2m               [0m
