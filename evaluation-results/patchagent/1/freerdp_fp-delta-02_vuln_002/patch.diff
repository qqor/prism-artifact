diff --git a/libfreerdp/crypto/x509_utils.c b/libfreerdp/crypto/x509_utils.c
index 7a24a35..8888a79 100644
--- a/libfreerdp/crypto/x509_utils.c
+++ b/libfreerdp/crypto/x509_utils.c
@@ -448,14 +448,19 @@ BOOL x509_validate_subject_aternative_names(const X509* cert) {
         GENERAL_NAME *gen_name = sk_GENERAL_NAME_value(san_names, i);
 
         if (gen_name->type == GEN_DNS) {
-			// Allocate string length + 1 for security
-			dns_name = malloc( strlen((char *)ASN1_STRING_get0_data(gen_name->d.dNSName)) + 1);
-
-			if (dns_name == NULL)
-				goto end;
-			
-			memcpy(dns_name, (char *)ASN1_STRING_get0_data(gen_name->d.dNSName),  
-				ASN1_STRING_length(gen_name->d.dNSName)) ;
+            /* Allocate buffer based on ASN1 string length and null-terminate */
+            {
+                size_t name_len = ASN1_STRING_length(gen_name->d.dNSName);
+                const unsigned char* src = ASN1_STRING_get0_data(gen_name->d.dNSName);
+
+                dns_name = malloc(name_len + 1);
+                if (dns_name == NULL)
+                    goto end;
+
+                /* Copy raw data and add null terminator */
+                memcpy(dns_name, src, name_len);
+                dns_name[name_len] = '\0';
+            }
 			
             if (!verify_san(dns_name)) {
 				free(dns_name);
@@ -469,7 +474,7 @@ BOOL x509_validate_subject_aternative_names(const X509* cert) {
 
 end:
     sk_GENERAL_NAME_pop_free(san_names, GENERAL_NAME_free);
-
+    return result;
 	return TRUE;
 }
 
