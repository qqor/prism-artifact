diff --git a/src/shared/condition.c b/src/shared/condition.c
index 67894f9..2c1e874 100644
--- a/src/shared/condition.c
+++ b/src/shared/condition.c
@@ -97,11 +97,27 @@ Condition* condition_free(Condition *c) {
 }
 
 Condition* condition_free_list_type(Condition *head, ConditionType type) {
-        LIST_FOREACH(conditions, c, head)
-                if (type < 0 || c->type == type) {
+        /* Safely free conditions matching the given type */
+        Condition *c, *n;
+
+        if (type < 0) {
+                /* Free all conditions */
+                while ((c = LIST_POP(conditions, head))) {
                         condition_free(c);
                 }
+        } else {
+                /* Free only conditions of the specified type */
+                for (c = head; c; c = n) {
+                        n = c->conditions_next;
+
+                        if (c->type == type) {
+                                LIST_REMOVE(conditions, head, c);
+                                condition_free(c);
+                        }
+                }
+        }
 
+        /* After freeing all (_CONDITION_TYPE_INVALID), head should be NULL */
         assert(type >= 0 || !head);
         return head;
 }
