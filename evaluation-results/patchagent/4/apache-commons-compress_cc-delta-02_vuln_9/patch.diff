diff --git a/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java b/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java
index 63ded15..0c24fc8 100644
--- a/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java
+++ b/src/main/java/org/apache/commons/compress/compressors/z/ZCompressorInputStream.java
@@ -35,6 +35,7 @@ public class ZCompressorInputStream extends LZWInputStream {
     private static final int MAGIC_1 = 0x1f;
     private static final int MAGIC_2 = 0x9d;
     private static final int BLOCK_MODE_MASK = 0x80;
+    private static final int MAX_ALLOWED_CODE_SIZE = 16;
     private static final int MAX_CODE_SIZE_MASK = 0x1f;
 
     /**
@@ -80,6 +81,10 @@ public ZCompressorInputStream(final InputStream inputStream, final int memoryLim
         }
         blockMode = (thirdByte & BLOCK_MODE_MASK) != 0;
         maxCodeSize = thirdByte & MAX_CODE_SIZE_MASK;
+        if (maxCodeSize < DEFAULT_CODE_SIZE || maxCodeSize > MAX_ALLOWED_CODE_SIZE) {
+            throw new IOException("Invalid maxCodeSize: " + maxCodeSize);
+        }
+        
         if (blockMode) {
             setClearCode(DEFAULT_CODE_SIZE);
         }
